exports.id=275,exports.ids=[275],exports.modules={59601:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.addAdminServicesToServer=S.registerAdminService=void 0;let R=[];function N(T,S){R.push({getServiceDefinition:T,getHandlers:S})}function O(T){for(let{getServiceDefinition:S,getHandlers:N}of R)T.addService(S(),N())}S.registerAdminService=N,S.addAdminServicesToServer=O},84934:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.BackoffTimeout=void 0;let R=1e3,N=1.6,O=12e4,P=.2;function M(T,S){return Math.random()*(S-T)+T}class L{constructor(T,S){this.callback=T,this.initialDelay=R,this.multiplier=N,this.maxDelay=O,this.jitter=P,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,S&&(S.initialDelay&&(this.initialDelay=S.initialDelay),S.multiplier&&(this.multiplier=S.multiplier),S.jitter&&(this.jitter=S.jitter),S.maxDelay&&(this.maxDelay=S.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(T){var S,R;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},T),this.hasRef||null===(R=(S=this.timerId).unref)||void 0===R||R.call(S)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let T=Math.min(this.nextDelay*this.multiplier,this.maxDelay),S=T*this.jitter;this.nextDelay=T+M(-S,S)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let T=new Date,S=this.startTime;S.setMilliseconds(S.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),T<S?this.runTimer(S.getTime()-T.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var T,S;this.hasRef=!0,null===(S=(T=this.timerId).ref)||void 0===S||S.call(T)}unref(){var T,S;this.hasRef=!1,null===(S=(T=this.timerId).unref)||void 0===S||S.call(T)}getEndTime(){return this.endTime}}S.BackoffTimeout=L},78931:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.CallCredentials=void 0;let N=R(62252);function O(T){return"getRequestHeaders"in T&&"function"==typeof T.getRequestHeaders}class P{static createFromMetadataGenerator(T){return new L(T)}static createFromGoogleCredential(T){return P.createFromMetadataGenerator((S,R)=>{let P;(P=O(T)?T.getRequestHeaders(S.service_url):new Promise((R,N)=>{T.getRequestMetadata(S.service_url,(T,S)=>{if(T){N(T);return}if(!S){N(Error("Headers not set by metadata plugin"));return}R(S)})})).then(T=>{let S=new N.Metadata;for(let R of Object.keys(T))S.add(R,T[R]);R(null,S)},T=>{R(T)})})}static createEmpty(){return new U}}S.CallCredentials=P;class M extends P{constructor(T){super(),this.creds=T}async generateMetadata(T){let S=new N.Metadata;for(let R of(await Promise.all(this.creds.map(S=>S.generateMetadata(T)))))S.merge(R);return S}compose(T){return new M(this.creds.concat([T]))}_equals(T){return this===T||T instanceof M&&this.creds.every((S,R)=>S._equals(T.creds[R]))}}class L extends P{constructor(T){super(),this.metadataGenerator=T}generateMetadata(T){return new Promise((S,R)=>{this.metadataGenerator(T,(T,N)=>{void 0!==N?S(N):R(T)})})}compose(T){return new M([this,T])}_equals(T){return this===T||T instanceof L&&this.metadataGenerator===T.metadataGenerator}}class U extends P{generateMetadata(T){return Promise.resolve(new N.Metadata)}compose(T){return T}_equals(T){return T instanceof U}}},46749:(T,S)=>{"use strict";function R(T){return void 0!==T.onReceiveMetadata&&1===T.onReceiveMetadata.length}Object.defineProperty(S,"__esModule",{value:!0}),S.InterceptingListenerImpl=S.isInterceptingListener=void 0,S.isInterceptingListener=R;class N{constructor(T,S){this.listener=T,this.nextListener=S,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(T){this.processingMetadata=!0,this.listener.onReceiveMetadata(T,T=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(T),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(T){this.processingMessage=!0,this.listener.onReceiveMessage(T,T=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=T,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(T),this.processPendingStatus())})}onReceiveStatus(T){this.listener.onReceiveStatus(T,T=>{this.processingMetadata||this.processingMessage?this.pendingStatus=T:this.nextListener.onReceiveStatus(T)})}}S.InterceptingListenerImpl=N},38445:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getNextCallNumber=void 0;let R=0;function N(){return R++}S.getNextCallNumber=N},78439:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ClientDuplexStreamImpl=S.ClientWritableStreamImpl=S.ClientReadableStreamImpl=S.ClientUnaryCallImpl=S.callErrorFromStatus=void 0;let N=R(82361),O=R(12781),P=R(32678);function M(T,S){let R=`${T.code} ${P.Status[T.code]}: ${T.details}`,N=Error(R),O=`${N.stack}
for call at
${S}`;return Object.assign(Error(R),T,{stack:O})}S.callErrorFromStatus=M;class L extends N.EventEmitter{constructor(){super()}cancel(){var T;null===(T=this.call)||void 0===T||T.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var T,S;return null!==(S=null===(T=this.call)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:"unknown"}}S.ClientUnaryCallImpl=L;class U extends O.Readable{constructor(T){super({objectMode:!0}),this.deserialize=T}cancel(){var T;null===(T=this.call)||void 0===T||T.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var T,S;return null!==(S=null===(T=this.call)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:"unknown"}_read(T){var S;null===(S=this.call)||void 0===S||S.startRead()}}S.ClientReadableStreamImpl=U;class V extends O.Writable{constructor(T){super({objectMode:!0}),this.serialize=T}cancel(){var T;null===(T=this.call)||void 0===T||T.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var T,S;return null!==(S=null===(T=this.call)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:"unknown"}_write(T,S,R){var N;let O={callback:R},P=Number(S);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,T)}_final(T){var S;null===(S=this.call)||void 0===S||S.halfClose(),T()}}S.ClientWritableStreamImpl=V;class $ extends O.Duplex{constructor(T,S){super({objectMode:!0}),this.serialize=T,this.deserialize=S}cancel(){var T;null===(T=this.call)||void 0===T||T.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var T,S;return null!==(S=null===(T=this.call)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:"unknown"}_read(T){var S;null===(S=this.call)||void 0===S||S.startRead()}_write(T,S,R){var N;let O={callback:R},P=Number(S);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,T)}_final(T){var S;null===(S=this.call)||void 0===S||S.halfClose(),T()}}S.ClientDuplexStreamImpl=$},92528:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ChannelCredentials=void 0;let N=R(24404),O=R(78931),P=R(43009);function M(T,S){if(T&&!(T instanceof Buffer))throw TypeError(`${S}, if provided, must be a Buffer.`)}class L{constructor(T){this.callCredentials=T||O.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(T,S,R,O){var L;if(M(T,"Root certificate"),M(S,"Private key"),M(R,"Certificate chain"),S&&!R)throw Error("Private key must be given with accompanying certificate chain");if(!S&&R)throw Error("Certificate chain must be given with accompanying private key");return new V((0,N.createSecureContext)({ca:null!==(L=null!=T?T:(0,P.getDefaultRootsData)())&&void 0!==L?L:void 0,key:null!=S?S:void 0,cert:null!=R?R:void 0,ciphers:P.CIPHER_SUITES}),null!=O?O:{})}static createFromSecureContext(T,S){return new V(T,null!=S?S:{})}static createInsecure(){return new U}}S.ChannelCredentials=L;class U extends L{constructor(T){super(T)}compose(T){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(T){return T instanceof U}}class V extends L{constructor(T,S){super(),this.secureContext=T,this.verifyOptions=S,this.connectionOptions={secureContext:T},(null==S?void 0:S.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=S.checkServerIdentity)}compose(T){return new $(this,this.callCredentials.compose(T))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(T){return this===T||T instanceof V&&this.secureContext===T.secureContext&&this.verifyOptions.checkServerIdentity===T.verifyOptions.checkServerIdentity}}class $ extends L{constructor(T,S){super(S),this.channelCredentials=T}compose(T){let S=this.callCredentials.compose(T);return new $(this.channelCredentials,S)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(T){return this===T||T instanceof $&&this.channelCredentials._equals(T.channelCredentials)&&this.callCredentials._equals(T.callCredentials)}}},79387:(T,S)=>{"use strict";function R(T,S){let R=Object.keys(T).sort(),N=Object.keys(S).sort();if(R.length!==N.length)return!1;for(let O=0;O<R.length;O+=1)if(R[O]!==N[O]||T[R[O]]!==S[N[O]])return!1;return!0}Object.defineProperty(S,"__esModule",{value:!0}),S.channelOptionsEqual=S.recognizedOptions=void 0,S.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},S.channelOptionsEqual=R},46261:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ChannelImplementation=void 0;let N=R(92528),O=R(21118);class P{constructor(T,S,R){if("string"!=typeof T)throw TypeError("Channel target must be a string");if(!(S instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.internalChannel=new O.InternalChannel(T,S,R)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(T){return this.internalChannel.getConnectivityState(T)}watchConnectivityState(T,S,R){this.internalChannel.watchConnectivityState(T,S,R)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(T,S,R,N,O){if("string"!=typeof T)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof S||S instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(T,S,R,N,O)}}S.ChannelImplementation=P},5993:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=S.getChannelzServiceDefinition=S.getChannelzHandlers=S.unregisterChannelzRef=S.registerChannelzSocket=S.registerChannelzServer=S.registerChannelzSubchannel=S.registerChannelzChannel=S.ChannelzCallTracker=S.ChannelzChildrenTracker=S.ChannelzTrace=void 0;let N=R(41808),O=R(33955),P=R(32678),M=R(23906),L=R(59601),U=R(35085);function V(T){return{channel_id:T.id,name:T.name}}function $(T){return{subchannel_id:T.id,name:T.name}}function K(T){return{server_id:T.id}}function W(T){return{socket_id:T.id,name:T.name}}let Q=32;class Y{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(T,S,R){let N=new Date;this.events.push({description:S,severity:T,timestamp:N,childChannel:(null==R?void 0:R.kind)==="channel"?R:void 0,childSubchannel:(null==R?void 0:R.kind)==="subchannel"?R:void 0}),this.events.length>=2*Q&&(this.events=this.events.slice(Q)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:eg(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(T=>({description:T.description,severity:T.severity,timestamp:eg(T.timestamp),channel_ref:T.childChannel?V(T.childChannel):null,subchannel_ref:T.childSubchannel?$(T.childSubchannel):null}))}}}S.ChannelzTrace=Y;class X{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(T){var S,R,N;switch(T.kind){case"channel":{let R=null!==(S=this.channelChildren.get(T.id))&&void 0!==S?S:{ref:T,count:0};R.count+=1,this.channelChildren.set(T.id,R);break}case"subchannel":{let S=null!==(R=this.subchannelChildren.get(T.id))&&void 0!==R?R:{ref:T,count:0};S.count+=1,this.subchannelChildren.set(T.id,S);break}case"socket":{let S=null!==(N=this.socketChildren.get(T.id))&&void 0!==N?N:{ref:T,count:0};S.count+=1,this.socketChildren.set(T.id,S)}}}unrefChild(T){switch(T.kind){case"channel":{let S=this.channelChildren.get(T.id);void 0!==S&&(S.count-=1,0===S.count?this.channelChildren.delete(T.id):this.channelChildren.set(T.id,S));break}case"subchannel":{let S=this.subchannelChildren.get(T.id);void 0!==S&&(S.count-=1,0===S.count?this.subchannelChildren.delete(T.id):this.subchannelChildren.set(T.id,S));break}case"socket":{let S=this.socketChildren.get(T.id);void 0!==S&&(S.count-=1,0===S.count?this.socketChildren.delete(T.id):this.socketChildren.set(T.id,S))}}}getChildLists(){let T=[];for(let{ref:S}of this.channelChildren.values())T.push(S);let S=[];for(let{ref:T}of this.subchannelChildren.values())S.push(T);let R=[];for(let{ref:T}of this.socketChildren.values())R.push(T);return{channels:T,subchannels:S,sockets:R}}}S.ChannelzChildrenTracker=X;class Z{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}S.ChannelzCallTracker=Z;let ee=1;function et(){return ee++}let er=[],en=[],ei=[],es=[];function ea(T,S,R){let N=et(),O={id:N,name:T,kind:"channel"};return R&&(er[N]={ref:O,getInfo:S}),O}function eo(T,S,R){let N=et(),O={id:N,name:T,kind:"subchannel"};return R&&(en[N]={ref:O,getInfo:S}),O}function eu(T,S){let R=et(),N={id:R,kind:"server"};return S&&(ei[R]={ref:N,getInfo:T}),N}function ec(T,S,R){let N=et(),O={id:N,name:T,kind:"socket"};return R&&(es[N]={ref:O,getInfo:S}),O}function ed(T){switch(T.kind){case"channel":delete er[T.id];return;case"subchannel":delete en[T.id];return;case"server":delete ei[T.id];return;case"socket":delete es[T.id];return}}function eh(T){let S=Number.parseInt(T,16);return[S/256|0,S%256]}function ep(T){return""===T?[]:[].concat(...T.split(":").map(T=>eh(T)))}function ef(T){if((0,N.isIPv4)(T))return Buffer.from(Uint8Array.from(T.split(".").map(T=>Number.parseInt(T))));if(!(0,N.isIPv6)(T))return null;{let S,R;let N=T.indexOf("::");-1===N?(S=T,R=""):(S=T.substring(0,N),R=T.substring(N+2));let O=Buffer.from(ep(S)),P=Buffer.from(ep(R)),M=Buffer.alloc(16-O.length-P.length,0);return Buffer.concat([O,M,P])}}function em(T){switch(T){case O.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case O.ConnectivityState.IDLE:return{state:"IDLE"};case O.ConnectivityState.READY:return{state:"READY"};case O.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case O.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function eg(T){if(!T)return null;let S=T.getTime();return{seconds:S/1e3|0,nanos:S%1e3*1e6}}function ey(T){let S=T.getInfo();return{ref:V(T.ref),data:{target:S.target,state:em(S.state),calls_started:S.callTracker.callsStarted,calls_succeeded:S.callTracker.callsSucceeded,calls_failed:S.callTracker.callsFailed,last_call_started_timestamp:eg(S.callTracker.lastCallStartedTimestamp),trace:S.trace.getTraceMessage()},channel_ref:S.children.channels.map(T=>V(T)),subchannel_ref:S.children.subchannels.map(T=>$(T))}}function ev(T,S){let R=Number.parseInt(T.request.channel_id),N=er[R];if(void 0===N){S({code:P.Status.NOT_FOUND,details:"No channel data found for id "+R});return}S(null,{channel:ey(N)})}function eb(T,S){let R=Number.parseInt(T.request.max_results),N=[],O=Number.parseInt(T.request.start_channel_id);for(;O<er.length;O++){let T=er[O];if(void 0!==T&&(N.push(ey(T)),N.length>=R))break}S(null,{channel:N,end:O>=ei.length})}function eT(T){let S=T.getInfo();return{ref:K(T.ref),data:{calls_started:S.callTracker.callsStarted,calls_succeeded:S.callTracker.callsSucceeded,calls_failed:S.callTracker.callsFailed,last_call_started_timestamp:eg(S.callTracker.lastCallStartedTimestamp),trace:S.trace.getTraceMessage()},listen_socket:S.listenerChildren.sockets.map(T=>W(T))}}function eS(T,S){let R=Number.parseInt(T.request.server_id),N=ei[R];if(void 0===N){S({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}S(null,{server:eT(N)})}function eE(T,S){let R=Number.parseInt(T.request.max_results),N=[],O=Number.parseInt(T.request.start_server_id);for(;O<ei.length;O++){let T=ei[O];if(void 0!==T&&(N.push(eT(T)),N.length>=R))break}S(null,{server:N,end:O>=ei.length})}function e_(T,S){let R=Number.parseInt(T.request.subchannel_id),N=en[R];if(void 0===N){S({code:P.Status.NOT_FOUND,details:"No subchannel data found for id "+R});return}let O=N.getInfo();S(null,{subchannel:{ref:$(N.ref),data:{target:O.target,state:em(O.state),calls_started:O.callTracker.callsStarted,calls_succeeded:O.callTracker.callsSucceeded,calls_failed:O.callTracker.callsFailed,last_call_started_timestamp:eg(O.callTracker.lastCallStartedTimestamp),trace:O.trace.getTraceMessage()},socket_ref:O.children.sockets.map(T=>W(T))}})}function ew(T){var S;return(0,M.isTcpSubchannelAddress)(T)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(S=ef(T.host))&&void 0!==S?S:void 0,port:T.port}}:{address:"uds_address",uds_address:{filename:T.path}}}function eC(T,S){var R,N,O,M,L;let U=Number.parseInt(T.request.socket_id),V=es[U];if(void 0===V){S({code:P.Status.NOT_FOUND,details:"No socket data found for id "+U});return}let $=V.getInfo(),K=$.security?{model:"tls",tls:{cipher_suite:$.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(R=$.security.cipherSuiteStandardName)&&void 0!==R?R:void 0,other_name:null!==(N=$.security.cipherSuiteOtherName)&&void 0!==N?N:void 0,local_certificate:null!==(O=$.security.localCertificate)&&void 0!==O?O:void 0,remote_certificate:null!==(M=$.security.remoteCertificate)&&void 0!==M?M:void 0}}:null;S(null,{socket:{ref:W(V.ref),local:$.localAddress?ew($.localAddress):null,remote:$.remoteAddress?ew($.remoteAddress):null,remote_name:null!==(L=$.remoteName)&&void 0!==L?L:void 0,security:K,data:{keep_alives_sent:$.keepAlivesSent,streams_started:$.streamsStarted,streams_succeeded:$.streamsSucceeded,streams_failed:$.streamsFailed,last_local_stream_created_timestamp:eg($.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:eg($.lastRemoteStreamCreatedTimestamp),messages_received:$.messagesReceived,messages_sent:$.messagesSent,last_message_received_timestamp:eg($.lastMessageReceivedTimestamp),last_message_sent_timestamp:eg($.lastMessageSentTimestamp),local_flow_control_window:$.localFlowControlWindow?{value:$.localFlowControlWindow}:null,remote_flow_control_window:$.remoteFlowControlWindow?{value:$.remoteFlowControlWindow}:null}}})}function eI(T,S){let R=Number.parseInt(T.request.server_id),N=ei[R];if(void 0===N){S({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}let O=Number.parseInt(T.request.start_socket_id),M=Number.parseInt(T.request.max_results),L=N.getInfo().sessionChildren.sockets.sort((T,S)=>T.id-S.id),U=[],V=0;for(;V<L.length&&(!(L[V].id>=O)||(U.push(W(L[V])),!(U.length>=M)));V++);S(null,{socket_ref:U,end:V>=L.length})}function eR(){return{GetChannel:ev,GetTopChannels:eb,GetServer:eS,GetServers:eE,GetSubchannel:e_,GetSocket:eC,GetServerSockets:eI}}S.registerChannelzChannel=ea,S.registerChannelzSubchannel=eo,S.registerChannelzServer=eu,S.registerChannelzSocket=ec,S.unregisterChannelzRef=ed,S.getChannelzHandlers=eR;let ek=null;function eN(){if(ek)return ek;let T=(0,R(58715).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return ek=(0,U.loadPackageDefinition)(T).grpc.channelz.v1.Channelz.service}function eA(){(0,L.registerAdminService)(eN,eR)}S.getChannelzServiceDefinition=eN,S.setup=eA},68601:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getInterceptingCall=S.InterceptingCall=S.RequesterBuilder=S.ListenerBuilder=S.InterceptorConfigurationError=void 0;let N=R(62252),O=R(46749),P=R(32678),M=R(75437);class L extends Error{constructor(T){super(T),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,L)}}S.InterceptorConfigurationError=L;class U{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(T){return this.metadata=T,this}withOnReceiveMessage(T){return this.message=T,this}withOnReceiveStatus(T){return this.status=T,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}S.ListenerBuilder=U;class V{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(T){return this.start=T,this}withSendMessage(T){return this.message=T,this}withHalfClose(T){return this.halfClose=T,this}withCancel(T){return this.cancel=T,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}S.RequesterBuilder=V;let $={onReceiveMetadata:(T,S)=>{S(T)},onReceiveMessage:(T,S)=>{S(T)},onReceiveStatus:(T,S)=>{S(T)}},K={start:(T,S,R)=>{R(T,S)},sendMessage:(T,S)=>{S(T)},halfClose:T=>{T()},cancel:T=>{T()}};class W{constructor(T,S){var R,N,O,P;this.nextCall=T,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,S?this.requester={start:null!==(R=S.start)&&void 0!==R?R:K.start,sendMessage:null!==(N=S.sendMessage)&&void 0!==N?N:K.sendMessage,halfClose:null!==(O=S.halfClose)&&void 0!==O?O:K.halfClose,cancel:null!==(P=S.cancel)&&void 0!==P?P:K.cancel}:this.requester=K}cancelWithStatus(T,S){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(T,S)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(T,S){var R,N,P,M,L,U;let V={onReceiveMetadata:null!==(N=null===(R=null==S?void 0:S.onReceiveMetadata)||void 0===R?void 0:R.bind(S))&&void 0!==N?N:T=>{},onReceiveMessage:null!==(M=null===(P=null==S?void 0:S.onReceiveMessage)||void 0===P?void 0:P.bind(S))&&void 0!==M?M:T=>{},onReceiveStatus:null!==(U=null===(L=null==S?void 0:S.onReceiveStatus)||void 0===L?void 0:L.bind(S))&&void 0!==U?U:T=>{}};this.processingMetadata=!0,this.requester.start(T,V,(T,S)=>{var R,N,P;let M;if(this.processingMetadata=!1,(0,O.isInterceptingListener)(S))M=S;else{let T={onReceiveMetadata:null!==(R=S.onReceiveMetadata)&&void 0!==R?R:$.onReceiveMetadata,onReceiveMessage:null!==(N=S.onReceiveMessage)&&void 0!==N?N:$.onReceiveMessage,onReceiveStatus:null!==(P=S.onReceiveStatus)&&void 0!==P?P:$.onReceiveStatus};M=new O.InterceptingListenerImpl(T,V)}this.nextCall.start(T,M),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(T,S){this.processingMessage=!0,this.requester.sendMessage(S,R=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=T,this.pendingMessage=S):(this.nextCall.sendMessageWithContext(T,R),this.processPendingHalfClose())})}sendMessage(T){this.sendMessageWithContext({},T)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function Q(T,S,R){var N,O;let P=null!==(N=R.deadline)&&void 0!==N?N:1/0,M=R.host,L=null!==(O=R.parent)&&void 0!==O?O:null,U=R.propagate_flags,V=R.credentials,$=T.createCall(S,P,M,L,U);return V&&$.setCredentials(V),$}S.InterceptingCall=W;class Y{constructor(T,S){this.call=T,this.methodDefinition=S}cancelWithStatus(T,S){this.call.cancelWithStatus(T,S)}getPeer(){return this.call.getPeer()}sendMessageWithContext(T,S){let R;try{R=this.methodDefinition.requestSerialize(S)}catch(T){this.call.cancelWithStatus(P.Status.INTERNAL,`Request message serialization failure: ${(0,M.getErrorMessage)(T)}`);return}this.call.sendMessageWithContext(T,R)}sendMessage(T){this.sendMessageWithContext({},T)}start(T,S){let R=null;this.call.start(T,{onReceiveMetadata:T=>{var R;null===(R=null==S?void 0:S.onReceiveMetadata)||void 0===R||R.call(S,T)},onReceiveMessage:T=>{var O;let L;try{L=this.methodDefinition.responseDeserialize(T)}catch(T){R={code:P.Status.INTERNAL,details:`Response message parsing error: ${(0,M.getErrorMessage)(T)}`,metadata:new N.Metadata},this.call.cancelWithStatus(R.code,R.details);return}null===(O=null==S?void 0:S.onReceiveMessage)||void 0===O||O.call(S,L)},onReceiveStatus:T=>{var N,O;R?null===(N=null==S?void 0:S.onReceiveStatus)||void 0===N||N.call(S,R):null===(O=null==S?void 0:S.onReceiveStatus)||void 0===O||O.call(S,T)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class X extends Y{constructor(T,S){super(T,S)}start(T,S){var R,N;let O=!1,P={onReceiveMetadata:null!==(N=null===(R=null==S?void 0:S.onReceiveMetadata)||void 0===R?void 0:R.bind(S))&&void 0!==N?N:T=>{},onReceiveMessage:T=>{var R;O=!0,null===(R=null==S?void 0:S.onReceiveMessage)||void 0===R||R.call(S,T)},onReceiveStatus:T=>{var R,N;O||null===(R=null==S?void 0:S.onReceiveMessage)||void 0===R||R.call(S,null),null===(N=null==S?void 0:S.onReceiveStatus)||void 0===N||N.call(S,T)}};super.start(T,P),this.call.startRead()}}class Z extends Y{}function ee(T,S,R){let N=Q(T,R.path,S);return R.responseStream?new Z(N,R):new X(N,R)}function et(T,S,R,N){if(T.clientInterceptors.length>0&&T.clientInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(T.callInterceptors.length>0&&T.callInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let O=[];O=T.callInterceptors.length>0||T.callInterceptorProviders.length>0?[].concat(T.callInterceptors,T.callInterceptorProviders.map(T=>T(S))).filter(T=>T):[].concat(T.clientInterceptors,T.clientInterceptorProviders.map(T=>T(S))).filter(T=>T);let P=Object.assign({},R,{method_definition:S});return O.reduceRight((T,S)=>R=>S(R,T),T=>ee(N,T,S))(P)}S.getInterceptingCall=et},69800:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Client=void 0;let N=R(78439),O=R(46261),P=R(33955),M=R(32678),L=R(62252),U=R(68601),V=Symbol(),$=Symbol(),K=Symbol(),W=Symbol();function Q(T){return"function"==typeof T}function Y(T){return T.stack.split("\n").slice(1).join("\n")}class X{constructor(T,S,R={}){var N,P;if(R=Object.assign({},R),this[$]=null!==(N=R.interceptors)&&void 0!==N?N:[],delete R.interceptors,this[K]=null!==(P=R.interceptor_providers)&&void 0!==P?P:[],delete R.interceptor_providers,this[$].length>0&&this[K].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[W]=R.callInvocationTransformer,delete R.callInvocationTransformer,R.channelOverride)this[V]=R.channelOverride;else if(R.channelFactoryOverride){let N=R.channelFactoryOverride;delete R.channelFactoryOverride,this[V]=N(T,S,R)}else this[V]=new O.ChannelImplementation(T,S,R)}close(){this[V].close()}getChannel(){return this[V]}waitForReady(T,S){let R=N=>{let O;if(N){S(Error("Failed to connect before the deadline"));return}try{O=this[V].getConnectivityState(!0)}catch(T){S(Error("The channel has been closed"));return}if(O===P.ConnectivityState.READY)S();else try{this[V].watchConnectivityState(O,T,R)}catch(T){S(Error("The channel has been closed"))}};setImmediate(R)}checkOptionalUnaryResponseArguments(T,S,R){if(Q(T))return{metadata:new L.Metadata,options:{},callback:T};if(Q(S))return T instanceof L.Metadata?{metadata:T,options:{},callback:S}:{metadata:new L.Metadata,options:T,callback:S};if(!(T instanceof L.Metadata&&S instanceof Object&&Q(R)))throw Error("Incorrect arguments passed");return{metadata:T,options:S,callback:R}}makeUnaryRequest(T,S,R,O,P,L,Q){var X,Z;let ee=this.checkOptionalUnaryResponseArguments(P,L,Q),et={path:T,requestStream:!1,responseStream:!1,requestSerialize:S,responseDeserialize:R},er={argument:O,metadata:ee.metadata,call:new N.ClientUnaryCallImpl,channel:this[V],methodDefinition:et,callOptions:ee.options,callback:ee.callback};this[W]&&(er=this[W](er));let en=er.call,ei={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(X=er.callOptions.interceptors)&&void 0!==X?X:[],callInterceptorProviders:null!==(Z=er.callOptions.interceptor_providers)&&void 0!==Z?Z:[]},es=(0,U.getInterceptingCall)(ei,er.methodDefinition,er.callOptions,er.channel);en.call=es;let ea=null,eo=!1,eu=Error();return es.start(er.metadata,{onReceiveMetadata:T=>{en.emit("metadata",T)},onReceiveMessage(T){null!==ea&&es.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),ea=T},onReceiveStatus(T){if(!eo){if(eo=!0,T.code===M.Status.OK){if(null===ea){let S=Y(eu);er.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:T.metadata},S))}else er.callback(null,ea)}else{let S=Y(eu);er.callback((0,N.callErrorFromStatus)(T,S))}eu=null,en.emit("status",T)}}}),es.sendMessage(O),es.halfClose(),en}makeClientStreamRequest(T,S,R,O,P,L){var Q,X;let Z=this.checkOptionalUnaryResponseArguments(O,P,L),ee={path:T,requestStream:!0,responseStream:!1,requestSerialize:S,responseDeserialize:R},et={metadata:Z.metadata,call:new N.ClientWritableStreamImpl(S),channel:this[V],methodDefinition:ee,callOptions:Z.options,callback:Z.callback};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=null,ea=!1,eo=Error();return ei.start(et.metadata,{onReceiveMetadata:T=>{er.emit("metadata",T)},onReceiveMessage(T){null!==es&&ei.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),es=T},onReceiveStatus(T){if(!ea){if(ea=!0,T.code===M.Status.OK){if(null===es){let S=Y(eo);et.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:T.metadata},S))}else et.callback(null,es)}else{let S=Y(eo);et.callback((0,N.callErrorFromStatus)(T,S))}eo=null,er.emit("status",T)}}}),er}checkMetadataAndOptions(T,S){let R,N;return T instanceof L.Metadata?(R=T,N=S||{}):(N=T||{},R=new L.Metadata),{metadata:R,options:N}}makeServerStreamRequest(T,S,R,O,P,L){var Q,X;let Z=this.checkMetadataAndOptions(P,L),ee={path:T,requestStream:!1,responseStream:!0,requestSerialize:S,responseDeserialize:R},et={argument:O,metadata:Z.metadata,call:new N.ClientReadableStreamImpl(R),channel:this[V],methodDefinition:ee,callOptions:Z.options};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=!1,ea=Error();return ei.start(et.metadata,{onReceiveMetadata(T){er.emit("metadata",T)},onReceiveMessage(T){er.push(T)},onReceiveStatus(T){if(!es){if(es=!0,er.push(null),T.code!==M.Status.OK){let S=Y(ea);er.emit("error",(0,N.callErrorFromStatus)(T,S))}ea=null,er.emit("status",T)}}}),ei.sendMessage(O),ei.halfClose(),er}makeBidiStreamRequest(T,S,R,O,P){var L,Q;let X=this.checkMetadataAndOptions(O,P),Z={path:T,requestStream:!0,responseStream:!0,requestSerialize:S,responseDeserialize:R},ee={metadata:X.metadata,call:new N.ClientDuplexStreamImpl(S,R),channel:this[V],methodDefinition:Z,callOptions:X.options};this[W]&&(ee=this[W](ee));let et=ee.call,er={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(L=ee.callOptions.interceptors)&&void 0!==L?L:[],callInterceptorProviders:null!==(Q=ee.callOptions.interceptor_providers)&&void 0!==Q?Q:[]},en=(0,U.getInterceptingCall)(er,ee.methodDefinition,ee.callOptions,ee.channel);et.call=en;let ei=!1,es=Error();return en.start(ee.metadata,{onReceiveMetadata(T){et.emit("metadata",T)},onReceiveMessage(T){et.push(T)},onReceiveStatus(T){if(!ei){if(ei=!0,et.push(null),T.code!==M.Status.OK){let S=Y(es);et.emit("error",(0,N.callErrorFromStatus)(T,S))}es=null,et.emit("status",T)}}}),et}}S.Client=X},59286:(T,S)=>{"use strict";var R;Object.defineProperty(S,"__esModule",{value:!0}),S.CompressionAlgorithms=void 0,function(T){T[T.identity=0]="identity",T[T.deflate=1]="deflate",T[T.gzip=2]="gzip"}(R||(S.CompressionAlgorithms=R={}))},44299:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.CompressionFilterFactory=S.CompressionFilter=void 0;let N=R(59796),O=R(59286),P=R(32678),M=R(78152),L=R(97504),U=T=>"number"==typeof T&&"string"==typeof O.CompressionAlgorithms[T];class V{async writeMessage(T,S){let R=T;S&&(R=await this.compressMessage(R));let N=Buffer.allocUnsafe(R.length+5);return N.writeUInt8(S?1:0,0),N.writeUInt32BE(R.length,1),R.copy(N,5),N}async readMessage(T){let S=1===T.readUInt8(0),R=T.slice(5);return S&&(R=await this.decompressMessage(R)),R}}class $ extends V{async compressMessage(T){return T}async writeMessage(T,S){let R=Buffer.allocUnsafe(T.length+5);return R.writeUInt8(0,0),R.writeUInt32BE(T.length,1),T.copy(R,5),R}decompressMessage(T){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class K extends V{constructor(T){super(),this.maxRecvMessageLength=T}compressMessage(T){return new Promise((S,R)=>{N.deflate(T,(T,N)=>{T?R(T):S(N)})})}decompressMessage(T){return new Promise((S,R)=>{let O=0,M=[],L=N.createInflate();L.on("data",T=>{M.push(T),O+=T.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{S(Buffer.concat(M))}),L.write(T),L.end()})}}class W extends V{constructor(T){super(),this.maxRecvMessageLength=T}compressMessage(T){return new Promise((S,R)=>{N.gzip(T,(T,N)=>{T?R(T):S(N)})})}decompressMessage(T){return new Promise((S,R)=>{let O=0,M=[],L=N.createGunzip();L.on("data",T=>{M.push(T),O+=T.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{S(Buffer.concat(M))}),L.write(T),L.end()})}}class Q extends V{constructor(T){super(),this.compressionName=T}compressMessage(T){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(T){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function Y(T,S){switch(T){case"identity":return new $;case"deflate":return new K(S);case"gzip":return new W(S);default:return new Q(T)}}class X extends M.BaseFilter{constructor(T,S){var R,N;super(),this.sharedFilterConfig=S,this.sendCompression=new $,this.receiveCompression=new $,this.currentCompressionAlgorithm="identity";let M=T["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(R=T["grpc.max_receive_message_length"])&&void 0!==R?R:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==M){if(U(M)){let T=O.CompressionAlgorithms[M],R=null===(N=S.serverSupportedEncodingHeader)||void 0===N?void 0:N.split(",");(!R||R.includes(T))&&(this.currentCompressionAlgorithm=T,this.sendCompression=Y(this.currentCompressionAlgorithm,-1))}else L.log(P.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${M}`)}}async sendMetadata(T){let S=await T;return S.set("grpc-accept-encoding","identity,deflate,gzip"),S.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?S.remove("grpc-encoding"):S.set("grpc-encoding",this.currentCompressionAlgorithm),S}receiveMetadata(T){let S=T.get("grpc-encoding");if(S.length>0){let T=S[0];"string"==typeof T&&(this.receiveCompression=Y(T,this.maxReceiveMessageLength))}T.remove("grpc-encoding");let R=T.get("grpc-accept-encoding")[0];return R&&(this.sharedFilterConfig.serverSupportedEncodingHeader=R,R.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new $,this.currentCompressionAlgorithm="identity")),T.remove("grpc-accept-encoding"),T}async sendMessage(T){var S;let R;let N=await T;return R=!(this.sendCompression instanceof $)&&((null!==(S=N.flags)&&void 0!==S?S:0)&2)==0,{message:await this.sendCompression.writeMessage(N.message,R),flags:N.flags}}async receiveMessage(T){return this.receiveCompression.readMessage(await T)}}S.CompressionFilter=X;class Z{constructor(T,S){this.options=S,this.sharedFilterConfig={}}createFilter(){return new X(this.options,this.sharedFilterConfig)}}S.CompressionFilterFactory=Z},33955:(T,S)=>{"use strict";var R;Object.defineProperty(S,"__esModule",{value:!0}),S.ConnectivityState=void 0,function(T){T[T.IDLE=0]="IDLE",T[T.CONNECTING=1]="CONNECTING",T[T.READY=2]="READY",T[T.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",T[T.SHUTDOWN=4]="SHUTDOWN"}(R||(S.ConnectivityState=R={}))},32678:(T,S)=>{"use strict";var R,N,O;Object.defineProperty(S,"__esModule",{value:!0}),S.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=S.DEFAULT_MAX_SEND_MESSAGE_LENGTH=S.Propagate=S.LogVerbosity=S.Status=void 0,function(T){T[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(R||(S.Status=R={})),function(T){T[T.DEBUG=0]="DEBUG",T[T.INFO=1]="INFO",T[T.ERROR=2]="ERROR",T[T.NONE=3]="NONE"}(N||(S.LogVerbosity=N={})),function(T){T[T.DEADLINE=1]="DEADLINE",T[T.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",T[T.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",T[T.CANCELLATION=8]="CANCELLATION",T[T.DEFAULTS=65535]="DEFAULTS"}(O||(S.Propagate=O={})),S.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,S.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},82155:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.restrictControlPlaneStatusCode=void 0;let N=R(32678),O=[N.Status.OK,N.Status.INVALID_ARGUMENT,N.Status.NOT_FOUND,N.Status.ALREADY_EXISTS,N.Status.FAILED_PRECONDITION,N.Status.ABORTED,N.Status.OUT_OF_RANGE,N.Status.DATA_LOSS];function P(T,S){return O.includes(T)?{code:N.Status.INTERNAL,details:`Invalid status from control plane: ${T} ${N.Status[T]} ${S}`}:{code:T,details:S}}S.restrictControlPlaneStatusCode=P},7931:(T,S)=>{"use strict";function R(...T){let S=1/0;for(let R of T){let T=R instanceof Date?R.getTime():R;T<S&&(S=T)}return S}Object.defineProperty(S,"__esModule",{value:!0}),S.deadlineToString=S.getRelativeTimeout=S.getDeadlineTimeoutString=S.minDeadline=void 0,S.minDeadline=R;let N=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function O(T){let S=new Date().getTime();T instanceof Date&&(T=T.getTime());let R=Math.max(T-S,0);for(let[T,S]of N){let N=R/S;if(N<1e8)return String(Math.ceil(N))+T}throw Error("Deadline is too far in the future")}S.getDeadlineTimeoutString=O;let P=2147483647;function M(T){let S=(T instanceof Date?T.getTime():T)-new Date().getTime();return S<0?0:S>P?1/0:S}function L(T){if(T instanceof Date)return T.toISOString();{let S=new Date(T);return Number.isNaN(S.getTime())?""+T:S.toISOString()}}S.getRelativeTimeout=M,S.deadlineToString=L},95330:(T,S)=>{"use strict";function R(T){return{seconds:T/1e3|0,nanos:T%1e3*1e6|0}}function N(T){return 1e3*T.seconds+T.nanos/1e6|0}function O(T){return"number"==typeof T.seconds&&"number"==typeof T.nanos}Object.defineProperty(S,"__esModule",{value:!0}),S.isDuration=S.durationToMs=S.msToDuration=void 0,S.msToDuration=R,S.durationToMs=N,S.isDuration=O},75437:(T,S)=>{"use strict";function R(T){return T instanceof Error?T.message:String(T)}function N(T){return"object"==typeof T&&null!==T&&"code"in T&&"number"==typeof T.code?T.code:null}Object.defineProperty(S,"__esModule",{value:!0}),S.getErrorCode=S.getErrorMessage=void 0,S.getErrorMessage=R,S.getErrorCode=N},30345:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.OutlierDetectionLoadBalancingConfig=S.BaseSubchannelWrapper=S.registerAdminService=S.FilterStackFactory=S.BaseFilter=S.PickResultType=S.QueuePicker=S.UnavailablePicker=S.ChildLoadBalancerHandler=S.subchannelAddressToString=S.validateLoadBalancingConfig=S.getFirstUsableConfig=S.registerLoadBalancerType=S.createChildChannelControlHelper=S.BackoffTimeout=S.durationToMs=S.uriToString=S.createResolver=S.registerResolver=S.log=S.trace=void 0;var N=R(97504);Object.defineProperty(S,"trace",{enumerable:!0,get:function(){return N.trace}}),Object.defineProperty(S,"log",{enumerable:!0,get:function(){return N.log}});var O=R(40492);Object.defineProperty(S,"registerResolver",{enumerable:!0,get:function(){return O.registerResolver}}),Object.defineProperty(S,"createResolver",{enumerable:!0,get:function(){return O.createResolver}});var P=R(18429);Object.defineProperty(S,"uriToString",{enumerable:!0,get:function(){return P.uriToString}});var M=R(95330);Object.defineProperty(S,"durationToMs",{enumerable:!0,get:function(){return M.durationToMs}});var L=R(84934);Object.defineProperty(S,"BackoffTimeout",{enumerable:!0,get:function(){return L.BackoffTimeout}});var U=R(27176);Object.defineProperty(S,"createChildChannelControlHelper",{enumerable:!0,get:function(){return U.createChildChannelControlHelper}}),Object.defineProperty(S,"registerLoadBalancerType",{enumerable:!0,get:function(){return U.registerLoadBalancerType}}),Object.defineProperty(S,"getFirstUsableConfig",{enumerable:!0,get:function(){return U.getFirstUsableConfig}}),Object.defineProperty(S,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return U.validateLoadBalancingConfig}});var V=R(23906);Object.defineProperty(S,"subchannelAddressToString",{enumerable:!0,get:function(){return V.subchannelAddressToString}});var $=R(982);Object.defineProperty(S,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return $.ChildLoadBalancerHandler}});var K=R(17064);Object.defineProperty(S,"UnavailablePicker",{enumerable:!0,get:function(){return K.UnavailablePicker}}),Object.defineProperty(S,"QueuePicker",{enumerable:!0,get:function(){return K.QueuePicker}}),Object.defineProperty(S,"PickResultType",{enumerable:!0,get:function(){return K.PickResultType}});var W=R(78152);Object.defineProperty(S,"BaseFilter",{enumerable:!0,get:function(){return W.BaseFilter}});var Q=R(2472);Object.defineProperty(S,"FilterStackFactory",{enumerable:!0,get:function(){return Q.FilterStackFactory}});var Y=R(59601);Object.defineProperty(S,"registerAdminService",{enumerable:!0,get:function(){return Y.registerAdminService}});var X=R(21407);Object.defineProperty(S,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return X.BaseSubchannelWrapper}});var Z=R(81433);Object.defineProperty(S,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Z.OutlierDetectionLoadBalancingConfig}})},2472:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.FilterStackFactory=S.FilterStack=void 0;class R{constructor(T){this.filters=T}sendMetadata(T){let S=T;for(let T=0;T<this.filters.length;T++)S=this.filters[T].sendMetadata(S);return S}receiveMetadata(T){let S=T;for(let T=this.filters.length-1;T>=0;T--)S=this.filters[T].receiveMetadata(S);return S}sendMessage(T){let S=T;for(let T=0;T<this.filters.length;T++)S=this.filters[T].sendMessage(S);return S}receiveMessage(T){let S=T;for(let T=this.filters.length-1;T>=0;T--)S=this.filters[T].receiveMessage(S);return S}receiveTrailers(T){let S=T;for(let T=this.filters.length-1;T>=0;T--)S=this.filters[T].receiveTrailers(S);return S}push(T){this.filters.unshift(...T)}getFilters(){return this.filters}}S.FilterStack=R;class N{constructor(T){this.factories=T}push(T){this.factories.unshift(...T)}clone(){return new N([...this.factories])}createFilter(){return new R(this.factories.map(T=>T.createFilter()))}}S.FilterStackFactory=N},78152:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.BaseFilter=void 0;class R{async sendMetadata(T){return T}receiveMetadata(T){return T}async sendMessage(T){return T}async receiveMessage(T){return T}receiveTrailers(T){return T}}S.BaseFilter=R},82039:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getProxiedConnection=S.mapProxyName=void 0;let N=R(97504),O=R(32678),P=R(40492),M=R(13685),L=R(24404),U=R(97504),V=R(23906),$=R(18429),K=R(57310),W=R(54605),Q="proxy";function Y(T){U.trace(O.LogVerbosity.DEBUG,Q,T)}function X(){let T,S="",R="";if(process.env.grpc_proxy)R="grpc_proxy",S=process.env.grpc_proxy;else if(process.env.https_proxy)R="https_proxy",S=process.env.https_proxy;else{if(!process.env.http_proxy)return{};R="http_proxy",S=process.env.http_proxy}try{T=new K.URL(S)}catch(T){return(0,N.log)(O.LogVerbosity.ERROR,`cannot parse value of "${R}" env var`),{}}if("http:"!==T.protocol)return(0,N.log)(O.LogVerbosity.ERROR,`"${T.protocol}" scheme not supported in proxy URI`),{};let P=null;T.username&&(T.password?((0,N.log)(O.LogVerbosity.INFO,"userinfo found in proxy URI"),P=`${T.username}:${T.password}`):P=T.username);let M=T.hostname,L=T.port;""===L&&(L="80");let U={address:`${M}:${L}`};return P&&(U.creds=P),Y("Proxy server "+U.address+" set by environment variable "+R),U}function Z(){let T=process.env.no_grpc_proxy,S="no_grpc_proxy";return(T||(T=process.env.no_proxy,S="no_proxy"),T)?(Y("No proxy server list set by environment variable "+S),T.split(",")):[]}function ee(T,S){var R;let N={target:T,extraOptions:{}};if((null!==(R=S["grpc.enable_http_proxy"])&&void 0!==R?R:1)===0||"unix"===T.scheme)return N;let O=X();if(!O.address)return N;let P=(0,$.splitHostPort)(T.path);if(!P)return N;let M=P.host;for(let S of Z())if(S===M)return Y("Not using proxy for target in no_proxy list: "+(0,$.uriToString)(T)),N;let L={"grpc.http_connect_target":(0,$.uriToString)(T)};return O.creds&&(L["grpc.http_connect_creds"]=O.creds),{target:{scheme:"dns",path:O.address},extraOptions:L}}function et(T,S,R){var U;if(!("grpc.http_connect_target"in S))return Promise.resolve({});let K=S["grpc.http_connect_target"],Q=(0,$.parseUri)(K);if(null===Q)return Promise.resolve({});let X=(0,$.splitHostPort)(Q.path);if(null===X)return Promise.resolve({});let Z=`${X.host}:${null!==(U=X.port)&&void 0!==U?U:W.DEFAULT_PORT}`,ee={method:"CONNECT",path:Z},et={Host:Z};(0,V.isTcpSubchannelAddress)(T)?(ee.host=T.host,ee.port=T.port):ee.socketPath=T.path,"grpc.http_connect_creds"in S&&(et["Proxy-Authorization"]="Basic "+Buffer.from(S["grpc.http_connect_creds"]).toString("base64")),ee.headers=et;let er=(0,V.subchannelAddressToString)(T);return Y("Using proxy "+er+" to connect to "+ee.path),new Promise((T,S)=>{let U=M.request(ee);U.once("connect",(M,V,K)=>{var W;if(U.removeAllListeners(),V.removeAllListeners(),200===M.statusCode){if(Y("Successfully connected to "+ee.path+" through proxy "+er),"secureContext"in R){let N=(0,P.getDefaultAuthority)(Q),O=(0,$.splitHostPort)(N),M=null!==(W=null==O?void 0:O.host)&&void 0!==W?W:N,U=L.connect(Object.assign({host:M,servername:M,socket:V},R),()=>{Y("Successfully established a TLS connection to "+ee.path+" through proxy "+er),T({socket:U,realTarget:Q})});U.on("error",T=>{Y("Failed to establish a TLS connection to "+ee.path+" through proxy "+er+" with error "+T.message),S()})}else Y("Successfully established a plaintext connection to "+ee.path+" through proxy "+er),T({socket:V,realTarget:Q})}else(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to "+ee.path+" through proxy "+er+" with status "+M.statusCode),S()}),U.once("error",T=>{U.removeAllListeners(),(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to proxy "+er+" with error "+T.message),S()}),U.end()})}S.mapProxyName=ee,S.getProxiedConnection=et},22165:(T,S,R)=>{"use strict";Z={value:!0},Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=S.Rz=Z=Z=Z=Z=Z=Z=S.SF=S.K9=void 0;let N=R(78931);Z={enumerable:!0,get:function(){return N.CallCredentials}};let O=R(46261);Z={enumerable:!0,get:function(){return O.ChannelImplementation}};let P=R(59286);Z={enumerable:!0,get:function(){return P.CompressionAlgorithms}};let M=R(33955);Z={enumerable:!0,get:function(){return M.ConnectivityState}};let L=R(92528);Z={enumerable:!0,get:function(){return L.ChannelCredentials}};let U=R(69800);Z={enumerable:!0,get:function(){return U.Client}};let V=R(32678);Z={enumerable:!0,get:function(){return V.LogVerbosity}},Z={enumerable:!0,get:function(){return V.Status}},Z={enumerable:!0,get:function(){return V.Propagate}};let $=R(97504),K=R(35085);Object.defineProperty(S,"Rz",{enumerable:!0,get:function(){return K.loadPackageDefinition}}),Z={enumerable:!0,get:function(){return K.makeClientConstructor}},Z={enumerable:!0,get:function(){return K.makeClientConstructor}};let W=R(62252);Object.defineProperty(S,"SF",{enumerable:!0,get:function(){return W.Metadata}});let Q=R(57691);Z={enumerable:!0,get:function(){return Q.Server}};let Y=R(74181);Z={enumerable:!0,get:function(){return Y.ServerCredentials}};let X=R(39932);Z={enumerable:!0,get:function(){return X.StatusBuilder}},S.K9={combineChannelCredentials:(T,...S)=>S.reduce((T,S)=>T.compose(S),T),combineCallCredentials:(T,...S)=>S.reduce((T,S)=>T.compose(S),T),createInsecure:L.ChannelCredentials.createInsecure,createSsl:L.ChannelCredentials.createSsl,createFromSecureContext:L.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:N.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:N.CallCredentials.createFromGoogleCredential,createEmpty:N.CallCredentials.createEmpty},Z=T=>T.close(),Z=(T,S,R)=>T.waitForReady(S,R),Z=(T,S)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=(T,S,R)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=T=>{$.setLogger(T)},Z=T=>{$.setLoggerVerbosity(T)},Z=T=>U.Client.prototype.getChannel.call(T);var Z,ee=R(68601);Z={enumerable:!0,get:function(){return ee.ListenerBuilder}},Z={enumerable:!0,get:function(){return ee.RequesterBuilder}},Z={enumerable:!0,get:function(){return ee.InterceptingCall}},Z={enumerable:!0,get:function(){return ee.InterceptorConfigurationError}};var et=R(5993);Z={enumerable:!0,get:function(){return et.getChannelzServiceDefinition}},Z={enumerable:!0,get:function(){return et.getChannelzHandlers}};var er=R(59601);Z={enumerable:!0,get:function(){return er.addAdminServicesToServer}},Z=R(30345);let en=R(54605),ei=R(45862),es=R(53562),ea=R(56170),eo=R(62255),eu=R(81433),ec=R(5993);(()=>{en.setup(),ei.setup(),es.setup(),ea.setup(),eo.setup(),eu.setup(),ec.setup()})()},21118:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.InternalChannel=void 0;let N=R(92528),O=R(82380),P=R(42328),M=R(17064),L=R(32678),U=R(2472),V=R(44299),$=R(40492),K=R(97504),W=R(82039),Q=R(18429),Y=R(33955),X=R(5993),Z=R(60980),ee=R(7931),et=R(63003),er=R(38445),en=R(82155),ei=R(44398),es=R(21407),ea=2147483647,eo=1e3,eu=18e5,ec=new Map,ed=16777216,eh=1048576;class ep extends es.BaseSubchannelWrapper{constructor(T,S){super(T),this.channel=S,this.refCount=0,this.subchannelStateListener=(T,R,N,O)=>{S.throttleKeepalive(O)},T.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class ef{constructor(T,S,R){var Z,ee,et,er,es,ef,em,eg;if(this.credentials=S,this.options=R,this.connectivityState=Y.ConnectivityState.IDLE,this.currentPicker=new M.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new X.ChannelzCallTracker,this.childrenTracker=new X.ChannelzChildrenTracker,"string"!=typeof T)throw TypeError("Channel target must be a string");if(!(S instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.originalTarget=T;let ey=(0,Q.parseUri)(T);if(null===ey)throw Error(`Could not parse target name "${T}"`);let ev=(0,$.mapUriDefaultScheme)(ey);if(null===ev)throw Error(`Could not find a default scheme for target name "${T}"`);this.callRefTimer=setInterval(()=>{},ea),null===(ee=(Z=this.callRefTimer).unref)||void 0===ee||ee.call(Z),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new X.ChannelzTrace,this.channelzRef=(0,X.registerChannelzChannel)(T,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,$.getDefaultAuthority)(ev);let eb=(0,W.mapProxyName)(ev,R);this.target=eb.target,this.options=Object.assign({},this.options,eb.extraOptions),this.subchannelPool=(0,P.getSubchannelPool)((null!==(et=R["grpc.use_local_subchannel_pool"])&&void 0!==et?et:0)===0),this.retryBufferTracker=new ei.MessageBufferTracker(null!==(er=R["grpc.retry_buffer_size"])&&void 0!==er?er:ed,null!==(es=R["grpc.per_rpc_retry_buffer_size"])&&void 0!==es?es:eh),this.keepaliveTime=null!==(ef=R["grpc.keepalive_time_ms"])&&void 0!==ef?ef:-1,this.idleTimeoutMs=Math.max(null!==(em=R["grpc.client_idle_timeout_ms"])&&void 0!==em?em:eu,eo);let eT={createSubchannel:(T,S)=>{let R=this.subchannelPool.getOrCreateSubchannel(this.target,T,Object.assign({},this.options,S),this.credentials);R.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",R.getChannelzRef());let N=new ep(R,this);return this.wrappedSubchannels.add(N),N},updateState:(T,S)=>{this.currentPicker=S;let R=this.pickQueue.slice();for(let T of(this.pickQueue=[],R.length>0&&this.callRefTimerUnref(),R))T.doPick();this.updateState(T)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:T=>{this.channelzEnabled&&this.childrenTracker.refChild(T)},removeChannelzChild:T=>{this.channelzEnabled&&this.childrenTracker.unrefChild(T)}};this.resolvingLoadBalancer=new O.ResolvingLoadBalancer(this.target,eT,R,(T,S)=>{T.retryThrottling?ec.set(this.getTarget(),new ei.RetryThrottler(T.retryThrottling.maxTokens,T.retryThrottling.tokenRatio,ec.get(this.getTarget()))):ec.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=S,this.currentResolutionError=null,process.nextTick(()=>{let T=this.configSelectionQueue;for(let S of(this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref(),T))S.getConfig()})},T=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+T.code+' and details "'+T.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,en.restrictControlPlaneStatusCode)(T.code,T.details)),{metadata:T.metadata}));let S=this.configSelectionQueue;for(let R of(this.configSelectionQueue=[],S.length>0&&this.callRefTimerUnref(),S))R.reportResolverError(T)}),this.filterStackFactory=new U.FilterStackFactory([new V.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(R,void 0,2));let eS=Error();(0,K.trace)(L.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(eg=eS.stack)||void 0===eg?void 0:eg.substring(eS.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(T,S){(0,K.trace)(null!=S?S:L.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+T)}callRefTimerRef(){var T,S,R,N;(null===(S=(T=this.callRefTimer).hasRef)||void 0===S?void 0:S.call(T))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(N=(R=this.callRefTimer).ref)||void 0===N||N.call(R))}callRefTimerUnref(){var T,S;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(S=(T=this.callRefTimer).unref)||void 0===S||S.call(T))}removeConnectivityStateWatcher(T){let S=this.connectivityStateWatchers.findIndex(S=>S===T);S>=0&&this.connectivityStateWatchers.splice(S,1)}updateState(T){for(let S of((0,K.trace)(L.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+Y.ConnectivityState[this.connectivityState]+" -> "+Y.ConnectivityState[T]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Y.ConnectivityState[T]),this.connectivityState=T,this.connectivityStateWatchers.slice()))T!==S.currentState&&(S.timer&&clearTimeout(S.timer),this.removeConnectivityStateWatcher(S),S.callback());T!==Y.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(T){if(T>this.keepaliveTime)for(let S of(this.keepaliveTime=T,this.wrappedSubchannels))S.throttleKeepalive(T)}removeWrappedSubchannel(T){this.wrappedSubchannels.delete(T)}doPick(T,S){return this.currentPicker.pick({metadata:T,extraPickInfo:S})}queueCallForPick(T){this.pickQueue.push(T),this.callRefTimerRef()}getConfig(T,S){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(T,S)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(T){this.configSelectionQueue.push(T),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.IDLE),this.currentPicker=new M.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(T){var S,R;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let T=new Date().valueOf()-this.lastActivityTimestamp.valueOf();T>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-T)},T),null===(R=(S=this.idleTimer).unref)||void 0===R||R.call(S)}maybeStartIdleTimer(){this.connectivityState===Y.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(T){this.channelzEnabled&&(T.code===L.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(T,S,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+P+'] method="'+S+'"'),new Z.LoadBalancingCall(this,T,S,R,N,O,P)}createRetryingCall(T,S,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createRetryingCall ["+P+'] method="'+S+'"'),new ei.RetryingCall(this,T,S,R,N,O,P,this.retryBufferTracker,ec.get(this.getTarget()))}createInnerCall(T,S,R,N,O){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(T,S,R,N,O):this.createRetryingCall(T,S,R,N,O)}createResolvingCall(T,S,R,N,O){let P=(0,er.getNextCallNumber)();this.trace("createResolvingCall ["+P+'] method="'+T+'", deadline='+(0,ee.deadlineToString)(S));let M={deadline:S,flags:null!=O?O:L.Propagate.DEFAULTS,host:null!=R?R:this.defaultAuthority,parentCall:N},U=new et.ResolvingCall(this,T,M,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),P);return this.onCallStart(),U.addStatusWatcher(T=>{this.onCallEnd(T)}),U}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,X.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Q.uriToString)(this.target)}getConnectivityState(T){let S=this.connectivityState;return T&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),S}watchConnectivityState(T,S,R){if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let N=null;if(S!==1/0){let T=S instanceof Date?S:new Date(S),P=new Date;if(S===-1/0||T<=P){process.nextTick(R,Error("Deadline passed without connectivity state change"));return}N=setTimeout(()=>{this.removeConnectivityStateWatcher(O),R(Error("Deadline passed without connectivity state change"))},T.getTime()-P.getTime())}let O={currentState:T,callback:R,timer:N};this.connectivityStateWatchers.push(O)}getChannelzRef(){return this.channelzRef}createCall(T,S,R,N,O){if("string"!=typeof T)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof S||S instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(T,S,R,N,O)}}S.InternalChannel=ef},982:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ChildLoadBalancerHandler=void 0;let N=R(27176),O=R(33955),P="child_load_balancer_helper";class M{constructor(T){this.channelControlHelper=T,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(T){this.parent=T,this.child=null}createSubchannel(T,S){return this.parent.channelControlHelper.createSubchannel(T,S)}updateState(T,S){var R;if(this.calledByPendingChild()){if(T===O.ConnectivityState.CONNECTING)return;null===(R=this.parent.currentChild)||void 0===R||R.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(T,S)}requestReresolution(){var T;let S=null!==(T=this.parent.pendingChild)&&void 0!==T?T:this.parent.currentChild;this.child===S&&this.parent.channelControlHelper.requestReresolution()}setChild(T){this.child=T}addChannelzChild(T){this.parent.channelControlHelper.addChannelzChild(T)}removeChannelzChild(T){this.parent.channelControlHelper.removeChannelzChild(T)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(T,S){return T.getLoadBalancerName()!==S.getLoadBalancerName()}updateAddressList(T,S,R){let O;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,S)){let T=new this.ChildPolicyHelper(this),R=(0,N.createLoadBalancer)(S,T);T.setChild(R),null===this.currentChild?(this.currentChild=R,O=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=R,O=this.pendingChild)}else O=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=S,O.updateAddressList(T,S,R)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return P}}S.ChildLoadBalancerHandler=M},81433:(T,S,R)=>{"use strict";var N;Object.defineProperty(S,"__esModule",{value:!0}),S.setup=S.OutlierDetectionLoadBalancer=S.OutlierDetectionLoadBalancingConfig=void 0;let O=R(33955),P=R(32678),M=R(95330),L=R(30345),U=R(27176),V=R(982),$=R(17064),K=R(23906),W=R(21407),Q=R(97504),Y="outlier_detection";function X(T){Q.trace(P.LogVerbosity.DEBUG,Y,T)}let Z="outlier_detection",ee=(null!==(N=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==N?N:"true")==="true",et={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},er={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function en(T,S,R,N){if(S in T&&typeof T[S]!==R){let O=N?`${N}.${S}`:S;throw Error(`outlier detection config ${O} parse error: expected ${R}, got ${typeof T[S]}`)}}function ei(T,S,R){let N=R?`${R}.${S}`:S;if(S in T){if(!(0,M.isDuration)(T[S]))throw Error(`outlier detection config ${N} parse error: expected Duration, got ${typeof T[S]}`);if(!(T[S].seconds>=0&&T[S].seconds<=315576e6&&T[S].nanos>=0&&T[S].nanos<=999999999))throw Error(`outlier detection config ${N} parse error: values out of range for non-negative Duaration`)}}function es(T,S,R){let N=R?`${R}.${S}`:S;if(en(T,S,"number",R),S in T&&!(T[S]>=0&&T[S]<=100))throw Error(`outlier detection config ${N} parse error: value out of range for percentage (0-100)`)}class ea{constructor(T,S,R,N,O,P,M){if(this.childPolicy=M,M.length>0&&"pick_first"===M[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=T?T:1e4,this.baseEjectionTimeMs=null!=S?S:3e4,this.maxEjectionTimeMs=null!=R?R:3e5,this.maxEjectionPercent=null!=N?N:10,this.successRateEjection=O?Object.assign(Object.assign({},et),O):null,this.failurePercentageEjection=P?Object.assign(Object.assign({},er),P):null}getLoadBalancerName(){return Z}toJsonObject(){return{interval:(0,M.msToDuration)(this.intervalMs),base_ejection_time:(0,M.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,M.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(T=>T.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(T){return new ea(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,T)}static createFromJson(T){var S;if(ei(T,"interval"),ei(T,"base_ejection_time"),ei(T,"max_ejection_time"),es(T,"max_ejection_percent"),"success_rate_ejection"in T){if("object"!=typeof T.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");en(T.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),es(T.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),en(T.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),en(T.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in T){if("object"!=typeof T.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");es(T.failure_percentage_ejection,"threshold","failure_percentage_ejection"),es(T.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),en(T.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),en(T.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new ea(T.interval?(0,M.durationToMs)(T.interval):null,T.base_ejection_time?(0,M.durationToMs)(T.base_ejection_time):null,T.max_ejection_time?(0,M.durationToMs)(T.max_ejection_time):null,null!==(S=T.max_ejection_percent)&&void 0!==S?S:null,T.success_rate_ejection,T.failure_percentage_ejection,T.child_policy.map(U.validateLoadBalancingConfig))}}S.OutlierDetectionLoadBalancingConfig=ea;class eo extends W.BaseSubchannelWrapper{constructor(T,S){super(T),this.mapEntry=S,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=T.getConnectivityState(),T.addConnectivityStateListener((T,S,R,N)=>{if(this.childSubchannelState=R,!this.ejected)for(let T of this.stateListeners)T(this,S,R,N)})}getConnectivityState(){return this.ejected?O.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(T){this.stateListeners.push(T)}removeConnectivityStateListener(T){let S=this.stateListeners.indexOf(T);S>-1&&this.stateListeners.splice(S,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let T=this.mapEntry.subchannelWrappers.indexOf(this);T>=0&&this.mapEntry.subchannelWrappers.splice(T,1)}}eject(){for(let T of(this.ejected=!0,this.stateListeners))T(this,this.childSubchannelState,O.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let T of(this.ejected=!1,this.stateListeners))T(this,O.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function eu(){return{success:0,failure:0}}class ec{constructor(){this.activeBucket=eu(),this.inactiveBucket=eu()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=eu()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class ed{constructor(T,S){this.wrappedPicker=T,this.countCalls=S}pick(T){let S=this.wrappedPicker.pick(T);if(S.pickResultType!==$.PickResultType.COMPLETE)return S;{let T=S.subchannel,R=T.getMapEntry();if(!R)return Object.assign(Object.assign({},S),{subchannel:T.getWrappedSubchannel()});{let N=S.onCallEnded;return this.countCalls&&(N=T=>{var N;T===P.Status.OK?R.counter.addSuccess():R.counter.addFailure(),null===(N=S.onCallEnded)||void 0===N||N.call(S,T)}),Object.assign(Object.assign({},S),{subchannel:T.getWrappedSubchannel(),onCallEnded:N})}}}}class eh{constructor(T){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new V.ChildLoadBalancerHandler((0,L.createChildChannelControlHelper)(T,{createSubchannel:(S,R)=>{let N=T.createSubchannel(S,R),O=this.addressMap.get((0,K.subchannelAddressToString)(S)),P=new eo(N,O);return(null==O?void 0:O.currentEjectionTimestamp)!==null&&P.eject(),null==O||O.subchannelWrappers.push(P),P},updateState:(S,R)=>{S===O.ConnectivityState.READY?T.updateState(S,new ed(R,this.isCountingEnabled())):T.updateState(S,R)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let T=0;for(let S of this.addressMap.values())null!==S.currentEjectionTimestamp&&(T+=1);return 100*T/this.addressMap.size}runSuccessRateCheck(T){if(!this.latestConfig)return;let S=this.latestConfig.getSuccessRateEjectionConfig();if(!S)return;X("Running success rate check");let R=S.request_volume,N=0,O=[];for(let[T,S]of this.addressMap){let P=S.counter.getLastSuccesses(),M=S.counter.getLastFailures();X("Stats for "+T+": successes="+P+" failures="+M+" targetRequestVolume="+R),P+M>=R&&(N+=1,O.push(P/(P+M)))}if(X("Found "+N+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+O+"]"),N<S.minimum_hosts)return;let P=O.reduce((T,S)=>T+S)/O.length,M=0;for(let T of O){let S=T-P;M+=S*S}let L=Math.sqrt(M/O.length),U=P-S.stdev_factor/1e3*L;for(let[N,O]of(X("stdev="+L+" ejectionThreshold="+U),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let P=O.counter.getLastSuccesses(),M=O.counter.getLastFailures();if(P+M<R)continue;let L=P/(P+M);if(X("Checking candidate "+N+" successRate="+L),L<U){let R=100*Math.random();X("Candidate "+N+" randomNumber="+R+" enforcement_percentage="+S.enforcement_percentage),R<S.enforcement_percentage&&(X("Ejecting candidate "+N),this.eject(O,T))}}}runFailurePercentageCheck(T){if(!this.latestConfig)return;let S=this.latestConfig.getFailurePercentageEjectionConfig();if(!S)return;X("Running failure percentage check. threshold="+S.threshold+" request volume threshold="+S.request_volume);let R=0;for(let T of this.addressMap.values())T.counter.getLastSuccesses()+T.counter.getLastFailures()>=S.request_volume&&(R+=1);if(!(R<S.minimum_hosts))for(let[R,N]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let O=N.counter.getLastSuccesses(),P=N.counter.getLastFailures();if(X("Candidate successes="+O+" failures="+P),!(O+P<S.request_volume)&&100*P/(P+O)>S.threshold){let O=100*Math.random();X("Candidate "+R+" randomNumber="+O+" enforcement_percentage="+S.enforcement_percentage),O<S.enforcement_percentage&&(X("Ejecting candidate "+R),this.eject(N,T))}}}eject(T,S){for(let S of(T.currentEjectionTimestamp=new Date,T.ejectionTimeMultiplier+=1,T.subchannelWrappers))S.eject()}uneject(T){for(let S of(T.currentEjectionTimestamp=null,T.subchannelWrappers))S.uneject()}switchAllBuckets(){for(let T of this.addressMap.values())T.counter.switchBuckets()}startTimer(T){var S,R;this.ejectionTimer=setTimeout(()=>this.runChecks(),T),null===(R=(S=this.ejectionTimer).unref)||void 0===R||R.call(S)}runChecks(){let T=new Date;if(X("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[S,R]of(this.timerStartTime=T,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(T),this.runFailurePercentageCheck(T),this.addressMap.entries()))if(null===R.currentEjectionTimestamp)R.ejectionTimeMultiplier>0&&(R.ejectionTimeMultiplier-=1);else{let T=this.latestConfig.getBaseEjectionTimeMs(),N=this.latestConfig.getMaxEjectionTimeMs(),O=new Date(R.currentEjectionTimestamp.getTime());O.setMilliseconds(O.getMilliseconds()+Math.min(T*R.ejectionTimeMultiplier,Math.max(T,N))),O<new Date&&(X("Unejecting "+S),this.uneject(R))}}updateAddressList(T,S,R){if(!(S instanceof ea))return;let N=new Set;for(let S of T)N.add((0,K.subchannelAddressToString)(S));for(let T of N)this.addressMap.has(T)||(X("Adding map entry for "+T),this.addressMap.set(T,{counter:new ec,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let T of this.addressMap.keys())N.has(T)||(X("Removing map entry for "+T),this.addressMap.delete(T));let O=(0,U.getFirstUsableConfig)(S.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(T,O,R),S.getSuccessRateEjectionConfig()||S.getFailurePercentageEjectionConfig()){if(this.timerStartTime){X("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let T=S.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(T)}else X("Starting new timer"),this.timerStartTime=new Date,this.startTimer(S.getIntervalMs()),this.switchAllBuckets()}else for(let T of(X("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(T),T.ejectionTimeMultiplier=0;this.latestConfig=S}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Z}}function ep(){ee&&(0,L.registerLoadBalancerType)(Z,eh,ea)}S.OutlierDetectionLoadBalancer=eh,S.setup=ep},56170:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=S.PickFirstLoadBalancer=S.shuffled=S.PickFirstLoadBalancingConfig=void 0;let N=R(27176),O=R(33955),P=R(17064),M=R(97504),L=R(32678),U="pick_first";function V(T){M.trace(L.LogVerbosity.DEBUG,U,T)}let $="pick_first",K=250;class W{constructor(T){this.shuffleAddressList=T}getLoadBalancerName(){return $}toJsonObject(){return{[$]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(T){if("shuffleAddressList"in T&&"boolean"!=typeof T.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new W(!0===T.shuffleAddressList)}}S.PickFirstLoadBalancingConfig=W;class Q{constructor(T){this.subchannel=T}pick(T){return{pickResultType:P.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function Y(T){let S=T.slice();for(let T=S.length-1;T>1;T--){let R=Math.floor(Math.random()*(T+1)),N=S[T];S[T]=S[R],S[R]=N}return S}S.shuffled=Y;class X{constructor(T){this.channelControlHelper=T,this.children=[],this.currentState=O.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(T,S,R,N,O)=>{this.onSubchannelStateUpdate(T,S,R,O)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(T=>T.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(O.ConnectivityState.READY,new Q(this.currentPick)):0===this.children.length?this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:T}of(this.stickyTransientFailureMode=!0,this.children))T.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let T=this.currentPick;this.currentPick=null,T.unref(),T.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(T.getChannelzRef())}}onSubchannelStateUpdate(T,S,R,N){var P;if(null===(P=this.currentPick)||void 0===P?void 0:P.realSubchannelEquals(T)){R!==O.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[S,P]of this.children.entries())if(T.realSubchannelEquals(P.subchannel)){R===O.ConnectivityState.READY&&this.pickSubchannel(P.subchannel),R===O.ConnectivityState.TRANSIENT_FAILURE&&(P.hasReportedTransientFailure=!0,N&&(this.lastError=N),this.maybeEnterStickyTransientFailureMode(),S===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(S+1)),P.subchannel.startConnecting();return}}startNextSubchannelConnecting(T){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[S,R]of this.children.entries())if(S>=T){let T=R.subchannel.getConnectivityState();if(T===O.ConnectivityState.IDLE||T===O.ConnectivityState.CONNECTING){this.startConnecting(S);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(T){var S,R;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=T,this.children[T].subchannel.getConnectivityState()===O.ConnectivityState.IDLE&&(V("Start connecting to subchannel with address "+this.children[T].subchannel.getAddress()),process.nextTick(()=>{var S;null===(S=this.children[T])||void 0===S||S.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(R=(S=setTimeout(()=>{this.startNextSubchannelConnecting(T+1)},K)).unref)||void 0===R?void 0:R.call(S)}pickSubchannel(T){this.currentPick&&T.realSubchannelEquals(this.currentPick)||(V("Pick subchannel with address "+T.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=T,T.ref(),this.channelControlHelper.addChannelzChild(T.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(T,S){V(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[T]),this.currentState=T,this.channelControlHelper.updateState(T,S)}resetSubchannelList(){for(let T of this.children)this.currentPick&&T.subchannel.realSubchannelEquals(this.currentPick)||T.subchannel.removeConnectivityStateListener(this.subchannelStateListener),T.subchannel.unref(),this.channelControlHelper.removeChannelzChild(T.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(T){let S=T.map(T=>({subchannel:this.channelControlHelper.createSubchannel(T,{}),hasReportedTransientFailure:!1}));for(let{subchannel:T}of S)T.ref(),this.channelControlHelper.addChannelzChild(T.getChannelzRef());for(let{subchannel:T}of(this.resetSubchannelList(),this.children=S,this.children))if(T.addConnectivityStateListener(this.subchannelStateListener),T.getConnectivityState()===O.ConnectivityState.READY){this.pickSubchannel(T);return}for(let T of this.children)T.subchannel.getConnectivityState()===O.ConnectivityState.TRANSIENT_FAILURE&&(T.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(T,S){S instanceof W&&(S.getShuffleAddressList()&&(T=Y(T)),this.latestAddressList=T,this.connectToAddressList(T))}exitIdle(){this.currentState===O.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return $}}function Z(){(0,N.registerLoadBalancerType)($,X,W),(0,N.registerDefaultLoadBalancerType)($)}S.PickFirstLoadBalancer=X,S.setup=Z},62255:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=S.RoundRobinLoadBalancer=void 0;let N=R(27176),O=R(33955),P=R(17064),M=R(23906),L=R(97504),U=R(32678),V="round_robin";function $(T){L.trace(U.LogVerbosity.DEBUG,V,T)}let K="round_robin";class W{getLoadBalancerName(){return K}constructor(){}toJsonObject(){return{[K]:{}}}static createFromJson(T){return new W}}class Q{constructor(T,S=0){this.subchannelList=T,this.nextIndex=S}pick(T){let S=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:P.PickResultType.COMPLETE,subchannel:S,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class Y{constructor(T){this.channelControlHelper=T,this.subchannels=[],this.currentState=O.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(T,S,R,N,P)=>{this.calculateAndUpdateState(),(R===O.ConnectivityState.TRANSIENT_FAILURE||R===O.ConnectivityState.IDLE)&&(P&&(this.lastError=P),this.channelControlHelper.requestReresolution(),T.startConnecting())}}countSubchannelsWithState(T){return this.subchannels.filter(S=>S.getConnectivityState()===T).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(O.ConnectivityState.READY)>0){let T=this.subchannels.filter(T=>T.getConnectivityState()===O.ConnectivityState.READY),S=0;null!==this.currentReadyPicker&&(S=T.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(S=0),this.updateState(O.ConnectivityState.READY,new Q(T,S))}else this.countSubchannelsWithState(O.ConnectivityState.CONNECTING)>0?this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this)):this.countSubchannelsWithState(O.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this))}updateState(T,S){$(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[T]),T===O.ConnectivityState.READY?this.currentReadyPicker=S:this.currentReadyPicker=null,this.currentState=T,this.channelControlHelper.updateState(T,S)}resetSubchannelList(){for(let T of this.subchannels)T.removeConnectivityStateListener(this.subchannelStateListener),T.unref(),this.channelControlHelper.removeChannelzChild(T.getChannelzRef());this.subchannels=[]}updateAddressList(T,S){for(let S of(this.resetSubchannelList(),$("Connect to address list "+T.map(T=>(0,M.subchannelAddressToString)(T))),this.subchannels=T.map(T=>this.channelControlHelper.createSubchannel(T,{})),this.subchannels)){S.ref(),S.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(S.getChannelzRef());let T=S.getConnectivityState();(T===O.ConnectivityState.IDLE||T===O.ConnectivityState.TRANSIENT_FAILURE)&&S.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let T of this.subchannels)T.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return K}}function X(){(0,N.registerLoadBalancerType)(K,Y,W)}S.RoundRobinLoadBalancer=Y,S.setup=X},27176:(T,S)=>{"use strict";function R(T,S){var R,N,O,P,M,L,U,V,$,K;return{createSubchannel:null!==(N=null===(R=S.createSubchannel)||void 0===R?void 0:R.bind(S))&&void 0!==N?N:T.createSubchannel.bind(T),updateState:null!==(P=null===(O=S.updateState)||void 0===O?void 0:O.bind(S))&&void 0!==P?P:T.updateState.bind(T),requestReresolution:null!==(L=null===(M=S.requestReresolution)||void 0===M?void 0:M.bind(S))&&void 0!==L?L:T.requestReresolution.bind(T),addChannelzChild:null!==(V=null===(U=S.addChannelzChild)||void 0===U?void 0:U.bind(S))&&void 0!==V?V:T.addChannelzChild.bind(T),removeChannelzChild:null!==(K=null===($=S.removeChannelzChild)||void 0===$?void 0:$.bind(S))&&void 0!==K?K:T.removeChannelzChild.bind(T)}}Object.defineProperty(S,"__esModule",{value:!0}),S.validateLoadBalancingConfig=S.getFirstUsableConfig=S.isLoadBalancerNameRegistered=S.createLoadBalancer=S.registerDefaultLoadBalancerType=S.registerLoadBalancerType=S.createChildChannelControlHelper=void 0,S.createChildChannelControlHelper=R;let N={},O=null;function P(T,S,R){N[T]={LoadBalancer:S,LoadBalancingConfig:R}}function M(T){O=T}function L(T,S){let R=T.getLoadBalancerName();return R in N?new N[R].LoadBalancer(S):null}function U(T){return T in N}function V(T,S=!1){for(let S of T)if(S.getLoadBalancerName() in N)return S;return S&&O?new N[O].LoadBalancingConfig:null}function $(T){if(!(null!==T&&"object"==typeof T))throw Error("Load balancing config must be an object");let S=Object.keys(T);if(1!==S.length)throw Error("Provided load balancing config has multiple conflicting entries");let R=S[0];if(R in N)return N[R].LoadBalancingConfig.createFromJson(T[R]);throw Error(`Unrecognized load balancing config name ${R}`)}S.registerLoadBalancerType=P,S.registerDefaultLoadBalancerType=M,S.createLoadBalancer=L,S.isLoadBalancerNameRegistered=U,S.getFirstUsableConfig=V,S.validateLoadBalancingConfig=$},60980:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.LoadBalancingCall=void 0;let N=R(33955),O=R(32678),P=R(7931),M=R(62252),L=R(17064),U=R(18429),V=R(97504),$=R(82155),K=R(85158),W="load_balancing_call";class Q{constructor(T,S,R,N,O,P,M){var L,V;this.channel=T,this.callConfig=S,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let $=this.methodName.split("/"),K="";$.length>=2&&(K=$[1]);let W=null!==(V=null===(L=(0,U.splitHostPort)(this.host))||void 0===L?void 0:L.host)&&void 0!==V?V:"localhost";this.serviceUrl=`https://${W}/${K}`}trace(T){V.trace(O.LogVerbosity.DEBUG,W,"["+this.callNumber+"] "+T)}outputStatus(T,S){var R,N;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+T.code+' details="'+T.details+'"');let O=Object.assign(Object.assign({},T),{progress:S});null===(R=this.listener)||void 0===R||R.onReceiveStatus(O),null===(N=this.onCallEnded)||void 0===N||N.call(this,O.code)}}doPick(){var T,S;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let R=this.channel.doPick(this.metadata,this.callConfig.pickInformation),U=R.subchannel?"("+R.subchannel.getChannelzRef().id+") "+R.subchannel.getAddress():""+R.subchannel;switch(this.trace("Pick result: "+L.PickResultType[R.pickResultType]+" subchannel: "+U+" status: "+(null===(T=R.status)||void 0===T?void 0:T.code)+" "+(null===(S=R.status)||void 0===S?void 0:S.details)),R.pickResultType){case L.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(T=>{var S,L,V;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let $=this.metadata.clone();if($.merge(T),$.get("authorization").length>1&&this.outputStatus({code:O.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new M.Metadata},"PROCESSED"),R.subchannel.getConnectivityState()!==N.ConnectivityState.READY){this.trace("Picked subchannel "+U+" has state "+N.ConnectivityState[R.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&$.set("grpc-timeout",(0,P.getDeadlineTimeoutString)(this.deadline));try{this.child=R.subchannel.getRealSubchannel().createCall($,this.host,this.methodName,{onReceiveMetadata:T=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(T)},onReceiveMessage:T=>{this.trace("Received message"),this.listener.onReceiveMessage(T)},onReceiveStatus:T=>{this.trace("Received status"),T.rstCode===K.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(T,"REFUSED"):this.outputStatus(T,"PROCESSED")}})}catch(T){this.trace("Failed to start call on picked subchannel "+U+" with error "+T.message),this.outputStatus({code:O.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+T.message,metadata:new M.Metadata},"NOT_STARTED");return}null===(L=(S=this.callConfig).onCommitted)||void 0===L||L.call(S),null===(V=R.onCallStarted)||void 0===V||V.call(R),this.onCallEnded=R.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},T=>{let{code:S,details:R}=(0,$.restrictControlPlaneStatusCode)("number"==typeof T.code?T.code:O.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${T.message}`);this.outputStatus({code:S,details:R,metadata:new M.Metadata},"PROCESSED")});break;case L.PickResultType.DROP:let{code:V,details:W}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:V,details:W,metadata:R.status.metadata},"DROP")});break;case L.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:T,details:S}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:T,details:S,metadata:R.status.metadata},"PROCESSED")})}break;case L.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(T,S){var R;this.trace("cancelWithStatus code: "+T+' details: "'+S+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(T,S),this.outputStatus({code:T,details:S,metadata:new M.Metadata},"PROCESSED")}getPeer(){var T,S;return null!==(S=null===(T=this.child)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:this.channel.getTarget()}start(T,S){this.trace("start called"),this.listener=S,this.metadata=T,this.doPick()}sendMessageWithContext(T,S){this.trace("write() called with message of length "+S.length),this.child?this.child.sendMessageWithContext(T,S):this.pendingMessage={context:T,message:S}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(T){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}S.LoadBalancingCall=Q},97504:(T,S,R)=>{"use strict";var N,O,P,M;Object.defineProperty(S,"__esModule",{value:!0}),S.isTracerEnabled=S.trace=S.log=S.setLoggerVerbosity=S.setLogger=S.getLogger=void 0;let L=R(32678),U=R(77282),V=R(81513).i8,$={error:(T,...S)=>{},info:(T,...S)=>{},debug:(T,...S)=>{}},K=L.LogVerbosity.ERROR;switch((null!==(O=null!==(N=process.env.GRPC_NODE_VERBOSITY)&&void 0!==N?N:process.env.GRPC_VERBOSITY)&&void 0!==O?O:"").toUpperCase()){case"DEBUG":K=L.LogVerbosity.DEBUG;break;case"INFO":K=L.LogVerbosity.INFO;break;case"ERROR":K=L.LogVerbosity.ERROR;break;case"NONE":K=L.LogVerbosity.NONE}let W=()=>$;S.getLogger=W;let Q=T=>{$=T};S.setLogger=Q;let Y=T=>{K=T};S.setLoggerVerbosity=Y;let X=(T,...S)=>{let R;if(T>=K){switch(T){case L.LogVerbosity.DEBUG:R=$.debug;break;case L.LogVerbosity.INFO:R=$.info;break;case L.LogVerbosity.ERROR:R=$.error}R||(R=$.error),R&&R.bind($)(...S)}};S.log=X;let Z=null!==(M=null!==(P=process.env.GRPC_NODE_TRACE)&&void 0!==P?P:process.env.GRPC_TRACE)&&void 0!==M?M:"",ee=new Set,et=new Set;for(let T of Z.split(","))T.startsWith("-")?et.add(T.substring(1)):ee.add(T);let er=ee.has("all");function en(T,R,N){ei(R)&&(0,S.log)(T,new Date().toISOString()+" | v"+V+" "+U.pid+" | "+R+" | "+N)}function ei(T){return!et.has(T)&&(er||ee.has(T))}S.trace=en,S.isTracerEnabled=ei},35085:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.loadPackageDefinition=S.makeClientConstructor=void 0;let N=R(69800),O={unary:N.Client.prototype.makeUnaryRequest,server_stream:N.Client.prototype.makeServerStreamRequest,client_stream:N.Client.prototype.makeClientStreamRequest,bidi:N.Client.prototype.makeBidiStreamRequest};function P(T){return["__proto__","prototype","constructor"].includes(T)}function M(T,S,R){R||(R={});class M extends N.Client{}return Object.keys(T).forEach(S=>{let R;if(P(S))return;let N=T[S];if("string"==typeof S&&"$"===S.charAt(0))throw Error("Method names cannot start with $");R=N.requestStream?N.responseStream?"bidi":"client_stream":N.responseStream?"server_stream":"unary";let U=N.requestSerialize,V=N.responseDeserialize,$=L(O[R],N.path,U,V);M.prototype[S]=$,Object.assign(M.prototype[S],N),N.originalName&&!P(N.originalName)&&(M.prototype[N.originalName]=M.prototype[S])}),M.service=T,M.serviceName=S,M}function L(T,S,R,N){return function(...O){return T.call(this,S,R,N,...O)}}function U(T){return"format"in T}function V(T){let S={};for(let R in T)if(Object.prototype.hasOwnProperty.call(T,R)){let N=T[R],O=R.split(".");if(O.some(T=>P(T)))continue;let L=O[O.length-1],V=S;for(let T of O.slice(0,-1))V[T]||(V[T]={}),V=V[T];U(N)?V[L]=N:V[L]=M(N,L,{})}return S}S.makeClientConstructor=M,S.loadPackageDefinition=V},62252:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Metadata=void 0;let N=R(97504),O=R(32678),P=R(75437),M=/^[0-9a-z_.-]+$/,L=/^[ -~]*$/;function U(T){return M.test(T)}function V(T){return L.test(T)}function $(T){return T.endsWith("-bin")}function K(T){return!T.startsWith("grpc-")}function W(T){return T.toLowerCase()}function Q(T,S){if(!U(T))throw Error('Metadata key "'+T+'" contains illegal characters');if(null!=S){if($(T)){if(!Buffer.isBuffer(S))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(S))throw Error("keys that don't end with '-bin' must have String values");if(!V(S))throw Error('Metadata string value "'+S+'" contains illegal characters')}}}class Y{constructor(T={}){this.internalRepr=new Map,this.options=T}set(T,S){Q(T=W(T),S),this.internalRepr.set(T,[S])}add(T,S){Q(T=W(T),S);let R=this.internalRepr.get(T);void 0===R?this.internalRepr.set(T,[S]):R.push(S)}remove(T){T=W(T),this.internalRepr.delete(T)}get(T){return T=W(T),this.internalRepr.get(T)||[]}getMap(){let T={};for(let[S,R]of this.internalRepr)if(R.length>0){let N=R[0];T[S]=Buffer.isBuffer(N)?Buffer.from(N):N}return T}clone(){let T=new Y(this.options),S=T.internalRepr;for(let[T,R]of this.internalRepr){let N=R.map(T=>Buffer.isBuffer(T)?Buffer.from(T):T);S.set(T,N)}return T}merge(T){for(let[S,R]of T.internalRepr){let T=(this.internalRepr.get(S)||[]).concat(R);this.internalRepr.set(S,T)}}setOptions(T){this.options=T}getOptions(){return this.options}toHttp2Headers(){let T={};for(let[S,R]of this.internalRepr)T[S]=R.map(X);return T}toJSON(){let T={};for(let[S,R]of this.internalRepr)T[S]=R;return T}static fromHttp2Headers(T){let S=new Y;for(let R of Object.keys(T)){if(":"===R.charAt(0))continue;let M=T[R];try{$(R)?Array.isArray(M)?M.forEach(T=>{S.add(R,Buffer.from(T,"base64"))}):void 0!==M&&(K(R)?M.split(",").forEach(T=>{S.add(R,Buffer.from(T.trim(),"base64"))}):S.add(R,Buffer.from(M,"base64"))):Array.isArray(M)?M.forEach(T=>{S.add(R,T)}):void 0!==M&&S.add(R,M)}catch(S){let T=`Failed to add metadata entry ${R}: ${M}. ${(0,P.getErrorMessage)(S)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,N.log)(O.LogVerbosity.ERROR,T)}}return S}}S.Metadata=Y;let X=T=>Buffer.isBuffer(T)?T.toString("base64"):T},17064:(T,S,R)=>{"use strict";var N;Object.defineProperty(S,"__esModule",{value:!0}),S.QueuePicker=S.UnavailablePicker=S.PickResultType=void 0;let O=R(62252),P=R(32678);!function(T){T[T.COMPLETE=0]="COMPLETE",T[T.QUEUE=1]="QUEUE",T[T.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",T[T.DROP=3]="DROP"}(N||(S.PickResultType=N={}));class M{constructor(T){this.status=Object.assign({code:P.Status.UNAVAILABLE,details:"No connection established",metadata:new O.Metadata},T)}pick(T){return{pickResultType:N.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}S.UnavailablePicker=M;class L{constructor(T){this.loadBalancer=T,this.calledExitIdle=!1}pick(T){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:N.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}S.QueuePicker=L},54605:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=S.DEFAULT_PORT=void 0;let N=R(40492),O=R(9523),P=R(73837),M=R(26262),L=R(32678),U=R(62252),V=R(97504),$=R(32678),K=R(18429),W=R(41808),Q=R(84934),Y="dns_resolver";function X(T){V.trace($.LogVerbosity.DEBUG,Y,T)}S.DEFAULT_PORT=443;let Z=3e4,ee=P.promisify(O.resolveTxt),et=P.promisify(O.lookup);function er(...T){let S=[];for(let R=0;R<Math.max.apply(null,T.map(T=>T.length));R++)for(let N of T)R<N.length&&S.push(N[R]);return S}class en{constructor(T,R,N){var O,P,M;this.target=T,this.listener=R,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,X("Resolver constructed for target "+(0,K.uriToString)(T));let V=(0,K.splitHostPort)(T.path);null===V?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,W.isIPv4)(V.host)||(0,W.isIPv6)(V.host)?(this.ipResult=[{host:V.host,port:null!==(O=V.port)&&void 0!==O?O:S.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=V.host,this.port=null!==(P=V.port)&&void 0!==P?P:S.DEFAULT_PORT),this.percentage=100*Math.random(),1===N["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:L.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata};let $={initialDelay:N["grpc.initial_reconnect_backoff_ms"],maxDelay:N["grpc.max_reconnect_backoff_ms"]};this.backoff=new Q.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},$),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(M=N["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==M?M:Z,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(X("Returning IP address for target "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)X("Failed to parse DNS address "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:L.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;X("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let T=this.dnsHostname;this.pendingLookupPromise=et(T,{all:!0}),this.pendingLookupPromise.then(T=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let S=T.filter(T=>4===T.family),R=T.filter(T=>6===T.family);this.latestLookupResult=er(R,S).map(T=>({host:T.address,port:+this.port}));let N="["+this.latestLookupResult.map(T=>T.host+":"+T.port).join(",")+"]";if(X("Resolved addresses for target "+(0,K.uriToString)(this.target)+": "+N),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},T=>{null!==this.pendingLookupPromise&&(X("Resolution error for target "+(0,K.uriToString)(this.target)+": "+T.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=ee(T),this.pendingTxtPromise.then(T=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,M.extractAndSelectServiceConfig)(T,this.percentage)}catch(T){this.latestServiceConfigError={code:L.Status.UNAVAILABLE,details:`Parsing service config failed with error ${T.message}`,metadata:new U.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},T=>{}))}}startNextResolutionTimer(){var T,S;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(S=(T=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===S?void 0:S.call(T),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?X('resolution update delayed by "min time between resolutions" rate limit'):X("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(T){return T.path}}function ei(){(0,N.registerResolver)("dns",en),(0,N.registerDefaultScheme)("dns")}S.setup=ei},53562:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=void 0;let N=R(41808),O=R(32678),P=R(62252),M=R(40492),L=R(18429),U=R(97504),V="ip_resolver";function $(T){U.trace(O.LogVerbosity.DEBUG,V,T)}let K="ipv4",W="ipv6",Q=443;class Y{constructor(T,S,R){var M;this.listener=S,this.addresses=[],this.error=null,this.hasReturnedResult=!1,$("Resolver constructed for target "+(0,L.uriToString)(T));let U=[];if(!(T.scheme===K||T.scheme===W)){this.error={code:O.Status.UNAVAILABLE,details:`Unrecognized scheme ${T.scheme} in IP resolver`,metadata:new P.Metadata};return}for(let S of T.path.split(",")){let R=(0,L.splitHostPort)(S);if(null===R||T.scheme===K&&!(0,N.isIPv4)(R.host)||T.scheme===W&&!(0,N.isIPv6)(R.host)){this.error={code:O.Status.UNAVAILABLE,details:`Failed to parse ${T.scheme} address ${S}`,metadata:new P.Metadata};return}U.push({host:R.host,port:null!==(M=R.port)&&void 0!==M?M:Q})}this.addresses=U,$("Parsed "+T.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(T){return T.path.split(",")[0]}}function X(){(0,M.registerResolver)(K,Y),(0,M.registerResolver)(W,Y)}S.setup=X},45862:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.setup=void 0;let N=R(40492);class O{constructor(T,S,R){let N;this.listener=S,this.addresses=[],this.hasReturnedResult=!1,N=""===T.authority?"/"+T.path:T.path,this.addresses=[{path:N}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(T){return"localhost"}}function P(){(0,N.registerResolver)("unix",O)}S.setup=P},40492:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.mapUriDefaultScheme=S.getDefaultAuthority=S.createResolver=S.registerDefaultScheme=S.registerResolver=void 0;let N=R(18429),O={},P=null;function M(T,S){O[T]=S}function L(T){P=T}function U(T,S,R){if(void 0!==T.scheme&&T.scheme in O)return new O[T.scheme](T,S,R);throw Error(`No resolver could be created for target ${(0,N.uriToString)(T)}`)}function V(T){if(void 0!==T.scheme&&T.scheme in O)return O[T.scheme].getDefaultAuthority(T);throw Error(`Invalid target ${(0,N.uriToString)(T)}`)}function $(T){return void 0!==T.scheme&&T.scheme in O?T:null!==P?{scheme:P,authority:void 0,path:(0,N.uriToString)(T)}:null}S.registerResolver=M,S.registerDefaultScheme=L,S.createResolver=U,S.getDefaultAuthority=V,S.mapUriDefaultScheme=$},63003:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ResolvingCall=void 0;let N=R(32678),O=R(7931),P=R(62252),M=R(97504),L=R(82155),U="resolving_call";class V{constructor(T,S,R,P,M,L){this.channel=T,this.method=S,this.filterStackFactory=P,this.credentials=M,this.callNumber=L,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=R.deadline,this.host=R.host,R.parentCall&&(R.flags&N.Propagate.CANCELLATION&&R.parentCall.on("cancelled",()=>{this.cancelWithStatus(N.Status.CANCELLED,"Cancelled by parent call")}),R.flags&N.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+R.parentCall.getDeadline()),this.deadline=(0,O.minDeadline)(this.deadline,R.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(T){M.trace(N.LogVerbosity.DEBUG,U,"["+this.callNumber+"] "+T)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,O.deadlineToString)(this.deadline));let T=(0,O.getRelativeTimeout)(this.deadline);if(T!==1/0){this.trace("Deadline will be reached in "+T+"ms");let S=()=>{this.cancelWithStatus(N.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};T<=0?process.nextTick(S):this.deadlineTimer=setTimeout(S,T)}}outputStatus(T){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let S=this.filterStack.receiveTrailers(T);this.trace("ended with status: code="+S.code+' details="'+S.details+'"'),this.statusWatchers.forEach(T=>T(S)),process.nextTick(()=>{var T;null===(T=this.listener)||void 0===T||T.onReceiveStatus(S)})}}sendMessageOnChild(T,S){if(!this.child)throw Error("sendMessageonChild called with child not populated");let R=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:S,flags:T.flags})).then(S=>{this.writeFilterPending=!1,R.sendMessageWithContext(T,S.message),this.pendingHalfClose&&R.halfClose()},T=>{this.cancelWithStatus(T.code,T.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let T=this.channel.getConfig(this.method,this.metadata);if("NONE"===T.type){this.channel.queueCallForConfig(this);return}if("ERROR"===T.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(T.error);return}let S=T.config;if(S.status!==N.Status.OK){let{code:T,details:R}=(0,L.restrictControlPlaneStatusCode)(S.status,"Failed to route call to method "+this.method);this.outputStatus({code:T,details:R,metadata:new P.Metadata});return}if(S.methodConfig.timeout){let T=new Date;T.setSeconds(T.getSeconds()+S.methodConfig.timeout.seconds),T.setMilliseconds(T.getMilliseconds()+S.methodConfig.timeout.nanos/1e6),this.deadline=(0,O.minDeadline)(this.deadline,T),this.runDeadlineTimer()}this.filterStackFactory.push(S.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(T=>{this.child=this.channel.createInnerCall(S,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(T,{onReceiveMetadata:T=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(T))},onReceiveMessage:T=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(T).then(T=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(T),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},T=>{this.cancelWithStatus(T.code,T.details)})},onReceiveStatus:T=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=T:this.outputStatus(T)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},T=>{this.outputStatus(T)})}reportResolverError(T){var S;(null===(S=this.metadata)||void 0===S?void 0:S.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(T)}cancelWithStatus(T,S){var R;this.trace("cancelWithStatus code: "+T+' details: "'+S+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(T,S),this.outputStatus({code:T,details:S,metadata:new P.Metadata})}getPeer(){var T,S;return null!==(S=null===(T=this.child)||void 0===T?void 0:T.getPeer())&&void 0!==S?S:this.channel.getTarget()}start(T,S){this.trace("start called"),this.metadata=T.clone(),this.listener=S,this.getConfig()}sendMessageWithContext(T,S){this.trace("write() called with message of length "+S.length),this.child?this.sendMessageOnChild(T,S):this.pendingMessage={context:T,message:S}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(T){this.credentials=this.credentials.compose(T)}addStatusWatcher(T){this.statusWatchers.push(T)}getCallNumber(){return this.callNumber}}S.ResolvingCall=V},82380:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ResolvingLoadBalancer=void 0;let N=R(27176),O=R(26262),P=R(33955),M=R(40492),L=R(17064),U=R(84934),V=R(32678),$=R(62252),K=R(97504),W=R(32678),Q=R(18429),Y=R(982),X="resolving_load_balancer";function Z(T){K.trace(W.LogVerbosity.DEBUG,X,T)}let ee=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function et(T,S,R,N){for(let O of R.name)switch(N){case"EMPTY":if(!O.service&&!O.method)return!0;break;case"SERVICE":if(O.service===T&&!O.method)return!0;break;case"SERVICE_AND_METHOD":if(O.service===T&&O.method===S)return!0}return!1}function er(T,S,R,N){for(let O of R)if(et(T,S,O,N))return O;return null}function en(T){return function(S,R){var N,O;let P=S.split("/").filter(T=>T.length>0),M=null!==(N=P[0])&&void 0!==N?N:"",L=null!==(O=P[1])&&void 0!==O?O:"";if(T&&T.methodConfig)for(let S of ee){let R=er(M,L,T.methodConfig,S);if(R)return{methodConfig:R,pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}}class ei{constructor(T,S,R,K,W){this.target=T,this.channelControlHelper=S,this.onSuccessfulResolution=K,this.onFailedResolution=W,this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,R["grpc.service_config"]?this.defaultServiceConfig=(0,O.validateServiceConfig)(JSON.parse(R["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(P.ConnectivityState.IDLE,new L.QueuePicker(this)),this.childLoadBalancer=new Y.ChildLoadBalancerHandler({createSubchannel:S.createSubchannel.bind(S),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Z("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(T,S)=>{this.latestChildState=T,this.latestChildPicker=S,this.updateState(T,S)},addChannelzChild:S.addChannelzChild.bind(S),removeChannelzChild:S.removeChannelzChild.bind(S)}),this.innerResolver=(0,M.createResolver)(T,{onSuccessfulResolution:(T,S,R,O,P)=>{var M;this.backoffTimeout.stop(),this.backoffTimeout.reset();let L=null;null===S?null===R?(this.previousServiceConfig=null,L=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(R):L=this.previousServiceConfig:(L=S,this.previousServiceConfig=S);let U=null!==(M=null==L?void 0:L.loadBalancingConfig)&&void 0!==M?M:[],K=(0,N.getFirstUsableConfig)(U,!0);if(null===K){this.handleResolutionFailure({code:V.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new $.Metadata});return}this.childLoadBalancer.updateAddressList(T,K,P);let W=null!=L?L:this.defaultServiceConfig;this.onSuccessfulResolution(W,null!=O?O:en(W))},onError:T=>{this.handleResolutionFailure(T)}},R);let Q={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new U.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},Q),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===P.ConnectivityState.IDLE&&this.updateState(P.ConnectivityState.CONNECTING,new L.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(T,S){Z((0,Q.uriToString)(this.target)+" "+P.ConnectivityState[this.currentState]+" -> "+P.ConnectivityState[T]),T===P.ConnectivityState.IDLE&&(S=new L.QueuePicker(this)),this.currentState=T,this.channelControlHelper.updateState(T,S)}handleResolutionFailure(T){this.latestChildState===P.ConnectivityState.IDLE&&(this.updateState(P.ConnectivityState.TRANSIENT_FAILURE,new L.UnavailablePicker(T)),this.onFailedResolution(T))}exitIdle(){(this.currentState===P.ConnectivityState.IDLE||this.currentState===P.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(T,S){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}S.ResolvingLoadBalancer=ei},44398:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.RetryingCall=S.MessageBufferTracker=S.RetryThrottler=void 0;let N=R(32678),O=R(62252),P=R(97504),M="retrying_call";class L{constructor(T,S,R){this.maxTokens=T,this.tokenRatio=S,R?this.tokens=R.tokens*(T/R.maxTokens):this.tokens=T}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}S.RetryThrottler=L;class U{constructor(T,S){this.totalLimit=T,this.limitPerCall=S,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(T,S){var R;let N=null!==(R=this.allocatedPerCall.get(S))&&void 0!==R?R:0;return!(this.limitPerCall-N<T)&&!(this.totalLimit-this.totalAllocated<T)&&(this.allocatedPerCall.set(S,N+T),this.totalAllocated+=T,!0)}free(T,S){var R;if(this.totalAllocated<T)throw Error(`Invalid buffer allocation state: call ${S} freed ${T} > total allocated ${this.totalAllocated}`);this.totalAllocated-=T;let N=null!==(R=this.allocatedPerCall.get(S))&&void 0!==R?R:0;if(N<T)throw Error(`Invalid buffer allocation state: call ${S} freed ${T} > allocated for call ${N}`);this.allocatedPerCall.set(S,N-T)}freeAll(T){var S;let R=null!==(S=this.allocatedPerCall.get(T))&&void 0!==S?S:0;if(this.totalAllocated<R)throw Error(`Invalid buffer allocation state: call ${T} allocated ${R} > total allocated ${this.totalAllocated}`);this.totalAllocated-=R,this.allocatedPerCall.delete(T)}}S.MessageBufferTracker=U;let V="grpc-previous-rpc-attempts";class ${constructor(T,S,R,N,O,P,M,L,U){if(this.channel=T,this.callConfig=S,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.bufferTracker=L,this.retryThrottler=U,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,S.methodConfig.retryPolicy){this.state="RETRY";let T=S.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(T.initialBackoff.substring(0,T.initialBackoff.length-1))}else S.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(T){P.trace(N.LogVerbosity.DEBUG,M,"["+this.callNumber+"] "+T)}reportStatus(T){this.trace("ended with status: code="+T.code+' details="'+T.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var S;null===(S=this.listener)||void 0===S||S.onReceiveStatus({code:T.code,details:T.details,metadata:T.metadata})})}cancelWithStatus(T,S){for(let{call:R}of(this.trace("cancelWithStatus code: "+T+' details: "'+S+'"'),this.reportStatus({code:T,details:S,metadata:new O.Metadata}),this.underlyingCalls))R.cancelWithStatus(T,S)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(T){var S;return null!==(S=this.writeBuffer[T-this.writeBufferOffset])&&void 0!==S?S:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let T=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let S=this.writeBufferOffset;S<T;S++){let T=this.getBufferEntry(S);T.allocated&&this.bufferTracker.free(T.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(T-this.writeBufferOffset),this.writeBufferOffset=T}commitCall(T){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[T].state){this.trace("Committing call ["+this.underlyingCalls[T].call.getCallNumber()+"] at index "+T),this.state="COMMITTED",this.committedCallIndex=T;for(let S=0;S<this.underlyingCalls.length;S++)S!==T&&"COMPLETED"!==this.underlyingCalls[S].state&&(this.underlyingCalls[S].state="COMPLETED",this.underlyingCalls[S].call.cancelWithStatus(N.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let T=-1,S=-1;for(let[R,N]of this.underlyingCalls.entries())"ACTIVE"===N.state&&N.nextMessageToSend>T&&(T=N.nextMessageToSend,S=R);-1===S?this.state="TRANSPARENT_ONLY":this.commitCall(S)}isStatusCodeInList(T,S){return T.some(T=>T===S||T.toString().toLowerCase()===N.Status[S].toLowerCase())}getNextRetryBackoffMs(){var T;let S=null===(T=this.callConfig)||void 0===T?void 0:T.methodConfig.retryPolicy;if(!S)return 0;let R=Math.random()*this.nextRetryBackoffSec*1e3,N=Number(S.maxBackoff.substring(0,S.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*S.backoffMultiplier,N),R}maybeRetryCall(T,S){let R;if("RETRY"!==this.state){S(!1);return}let N=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(N.maxAttempts,5)){S(!1);return}if(null===T)R=this.getNextRetryBackoffMs();else if(T<0){this.state="TRANSPARENT_ONLY",S(!1);return}else R=T,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var T,R;if("RETRY"!==this.state){S(!1);return}(null===(R=null===(T=this.retryThrottler)||void 0===T?void 0:T.canRetryCall())||void 0===R||R)&&(S(!0),this.attempts+=1,this.startNewAttempt())},R)}countActiveCalls(){let T=0;for(let S of this.underlyingCalls)(null==S?void 0:S.state)==="ACTIVE"&&(T+=1);return T}handleProcessedStatus(T,S,R){var N,O,P;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(S),this.reportStatus(T);break;case"HEDGING":if(this.isStatusCodeInList(null!==(N=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==N?N:[],T.code)){let N;if(null===(O=this.retryThrottler)||void 0===O||O.addCallFailed(),null===R)N=0;else if(R<0){this.state="TRANSPARENT_ONLY",this.commitCall(S),this.reportStatus(T);return}else N=R;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(S),this.reportStatus(T))},N)}else this.commitCall(S),this.reportStatus(T);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,T.code)?(null===(P=this.retryThrottler)||void 0===P||P.addCallFailed(),this.maybeRetryCall(R,R=>{R||(this.commitCall(S),this.reportStatus(T))})):(this.commitCall(S),this.reportStatus(T))}}getPushback(T){let S=T.get("grpc-retry-pushback-ms");if(0===S.length)return null;try{return parseInt(S[0])}catch(T){return -1}}handleChildStatus(T,S){var R;if("COMPLETED"===this.underlyingCalls[S].state)return;if(this.trace("state="+this.state+" handling status with progress "+T.progress+" from child ["+this.underlyingCalls[S].call.getCallNumber()+"] in state "+this.underlyingCalls[S].state),this.underlyingCalls[S].state="COMPLETED",T.code===N.Status.OK){null===(R=this.retryThrottler)||void 0===R||R.addCallSucceeded(),this.commitCall(S),this.reportStatus(T);return}if("COMMITTED"===this.state){this.reportStatus(T);return}let O=this.getPushback(T.metadata);switch(T.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(T,S,O):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(S),this.reportStatus(T);break;case"PROCESSED":this.handleProcessedStatus(T,S,O)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let T=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(T.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var T,S,R;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let N=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(N.maxAttempts,5))return;let O=null!==(T=N.hedgingDelay)&&void 0!==T?T:"0s",P=Number(O.substring(0,O.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*P),null===(R=(S=this.hedgingTimer).unref)||void 0===R||R.call(S)}startNewAttempt(){let T=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+T.getCallNumber()+"] for attempt "+this.attempts);let S=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:T,nextMessageToSend:0});let R=this.attempts-1,N=this.initialMetadata.clone();R>0&&N.set(V,`${R}`);let O=!1;T.start(N,{onReceiveMetadata:N=>{this.trace("Received metadata from child ["+T.getCallNumber()+"]"),this.commitCall(S),O=!0,R>0&&N.set(V,`${R}`),"ACTIVE"===this.underlyingCalls[S].state&&this.listener.onReceiveMetadata(N)},onReceiveMessage:R=>{this.trace("Received message from child ["+T.getCallNumber()+"]"),this.commitCall(S),"ACTIVE"===this.underlyingCalls[S].state&&this.listener.onReceiveMessage(R)},onReceiveStatus:N=>{this.trace("Received status from child ["+T.getCallNumber()+"]"),!O&&R>0&&N.metadata.set(V,`${R}`),this.handleChildStatus(N,S)}}),this.sendNextChildMessage(S),this.readStarted&&T.startRead()}start(T,S){this.trace("start called"),this.listener=S,this.initialMetadata=T,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(T){var S,R;let N=this.underlyingCalls[T],O=N.nextMessageToSend;null===(R=(S=this.getBufferEntry(O)).callback)||void 0===R||R.call(S),this.clearSentMessages(),N.nextMessageToSend+=1,this.sendNextChildMessage(T)}sendNextChildMessage(T){let S=this.underlyingCalls[T];if("COMPLETED"!==S.state&&this.getBufferEntry(S.nextMessageToSend)){let R=this.getBufferEntry(S.nextMessageToSend);switch(R.entryType){case"MESSAGE":S.call.sendMessageWithContext({callback:S=>{this.handleChildWriteCompleted(T)}},R.message.message);break;case"HALF_CLOSE":S.nextMessageToSend+=1,S.call.halfClose()}}}sendMessageWithContext(T,S){var R;this.trace("write() called with message of length "+S.length);let N={message:S,flags:T.flags},O=this.getNextBufferIndex(),P={entryType:"MESSAGE",message:N,allocated:this.bufferTracker.allocate(S.length,this.callNumber)};if(this.writeBuffer.push(P),P.allocated)for(let[N,P]of(null===(R=T.callback)||void 0===R||R.call(T),this.underlyingCalls.entries()))"ACTIVE"===P.state&&P.nextMessageToSend===O&&P.call.sendMessageWithContext({callback:T=>{this.handleChildWriteCompleted(N)}},S);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let R=this.underlyingCalls[this.committedCallIndex];P.callback=T.callback,"ACTIVE"===R.state&&R.nextMessageToSend===O&&R.call.sendMessageWithContext({callback:T=>{this.handleChildWriteCompleted(this.committedCallIndex)}},S)}}startRead(){for(let T of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==T?void 0:T.state)==="ACTIVE"&&T.call.startRead()}halfClose(){this.trace("halfClose called");let T=this.getNextBufferIndex();for(let S of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==S?void 0:S.state)==="ACTIVE"&&S.nextMessageToSend===T&&(S.nextMessageToSend+=1,S.call.halfClose())}setCredentials(T){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}S.RetryingCall=$},37061:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Http2ServerCallStream=S.ServerDuplexStreamImpl=S.ServerWritableStreamImpl=S.ServerReadableStreamImpl=S.ServerUnaryCallImpl=void 0;let N=R(82361),O=R(85158),P=R(12781),M=R(59796),L=R(32678),U=R(62252),V=R(38326),$=R(97504),K=R(75437),W="server_call";function Q(T){$.trace(L.LogVerbosity.DEBUG,W,T)}let Y="grpc-message",X="grpc-status",Z="grpc-timeout",ee=/(\d{1,8})\s*([HMSmun])/,et={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},er={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},en={[O.constants.HTTP2_HEADER_STATUS]:O.constants.HTTP_STATUS_OK,[O.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},ei={waitForTrailers:!0};class es extends N.EventEmitter{constructor(T,S,R){super(),this.call=T,this.metadata=S,this.request=R,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(T){this.call.sendMetadata(T)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}S.ServerUnaryCallImpl=es;class ea extends P.Readable{constructor(T,S,R,N){super({objectMode:!0}),this.call=T,this.metadata=S,this.deserialize=R,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,N)}_read(T){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(T){this.call.sendMetadata(T)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}S.ServerReadableStreamImpl=ea;class eo extends P.Writable{constructor(T,S,R,N){super({objectMode:!0}),this.call=T,this.metadata=S,this.serialize=R,this.request=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.on("error",T=>{this.call.sendError(T),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(T){this.call.sendMetadata(T)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(T,S,R){try{let S=this.call.serializeMessage(T);if(!this.call.write(S)){this.call.once("drain",R);return}}catch(T){this.emit("error",{details:(0,K.getErrorMessage)(T),code:L.Status.INTERNAL})}R()}_final(T){this.call.sendStatus({code:L.Status.OK,details:"OK",metadata:this.trailingMetadata}),T(null)}end(T){return T&&(this.trailingMetadata=T),super.end()}}S.ServerWritableStreamImpl=eo;class eu extends P.Duplex{constructor(T,S,R,N,O){super({objectMode:!0}),this.call=T,this.metadata=S,this.serialize=R,this.deserialize=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,O),this.on("error",T=>{this.call.sendError(T),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(T){this.call.sendMetadata(T)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(T){return T&&(this.trailingMetadata=T),super.end()}}S.ServerDuplexStreamImpl=eu,eu.prototype._read=ea.prototype._read,eu.prototype._write=eo.prototype._write,eu.prototype._final=eo.prototype._final;class ec extends N.EventEmitter{constructor(T,S,R){super(),this.stream=T,this.handler=S,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=L.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=L.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",T=>{}),this.stream.once("close",()=>{var T;Q("Request to method "+(null===(T=this.handler)||void 0===T?void 0:T.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:L.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in R&&(this.maxSendMessageSize=R["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in R&&(this.maxReceiveMessageSize=R["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(T,S){let R=T.subarray(5);if("identity"===S)return R;if("deflate"!==S&&"gzip"!==S)return Promise.reject({code:L.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${S}"`});{let T;return T="deflate"===S?M.createInflate():M.createGunzip(),new Promise((S,N)=>{let O=0,P=[];T.on("data",S=>{P.push(S),O+=S.byteLength,-1!==this.maxReceiveMessageSize&&O>this.maxReceiveMessageSize&&(T.destroy(),N({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),T.on("end",()=>{S(Buffer.concat(P))}),T.write(R),T.end()})}}sendMetadata(T){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let S=T?T.toHttp2Headers():null,R=Object.assign(Object.assign(Object.assign({},en),er),S);this.stream.respond(R,ei)}receiveMetadata(T){let S=U.Metadata.fromHttp2Headers(T);$.isTracerEnabled(W)&&Q("Request to "+this.handler.path+" received headers "+JSON.stringify(S.toJSON()));let R=S.get(Z);if(R.length>0){let T=R[0].toString().match(ee);if(null===T){let T=Error("Invalid deadline");return T.code=L.Status.OUT_OF_RANGE,this.sendError(T),S}let N=+T[1]*et[T[2]]|0,O=new Date;this.deadline=O.setMilliseconds(O.getMilliseconds()+N),this.deadlineTimer=setTimeout(ed,N,this),S.remove(Z)}return S.remove(O.constants.HTTP2_HEADER_ACCEPT_ENCODING),S.remove(O.constants.HTTP2_HEADER_TE),S.remove(O.constants.HTTP2_HEADER_CONTENT_TYPE),S.remove("grpc-accept-encoding"),S}receiveUnaryMessage(T){return new Promise((S,R)=>{let{stream:N}=this,O=0,P=this,M=[],U=this.maxReceiveMessageSize;function V(T){if(O+=T.byteLength,-1!==U&&O>U){N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),R({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${O} vs. ${U})`});return}M.push(T)}function $(U){if(N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),void 0!==U){R({code:L.Status.INTERNAL,details:U.message});return}if(0===O){R({code:L.Status.INTERNAL,details:"received empty unary message"});return}P.emit("receiveMessage");let K=Buffer.concat(M,O),W=1===K.readUInt8(0)?T:"identity",Q=P.getDecompressedMessage(K,W);if(Buffer.isBuffer(Q)){S(P.deserializeMessageWithInternalError(Q));return}Q.then(T=>S(P.deserializeMessageWithInternalError(T)),S=>R(S.code?S:{code:L.Status.INTERNAL,details:`Received "grpc-encoding" header "${T}" but ${T} decompression failed`}))}this.stream.on("data",V),this.stream.on("end",$),this.stream.on("error",$)})}async deserializeMessageWithInternalError(T){try{return this.deserializeMessage(T)}catch(T){throw{details:(0,K.getErrorMessage)(T),code:L.Status.INTERNAL}}}serializeMessage(T){let S=this.handler.serialize(T),R=S.byteLength,N=Buffer.allocUnsafe(R+5);return N.writeUInt8(0,0),N.writeUInt32BE(R,1),S.copy(N,5),N}deserializeMessage(T){return this.handler.deserialize(T)}async sendUnaryMessage(T,S,R,N){if(!this.checkCancelled()){if(void 0===R&&(R=null),T){!Object.prototype.hasOwnProperty.call(T,"metadata")&&R&&(T.metadata=R),this.sendError(T);return}try{let T=this.serializeMessage(S);this.write(T),this.sendStatus({code:L.Status.OK,details:"OK",metadata:R})}catch(T){this.sendError({details:(0,K.getErrorMessage)(T),code:L.Status.INTERNAL})}}}sendStatus(T){var S,R;if(this.emit("callEnd",T.code),this.emit("streamEnd",T.code===L.Status.OK),!this.checkCancelled()){if(Q("Request to method "+(null===(S=this.handler)||void 0===S?void 0:S.path)+" ended with status code: "+L.Status[T.code]+" details: "+T.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var S;let R=Object.assign({[X]:T.code,[Y]:encodeURI(T.details)},null===(S=T.metadata)||void 0===S?void 0:S.toHttp2Headers());this.stream.sendTrailers(R),this.statusSent=!0}),this.stream.end());else{let S=Object.assign(Object.assign({[X]:T.code,[Y]:encodeURI(T.details)},en),null===(R=T.metadata)||void 0===R?void 0:R.toHttp2Headers());this.stream.respond(S,{endStream:!0}),this.statusSent=!0}}}sendError(T){let S={code:L.Status.UNKNOWN,details:"message"in T?T.message:"Unknown Error",metadata:"metadata"in T&&void 0!==T.metadata?T.metadata:null};"code"in T&&"number"==typeof T.code&&Number.isInteger(T.code)&&(S.code=T.code,"details"in T&&"string"==typeof T.details&&(S.details=T.details)),this.sendStatus(S)}write(T){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&T.length>this.maxSendMessageSize){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${T.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(T)}}resume(){this.stream.resume()}setupSurfaceCall(T){this.once("cancelled",S=>{T.cancelled=!0,T.emit("cancelled",S)}),this.once("callEnd",S=>T.emit("callEnd",S))}setupReadable(T,S){let R=new V.StreamDecoder(this.maxReceiveMessageSize),N=!1,O=!1,P=!1,M=async()=>{P||!N||O||(P=!0,await this.pushOrBufferMessage(T,null))};this.stream.on("data",async N=>{let P;try{P=R.write(N)}catch(T){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:T.message});return}for(let R of(O=!0,this.stream.pause(),P)){let N;this.emit("receiveMessage");let O=1===R.readUInt8(0)?S:"identity";try{N=await this.getDecompressedMessage(R,O)}catch(T){this.sendError(T);return}if(!N)return;await this.pushOrBufferMessage(T,N)}O=!1,this.stream.resume(),await M()}),this.stream.once("end",async()=>{N=!0,await M()})}consumeUnpushedMessages(T){for(this.canPush=!0;this.messagesToPush.length>0;){let S=this.messagesToPush.shift(),R=T.push(S);if(null===S||!1===R){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(T,S){this.isPushPending?this.bufferedMessages.push(S):await this.pushMessage(T,S)}async pushMessage(T,S){if(null===S){Q("Received end of stream"),this.canPush?T.push(null):this.messagesToPush.push(null);return}Q("Received message of length "+S.length),this.isPushPending=!0;try{let R=await this.deserializeMessage(S);this.canPush?T.push(R)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(R)}catch(R){this.bufferedMessages.length=0;let S=(0,K.getErrorCode)(R);(null===S||S<L.Status.OK||S>L.Status.UNAUTHENTICATED)&&(S=L.Status.INTERNAL),T.emit("error",{details:(0,K.getErrorMessage)(R),code:S})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(T,this.bufferedMessages.shift())}getPeer(){var T;let S=null===(T=this.stream.session)||void 0===T?void 0:T.socket;return null!=S&&S.remoteAddress?S.remotePort?`${S.remoteAddress}:${S.remotePort}`:S.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function ed(T){let S=Error("Deadline exceeded");S.code=L.Status.DEADLINE_EXCEEDED,T.sendError(S),T.cancelled=!0,T.emit("cancelled","deadline")}S.Http2ServerCallStream=ec},74181:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ServerCredentials=void 0;let N=R(43009);class O{static createInsecure(){return new P}static createSsl(T,S,R=!1){if(null!==T&&!Buffer.isBuffer(T))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(S))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof R)throw TypeError("checkClientCertificate must be a boolean");let O=[],P=[];for(let T=0;T<S.length;T++){let R=S[T];if(null===R||"object"!=typeof R)throw TypeError(`keyCertPair[${T}] must be an object`);if(!Buffer.isBuffer(R.private_key))throw TypeError(`keyCertPair[${T}].private_key must be a Buffer`);if(!Buffer.isBuffer(R.cert_chain))throw TypeError(`keyCertPair[${T}].cert_chain must be a Buffer`);O.push(R.cert_chain),P.push(R.private_key)}return new M({ca:T||(0,N.getDefaultRootsData)()||void 0,cert:O,key:P,requestCert:R,ciphers:N.CIPHER_SUITES})}}S.ServerCredentials=O;class P extends O{_isSecure(){return!1}_getSettings(){return null}}class M extends O{constructor(T){super(),this.options=T}_isSecure(){return!0}_getSettings(){return this.options}}},57691:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Server=void 0;let N=R(85158),O=R(32678),P=R(37061),M=R(74181),L=R(40492),U=R(97504),V=R(23906),$=R(18429),K=R(5993),W=2147483647,Q=2147483647,Y=2e4,{HTTP2_HEADER_PATH:X}=N.constants,Z="server";function ee(){}function et(T){return{code:O.Status.UNIMPLEMENTED,details:`The server does not implement the method ${T}`}}function er(T,S){let R=et(S);switch(T){case"unary":return(T,S)=>{S(R,null)};case"clientStream":return(T,S)=>{S(R,null)};case"serverStream":return T=>{T.emit("error",R)};case"bidi":return T=>{T.emit("error",R)};default:throw Error(`Invalid handlerType ${T}`)}}class en{constructor(T){var S,R,N,O;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new K.ChannelzTrace,this.callTracker=new K.ChannelzCallTracker,this.listenerChildrenTracker=new K.ChannelzChildrenTracker,this.sessionChildrenTracker=new K.ChannelzChildrenTracker,this.options=null!=T?T:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,K.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(S=this.options["grpc.max_connection_age_ms"])&&void 0!==S?S:W,this.maxConnectionAgeGraceMs=null!==(R=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==R?R:W,this.keepaliveTimeMs=null!==(N=this.options["grpc.keepalive_time_ms"])&&void 0!==N?N:Q,this.keepaliveTimeoutMs=null!==(O=this.options["grpc.keepalive_timeout_ms"])&&void 0!==O?O:Y,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(T){return()=>{var S,R,N;let O;let P=this.sessions.get(T),M=T.socket,L=M.remoteAddress?(0,V.stringToSubchannelAddress)(M.remoteAddress,M.remotePort):null,U=M.localAddress?(0,V.stringToSubchannelAddress)(M.localAddress,M.localPort):null;if(T.encrypted){let T=M,R=T.getCipher(),N=T.getCertificate(),P=T.getPeerCertificate();O={cipherSuiteStandardName:null!==(S=R.standardName)&&void 0!==S?S:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:N&&"raw"in N?N.raw:null,remoteCertificate:P&&"raw"in P?P.raw:null}}else O=null;return{remoteAddress:L,localAddress:U,security:O,remoteName:null,streamsStarted:P.streamTracker.callsStarted,streamsSucceeded:P.streamTracker.callsSucceeded,streamsFailed:P.streamTracker.callsFailed,messagesSent:P.messagesSent,messagesReceived:P.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:P.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:P.lastMessageSentTimestamp,lastMessageReceivedTimestamp:P.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(R=T.state.localWindowSize)&&void 0!==R?R:null,remoteFlowControlWindow:null!==(N=T.state.remoteWindowSize)&&void 0!==N?N:null}}}trace(T){U.trace(O.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+T)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(T,S){if(null===T||"object"!=typeof T||null===S||"object"!=typeof S)throw Error("addService() requires two objects as arguments");let R=Object.keys(T);if(0===R.length)throw Error("Cannot add an empty service to a server");R.forEach(R=>{let N,O;let P=T[R];N=P.requestStream?P.responseStream?"bidi":"clientStream":P.responseStream?"serverStream":"unary";let M=S[R];if(void 0===M&&"string"==typeof P.originalName&&(M=S[P.originalName]),O=void 0!==M?M.bind(S):er(N,R),!1===this.register(P.path,O,P.responseSerialize,P.requestDeserialize,N))throw Error(`Method handler for ${P.path} already provided.`)})}removeService(T){if(null===T||"object"!=typeof T)throw Error("removeService() requires object as argument");Object.keys(T).forEach(S=>{let R=T[S];this.unregister(R.path)})}bind(T,S){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(T,S,R){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof T)throw TypeError("port must be a string");if(null===S||!(S instanceof M.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof R)throw TypeError("callback must be a function");let P=(0,$.parseUri)(T);if(null===P)throw Error(`Could not parse port "${T}"`);let W=(0,L.mapUriDefaultScheme)(P);if(null===W)throw Error(`Could not get a default scheme for port "${T}"`);let Q={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?Q.maxSessionMemory=this.options["grpc-node.max_session_memory"]:Q.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(Q.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let Y=(T,S)=>{process.nextTick(()=>R(T,S))},X=()=>{let T;if(S._isSecure()){let R=Object.assign(Q,S._getSettings());R.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(T=N.createSecureServer(R)).on("secureConnection",T=>{T.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else T=N.createServer(Q);return T.setTimeout(0,ee),this._setupHandlers(T),T},Z=(T,S,R)=>0===T.length?Promise.resolve({port:S,count:R}):Promise.all(T.map(T=>{let R;this.trace("Attempting to bind "+(0,V.subchannelAddressToString)(T)),R=(0,V.isTcpSubchannelAddress)(T)?{host:T.host,port:S}:T;let N=X();return new Promise((O,P)=>{let M=S=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(T)+" with error "+S.message),O(S)};N.once("error",M),N.listen(R,()=>{let T;if(this.shutdown){N.close(),O(Error("bindAsync failed because server is shutdown"));return}let R=N.address();T="string"==typeof R?{path:R}:{host:R.address,port:R.port};let P=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(T),()=>({localAddress:T,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(P),this.http2ServerList.push({server:N,channelzRef:P}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(T)),O("port"in T?T.port:S),N.removeListener("error",M)})})})).then(T=>{let N=0;for(let R of T)if("number"==typeof R&&(N+=1,R!==S))throw Error("Invalid state: multiple port numbers added from single address");return{port:S,count:N+R}}),et=T=>{if(0===T.length)return Promise.resolve({port:0,count:0});let S=T[0],R=X();return new Promise((N,O)=>{let P=R=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(S)+" with error "+R.message),N(et(T.slice(1)))};R.once("error",P),R.listen(S,()=>{if(this.shutdown){R.close(),N({port:0,count:0});return}let S=R.address(),O={host:S.address,port:S.port},M=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(O),()=>({localAddress:O,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(M),this.http2ServerList.push({server:R,channelzRef:M}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(O)),N(Z(T.slice(1),S.port,1)),R.removeListener("error",P)})})},er={onSuccessfulResolution:(S,R,N)=>{let P;if(er.onSuccessfulResolution=()=>{},this.shutdown&&Y(Error("bindAsync failed because server is shutdown"),0),0===S.length){Y(Error(`No addresses resolved for port ${T}`),0);return}(P=(0,V.isTcpSubchannelAddress)(S[0])?0===S[0].port?et(S):Z(S,S[0].port,0):Z(S,1,0)).then(T=>{if(0===T.count){let T=`No address added out of total ${S.length} resolved`;U.log(O.LogVerbosity.ERROR,T),Y(Error(T),0)}else T.count<S.length&&U.log(O.LogVerbosity.INFO,`WARNING Only ${T.count} addresses added out of total ${S.length} resolved`),Y(null,T.port)},T=>{let R=`No address added out of total ${S.length} resolved`;U.log(O.LogVerbosity.ERROR,R),Y(Error(R),0)})},onError:T=>{Y(Error(T.details),0)}};(0,L.createResolver)(W,er,this.options).updateResolution()}forceShutdown(){for(let{server:T,channelzRef:S}of this.http2ServerList)T.listening&&T.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(S),(0,K.unregisterChannelzRef)(S))});this.started=!1,this.shutdown=!0,this.sessions.forEach((T,S)=>{S.destroy(N.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef)}register(T,S,R,N,O){return!this.handlers.has(T)&&(this.handlers.set(T,{func:S,serialize:R,deserialize:N,type:O,path:T}),!0)}unregister(T){return this.handlers.delete(T)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:T})=>!0!==T.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(T){let S=S=>{this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef),T(S)},R=0;function N(){0==--R&&S()}for(let{server:T,channelzRef:S}of(this.started=!1,this.shutdown=!0,this.http2ServerList))T.listening&&(R++,T.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(S),(0,K.unregisterChannelzRef)(S)),N()}));this.sessions.forEach((T,S)=>{S.closed||(R+=1,S.close(N))}),0===R&&S()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(T,S){let R=S[N.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof R&&R.startsWith("application/grpc"))||(T.respond({[N.constants.HTTP2_HEADER_STATUS]:N.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(T){this.trace("Received call to method "+T+" at address "+this.serverAddressString);let S=this.handlers.get(T);return void 0===S?(this.trace("No handler registered for method "+T+". Sending UNIMPLEMENTED status."),null):S}_respondWithError(T,S,R=null){let N=new P.Http2ServerCallStream(S,null,this.options);void 0===T.code&&(T.code=O.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed()),N.sendError(T)}_channelzHandler(T,S){let R=this.sessions.get(T.session);if(this.callTracker.addCallStarted(),null==R||R.streamTracker.addCallStarted(),!this._verifyContentType(T,S)){this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed();return}let N=S[X],M=this._retrieveHandler(N);if(!M){this._respondWithError(et(N),T,R);return}let L=new P.Http2ServerCallStream(T,M,this.options);L.once("callEnd",T=>{T===O.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),R&&(L.once("streamEnd",T=>{T?R.streamTracker.addCallSucceeded():R.streamTracker.addCallFailed()}),L.on("sendMessage",()=>{R.messagesSent+=1,R.lastMessageSentTimestamp=new Date}),L.on("receiveMessage",()=>{R.messagesReceived+=1,R.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(L,M,S)||(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed(),L.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${M.type}`}))}_streamHandler(T,S){if(!0!==this._verifyContentType(T,S))return;let R=S[X],N=this._retrieveHandler(R);if(!N){this._respondWithError(et(R),T,null);return}let M=new P.Http2ServerCallStream(T,N,this.options);this._runHandlerForCall(M,N,S)||M.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${N.type}`})}_runHandlerForCall(T,S,R){var N;let O=T.receiveMetadata(R),P=null!==(N=O.get("grpc-encoding")[0])&&void 0!==N?N:"identity";O.remove("grpc-encoding");let{type:M}=S;if("unary"===M)ei(T,S,O,P);else if("clientStream"===M)es(T,S,O,P);else if("serverStream"===M)ea(T,S,O,P);else{if("bidi"!==M)return!1;eo(T,S,O,P)}return!0}_setupHandlers(T){if(null===T)return;let S=T.address(),R="null";S&&(R="string"==typeof S?S:S.address+":"+S.port),this.serverAddressString=R;let O=this.channelzEnabled?this._channelzHandler:this._streamHandler;T.on("stream",O.bind(this)),T.on("session",T=>{var S,R,O,P,M;if(!this.started){T.destroy();return}let L=(0,K.registerChannelzSocket)(null!==(S=T.socket.remoteAddress)&&void 0!==S?S:"unknown",this.getChannelzSessionInfoGetter(T),this.channelzEnabled),U={ref:L,streamTracker:new K.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(T,U);let V=T.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+V),this.sessionChildrenTracker.refChild(L));let $=null,Q=null,Y=!1;if(this.maxConnectionAgeMs!==W){let S=this.maxConnectionAgeMs/10,P=Math.random()*S*2-S;$=null===(O=(R=setTimeout(()=>{var S,R;Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+V);try{T.goaway(N.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(S){T.destroy();return}T.close(),this.maxConnectionAgeGraceMs!==W&&(Q=null===(R=(S=setTimeout(()=>{T.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===R?void 0:R.call(S))},this.maxConnectionAgeMs+P)).unref)||void 0===O?void 0:O.call(R)}let X=null===(M=(P=setInterval(()=>{var S,R;let N=null===(R=(S=setTimeout(()=>{Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+V),T.close()},this.keepaliveTimeoutMs)).unref)||void 0===R?void 0:R.call(S);try{T.ping((T,S,R)=>{clearTimeout(N)})}catch(S){T.destroy()}},this.keepaliveTimeMs)).unref)||void 0===M?void 0:M.call(P);T.on("close",()=>{this.channelzEnabled&&(Y||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+V),this.sessionChildrenTracker.unrefChild(L),(0,K.unregisterChannelzRef)(L)),$&&clearTimeout($),Q&&clearTimeout(Q),X&&clearTimeout(X),this.sessions.delete(T)})})}}async function ei(T,S,R,N){try{let O=await T.receiveUnaryMessage(N);if(void 0===O||T.cancelled)return;let M=new P.ServerUnaryCallImpl(T,R,O);S.func(M,(S,R,N,O)=>{T.sendUnaryMessage(S,R,N,O)})}catch(S){T.sendError(S)}}function es(T,S,R,N){let O=new P.ServerReadableStreamImpl(T,R,S.deserialize,N);function M(S,R,N,P){O.destroy(),T.sendUnaryMessage(S,R,N,P)}T.cancelled||(O.on("error",M),S.func(O,M))}async function ea(T,S,R,N){try{let O=await T.receiveUnaryMessage(N);if(void 0===O||T.cancelled)return;let M=new P.ServerWritableStreamImpl(T,R,S.serialize,O);S.func(M)}catch(S){T.sendError(S)}}function eo(T,S,R,N){let O=new P.ServerDuplexStreamImpl(T,R,S.serialize,S.deserialize,N);T.cancelled||S.func(O)}S.Server=en},26262:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.extractAndSelectServiceConfig=S.validateServiceConfig=S.validateRetryThrottling=void 0;let N=R(22037),O=R(32678),P=R(27176),M=/^\d+(\.\d{1,9})?s$/,L="node";function U(T){if("service"in T&&""!==T.service){if("string"!=typeof T.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof T.service}`);if(!("method"in T)||""===T.method)return{service:T.service};if("string"!=typeof T.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof T.service}`);return{service:T.service,method:T.method}}if("method"in T&&void 0!==T.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function V(T){if(!("maxAttempts"in T)||!Number.isInteger(T.maxAttempts)||T.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in T)||"string"!=typeof T.initialBackoff||!M.test(T.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in T)||"string"!=typeof T.maxBackoff||!M.test(T.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in T)||"number"!=typeof T.backoffMultiplier||T.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in T&&Array.isArray(T.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===T.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let S of T.retryableStatusCodes)if("number"==typeof S){if(!Object.values(O.Status).includes(S))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof S){if(!Object.values(O.Status).includes(S.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:T.maxAttempts,initialBackoff:T.initialBackoff,maxBackoff:T.maxBackoff,backoffMultiplier:T.backoffMultiplier,retryableStatusCodes:T.retryableStatusCodes}}function $(T){if(!("maxAttempts"in T)||!Number.isInteger(T.maxAttempts)||T.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in T&&("string"!=typeof T.hedgingDelay||!M.test(T.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in T&&Array.isArray(T.nonFatalStatusCodes))for(let S of T.nonFatalStatusCodes)if("number"==typeof S){if(!Object.values(O.Status).includes(S))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof S){if(!Object.values(O.Status).includes(S.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let S={maxAttempts:T.maxAttempts};return T.hedgingDelay&&(S.hedgingDelay=T.hedgingDelay),T.nonFatalStatusCodes&&(S.nonFatalStatusCodes=T.nonFatalStatusCodes),S}function K(T){var S;let R={name:[]};if(!("name"in T)||!Array.isArray(T.name))throw Error("Invalid method config: invalid name array");for(let S of T.name)R.name.push(U(S));if("waitForReady"in T){if("boolean"!=typeof T.waitForReady)throw Error("Invalid method config: invalid waitForReady");R.waitForReady=T.waitForReady}if("timeout"in T){if("object"==typeof T.timeout){if(!("seconds"in T.timeout)||"number"!=typeof T.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in T.timeout)||"number"!=typeof T.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");R.timeout=T.timeout}else if("string"==typeof T.timeout&&M.test(T.timeout)){let N=T.timeout.substring(0,T.timeout.length-1).split(".");R.timeout={seconds:0|N[0],nanos:(null!==(S=N[1])&&void 0!==S?S:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in T){if("number"!=typeof T.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxRequestBytes=T.maxRequestBytes}if("maxResponseBytes"in T){if("number"!=typeof T.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxResponseBytes=T.maxResponseBytes}if("retryPolicy"in T){if("hedgingPolicy"in T)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");R.retryPolicy=V(T.retryPolicy)}else"hedgingPolicy"in T&&(R.hedgingPolicy=$(T.hedgingPolicy));return R}function W(T){if(!("maxTokens"in T)||"number"!=typeof T.maxTokens||T.maxTokens<=0||T.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in T)||"number"!=typeof T.tokenRatio||T.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+T.maxTokens.toFixed(3),tokenRatio:+T.tokenRatio.toFixed(3)}}function Q(T){let S={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in T){if("string"==typeof T.loadBalancingPolicy)S.loadBalancingPolicy=T.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in T){if(Array.isArray(T.loadBalancingConfig))for(let R of T.loadBalancingConfig)S.loadBalancingConfig.push((0,P.validateLoadBalancingConfig)(R));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in T&&Array.isArray(T.methodConfig))for(let R of T.methodConfig)S.methodConfig.push(K(R));"retryThrottling"in T&&(S.retryThrottling=W(T.retryThrottling));let R=[];for(let T of S.methodConfig)for(let S of T.name){for(let T of R)if(S.service===T.service&&S.method===T.method)throw Error(`Invalid service config: duplicate name ${S.service}/${S.method}`);R.push(S)}return S}function Y(T){if(!("serviceConfig"in T))throw Error("Invalid service config choice: missing service config");let S={serviceConfig:Q(T.serviceConfig)};if("clientLanguage"in T){if(Array.isArray(T.clientLanguage))for(let R of(S.clientLanguage=[],T.clientLanguage))if("string"==typeof R)S.clientLanguage.push(R);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in T){if(Array.isArray(T.clientHostname))for(let R of(S.clientHostname=[],T.clientHostname))if("string"==typeof R)S.clientHostname.push(R);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in T){if("number"==typeof T.percentage&&0<=T.percentage&&T.percentage<=100)S.percentage=T.percentage;else throw Error("Invalid service config choice: invalid percentage")}let R=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let S in T)if(!R.includes(S))throw Error(`Invalid service config choice: unexpected field ${S}`);return S}function X(T,S){if(!Array.isArray(T))throw Error("Invalid service config list");for(let R of T){let T=Y(R);if("number"!=typeof T.percentage||!(S>T.percentage)){if(Array.isArray(T.clientHostname)){let S=!1;for(let R of T.clientHostname)R===N.hostname()&&(S=!0);if(!S)continue}if(Array.isArray(T.clientLanguage)){let S=!1;for(let R of T.clientLanguage)R===L&&(S=!0);if(!S)continue}return T.serviceConfig}}throw Error("No matching service config found")}function Z(T,S){for(let R of T)if(R.length>0&&R[0].startsWith("grpc_config="))return X(JSON.parse(R.join("").substring(12)),S);return null}S.validateRetryThrottling=W,S.validateServiceConfig=Q,S.extractAndSelectServiceConfig=Z},39932:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.StatusBuilder=void 0;class R{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(T){return this.code=T,this}withDetails(T){return this.details=T,this}withMetadata(T){return this.metadata=T,this}build(){let T={};return null!==this.code&&(T.code=this.code),null!==this.details&&(T.details=this.details),null!==this.metadata&&(T.metadata=this.metadata),T}}S.StatusBuilder=R},38326:(T,S)=>{"use strict";var R;Object.defineProperty(S,"__esModule",{value:!0}),S.StreamDecoder=void 0,function(T){T[T.NO_DATA=0]="NO_DATA",T[T.READING_SIZE=1]="READING_SIZE",T[T.READING_MESSAGE=2]="READING_MESSAGE"}(R||(R={}));class N{constructor(T){this.maxReadMessageLength=T,this.readState=R.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(T){let S,N=0,O=[];for(;N<T.length;)switch(this.readState){case R.NO_DATA:this.readCompressFlag=T.slice(N,N+1),N+=1,this.readState=R.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case R.READING_SIZE:if(S=Math.min(T.length-N,this.readSizeRemaining),T.copy(this.readPartialSize,4-this.readSizeRemaining,N,N+S),this.readSizeRemaining-=S,N+=S,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=R.READING_MESSAGE;else{let T=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=R.NO_DATA,O.push(T)}}break;case R.READING_MESSAGE:if(S=Math.min(T.length-N,this.readMessageRemaining),this.readPartialMessage.push(T.slice(N,N+S)),this.readMessageRemaining-=S,N+=S,0===this.readMessageRemaining){let T=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),S=Buffer.concat(T,this.readMessageSize+5);this.readState=R.NO_DATA,O.push(S)}break;default:throw Error("Unexpected read state")}return O}}S.StreamDecoder=N},23906:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.stringToSubchannelAddress=S.subchannelAddressToString=S.subchannelAddressEqual=S.isTcpSubchannelAddress=void 0;let N=R(41808);function O(T){return"port"in T}function P(T,S){return!T&&!S||!!T&&!!S&&(O(T)?O(S)&&T.host===S.host&&T.port===S.port:!O(S)&&T.path===S.path)}function M(T){return O(T)?T.host+":"+T.port:T.path}S.isTcpSubchannelAddress=O,S.subchannelAddressEqual=P,S.subchannelAddressToString=M;let L=443;function U(T,S){return(0,N.isIP)(T)?{host:T,port:null!=S?S:L}:{path:T}}S.stringToSubchannelAddress=U},87060:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Http2SubchannelCall=void 0;let N=R(85158),O=R(22037),P=R(32678),M=R(62252),L=R(38326),U=R(97504),V=R(32678),$="subchannel_call";function K(T){for(let[S,R]of Object.entries(O.constants.errno))if(R===T)return S;return"Unknown system error "+T}class W{constructor(T,S,R,O,U){var V;this.http2Stream=T,this.callEventTracker=S,this.listener=R,this.transport=O,this.callId=U,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=P.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let $=null!==(V=O.getOptions()["grpc.max_receive_message_length"])&&void 0!==V?V:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new L.StreamDecoder($),T.on("response",(T,S)=>{let R="";for(let S of Object.keys(T))R+="		"+S+": "+T[S]+"\n";switch(this.trace("Received server headers:\n"+R),T[":status"]){case 400:this.mappedStatusCode=P.Status.INTERNAL;break;case 401:this.mappedStatusCode=P.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=P.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=P.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=P.Status.UNAVAILABLE;break;default:this.mappedStatusCode=P.Status.UNKNOWN}if(S&N.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(T);else{let S;try{S=M.Metadata.fromHttp2Headers(T)}catch(T){this.endCall({code:P.Status.UNKNOWN,details:T.message,metadata:new M.Metadata});return}this.listener.onReceiveMetadata(S)}}),T.on("trailers",T=>{this.handleTrailers(T)}),T.on("data",T=>{let S;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+T.length);try{S=this.decoder.write(T)}catch(T){this.cancelWithStatus(P.Status.RESOURCE_EXHAUSTED,T.message);return}for(let T of S)this.trace("parsed message of length "+T.length),this.callEventTracker.addMessageReceived(),this.tryPush(T)}}),T.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),T.on("close",()=>{process.nextTick(()=>{var S;let R;if(this.trace("HTTP/2 stream closed with code "+T.rstCode),(null===(S=this.finalStatus)||void 0===S?void 0:S.code)===P.Status.OK)return;let O="";switch(T.rstCode){case N.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${T.rstCode}`;break;case N.constants.NGHTTP2_REFUSED_STREAM:R=P.Status.UNAVAILABLE,O="Stream refused by server";break;case N.constants.NGHTTP2_CANCEL:R=P.Status.CANCELLED,O="Call cancelled";break;case N.constants.NGHTTP2_ENHANCE_YOUR_CALM:R=P.Status.RESOURCE_EXHAUSTED,O="Bandwidth exhausted or memory limit exceeded";break;case N.constants.NGHTTP2_INADEQUATE_SECURITY:R=P.Status.PERMISSION_DENIED,O="Protocol not secure enough";break;case N.constants.NGHTTP2_INTERNAL_ERROR:R=P.Status.INTERNAL,null===this.internalError?O=`Received RST_STREAM with code ${T.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(R=P.Status.UNAVAILABLE,O=this.internalError.message):O=`Received RST_STREAM with code ${T.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${T.rstCode}`}this.endCall({code:R,details:O,metadata:new M.Metadata,rstCode:T.rstCode})})}),T.on("error",T=>{"ERR_HTTP2_STREAM_ERROR"!==T.code&&(this.trace("Node error event: message="+T.message+" code="+T.code+" errno="+K(T.errno)+" syscall="+T.syscall),this.internalError=T),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:P.Status.UNAVAILABLE,details:"Connection dropped",metadata:new M.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(T){U.trace(V.LogVerbosity.DEBUG,$,"["+this.callId+"] "+T)}endCall(T){(null===this.finalStatus||this.finalStatus.code===P.Status.OK)&&(this.finalStatus=T,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===P.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(T){this.trace("pushing to reader message of length "+(T instanceof Buffer?T.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(T),this.maybeOutputStatus())})}tryPush(T){this.canPush?(this.http2Stream.pause(),this.push(T)):(this.trace("unpushedReadMessages.push message of length "+T.length),this.unpushedReadMessages.push(T))}handleTrailers(T){let S;this.callEventTracker.onStreamEnd(!0);let R="";for(let S of Object.keys(T))R+="		"+S+": "+T[S]+"\n";this.trace("Received server trailers:\n"+R);try{S=M.Metadata.fromHttp2Headers(T)}catch(T){S=new M.Metadata}let N=S.getMap(),O=this.mappedStatusCode;if(O===P.Status.UNKNOWN&&"string"==typeof N["grpc-status"]){let T=Number(N["grpc-status"]);T in P.Status&&(O=T,this.trace("received status code "+T+" from server")),S.remove("grpc-status")}let L="";if("string"==typeof N["grpc-message"]){try{L=decodeURI(N["grpc-message"])}catch(T){L=N["grpc-message"]}S.remove("grpc-message"),this.trace('received status details string "'+L+'" from server')}let U={code:O,details:L,metadata:S};this.endCall(U)}destroyHttp2Stream(){var T;if(!this.http2Stream.destroyed){let S;S=(null===(T=this.finalStatus)||void 0===T?void 0:T.code)===P.Status.OK?N.constants.NGHTTP2_NO_ERROR:N.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+S),this.http2Stream.close(S)}}cancelWithStatus(T,S){this.trace("cancelWithStatus code: "+T+' details: "'+S+'"'),this.endCall({code:T,details:S,metadata:new M.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==P.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let T=this.unpushedReadMessages.shift();this.push(T);return}this.http2Stream.resume()}sendMessageWithContext(T,S){this.trace("write() called with message of length "+S.length);let R=S=>{process.nextTick(()=>{var R;let N=P.Status.UNAVAILABLE;(null==S?void 0:S.code)==="ERR_STREAM_WRITE_AFTER_END"&&(N=P.Status.INTERNAL),S&&this.cancelWithStatus(N,`Write error: ${S.message}`),null===(R=T.callback)||void 0===R||R.call(T)})};this.trace("sending data chunk of length "+S.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(S,R)}catch(T){this.endCall({code:P.Status.UNAVAILABLE,details:`Write failed with error ${T.message}`,metadata:new M.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}S.Http2SubchannelCall=W},21407:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.BaseSubchannelWrapper=void 0;class R{constructor(T){this.child=T}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(T){this.child.addConnectivityStateListener(T)}removeConnectivityStateListener(T){this.child.removeConnectivityStateListener(T)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(T){this.child.throttleKeepalive(T)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(T){return this.getRealSubchannel()===T.getRealSubchannel()}}S.BaseSubchannelWrapper=R},42328:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getSubchannelPool=S.SubchannelPool=void 0;let N=R(79387),O=R(91727),P=R(23906),M=R(18429),L=R(62869),U=1e4;class V{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let T=!0;for(let S in this.pool){let R=this.pool[S].filter(T=>!T.subchannel.unrefIfOneRef());R.length>0&&(T=!1),this.pool[S]=R}T&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var T,S;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},U),null===(S=(T=this.cleanupTimer).unref)||void 0===S||S.call(T))}getOrCreateSubchannel(T,S,R,U){this.ensureCleanupTask();let V=(0,M.uriToString)(T);if(V in this.pool){for(let T of this.pool[V])if((0,P.subchannelAddressEqual)(S,T.subchannelAddress)&&(0,N.channelOptionsEqual)(R,T.channelArguments)&&U._equals(T.channelCredentials))return T.subchannel}let $=new O.Subchannel(T,S,R,U,new L.Http2SubchannelConnector(T));return V in this.pool||(this.pool[V]=[]),this.pool[V].push({subchannelAddress:S,channelArguments:R,channelCredentials:U,subchannel:$}),$.ref(),$}}S.SubchannelPool=V;let $=new V;function K(T){return T?$:new V}S.getSubchannelPool=K},91727:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Subchannel=void 0;let N=R(33955),O=R(84934),P=R(97504),M=R(32678),L=R(18429),U=R(23906),V=R(5993),$="subchannel",K=2147483647;class W{constructor(T,S,R,P,M){var L;this.channelTarget=T,this.subchannelAddress=S,this.options=R,this.credentials=P,this.connector=M,this.connectivityState=N.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new V.ChannelzCallTracker,this.childrenTracker=new V.ChannelzChildrenTracker,this.streamTracker=new V.ChannelzCallTracker;let $={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new O.BackoffTimeout(()=>{this.handleBackoffTimer()},$),this.backoffTimeout.unref(),this.subchannelAddressString=(0,U.subchannelAddressToString)(S),this.keepaliveTime=null!==(L=R["grpc.keepalive_time_ms"])&&void 0!==L?L:-1,0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new V.ChannelzTrace,this.channelzRef=(0,V.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(R,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(T){P.trace(M.LogVerbosity.DEBUG,$,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}refTrace(T){P.trace(M.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING):this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let T=this.options;if(T["grpc.keepalive_time_ms"]){let S=Math.min(this.keepaliveTime,K);T=Object.assign(Object.assign({},T),{"grpc.keepalive_time_ms":S})}this.connector.connect(this.subchannelAddress,this.credentials,T).then(T=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.READY)?(this.transport=T,this.channelzEnabled&&this.childrenTracker.refChild(T.getChannelzRef()),T.addDisconnectListener(T=>{this.transitionToState([N.ConnectivityState.READY],N.ConnectivityState.IDLE),T&&this.keepaliveTime>0&&(this.keepaliveTime*=2,P.log(M.LogVerbosity.ERROR,`Connection to ${(0,L.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):T.shutdown()},T=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.TRANSIENT_FAILURE,`${T}`)})}transitionToState(T,S,R){var O,P;if(-1===T.indexOf(this.connectivityState))return!1;this.trace(N.ConnectivityState[this.connectivityState]+" -> "+N.ConnectivityState[S]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+N.ConnectivityState[S]);let M=this.connectivityState;switch(this.connectivityState=S,S){case N.ConnectivityState.READY:this.stopBackoff();break;case N.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case N.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(O=this.transport)||void 0===O||O.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case N.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(P=this.transport)||void 0===P||P.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${S}`)}for(let T of this.stateListeners)T(this,M,S,this.keepaliveTime,R);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,V.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([N.ConnectivityState.CONNECTING,N.ConnectivityState.READY],N.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(T,S,R,N){let O;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),O={onCallEnd:T=>{T.code===M.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):O={},this.transport.createCall(T,S,R,N,O)}startConnecting(){process.nextTick(()=>{this.transitionToState([N.ConnectivityState.IDLE],N.ConnectivityState.CONNECTING)||this.connectivityState!==N.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(T){this.stateListeners.add(T)}removeConnectivityStateListener(T){this.stateListeners.delete(T)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(T){return T.getRealSubchannel()===this}throttleKeepalive(T){T>this.keepaliveTime&&(this.keepaliveTime=T)}}S.Subchannel=W},43009:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getDefaultRootsData=S.CIPHER_SUITES=void 0;let N=R(57147);S.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let O=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,P=null;function M(){return O?(null===P&&(P=N.readFileSync(O)),P):null}S.getDefaultRootsData=M},62869:(T,S,R)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Http2SubchannelConnector=void 0;let N=R(85158),O=R(24404),P=R(5993),M=R(32678),L=R(82039),U=R(97504),V=R(40492),$=R(23906),K=R(18429),W=R(41808),Q=R(87060),Y=R(38445),X="transport",Z="transport_flowctrl",ee=R(81513).i8,{HTTP2_HEADER_AUTHORITY:et,HTTP2_HEADER_CONTENT_TYPE:er,HTTP2_HEADER_METHOD:en,HTTP2_HEADER_PATH:ei,HTTP2_HEADER_TE:es,HTTP2_HEADER_USER_AGENT:ea}=N.constants,eo=2e4,eu=Buffer.from("too_many_pings","ascii");class ec{constructor(T,S,R,O){this.session=T,this.options=R,this.remoteName=O,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=eo,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new P.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,$.subchannelAddressToString)(S),0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,P.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[R["grpc.primary_user_agent"],`grpc-node-js/${ee}`,R["grpc.secondary_user_agent"]].filter(T=>T).join(" "),"grpc.keepalive_time_ms"in R&&(this.keepaliveTimeMs=R["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in R&&(this.keepaliveTimeoutMs=R["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in R?this.keepaliveWithoutCalls=1===R["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,T.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),T.once("goaway",(T,S,R)=>{let O=!1;T===N.constants.NGHTTP2_ENHANCE_YOUR_CALM&&R&&R.equals(eu)&&(O=!0),this.trace("connection closed by GOAWAY with code "+T+" and data "+(null==R?void 0:R.toString())),this.reportDisconnectToOwner(O)}),T.once("error",T=>{this.trace("connection closed with error "+T.message)}),U.isTracerEnabled(X)&&(T.on("remoteSettings",S=>{this.trace("new settings received"+(this.session!==T?" on the old connection":"")+": "+JSON.stringify(S))}),T.on("localSettings",S=>{this.trace("local settings acknowledged by remote"+(this.session!==T?" on the old connection":"")+": "+JSON.stringify(S))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var T,S,R;let N;let O=this.session.socket,P=O.remoteAddress?(0,$.stringToSubchannelAddress)(O.remoteAddress,O.remotePort):null,M=O.localAddress?(0,$.stringToSubchannelAddress)(O.localAddress,O.localPort):null;if(this.session.encrypted){let S=O,R=S.getCipher(),P=S.getCertificate(),M=S.getPeerCertificate();N={cipherSuiteStandardName:null!==(T=R.standardName)&&void 0!==T?T:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:P&&"raw"in P?P.raw:null,remoteCertificate:M&&"raw"in M?M.raw:null}}else N=null;return{remoteAddress:P,localAddress:M,security:N,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(S=this.session.state.localWindowSize)&&void 0!==S?S:null,remoteFlowControlWindow:null!==(R=this.session.state.remoteWindowSize)&&void 0!==R?R:null}}trace(T){U.trace(M.LogVerbosity.DEBUG,X,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}keepaliveTrace(T){U.trace(M.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}flowControlTrace(T){U.trace(M.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}internalsTrace(T){U.trace(M.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+T)}reportDisconnectToOwner(T){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(S=>S(T)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let T of this.activeCalls)T.onDisconnect()})}addDisconnectListener(T){this.disconnectListeners.push(T)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var T,S;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(S=(T=this.keepaliveTimeoutId).unref)||void 0===S||S.call(T));try{this.session.ping((T,S,R)=>{T&&(this.keepaliveTrace("Ping failed with error "+T.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(T){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var T,S;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(S=(T=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===S?void 0:S.call(T)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(T){this.activeCalls.delete(T),0===this.activeCalls.size&&this.session.unref()}addActiveCall(T){this.activeCalls.add(T),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(T,S,R,N,O){let P,M,L;let U=T.toHttp2Headers();U[et]=S,U[ea]=this.userAgent,U[er]="application/grpc",U[en]="POST",U[ei]=R,U[es]="trailers";try{P=this.session.request(U)}catch(T){throw this.handleDisconnect(),T}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),M={addMessageSent:()=>{var T;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(T=O.addMessageSent)||void 0===T||T.call(O)},addMessageReceived:()=>{var T;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(T=O.addMessageReceived)||void 0===T||T.call(O)},onCallEnd:T=>{var S;null===(S=O.onCallEnd)||void 0===S||S.call(O,T),this.removeActiveCall(L)},onStreamEnd:T=>{var S;T?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(S=O.onStreamEnd)||void 0===S||S.call(O,T)}}):M={addMessageSent:()=>{var T;null===(T=O.addMessageSent)||void 0===T||T.call(O)},addMessageReceived:()=>{var T;null===(T=O.addMessageReceived)||void 0===T||T.call(O)},onCallEnd:T=>{var S;null===(S=O.onCallEnd)||void 0===S||S.call(O,T),this.removeActiveCall(L)},onStreamEnd:T=>{var S;null===(S=O.onStreamEnd)||void 0===S||S.call(O,T)}},L=new Q.Http2SubchannelCall(P,M,N,this,(0,Y.getNextCallNumber)()),this.addActiveCall(L),L}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,P.unregisterChannelzRef)(this.channelzRef)}}class ed{constructor(T){this.channelTarget=T,this.session=null,this.isShutdown=!1}trace(T){U.trace(M.LogVerbosity.DEBUG,X,(0,K.uriToString)(this.channelTarget)+" "+T)}createSession(T,S,R,P){return this.isShutdown?Promise.reject():new Promise((M,L)=>{var U,Q,Y;let X;P.realTarget?(X=(0,K.uriToString)(P.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,K.uriToString)(P.realTarget))):(X=null,this.trace("creating HTTP/2 session to "+(0,$.subchannelAddressToString)(T)));let Z=(0,V.getDefaultAuthority)(null!==(U=P.realTarget)&&void 0!==U?U:this.channelTarget),ee=S._getConnectionOptions()||{};ee.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in R?ee.maxSessionMemory=R["grpc-node.max_session_memory"]:ee.maxSessionMemory=Number.MAX_SAFE_INTEGER;let et="http://";if("secureContext"in ee){if(et="https://",R["grpc.ssl_target_name_override"]){let T=R["grpc.ssl_target_name_override"];ee.checkServerIdentity=(S,R)=>(0,O.checkServerIdentity)(T,R),ee.servername=T}else{let T=null!==(Y=null===(Q=(0,K.splitHostPort)(Z))||void 0===Q?void 0:Q.host)&&void 0!==Y?Y:"localhost";ee.servername=T}P.socket&&(ee.createConnection=(T,S)=>P.socket)}else ee.createConnection=(S,R)=>P.socket?P.socket:W.connect(T);ee=Object.assign(Object.assign(Object.assign({},ee),T),{enableTrace:1===R["grpc-node.tls_enable_trace"]});let er=N.connect(et+Z,ee);this.session=er;let en="Failed to connect";er.unref(),er.once("connect",()=>{er.removeAllListeners(),M(new ec(er,T,R,X)),this.session=null}),er.once("close",()=>{this.session=null,setImmediate(()=>{L(`${en} (${new Date().toISOString()})`)})}),er.once("error",T=>{en=T.message,this.trace("connection failed with error "+en)})})}connect(T,S,R){var N,P;if(this.isShutdown)return Promise.reject();let M=S._getConnectionOptions()||{};if("secureContext"in M){if(M.ALPNProtocols=["h2"],R["grpc.ssl_target_name_override"]){let T=R["grpc.ssl_target_name_override"];M.checkServerIdentity=(S,R)=>(0,O.checkServerIdentity)(T,R),M.servername=T}else if("grpc.http_connect_target"in R){let T=(0,V.getDefaultAuthority)(null!==(N=(0,K.parseUri)(R["grpc.http_connect_target"]))&&void 0!==N?N:{path:"localhost"}),S=(0,K.splitHostPort)(T);M.servername=null!==(P=null==S?void 0:S.host)&&void 0!==P?P:T}R["grpc-node.tls_enable_trace"]&&(M.enableTrace=!0)}return(0,L.getProxiedConnection)(T,R,M).then(N=>this.createSession(T,S,R,N))}shutdown(){var T;this.isShutdown=!0,null===(T=this.session)||void 0===T||T.close(),this.session=null}}S.Http2SubchannelConnector=ed},18429:(T,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.uriToString=S.splitHostPort=S.parseUri=void 0;let R=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function N(T){let S=R.exec(T);return null===S?null:{scheme:S[1],authority:S[2],path:S[3]}}S.parseUri=N;let O=/^\d+$/;function P(T){if(T.startsWith("[")){let S=T.indexOf("]");if(-1===S)return null;let R=T.substring(1,S);if(-1===R.indexOf(":"))return null;if(!(T.length>S+1))return{host:R};if(":"!==T[S+1])return null;{let N=T.substring(S+2);return O.test(N)?{host:R,port:+N}:null}}{let S=T.split(":");return 2!==S.length?{host:T}:O.test(S[1])?{host:S[0],port:+S[1]}:null}}function M(T){let S="";return void 0!==T.scheme&&(S+=T.scheme+":"),void 0!==T.authority&&(S+="//"+T.authority+"/"),S+=T.path}S.splitHostPort=P,S.uriToString=M},58715:(T,S,R)=>{"use strict";var N,O;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */N={value:!0},N=N=S.im=S.J_=N=S.Cp=N=N=void 0;let P=R(51382),M=R(25269),L=R(21725),U=R(72916);N=R(31468),N=function(T){return"@type"in T&&"string"==typeof T["@type"]},function(T){T.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",T.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",T.IDEMPOTENT="IDEMPOTENT"}(O=S.Cp||(S.Cp={}));let V={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function $(T,S){return""===T?S:T+"."+S}function K(T){return T instanceof M.Service||T instanceof M.Type||T instanceof M.Enum}function W(T){return T instanceof M.Namespace||T instanceof M.Root}function Q(T,S){let R=$(S,T.name);return K(T)?[[R,T]]:W(T)&&void 0!==T.nested?Object.keys(T.nested).map(S=>Q(T.nested[S],R)).reduce((T,S)=>T.concat(S),[]):[]}function Y(T,S){return function(R){return T.toObject(T.decode(R),S)}}function X(T){return function(S){if(Array.isArray(S))throw Error(`Failed to serialize message: expected object with ${T.name} structure, got array instead`);let R=T.fromObject(S);return T.encode(R).finish()}}function Z(T){return(T||[]).reduce((T,S)=>{for(let[R,N]of Object.entries(S))"uninterpreted_option"===R?T.uninterpreted_option.push(S.uninterpreted_option):T[R]=N;return T},{deprecated:!1,idempotency_level:O.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function ee(T,S,R,N){let O=T.resolvedRequestType,M=T.resolvedResponseType;return{path:"/"+S+"/"+T.name,requestStream:!!T.requestStream,responseStream:!!T.responseStream,requestSerialize:X(O),requestDeserialize:Y(O,R),responseSerialize:X(M),responseDeserialize:Y(M,R),originalName:P(T.name),requestType:er(O,N),responseType:er(M,N),options:Z(T.parsedOptions)}}function et(T,S,R,N){let O={};for(let P of T.methodsArray)O[P.name]=ee(P,S,R,N);return O}function er(T,S){let R=T.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:S}}function en(T,S){let R=T.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:S}}function ei(T,S,R,N){if(T instanceof M.Service)return et(T,S,R,N);if(T instanceof M.Type)return er(T,N);if(T instanceof M.Enum)return en(T,N);throw Error("Type mismatch in reflection object handling")}function es(T,S){let R={};T.resolveAll();let N=T.toDescriptor("proto3").file.map(T=>Buffer.from(L.FileDescriptorProto.encode(T).finish()));for(let[O,P]of Q(T,""))R[O]=ei(P,O,S,N);return R}function ea(T,S){S=S||{};let R=M.Root.fromDescriptor(T);return R.resolveAll(),es(R,S)}function eo(T,S){return es((0,U.loadProtosWithOptionsSync)(T,S),S)}function eu(T,S){S=S||{};let R=M.Root.fromJSON(T);return R.resolveAll(),es(R,S)}N=function(T,S){return(0,U.loadProtosWithOptions)(T,S).then(T=>es(T,S))},S.J_=eo,S.im=eu,N=function(T,S){return ea(L.FileDescriptorSet.decode(T),S)},N=function(T,S){return ea(L.FileDescriptorSet.fromObject(T),S)},(0,U.addCommonProtos)()},72916:(T,S,R)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(S,"__esModule",{value:!0}),S.addCommonProtos=S.loadProtosWithOptionsSync=S.loadProtosWithOptions=void 0;let N=R(57147),O=R(71017),P=R(25269);function M(T,S){let R=T.resolvePath;T.resolvePath=(T,P)=>{if(O.isAbsolute(P))return P;for(let T of S){let S=O.join(T,P);try{return N.accessSync(S,N.constants.R_OK),S}catch(T){continue}}return process.emitWarning(`${P} not found in any of the include paths ${S}`),R(T,P)}}async function L(T,S){let R=new P.Root;if((S=S||{}).includeDirs){if(!Array.isArray(S.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));M(R,S.includeDirs)}let N=await R.load(T,S);return N.resolveAll(),N}function U(T,S){let R=new P.Root;if((S=S||{}).includeDirs){if(!Array.isArray(S.includeDirs))throw Error("The includeDirs option must be an array");M(R,S.includeDirs)}let N=R.loadSync(T,S);return N.resolveAll(),N}function V(){let T=R(56541),S=R(89987),N=R(57674),O=R(73795);P.common("api",T.nested.google.nested.protobuf.nested),P.common("descriptor",S.nested.google.nested.protobuf.nested),P.common("source_context",N.nested.google.nested.protobuf.nested),P.common("type",O.nested.google.nested.protobuf.nested)}S.loadProtosWithOptions=L,S.loadProtosWithOptionsSync=U,S.addCommonProtos=V},70799:T=>{"use strict";function S(T,S){for(var R=Array(arguments.length-1),N=0,O=2,P=!0;O<arguments.length;)R[N++]=arguments[O++];return new Promise(function(O,M){R[N]=function(T){if(P){if(P=!1,T)M(T);else{for(var S=Array(arguments.length-1),R=0;R<S.length;)S[R++]=arguments[R];O.apply(null,S)}}};try{T.apply(S||null,R)}catch(T){P&&(P=!1,M(T))}})}T.exports=S},92130:(T,S)=>{"use strict";var R=S;R.length=function(T){var S=T.length;if(!S)return 0;for(var R=0;--S%4>1&&"="===T.charAt(S);)++R;return Math.ceil(3*T.length)/4-R};for(var N=Array(64),O=Array(123),P=0;P<64;)O[N[P]=P<26?P+65:P<52?P+71:P<62?P-4:P-59|43]=P++;R.encode=function(T,S,R){for(var O,P=null,M=[],L=0,U=0;S<R;){var V=T[S++];switch(U){case 0:M[L++]=N[V>>2],O=(3&V)<<4,U=1;break;case 1:M[L++]=N[O|V>>4],O=(15&V)<<2,U=2;break;case 2:M[L++]=N[O|V>>6],M[L++]=N[63&V],U=0}L>8191&&((P||(P=[])).push(String.fromCharCode.apply(String,M)),L=0)}return(U&&(M[L++]=N[O],M[L++]=61,1===U&&(M[L++]=61)),P)?(L&&P.push(String.fromCharCode.apply(String,M.slice(0,L))),P.join("")):String.fromCharCode.apply(String,M.slice(0,L))};var M="invalid encoding";R.decode=function(T,S,R){for(var N,P=R,L=0,U=0;U<T.length;){var V=T.charCodeAt(U++);if(61===V&&L>1)break;if(void 0===(V=O[V]))throw Error(M);switch(L){case 0:N=V,L=1;break;case 1:S[R++]=N<<2|(48&V)>>4,N=V,L=2;break;case 2:S[R++]=(15&N)<<4|(60&V)>>2,N=V,L=3;break;case 3:S[R++]=(3&N)<<6|V,L=0}}if(1===L)throw Error(M);return R-P},R.test=function(T){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(T)}},52012:T=>{"use strict";function S(T,R){"string"==typeof T&&(R=T,T=void 0);var N=[];function O(T){if("string"!=typeof T){var R=P();if(S.verbose,R="return "+R,T){for(var M=Object.keys(T),L=Array(M.length+1),U=Array(M.length),V=0;V<M.length;)L[V]=M[V],U[V]=T[M[V++]];return L[V]=R,Function.apply(null,L).apply(null,U)}return Function(R)()}for(var $=Array(arguments.length-1),K=0;K<$.length;)$[K]=arguments[++K];if(K=0,T=T.replace(/%([%dfijs])/g,function(T,S){var R=$[K++];switch(S){case"d":case"f":return String(Number(R));case"i":return String(Math.floor(R));case"j":return JSON.stringify(R);case"s":return String(R)}return"%"}),K!==$.length)throw Error("parameter count mismatch");return N.push(T),O}function P(S){return"function "+(S||R||"")+"("+(T&&T.join(",")||"")+"){\n  "+N.join("\n  ")+"\n}"}return O.toString=P,O}T.exports=S,S.verbose=!1},80854:T=>{"use strict";function S(){this._listeners={}}T.exports=S,S.prototype.on=function(T,S,R){return(this._listeners[T]||(this._listeners[T]=[])).push({fn:S,ctx:R||this}),this},S.prototype.off=function(T,S){if(void 0===T)this._listeners={};else if(void 0===S)this._listeners[T]=[];else for(var R=this._listeners[T],N=0;N<R.length;)R[N].fn===S?R.splice(N,1):++N;return this},S.prototype.emit=function(T){var S=this._listeners[T];if(S){for(var R=[],N=1;N<arguments.length;)R.push(arguments[N++]);for(N=0;N<S.length;)S[N].fn.apply(S[N++].ctx,R)}return this}},63035:(T,S,R)=>{"use strict";T.exports=P;var N=R(70799),O=R(20449)("fs");function P(T,S,R){return("function"==typeof S?(R=S,S={}):S||(S={}),R)?!S.xhr&&O&&O.readFile?O.readFile(T,function(N,O){return N&&"undefined"!=typeof XMLHttpRequest?P.xhr(T,S,R):N?R(N):R(null,S.binary?O:O.toString("utf8"))}):P.xhr(T,S,R):N(P,this,T,S)}P.xhr=function(T,S,R){var N=new XMLHttpRequest;N.onreadystatechange=function(){if(4===N.readyState){if(0!==N.status&&200!==N.status)return R(Error("status "+N.status));if(S.binary){var T=N.response;if(!T){T=[];for(var O=0;O<N.responseText.length;++O)T.push(255&N.responseText.charCodeAt(O))}return R(null,"undefined"!=typeof Uint8Array?new Uint8Array(T):T)}return R(null,N.responseText)}},S.binary&&("overrideMimeType"in N&&N.overrideMimeType("text/plain; charset=x-user-defined"),N.responseType="arraybuffer"),N.open("GET",T),N.send()}},14324:T=>{"use strict";function S(T){return"undefined"!=typeof Float32Array?function(){var S=new Float32Array([-0]),R=new Uint8Array(S.buffer),N=128===R[3];function O(T,N,O){S[0]=T,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3]}function P(T,N,O){S[0]=T,N[O]=R[3],N[O+1]=R[2],N[O+2]=R[1],N[O+3]=R[0]}function M(T,N){return R[0]=T[N],R[1]=T[N+1],R[2]=T[N+2],R[3]=T[N+3],S[0]}function L(T,N){return R[3]=T[N],R[2]=T[N+1],R[1]=T[N+2],R[0]=T[N+3],S[0]}T.writeFloatLE=N?O:P,T.writeFloatBE=N?P:O,T.readFloatLE=N?M:L,T.readFloatBE=N?L:M}():function(){function S(T,S,R,N){var O=S<0?1:0;if(O&&(S=-S),0===S)T(1/S>0?0:2147483648,R,N);else if(isNaN(S))T(2143289344,R,N);else if(S>34028234663852886e22)T((O<<31|2139095040)>>>0,R,N);else if(S<11754943508222875e-54)T((O<<31|Math.round(S/1401298464324817e-60))>>>0,R,N);else{var P=Math.floor(Math.log(S)/Math.LN2),M=8388607&Math.round(S*Math.pow(2,-P)*8388608);T((O<<31|P+127<<23|M)>>>0,R,N)}}function M(T,S,R){var N=T(S,R),O=(N>>31)*2+1,P=N>>>23&255,M=8388607&N;return 255===P?M?NaN:1/0*O:0===P?1401298464324817e-60*O*M:O*Math.pow(2,P-150)*(M+8388608)}T.writeFloatLE=S.bind(null,R),T.writeFloatBE=S.bind(null,N),T.readFloatLE=M.bind(null,O),T.readFloatBE=M.bind(null,P)}(),"undefined"!=typeof Float64Array?function(){var S=new Float64Array([-0]),R=new Uint8Array(S.buffer),N=128===R[7];function O(T,N,O){S[0]=T,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3],N[O+4]=R[4],N[O+5]=R[5],N[O+6]=R[6],N[O+7]=R[7]}function P(T,N,O){S[0]=T,N[O]=R[7],N[O+1]=R[6],N[O+2]=R[5],N[O+3]=R[4],N[O+4]=R[3],N[O+5]=R[2],N[O+6]=R[1],N[O+7]=R[0]}function M(T,N){return R[0]=T[N],R[1]=T[N+1],R[2]=T[N+2],R[3]=T[N+3],R[4]=T[N+4],R[5]=T[N+5],R[6]=T[N+6],R[7]=T[N+7],S[0]}function L(T,N){return R[7]=T[N],R[6]=T[N+1],R[5]=T[N+2],R[4]=T[N+3],R[3]=T[N+4],R[2]=T[N+5],R[1]=T[N+6],R[0]=T[N+7],S[0]}T.writeDoubleLE=N?O:P,T.writeDoubleBE=N?P:O,T.readDoubleLE=N?M:L,T.readDoubleBE=N?L:M}():function(){function S(T,S,R,N,O,P){var M,L=N<0?1:0;if(L&&(N=-N),0===N)T(0,O,P+S),T(1/N>0?0:2147483648,O,P+R);else if(isNaN(N))T(0,O,P+S),T(2146959360,O,P+R);else if(N>17976931348623157e292)T(0,O,P+S),T((L<<31|2146435072)>>>0,O,P+R);else if(N<22250738585072014e-324)T((M=N/5e-324)>>>0,O,P+S),T((L<<31|M/4294967296)>>>0,O,P+R);else{var U=Math.floor(Math.log(N)/Math.LN2);1024===U&&(U=1023),T(4503599627370496*(M=N*Math.pow(2,-U))>>>0,O,P+S),T((L<<31|U+1023<<20|1048576*M&1048575)>>>0,O,P+R)}}function M(T,S,R,N,O){var P=T(N,O+S),M=T(N,O+R),L=(M>>31)*2+1,U=M>>>20&2047,V=4294967296*(1048575&M)+P;return 2047===U?V?NaN:1/0*L:0===U?5e-324*L*V:L*Math.pow(2,U-1075)*(V+4503599627370496)}T.writeDoubleLE=S.bind(null,R,0,4),T.writeDoubleBE=S.bind(null,N,4,0),T.readDoubleLE=M.bind(null,O,0,4),T.readDoubleBE=M.bind(null,P,4,0)}(),T}function R(T,S,R){S[R]=255&T,S[R+1]=T>>>8&255,S[R+2]=T>>>16&255,S[R+3]=T>>>24}function N(T,S,R){S[R]=T>>>24,S[R+1]=T>>>16&255,S[R+2]=T>>>8&255,S[R+3]=255&T}function O(T,S){return(T[S]|T[S+1]<<8|T[S+2]<<16|T[S+3]<<24)>>>0}function P(T,S){return(T[S]<<24|T[S+1]<<16|T[S+2]<<8|T[S+3])>>>0}T.exports=S(S)},20449:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},29986:(T,S)=>{"use strict";var R=S,N=R.isAbsolute=function(T){return/^(?:\/|\w+:)/.test(T)},O=R.normalize=function(T){var S=(T=T.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),R=N(T),O="";R&&(O=S.shift()+"/");for(var P=0;P<S.length;)".."===S[P]?P>0&&".."!==S[P-1]?S.splice(--P,2):R?S.splice(P,1):++P:"."===S[P]?S.splice(P,1):++P;return O+S.join("/")};R.resolve=function(T,S,R){return(R||(S=O(S)),N(S))?S:(R||(T=O(T)),(T=T.replace(/(?:\/|^)[^/]+$/,"")).length?O(T+"/"+S):S)}},56035:T=>{"use strict";function S(T,S,R){var N=R||8192,O=N>>>1,P=null,M=N;return function(R){if(R<1||R>O)return T(R);M+R>N&&(P=T(N),M=0);var L=S.call(P,M,M+=R);return 7&M&&(M=(7|M)+1),L}}T.exports=S},78131:(T,S)=>{"use strict";var R=S;R.length=function(T){for(var S=0,R=0,N=0;N<T.length;++N)(R=T.charCodeAt(N))<128?S+=1:R<2048?S+=2:(64512&R)==55296&&(64512&T.charCodeAt(N+1))==56320?(++N,S+=4):S+=3;return S},R.read=function(T,S,R){if(R-S<1)return"";for(var N,O=null,P=[],M=0;S<R;)(N=T[S++])<128?P[M++]=N:N>191&&N<224?P[M++]=(31&N)<<6|63&T[S++]:N>239&&N<365?(N=((7&N)<<18|(63&T[S++])<<12|(63&T[S++])<<6|63&T[S++])-65536,P[M++]=55296+(N>>10),P[M++]=56320+(1023&N)):P[M++]=(15&N)<<12|(63&T[S++])<<6|63&T[S++],M>8191&&((O||(O=[])).push(String.fromCharCode.apply(String,P)),M=0);return O?(M&&O.push(String.fromCharCode.apply(String,P.slice(0,M))),O.join("")):String.fromCharCode.apply(String,P.slice(0,M))},R.write=function(T,S,R){for(var N,O,P=R,M=0;M<T.length;++M)(N=T.charCodeAt(M))<128?S[R++]=N:(N<2048?S[R++]=N>>6|192:((64512&N)==55296&&(64512&(O=T.charCodeAt(M+1)))==56320?(N=65536+((1023&N)<<10)+(1023&O),++M,S[R++]=N>>18|240,S[R++]=N>>12&63|128):S[R++]=N>>12|224,S[R++]=N>>6&63|128),S[R++]=63&N|128);return R-P}},51382:T=>{var S=1/0,R="[object Symbol]",N=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,O=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,P="\ud800-\udfff",M="\\u0300-\\u036f\\ufe20-\\ufe23",L="\\u20d0-\\u20f0",U="\\u2700-\\u27bf",V="a-z\\xdf-\\xf6\\xf8-\\xff",$="A-Z\\xc0-\\xd6\\xd8-\\xde",K="\\ufe0e\\ufe0f",W="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Q="[']",Y="["+P+"]",X="["+W+"]",Z="["+M+L+"]",ee="\\d+",et="["+U+"]",er="["+V+"]",en="[^"+P+W+ee+U+V+$+"]",ei="\ud83c[\udffb-\udfff]",es="[^"+P+"]",ea="(?:\ud83c[\udde6-\uddff]){2}",eo="[\ud800-\udbff][\udc00-\udfff]",eu="["+$+"]",ec="\\u200d",ed="(?:"+er+"|"+en+")",eh="(?:"+eu+"|"+en+")",ep="(?:"+Q+"(?:d|ll|m|re|s|t|ve))?",ef="(?:"+Q+"(?:D|LL|M|RE|S|T|VE))?",em="(?:"+Z+"|"+ei+")?",eg="["+K+"]?",ey="(?:"+ec+"(?:"+[es,ea,eo].join("|")+")"+eg+em+")*",ev=eg+em+ey,eb="(?:"+[et,ea,eo].join("|")+")"+ev,eT="(?:"+[es+Z+"?",Z,ea,eo,Y].join("|")+")",eS=RegExp(Q,"g"),eE=RegExp(Z,"g"),e_=RegExp(ei+"(?="+ei+")|"+eT+ev,"g"),ew=RegExp([eu+"?"+er+"+"+ep+"(?="+[X,eu,"$"].join("|")+")",eh+"+"+ef+"(?="+[X,eu+ed,"$"].join("|")+")",eu+"?"+ed+"+"+ep,eu+"+"+ef,ee,eb].join("|"),"g"),eC=RegExp("["+ec+P+M+L+K+"]"),eI=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eR={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},ek="object"==typeof global&&global&&global.Object===Object&&global,eN="object"==typeof self&&self&&self.Object===Object&&self,eA=ek||eN||Function("return this")();function eD(T,S,R,N){var O=-1,P=T?T.length:0;for(N&&P&&(R=T[++O]);++O<P;)R=S(R,T[O],O,T);return R}function eO(T){return T.split("")}function ex(T){return T.match(N)||[]}var eP=function(T){return function(S){return null==T?void 0:T[S]}}(eR);function eM(T){return eC.test(T)}function eL(T){return eI.test(T)}function eF(T){return eM(T)?eB(T):eO(T)}function eB(T){return T.match(e_)||[]}function eU(T){return T.match(ew)||[]}var eV=Object.prototype.toString,ej=eA.Symbol,ez=ej?ej.prototype:void 0,eq=ez?ez.toString:void 0;function eG(T,S,R){var N=-1,O=T.length;S<0&&(S=-S>O?0:O+S),(R=R>O?O:R)<0&&(R+=O),O=S>R?0:R-S>>>0,S>>>=0;for(var P=Array(O);++N<O;)P[N]=T[N+S];return P}function e$(T){if("string"==typeof T)return T;if(eQ(T))return eq?eq.call(T):"";var R=T+"";return"0"==R&&1/T==-S?"-0":R}function eK(T,S,R){var N=T.length;return R=void 0===R?N:R,!S&&R>=N?T:eG(T,S,R)}function eH(T){return function(S){var R=eM(S=eY(S))?eF(S):void 0,N=R?R[0]:S.charAt(0),O=R?eK(R,1).join(""):S.slice(1);return N[T]()+O}}function eW(T){return!!T&&"object"==typeof T}function eQ(T){return"symbol"==typeof T||eW(T)&&eV.call(T)==R}function eY(T){return null==T?"":e$(T)}var eJ=function(T){return function(S){return eD(e1(eZ(S).replace(eS,"")),T,"")}}(function(T,S,R){return S=S.toLowerCase(),T+(R?eX(S):S)});function eX(T){return e0(eY(T).toLowerCase())}function eZ(T){return(T=eY(T))&&T.replace(O,eP).replace(eE,"")}var e0=eH("toUpperCase");function e1(T,S,R){return(T=eY(T),void 0===(S=R?void 0:S))?eL(T)?eU(T):ex(T):T.match(S)||[]}T.exports=eJ},21725:(T,S,R)=>{"use strict";var N=R(25269);T.exports=S=N.descriptor=N.Root.fromJSON(R(89987)).lookup(".google.protobuf");var O=N.Namespace,P=N.Root,M=N.Enum,L=N.Type,U=N.Field,V=N.MapField,$=N.OneOf,K=N.Service,W=N.Method;function Q(T,R,N){var V=S.FileDescriptorProto.create({name:T.filename||(T.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});ef(N,V),T instanceof P||(V.package=T.fullName.substring(1));for(var $,W=0;W<T.nestedArray.length;++W)($=T._nestedArray[W])instanceof L?V.messageType.push($.toDescriptor(N)):$ instanceof M?V.enumType.push($.toDescriptor()):$ instanceof U?V.extension.push($.toDescriptor(N)):$ instanceof K?V.service.push($.toDescriptor()):$ instanceof O&&Q($,R,N);V.options=ec(T.options,S.FileOptions),V.messageType.length+V.enumType.length+V.extension.length+V.service.length&&R.push(V)}P.fromDescriptor=function(T){"number"==typeof T.length&&(T=S.FileDescriptorSet.decode(T));var R=new P;if(T.file)for(var N,O,V,$=0;$<T.file.length;++$){O=R,(N=T.file[$]).package&&N.package.length&&(O=R.define(N.package));var W=ep(N);if(N.name&&N.name.length&&R.files.push(O.filename=N.name),N.messageType)for(V=0;V<N.messageType.length;++V)O.add(L.fromDescriptor(N.messageType[V],W));if(N.enumType)for(V=0;V<N.enumType.length;++V)O.add(M.fromDescriptor(N.enumType[V],W));if(N.extension)for(V=0;V<N.extension.length;++V)O.add(U.fromDescriptor(N.extension[V],W));if(N.service)for(V=0;V<N.service.length;++V)O.add(K.fromDescriptor(N.service[V],W));var Q=eo(N.options,S.FileOptions);if(Q){var Y=Object.keys(Q);for(V=0;V<Y.length;++V)O.setOption(Y[V],Q[Y[V]])}}return R.resolveAll()},P.prototype.toDescriptor=function(T){var R=S.FileDescriptorSet.create();return Q(this,R.file,T),R};var Y=0;L.fromDescriptor=function(T,R,N){"number"==typeof T.length&&(T=S.DescriptorProto.decode(T));var O,P=new L(T.name.length?T.name:"Type"+Y++,eo(T.options,S.MessageOptions));if(N||(P._edition=R),T.oneofDecl)for(O=0;O<T.oneofDecl.length;++O)P.add($.fromDescriptor(T.oneofDecl[O]));if(T.field)for(O=0;O<T.field.length;++O){var V=U.fromDescriptor(T.field[O],R,!0);P.add(V),T.field[O].hasOwnProperty("oneofIndex")&&P.oneofsArray[T.field[O].oneofIndex].add(V)}if(T.extension)for(O=0;O<T.extension.length;++O)P.add(U.fromDescriptor(T.extension[O],R,!0));if(T.nestedType)for(O=0;O<T.nestedType.length;++O)P.add(L.fromDescriptor(T.nestedType[O],R,!0)),T.nestedType[O].options&&T.nestedType[O].options.mapEntry&&P.setOption("map_entry",!0);if(T.enumType)for(O=0;O<T.enumType.length;++O)P.add(M.fromDescriptor(T.enumType[O],R,!0));if(T.extensionRange&&T.extensionRange.length)for(O=0,P.extensions=[];O<T.extensionRange.length;++O)P.extensions.push([T.extensionRange[O].start,T.extensionRange[O].end]);if(T.reservedRange&&T.reservedRange.length||T.reservedName&&T.reservedName.length){if(P.reserved=[],T.reservedRange)for(O=0;O<T.reservedRange.length;++O)P.reserved.push([T.reservedRange[O].start,T.reservedRange[O].end]);if(T.reservedName)for(O=0;O<T.reservedName.length;++O)P.reserved.push(T.reservedName[O])}return P},L.prototype.toDescriptor=function(T){var R,N,O=S.DescriptorProto.create({name:this.name});for(N=0;N<this.fieldsArray.length;++N)if(O.field.push(R=this._fieldsArray[N].toDescriptor(T)),this._fieldsArray[N]instanceof V){var P=es(this._fieldsArray[N].keyType,this._fieldsArray[N].resolvedKeyType,!1),$=es(this._fieldsArray[N].type,this._fieldsArray[N].resolvedType,!1),K=11===$||14===$?this._fieldsArray[N].resolvedType&&ed(this.parent,this._fieldsArray[N].resolvedType)||this._fieldsArray[N].type:void 0;O.nestedType.push(S.DescriptorProto.create({name:R.typeName,field:[S.FieldDescriptorProto.create({name:"key",number:1,label:1,type:P}),S.FieldDescriptorProto.create({name:"value",number:2,label:1,type:$,typeName:K})],options:S.MessageOptions.create({mapEntry:!0})}))}for(N=0;N<this.oneofsArray.length;++N)O.oneofDecl.push(this._oneofsArray[N].toDescriptor());for(N=0;N<this.nestedArray.length;++N)this._nestedArray[N]instanceof U?O.field.push(this._nestedArray[N].toDescriptor(T)):this._nestedArray[N]instanceof L?O.nestedType.push(this._nestedArray[N].toDescriptor(T)):this._nestedArray[N]instanceof M&&O.enumType.push(this._nestedArray[N].toDescriptor());if(this.extensions)for(N=0;N<this.extensions.length;++N)O.extensionRange.push(S.DescriptorProto.ExtensionRange.create({start:this.extensions[N][0],end:this.extensions[N][1]}));if(this.reserved)for(N=0;N<this.reserved.length;++N)"string"==typeof this.reserved[N]?O.reservedName.push(this.reserved[N]):O.reservedRange.push(S.DescriptorProto.ReservedRange.create({start:this.reserved[N][0],end:this.reserved[N][1]}));return O.options=ec(this.options,S.MessageOptions),O};var X=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;U.fromDescriptor=function(T,R,N){if("number"==typeof T.length&&(T=S.DescriptorProto.decode(T)),"number"!=typeof T.number)throw Error("missing field id");switch(O=T.typeName&&T.typeName.length?T.typeName:en(T.type),T.label){case 1:P=void 0;break;case 2:P="required";break;case 3:P="repeated";break;default:throw Error("illegal label: "+T.label)}var O,P,M=T.extendee;void 0!==T.extendee&&(M=M.length?M:void 0);var L=new U(T.name.length?T.name:"field"+T.number,T.number,O,P,M);if(N||(L._edition=R),L.options=eo(T.options,S.FieldOptions),T.proto3_optional&&(L.options.proto3_optional=!0),T.defaultValue&&T.defaultValue.length){var V=T.defaultValue;switch(V){case"true":case"TRUE":V=!0;break;case"false":case"FALSE":V=!1;break;default:X.exec(V)&&(V=parseInt(V))}L.setOption("default",V)}return ei(T.type)&&("proto3"===R?T.options&&!T.options.packed&&L.setOption("packed",!1):(!R||"proto2"===R)&&T.options&&T.options.packed&&L.setOption("packed",!0)),L},U.prototype.toDescriptor=function(T){var R=S.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)R.type=11,R.typeName=N.util.ucFirst(this.name),R.label=3;else{switch(R.type=es(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:R.typeName=this.resolvedType?ed(this.parent,this.resolvedType):this.type}"repeated"===this.rule?R.label=3:this.required&&"proto2"===T?R.label=2:R.label=1}if(R.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(R.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(R.options=ec(this.options,S.FieldOptions),null!=this.options.default&&(R.defaultValue=String(this.options.default)),this.options.proto3_optional&&(R.proto3_optional=!0)),"proto3"===T?this.packed||((R.options||(R.options=S.FieldOptions.create())).packed=!1):(!T||"proto2"===T)&&this.packed&&((R.options||(R.options=S.FieldOptions.create())).packed=!0),R};var Z=0;M.fromDescriptor=function(T,R,N){"number"==typeof T.length&&(T=S.EnumDescriptorProto.decode(T));var O={};if(T.value)for(var P=0;P<T.value.length;++P){var L=T.value[P].name,U=T.value[P].number||0;O[L&&L.length?L:"NAME"+U]=U}var V=new M(T.name&&T.name.length?T.name:"Enum"+Z++,O,eo(T.options,S.EnumOptions));return N||(V._edition=R),V},M.prototype.toDescriptor=function(){for(var T=[],R=0,N=Object.keys(this.values);R<N.length;++R)T.push(S.EnumValueDescriptorProto.create({name:N[R],number:this.values[N[R]]}));return S.EnumDescriptorProto.create({name:this.name,value:T,options:ec(this.options,S.EnumOptions)})};var ee=0;$.fromDescriptor=function(T){return"number"==typeof T.length&&(T=S.OneofDescriptorProto.decode(T)),new $(T.name&&T.name.length?T.name:"oneof"+ee++)},$.prototype.toDescriptor=function(){return S.OneofDescriptorProto.create({name:this.name})};var et=0;K.fromDescriptor=function(T,R,N){"number"==typeof T.length&&(T=S.ServiceDescriptorProto.decode(T));var O=new K(T.name&&T.name.length?T.name:"Service"+et++,eo(T.options,S.ServiceOptions));if(N||(O._edition=R),T.method)for(var P=0;P<T.method.length;++P)O.add(W.fromDescriptor(T.method[P]));return O},K.prototype.toDescriptor=function(){for(var T=[],R=0;R<this.methodsArray.length;++R)T.push(this._methodsArray[R].toDescriptor());return S.ServiceDescriptorProto.create({name:this.name,method:T,options:ec(this.options,S.ServiceOptions)})};var er=0;function en(T){switch(T){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+T)}function ei(T){switch(T){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function es(T,S,R){switch(T){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(S instanceof M)return 14;if(S instanceof L)return R?10:11;throw Error("illegal type: "+T)}function ea(T,S){for(var R,N,O={},P=0;P<S.fieldsArray.length;++P)if("uninterpretedOption"!==(N=(R=S._fieldsArray[P]).name)&&Object.prototype.hasOwnProperty.call(T,N)){var U=eh(N);R.resolvedType instanceof L?O[U]=ea(T[N],R.resolvedType):R.resolvedType instanceof M?O[U]=R.resolvedType.valuesById[T[N]]:O[U]=T[N]}return O}function eo(T,S){if(T)return ea(S.toObject(T),S)}function eu(T,S){for(var R={},O=Object.keys(T),P=0;P<O.length;++P){var M=O[P],U=N.util.camelCase(M);if(Object.prototype.hasOwnProperty.call(S.fields,U)){var V=S.fields[U];V.resolvedType instanceof L?R[U]=eu(T[M],V.resolvedType):R[U]=T[M],V.repeated&&!Array.isArray(R[U])&&(R[U]=[R[U]])}}return R}function ec(T,S){if(T)return S.fromObject(eu(T,S))}function ed(T,S){var R=T.fullName.split("."),N=S.fullName.split("."),M=0,L=0,U=N.length-1;if(!(T instanceof P)&&S instanceof O)for(;M<R.length&&L<U&&R[M]===N[L];){var V=S.lookup(R[M++],!0);if(null!==V&&V!==S)break;++L}else for(;M<R.length&&L<U&&R[M]===N[L];++M,++L);return N.slice(L).join(".")}function eh(T){return T.substring(0,1)+T.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(T,S){return"_"+S.toLowerCase()})}function ep(T){if("editions"===T.syntax){if(T.edition===S.Edition.EDITION_2023)return"2023";throw Error("Unsupported edition "+T.edition)}return"proto3"===T.syntax?"proto3":"proto2"}function ef(T,R){if(T){if("proto2"===T||"proto3"===T)R.syntax=T;else if(R.syntax="editions","2023"===T)R.edition=S.Edition.EDITION_2023;else throw Error("Unsupported edition "+T)}}W.fromDescriptor=function(T){return"number"==typeof T.length&&(T=S.MethodDescriptorProto.decode(T)),new W(T.name&&T.name.length?T.name:"Method"+er++,"rpc",T.inputType,T.outputType,!!T.clientStreaming,!!T.serverStreaming,eo(T.options,S.MethodOptions))},W.prototype.toDescriptor=function(){return S.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:ec(this.options,S.MethodOptions)})}},25269:(T,S,R)=>{"use strict";T.exports=R(57954)},62516:T=>{"use strict";T.exports=N;var S,R=/\/|\./;function N(T,S){R.test(T)||(T="google/protobuf/"+T+".proto",S={nested:{google:{nested:{protobuf:{nested:S}}}}}),N[T]=S}N("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),N("duration",{Duration:S={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),N("timestamp",{Timestamp:S}),N("empty",{Empty:{fields:{}}}),N("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),N("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),N("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),N.get=function(T){return N[T]||null}},5944:(T,S,R)=>{"use strict";var N=S,O=R(33982),P=R(18289);function M(T,S,R,N){var P=!1;if(S.resolvedType){if(S.resolvedType instanceof O){T("switch(d%s){",N);for(var M=S.resolvedType.values,L=Object.keys(M),U=0;U<L.length;++U)M[L[U]]!==S.typeDefault||P||(T("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',N,N,N),S.repeated||T("break"),P=!0),T("case%j:",L[U])("case %i:",M[L[U]])("m%s=%j",N,M[L[U]])("break");T("}")}else T('if(typeof d%s!=="object")',N)("throw TypeError(%j)",S.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",N,R,N)}else{var V=!1;switch(S.type){case"double":case"float":T("m%s=Number(d%s)",N,N);break;case"uint32":case"fixed32":T("m%s=d%s>>>0",N,N);break;case"int32":case"sint32":case"sfixed32":T("m%s=d%s|0",N,N);break;case"uint64":V=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":T("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",N,N,V)('else if(typeof d%s==="string")',N)("m%s=parseInt(d%s,10)",N,N)('else if(typeof d%s==="number")',N)("m%s=d%s",N,N)('else if(typeof d%s==="object")',N)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",N,N,N,V?"true":"");break;case"bytes":T('if(typeof d%s==="string")',N)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",N,N,N)("else if(d%s.length >= 0)",N)("m%s=d%s",N,N);break;case"string":T("m%s=String(d%s)",N,N);break;case"bool":T("m%s=Boolean(d%s)",N,N)}}return T}function L(T,S,R,N){if(S.resolvedType)S.resolvedType instanceof O?T("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",N,R,N,N,R,N,N):T("d%s=types[%i].toObject(m%s,o)",N,R,N);else{var P=!1;switch(S.type){case"double":case"float":T("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",N,N,N,N);break;case"uint64":P=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":T('if(typeof m%s==="number")',N)("d%s=o.longs===String?String(m%s):m%s",N,N,N)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",N,N,N,N,P?"true":"",N);break;case"bytes":T("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",N,N,N,N,N);break;default:T("d%s=m%s",N,N)}}return T}N.fromObject=function(T){var S=T.fieldsArray,R=P.codegen(["d"],T.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!S.length)return R("return new this.ctor");R("var m=new this.ctor");for(var N=0;N<S.length;++N){var L=S[N].resolve(),U=P.safeProp(L.name);L.map?(R("if(d%s){",U)('if(typeof d%s!=="object")',U)("throw TypeError(%j)",L.fullName+": object expected")("m%s={}",U)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",U),M(R,L,N,U+"[ks[i]]")("}")("}")):L.repeated?(R("if(d%s){",U)("if(!Array.isArray(d%s))",U)("throw TypeError(%j)",L.fullName+": array expected")("m%s=[]",U)("for(var i=0;i<d%s.length;++i){",U),M(R,L,N,U+"[i]")("}")("}")):(L.resolvedType instanceof O||R("if(d%s!=null){",U),M(R,L,N,U),L.resolvedType instanceof O||R("}"))}return R("return m")},N.toObject=function(T){var S=T.fieldsArray.slice().sort(P.compareFieldsById);if(!S.length)return P.codegen()("return {}");for(var R=P.codegen(["m","o"],T.name+"$toObject")("if(!o)")("o={}")("var d={}"),N=[],M=[],U=[],V=0;V<S.length;++V)S[V].partOf||(S[V].resolve().repeated?N:S[V].map?M:U).push(S[V]);if(N.length){for(R("if(o.arrays||o.defaults){"),V=0;V<N.length;++V)R("d%s=[]",P.safeProp(N[V].name));R("}")}if(M.length){for(R("if(o.objects||o.defaults){"),V=0;V<M.length;++V)R("d%s={}",P.safeProp(M[V].name));R("}")}if(U.length){for(R("if(o.defaults){"),V=0;V<U.length;++V){var $=U[V],K=P.safeProp($.name);if($.resolvedType instanceof O)R("d%s=o.enums===String?%j:%j",K,$.resolvedType.valuesById[$.typeDefault],$.typeDefault);else if($.long)R("if(util.Long){")("var n=new util.Long(%i,%i,%j)",$.typeDefault.low,$.typeDefault.high,$.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",K)("}else")("d%s=o.longs===String?%j:%i",K,$.typeDefault.toString(),$.typeDefault.toNumber());else if($.bytes){var W="["+Array.prototype.slice.call($.typeDefault).join(",")+"]";R("if(o.bytes===String)d%s=%j",K,String.fromCharCode.apply(String,$.typeDefault))("else{")("d%s=%s",K,W)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",K,K)("}")}else R("d%s=%j",K,$.typeDefault)}R("}")}var Q=!1;for(V=0;V<S.length;++V){var $=S[V],Y=T._fieldsArray.indexOf($),K=P.safeProp($.name);$.map?(Q||(Q=!0,R("var ks2")),R("if(m%s&&(ks2=Object.keys(m%s)).length){",K,K)("d%s={}",K)("for(var j=0;j<ks2.length;++j){"),L(R,$,Y,K+"[ks2[j]]")("}")):$.repeated?(R("if(m%s&&m%s.length){",K,K)("d%s=[]",K)("for(var j=0;j<m%s.length;++j){",K),L(R,$,Y,K+"[j]")("}")):(R("if(m%s!=null&&m.hasOwnProperty(%j)){",K,$.name),L(R,$,Y,K),$.partOf&&R("if(o.oneofs)")("d%s=%j",P.safeProp($.partOf.name),$.name)),R("}")}return R("return d")}},98983:(T,S,R)=>{"use strict";T.exports=L;var N=R(33982),O=R(31627),P=R(18289);function M(T){return"missing required '"+T.name+"'"}function L(T){for(var S=P.codegen(["r","l","e"],T.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(T.fieldsArray.filter(function(T){return T.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),R=0;R<T.fieldsArray.length;++R){var L=T._fieldsArray[R].resolve(),U=L.resolvedType instanceof N?"int32":L.type,V="m"+P.safeProp(L.name);S("case %i: {",L.id),L.map?(S("if(%s===util.emptyObject)",V)("%s={}",V)("var c2 = r.uint32()+r.pos"),void 0!==O.defaults[L.keyType]?S("k=%j",O.defaults[L.keyType]):S("k=null"),void 0!==O.defaults[U]?S("value=%j",O.defaults[U]):S("value=null"),S("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",L.keyType)("case 2:"),void 0===O.basic[U]?S("value=types[%i].decode(r,r.uint32())",R):S("value=r.%s()",U),S("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),S(void 0!==O.long[L.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",V)):L.repeated?(S("if(!(%s&&%s.length))",V,V)("%s=[]",V),void 0!==O.packed[U]&&S("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",V,U)("}else"),void 0===O.basic[U]?S(L.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",V,R):S("%s.push(r.%s())",V,U)):void 0===O.basic[U]?S(L.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",V,R):S("%s=r.%s()",V,U),S("break")("}")}for(S("default:")("r.skipType(t&7)")("break")("}")("}"),R=0;R<T._fieldsArray.length;++R){var $=T._fieldsArray[R];$.required&&S("if(!m.hasOwnProperty(%j))",$.name)("throw util.ProtocolError(%j,{instance:m})",M($))}return S("return m")}},67337:(T,S,R)=>{"use strict";T.exports=L;var N=R(33982),O=R(31627),P=R(18289);function M(T,S,R,N){return S.delimited?T("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",R,N,(S.id<<3|3)>>>0,(S.id<<3|4)>>>0):T("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",R,N,(S.id<<3|2)>>>0)}function L(T){for(var S,R,L=P.codegen(["m","w"],T.name+"$encode")("if(!w)")("w=Writer.create()"),U=T.fieldsArray.slice().sort(P.compareFieldsById),S=0;S<U.length;++S){var V=U[S].resolve(),$=T._fieldsArray.indexOf(V),K=V.resolvedType instanceof N?"int32":V.type,W=O.basic[K];R="m"+P.safeProp(V.name),V.map?(L("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",R,V.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",R)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(V.id<<3|2)>>>0,8|O.mapKey[V.keyType],V.keyType),void 0===W?L("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",$,R):L(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|W,K,R),L("}")("}")):V.repeated?(L("if(%s!=null&&%s.length){",R,R),V.packed&&void 0!==O.packed[K]?L("w.uint32(%i).fork()",(V.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",R)("w.%s(%s[i])",K,R)("w.ldelim()"):(L("for(var i=0;i<%s.length;++i)",R),void 0===W?M(L,V,$,R+"[i]"):L("w.uint32(%i).%s(%s[i])",(V.id<<3|W)>>>0,K,R)),L("}")):(V.optional&&L("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",R,V.name),void 0===W?M(L,V,$,R):L("w.uint32(%i).%s(%s)",(V.id<<3|W)>>>0,K,R))}return L("return w")}},33982:(T,S,R)=>{"use strict";T.exports=M;var N=R(58831);((M.prototype=Object.create(N.prototype)).constructor=M).className="Enum";var O=R(44622),P=R(18289);function M(T,S,R,O,P,M){if(N.call(this,T,R),S&&"object"!=typeof S)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=O,this.comments=P||{},this.valuesOptions=M,this._valuesFeatures={},this.reserved=void 0,S)for(var L=Object.keys(S),U=0;U<L.length;++U)"number"==typeof S[L[U]]&&(this.valuesById[this.values[L[U]]=S[L[U]]]=L[U])}M.prototype._resolveFeatures=function(T){return T=this._edition||T,N.prototype._resolveFeatures.call(this,T),Object.keys(this.values).forEach(T=>{var S=Object.assign({},this._features);this._valuesFeatures[T]=Object.assign(S,this.valuesOptions&&this.valuesOptions[T]&&this.valuesOptions[T].features)}),this},M.fromJSON=function(T,S){var R=new M(T,S.values,S.options,S.comment,S.comments);return R.reserved=S.reserved,S.edition&&(R._edition=S.edition),R._defaultEdition="proto3",R},M.prototype.toJSON=function(T){var S=!!T&&!!T.keepComments;return P.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",S?this.comment:void 0,"comments",S?this.comments:void 0])},M.prototype.add=function(T,S,R,N){if(!P.isString(T))throw TypeError("name must be a string");if(!P.isInteger(S))throw TypeError("id must be an integer");if(void 0!==this.values[T])throw Error("duplicate name '"+T+"' in "+this);if(this.isReservedId(S))throw Error("id "+S+" is reserved in "+this);if(this.isReservedName(T))throw Error("name '"+T+"' is reserved in "+this);if(void 0!==this.valuesById[S]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+S+" in "+this);this.values[T]=S}else this.valuesById[this.values[T]=S]=T;return N&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[T]=N||null),this.comments[T]=R||null,this},M.prototype.remove=function(T){if(!P.isString(T))throw TypeError("name must be a string");var S=this.values[T];if(null==S)throw Error("name '"+T+"' does not exist in "+this);return delete this.valuesById[S],delete this.values[T],delete this.comments[T],this.valuesOptions&&delete this.valuesOptions[T],this},M.prototype.isReservedId=function(T){return O.isReservedId(this.reserved,T)},M.prototype.isReservedName=function(T){return O.isReservedName(this.reserved,T)}},92548:(T,S,R)=>{"use strict";T.exports=V;var N,O=R(58831);((V.prototype=Object.create(O.prototype)).constructor=V).className="Field";var P=R(33982),M=R(31627),L=R(18289),U=/^required|optional|repeated$/;function V(T,S,R,N,P,V,$){if(L.isObject(N)?($=P,V=N,N=P=void 0):L.isObject(P)&&($=V,V=P,P=void 0),O.call(this,T,V),!L.isInteger(S)||S<0)throw TypeError("id must be a non-negative integer");if(!L.isString(R))throw TypeError("type must be a string");if(void 0!==N&&!U.test(N=N.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==P&&!L.isString(P))throw TypeError("extend must be a string");"proto3_optional"===N&&(N="optional"),this.rule=N&&"optional"!==N?N:void 0,this.type=R,this.id=S,this.extend=P||void 0,this.repeated="repeated"===N,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!L.Long&&void 0!==M.long[R],this.bytes="bytes"===R,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=$}V.fromJSON=function(T,S){var R=new V(T,S.id,S.type,S.rule,S.extend,S.options,S.comment);return S.edition&&(R._edition=S.edition),R._defaultEdition="proto3",R},Object.defineProperty(V.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(V.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(V.prototype,"delimited",{get:function(){return this.resolvedType instanceof N&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(V.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(V.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),V.prototype.setOption=function(T,S,R){return O.prototype.setOption.call(this,T,S,R)},V.prototype.toJSON=function(T){var S=!!T&&!!T.keepComments;return L.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",S?this.comment:void 0])},V.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=M.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof N?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof P&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof P||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=L.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var T;L.base64.test(this.typeDefault)?L.base64.decode(this.typeDefault,T=L.newBuffer(L.base64.length(this.typeDefault)),0):L.utf8.write(this.typeDefault,T=L.newBuffer(L.utf8.length(this.typeDefault)),0),this.typeDefault=T}return this.map?this.defaultValue=L.emptyObject:this.repeated?this.defaultValue=L.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof N&&(this.parent.ctor.prototype[this.name]=this.defaultValue),O.prototype.resolve.call(this)},V.prototype._inferLegacyProtoFeatures=function(T){if("proto2"!==T&&"proto3"!==T)return{};var S={};if("required"===this.rule&&(S.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===M.defaults[this.type]){var R=this.parent.get(this.type.split(".").pop());R&&R instanceof N&&R.group&&(S.message_encoding="DELIMITED")}return!0===this.getOption("packed")?S.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(S.repeated_field_encoding="EXPANDED"),S},V.prototype._resolveFeatures=function(T){return O.prototype._resolveFeatures.call(this,this._edition||T)},V.d=function(T,S,R,N){return"function"==typeof S?S=L.decorateType(S).name:S&&"object"==typeof S&&(S=L.decorateEnum(S).name),function(O,P){L.decorateType(O.constructor).add(new V(P,T,S,R,{default:N}))}},V._configure=function(T){N=T}},72822:(T,S,R)=>{"use strict";var N=T.exports=R(65748);function O(T,S,R){return"function"==typeof S?(R=S,S=new N.Root):S||(S=new N.Root),S.load(T,R)}function P(T,S){return S||(S=new N.Root),S.loadSync(T)}N.build="light",N.load=O,N.loadSync=P,N.encoder=R(67337),N.decoder=R(98983),N.verifier=R(31181),N.converter=R(5944),N.ReflectionObject=R(58831),N.Namespace=R(44622),N.Root=R(34955),N.Enum=R(33982),N.Type=R(69396),N.Field=R(92548),N.OneOf=R(85677),N.MapField=R(30372),N.Service=R(26962),N.Method=R(3055),N.Message=R(55326),N.wrappers=R(82969),N.types=R(31627),N.util=R(18289),N.ReflectionObject._configure(N.Root),N.Namespace._configure(N.Type,N.Service,N.Enum),N.Root._configure(N.Type),N.Field._configure(N.Type)},65748:(T,S,R)=>{"use strict";var N=S;function O(){N.util._configure(),N.Writer._configure(N.BufferWriter),N.Reader._configure(N.BufferReader)}N.build="minimal",N.Writer=R(47474),N.BufferWriter=R(96985),N.Reader=R(8645),N.BufferReader=R(2126),N.util=R(86416),N.rpc=R(84415),N.roots=R(43675),N.configure=O,O()},57954:(T,S,R)=>{"use strict";var N=T.exports=R(72822);N.build="full",N.tokenize=R(89468),N.parse=R(60580),N.common=R(62516),N.Root._configure(N.Type,N.parse,N.common)},30372:(T,S,R)=>{"use strict";T.exports=M;var N=R(92548);((M.prototype=Object.create(N.prototype)).constructor=M).className="MapField";var O=R(31627),P=R(18289);function M(T,S,R,O,M,L){if(N.call(this,T,S,O,void 0,void 0,M,L),!P.isString(R))throw TypeError("keyType must be a string");this.keyType=R,this.resolvedKeyType=null,this.map=!0}M.fromJSON=function(T,S){return new M(T,S.id,S.keyType,S.type,S.options,S.comment)},M.prototype.toJSON=function(T){var S=!!T&&!!T.keepComments;return P.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",S?this.comment:void 0])},M.prototype.resolve=function(){if(this.resolved)return this;if(void 0===O.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return N.prototype.resolve.call(this)},M.d=function(T,S,R){return"function"==typeof R?R=P.decorateType(R).name:R&&"object"==typeof R&&(R=P.decorateEnum(R).name),function(N,O){P.decorateType(N.constructor).add(new M(O,T,S,R))}}},55326:(T,S,R)=>{"use strict";T.exports=O;var N=R(86416);function O(T){if(T)for(var S=Object.keys(T),R=0;R<S.length;++R)this[S[R]]=T[S[R]]}O.create=function(T){return this.$type.create(T)},O.encode=function(T,S){return this.$type.encode(T,S)},O.encodeDelimited=function(T,S){return this.$type.encodeDelimited(T,S)},O.decode=function(T){return this.$type.decode(T)},O.decodeDelimited=function(T){return this.$type.decodeDelimited(T)},O.verify=function(T){return this.$type.verify(T)},O.fromObject=function(T){return this.$type.fromObject(T)},O.toObject=function(T,S){return this.$type.toObject(T,S)},O.prototype.toJSON=function(){return this.$type.toObject(this,N.toJSONOptions)}},3055:(T,S,R)=>{"use strict";T.exports=P;var N=R(58831);((P.prototype=Object.create(N.prototype)).constructor=P).className="Method";var O=R(18289);function P(T,S,R,P,M,L,U,V,$){if(O.isObject(M)?(U=M,M=L=void 0):O.isObject(L)&&(U=L,L=void 0),!(void 0===S||O.isString(S)))throw TypeError("type must be a string");if(!O.isString(R))throw TypeError("requestType must be a string");if(!O.isString(P))throw TypeError("responseType must be a string");N.call(this,T,U),this.type=S||"rpc",this.requestType=R,this.requestStream=!!M||void 0,this.responseType=P,this.responseStream=!!L||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=V,this.parsedOptions=$}P.fromJSON=function(T,S){return new P(T,S.type,S.requestType,S.responseType,S.requestStream,S.responseStream,S.options,S.comment,S.parsedOptions)},P.prototype.toJSON=function(T){var S=!!T&&!!T.keepComments;return O.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",S?this.comment:void 0,"parsedOptions",this.parsedOptions])},P.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),N.prototype.resolve.call(this))}},44622:(T,S,R)=>{"use strict";T.exports=K;var N,O,P,M=R(58831);((K.prototype=Object.create(M.prototype)).constructor=K).className="Namespace";var L=R(92548),U=R(18289),V=R(85677);function $(T,S){if(T&&T.length){for(var R={},N=0;N<T.length;++N)R[T[N].name]=T[N].toJSON(S);return R}}function K(T,S){M.call(this,T,S),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function W(T){T._nestedArray=null,T._lookupCache={};for(var S=T;S=S.parent;)S._lookupCache={};return T}K.fromJSON=function(T,S){return new K(T,S.options).addJSON(S.nested)},K.arrayToJSON=$,K.isReservedId=function(T,S){if(T){for(var R=0;R<T.length;++R)if("string"!=typeof T[R]&&T[R][0]<=S&&T[R][1]>S)return!0}return!1},K.isReservedName=function(T,S){if(T){for(var R=0;R<T.length;++R)if(T[R]===S)return!0}return!1},Object.defineProperty(K.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=U.toArray(this.nested))}}),K.prototype.toJSON=function(T){return U.toObject(["options",this.options,"nested",$(this.nestedArray,T)])},K.prototype.addJSON=function(T){var S=this;if(T)for(var R,M=Object.keys(T),U=0;U<M.length;++U)R=T[M[U]],S.add((void 0!==R.fields?N.fromJSON:void 0!==R.values?P.fromJSON:void 0!==R.methods?O.fromJSON:void 0!==R.id?L.fromJSON:K.fromJSON)(M[U],R));return this},K.prototype.get=function(T){return this.nested&&this.nested[T]||null},K.prototype.getEnum=function(T){if(this.nested&&this.nested[T]instanceof P)return this.nested[T].values;throw Error("no such enum: "+T)},K.prototype.add=function(T){if(!(T instanceof L&&void 0!==T.extend||T instanceof N||T instanceof V||T instanceof P||T instanceof O||T instanceof K))throw TypeError("object must be a valid nested object");if(this.nested){var S=this.get(T.name);if(S){if(S instanceof K&&T instanceof K&&!(S instanceof N||S instanceof O)){for(var R=S.nestedArray,M=0;M<R.length;++M)T.add(R[M]);this.remove(S),this.nested||(this.nested={}),T.setOptions(S.options,!0)}else throw Error("duplicate name '"+T.name+"' in "+this)}}else this.nested={};this.nested[T.name]=T,this instanceof N||this instanceof O||this instanceof P||this instanceof L||T._edition||(T._edition=T._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var U=this;U=U.parent;)U._needsRecursiveFeatureResolution=!0,U._needsRecursiveResolve=!0;return T.onAdd(this),W(this)},K.prototype.remove=function(T){if(!(T instanceof M))throw TypeError("object must be a ReflectionObject");if(T.parent!==this)throw Error(T+" is not a member of "+this);return delete this.nested[T.name],Object.keys(this.nested).length||(this.nested=void 0),T.onRemove(this),W(this)},K.prototype.define=function(T,S){if(U.isString(T))T=T.split(".");else if(!Array.isArray(T))throw TypeError("illegal path");if(T&&T.length&&""===T[0])throw Error("path must be relative");for(var R=this;T.length>0;){var N=T.shift();if(R.nested&&R.nested[N]){if(!((R=R.nested[N])instanceof K))throw Error("path conflicts with non-namespace objects")}else R.add(R=new K(N))}return S&&R.addJSON(S),R},K.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var T=this.nestedArray,S=0;for(this.resolve();S<T.length;)T[S]instanceof K?T[S++].resolveAll():T[S++].resolve();return this._needsRecursiveResolve=!1,this},K.prototype._resolveFeaturesRecursive=function(T){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,T=this._edition||T,M.prototype._resolveFeaturesRecursive.call(this,T),this.nestedArray.forEach(S=>{S._resolveFeaturesRecursive(T)})),this},K.prototype.lookup=function(T,S,R){if("boolean"==typeof S?(R=S,S=void 0):S&&!Array.isArray(S)&&(S=[S]),U.isString(T)&&T.length){if("."===T)return this.root;T=T.split(".")}else if(!T.length)return this;var N=T.join(".");if(""===T[0])return this.root.lookup(T.slice(1),S);var O=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+N];if(O&&(!S||S.indexOf(O.constructor)>-1)||(O=this._lookupImpl(T,N))&&(!S||S.indexOf(O.constructor)>-1))return O;if(R)return null;for(var P=this;P.parent;){if((O=P.parent._lookupImpl(T,N))&&(!S||S.indexOf(O.constructor)>-1))return O;P=P.parent}return null},K.prototype._lookupImpl=function(T,S){if(Object.prototype.hasOwnProperty.call(this._lookupCache,S))return this._lookupCache[S];var R=this.get(T[0]),N=null;if(R)1===T.length?N=R:R instanceof K&&(T=T.slice(1),N=R._lookupImpl(T,T.join(".")));else for(var O=0;O<this.nestedArray.length;++O)this._nestedArray[O]instanceof K&&(R=this._nestedArray[O]._lookupImpl(T,S))&&(N=R);return this._lookupCache[S]=N,N},K.prototype.lookupType=function(T){var S=this.lookup(T,[N]);if(!S)throw Error("no such type: "+T);return S},K.prototype.lookupEnum=function(T){var S=this.lookup(T,[P]);if(!S)throw Error("no such Enum '"+T+"' in "+this);return S},K.prototype.lookupTypeOrEnum=function(T){var S=this.lookup(T,[N,P]);if(!S)throw Error("no such Type or Enum '"+T+"' in "+this);return S},K.prototype.lookupService=function(T){var S=this.lookup(T,[O]);if(!S)throw Error("no such Service '"+T+"' in "+this);return S},K._configure=function(T,S,R){N=T,O=S,P=R}},58831:(T,S,R)=>{"use strict";T.exports=V,V.className="ReflectionObject";let N=R(85677);var O,P=R(18289),M={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},L={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},U={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function V(T,S){if(!P.isString(T))throw TypeError("name must be a string");if(S&&!P.isObject(S))throw TypeError("options must be an object");this.options=S,this.parsedOptions=null,this.name=T,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(V.prototype,{root:{get:function(){for(var T=this;null!==T.parent;)T=T.parent;return T}},fullName:{get:function(){for(var T=[this.name],S=this.parent;S;)T.unshift(S.name),S=S.parent;return T.join(".")}}}),V.prototype.toJSON=function(){throw Error()},V.prototype.onAdd=function(T){this.parent&&this.parent!==T&&this.parent.remove(this),this.parent=T,this.resolved=!1;var S=T.root;S instanceof O&&S._handleAdd(this)},V.prototype.onRemove=function(T){var S=T.root;S instanceof O&&S._handleRemove(this),this.parent=null,this.resolved=!1},V.prototype.resolve=function(){return this.resolved||this.root instanceof O&&(this.resolved=!0),this},V.prototype._resolveFeaturesRecursive=function(T){return this._resolveFeatures(this._edition||T)},V.prototype._resolveFeatures=function(T){if(!this._featuresResolved){var S={};if(!T)throw Error("Unknown edition for "+this.fullName);var R=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(T));if(this._edition){if("proto2"===T)S=Object.assign({},L);else if("proto3"===T)S=Object.assign({},U);else if("2023"===T)S=Object.assign({},M);else throw Error("Unknown edition: "+T);this._features=Object.assign(S,R||{}),this._featuresResolved=!0;return}if(this.partOf instanceof N){var O=Object.assign({},this.partOf._features);this._features=Object.assign(O,R||{})}else if(this.declaringField);else if(this.parent){var P=Object.assign({},this.parent._features);this._features=Object.assign(P,R||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},V.prototype._inferLegacyProtoFeatures=function(){return{}},V.prototype.getOption=function(T){if(this.options)return this.options[T]},V.prototype.setOption=function(T,S,R){return this.options||(this.options={}),/^features\./.test(T)?P.setProperty(this.options,T,S,R):R&&void 0!==this.options[T]||(this.getOption(T)!==S&&(this.resolved=!1),this.options[T]=S),this},V.prototype.setParsedOption=function(T,S,R){this.parsedOptions||(this.parsedOptions=[]);var N=this.parsedOptions;if(R){var O=N.find(function(S){return Object.prototype.hasOwnProperty.call(S,T)});if(O){var M=O[T];P.setProperty(M,R,S)}else(O={})[T]=P.setProperty({},R,S),N.push(O)}else{var L={};L[T]=S,N.push(L)}return this},V.prototype.setOptions=function(T,S){if(T)for(var R=Object.keys(T),N=0;N<R.length;++N)this.setOption(R[N],T[R[N]],S);return this},V.prototype.toString=function(){var T=this.constructor.className,S=this.fullName;return S.length?T+" "+S:T},V.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},V._configure=function(T){O=T}},85677:(T,S,R)=>{"use strict";T.exports=M;var N=R(58831);((M.prototype=Object.create(N.prototype)).constructor=M).className="OneOf";var O=R(92548),P=R(18289);function M(T,S,R,O){if(Array.isArray(S)||(R=S,S=void 0),N.call(this,T,R),!(void 0===S||Array.isArray(S)))throw TypeError("fieldNames must be an Array");this.oneof=S||[],this.fieldsArray=[],this.comment=O}function L(T){if(T.parent)for(var S=0;S<T.fieldsArray.length;++S)T.fieldsArray[S].parent||T.parent.add(T.fieldsArray[S])}M.fromJSON=function(T,S){return new M(T,S.oneof,S.options,S.comment)},M.prototype.toJSON=function(T){var S=!!T&&!!T.keepComments;return P.toObject(["options",this.options,"oneof",this.oneof,"comment",S?this.comment:void 0])},M.prototype.add=function(T){if(!(T instanceof O))throw TypeError("field must be a Field");return T.parent&&T.parent!==this.parent&&T.parent.remove(T),this.oneof.push(T.name),this.fieldsArray.push(T),T.partOf=this,L(this),this},M.prototype.remove=function(T){if(!(T instanceof O))throw TypeError("field must be a Field");var S=this.fieldsArray.indexOf(T);if(S<0)throw Error(T+" is not a member of "+this);return this.fieldsArray.splice(S,1),(S=this.oneof.indexOf(T.name))>-1&&this.oneof.splice(S,1),T.partOf=null,this},M.prototype.onAdd=function(T){N.prototype.onAdd.call(this,T);for(var S=this,R=0;R<this.oneof.length;++R){var O=T.get(this.oneof[R]);O&&!O.partOf&&(O.partOf=S,S.fieldsArray.push(O))}L(this)},M.prototype.onRemove=function(T){for(var S,R=0;R<this.fieldsArray.length;++R)(S=this.fieldsArray[R]).parent&&S.parent.remove(S);N.prototype.onRemove.call(this,T)},Object.defineProperty(M.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var T=this.fieldsArray[0];return null!=T.options&&!0===T.options.proto3_optional}}),M.d=function(){for(var T=Array(arguments.length),S=0;S<arguments.length;)T[S]=arguments[S++];return function(S,R){P.decorateType(S.constructor).add(new M(R,T)),Object.defineProperty(S,R,{get:P.oneOfGetter(T),set:P.oneOfSetter(T)})}}},60580:(T,S,R)=>{"use strict";T.exports=eo,eo.filename=null,eo.defaults={keepCase:!1};var N=R(89468),O=R(34955),P=R(69396),M=R(92548),L=R(30372),U=R(85677),V=R(33982),$=R(26962),K=R(3055),W=R(58831),Q=R(31627),Y=R(18289),X=/^[1-9][0-9]*$/,Z=/^-?[1-9][0-9]*$/,ee=/^0[x][0-9a-fA-F]+$/,et=/^-?0[x][0-9a-fA-F]+$/,er=/^0[0-7]+$/,en=/^-?0[0-7]+$/,ei=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,es=/^[a-zA-Z_][a-zA-Z_0-9]*$/,ea=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function eo(T,S,R){S instanceof O||(R=S,S=new O),R||(R=eo.defaults);var eu,ec,ed,eh,ep=R.preferTrailingComment||!1,ef=N(T,R.alternateCommentMode||!1),em=ef.next,eg=ef.push,ey=ef.peek,ev=ef.skip,eb=ef.cmnt,eT=!0,eS="proto2",eE=S,e_=[],ew={},eC=R.keepCase?function(T){return T}:Y.camelCase;function eI(){e_.forEach(T=>{T._edition=eS,Object.keys(ew).forEach(S=>{void 0===T.getOption(S)&&T.setOption(S,ew[S],!0)})})}function eR(T,S,R){var N=eo.filename;return R||(eo.filename=null),Error("illegal "+(S||"token")+" '"+T+"' ("+(N?N+", ":"")+"line "+ef.line+")")}function ek(){var T,S=[];do{if('"'!==(T=em())&&"'"!==T)throw eR(T);S.push(em()),ev(T),T=ey()}while('"'===T||"'"===T);return S.join("")}function eN(T){var S=em();switch(S){case"'":case'"':return eg(S),ek();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return eD(S,!0)}catch(R){if(T&&ea.test(S))return S;throw eR(S,"value")}}function eA(T,S){do if(S&&('"'===(R=ey())||"'"===R)){var R,N,O=ek();if(T.push(O),eS>=2023)throw eR(O,"id")}else try{T.push([N=eO(em()),ev("to",!0)?eO(em()):N])}catch(N){if(S&&ea.test(R)&&eS>=2023)T.push(R);else throw N}while(ev(",",!0));var P={options:void 0};P.setOption=function(T,S){void 0===this.options&&(this.options={}),this.options[T]=S},eB(P,function(T){if("option"===T)eK(P,T),ev(";");else throw eR(T)},function(){eY(P)})}function eD(T,S){var R=1;switch("-"===T.charAt(0)&&(R=-1,T=T.substring(1)),T){case"inf":case"INF":case"Inf":return 1/0*R;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(X.test(T))return R*parseInt(T,10);if(ee.test(T))return R*parseInt(T,16);if(er.test(T))return R*parseInt(T,8);if(ei.test(T))return R*parseFloat(T);throw eR(T,"number",S)}function eO(T,S){switch(T){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!S&&"-"===T.charAt(0))throw eR(T,"id");if(Z.test(T))return parseInt(T,10);if(et.test(T))return parseInt(T,16);if(en.test(T))return parseInt(T,8);throw eR(T,"id")}function ex(){if(void 0!==ec)throw eR("package");if(ec=em(),!ea.test(ec))throw eR(ec,"name");eE=eE.define(ec),ev(";")}function eP(){var T,S=ey();switch(S){case"weak":T=eh||(eh=[]),em();break;case"public":em();default:T=ed||(ed=[])}S=ek(),ev(";"),T.push(S)}function eM(){if(ev("="),(eS=ek())<2023)throw eR(eS,"syntax");ev(";")}function eL(){if(ev("="),!["2023"].includes(eS=ek()))throw eR(eS,"edition");ev(";")}function eF(T,S){switch(S){case"option":return eK(T,S),ev(";"),!0;case"message":return eU(T,S),!0;case"enum":return eG(T,S),!0;case"service":return eJ(T,S),!0;case"extend":return eZ(T,S),!0}return!1}function eB(T,S,R){var N,O=ef.line;if(T&&("string"!=typeof T.comment&&(T.comment=eb()),T.filename=eo.filename),ev("{",!0)){for(;"}"!==(N=em());)S(N);ev(";",!0)}else R&&R(),ev(";"),T&&("string"!=typeof T.comment||ep)&&(T.comment=eb(O)||T.comment)}function eU(T,S){if(!es.test(S=em()))throw eR(S,"type name");var R=new P(S);eB(R,function(T){if(!eF(R,T))switch(T){case"map":ez(R,T);break;case"required":if("proto2"!==eS)throw eR(T);case"repeated":eV(R,T);break;case"optional":if("proto3"===eS)eV(R,"proto3_optional");else if("proto2"!==eS)throw eR(T);else eV(R,"optional");break;case"oneof":eq(R,T);break;case"extensions":eA(R.extensions||(R.extensions=[]));break;case"reserved":eA(R.reserved||(R.reserved=[]),!0);break;default:if("proto2"===eS||!ea.test(T))throw eR(T);eg(T),eV(R,"optional")}}),T.add(R),T===eE&&e_.push(R)}function eV(T,S,R){var N=em();if("group"===N){ej(T,S);return}for(;N.endsWith(".")||ey().startsWith(".");)N+=em();if(!ea.test(N))throw eR(N,"type");var O=em();if(!es.test(O))throw eR(O,"name");O=eC(O),ev("=");var P=new M(O,eO(em()),N,S,R);if(eB(P,function(T){if("option"===T)eK(P,T),ev(";");else throw eR(T)},function(){eY(P)}),"proto3_optional"===S){var L=new U("_"+O);P.setOption("proto3_optional",!0),L.add(P),T.add(L)}else T.add(P);T===eE&&e_.push(P)}function ej(T,S){if(eS>=2023)throw eR("group");var R=em();if(!es.test(R))throw eR(R,"name");var N=Y.lcFirst(R);R===N&&(R=Y.ucFirst(R)),ev("=");var O=eO(em()),L=new P(R);L.group=!0;var U=new M(N,O,R,S);U.filename=eo.filename,eB(L,function(T){switch(T){case"option":eK(L,T),ev(";");break;case"required":case"repeated":eV(L,T);break;case"optional":"proto3"===eS?eV(L,"proto3_optional"):eV(L,"optional");break;case"message":eU(L,T);break;case"enum":eG(L,T);break;case"reserved":eA(L.reserved||(L.reserved=[]),!0);break;default:throw eR(T)}}),T.add(L).add(U)}function ez(T){ev("<");var S=em();if(void 0===Q.mapKey[S])throw eR(S,"type");ev(",");var R=em();if(!ea.test(R))throw eR(R,"type");ev(">");var N=em();if(!es.test(N))throw eR(N,"name");ev("=");var O=new L(eC(N),eO(em()),S,R);eB(O,function(T){if("option"===T)eK(O,T),ev(";");else throw eR(T)},function(){eY(O)}),T.add(O)}function eq(T,S){if(!es.test(S=em()))throw eR(S,"name");var R=new U(eC(S));eB(R,function(T){"option"===T?(eK(R,T),ev(";")):(eg(T),eV(R,"optional"))}),T.add(R)}function eG(T,S){if(!es.test(S=em()))throw eR(S,"name");var R=new V(S);eB(R,function(T){switch(T){case"option":eK(R,T),ev(";");break;case"reserved":eA(R.reserved||(R.reserved=[]),!0),void 0===R.reserved&&(R.reserved=[]);break;default:e$(R,T)}}),T.add(R),T===eE&&e_.push(R)}function e$(T,S){if(!es.test(S))throw eR(S,"name");ev("=");var R=eO(em(),!0),N={options:void 0};N.getOption=function(T){return this.options[T]},N.setOption=function(T,S){W.prototype.setOption.call(N,T,S)},N.setParsedOption=function(){},eB(N,function(T){if("option"===T)eK(N,T),ev(";");else throw eR(T)},function(){eY(N)}),T.add(S,R,N.comment,N.parsedOptions||N.options)}function eK(T,S){var R,N,O=!0;for("option"===S&&(S=em());"="!==S;){if("("===S){var P=em();ev(")"),S="("+P+")"}if(O){if(O=!1,S.includes(".")&&!S.includes("(")){var M=S.split(".");R=M[0]+".",S=M[1];continue}R=S}else N=N?N+=S:S;S=em()}var L=eH(T,N?R.concat(N):R);N=N&&"."===N[0]?N.slice(1):N,eQ(T,R=R&&"."===R[R.length-1]?R.slice(0,-1):R,L,N)}function eH(T,S){if(ev("{",!0)){for(var R={};!ev("}",!0);){if(!es.test(eu=em()))throw eR(eu,"name");if(null===eu)throw eR(eu,"end of input");var N,O,P=eu;if(ev(":",!0),"{"===ey())N=eH(T,S+"."+eu);else if("["===ey()){if(N=[],ev("[",!0)){do O=eN(!0),N.push(O);while(ev(",",!0));ev("]"),void 0!==O&&eW(T,S+"."+eu,O)}}else N=eN(!0),eW(T,S+"."+eu,N);var M=R[P];M&&(N=[].concat(M).concat(N)),R[P]=N,ev(",",!0),ev(";",!0)}return R}var L=eN(!0);return eW(T,S,L),L}function eW(T,S,R){if(eE===T&&/^features\./.test(S)){ew[S]=R;return}T.setOption&&T.setOption(S,R)}function eQ(T,S,R,N){T.setParsedOption&&T.setParsedOption(S,R,N)}function eY(T){if(ev("[",!0)){do eK(T,"option");while(ev(",",!0));ev("]")}return T}function eJ(T,S){if(!es.test(S=em()))throw eR(S,"service name");var R=new $(S);eB(R,function(T){if(!eF(R,T)){if("rpc"===T)eX(R,T);else throw eR(T)}}),T.add(R),T===eE&&e_.push(R)}function eX(T,S){var R=eb(),N=S;if(!es.test(S=em()))throw eR(S,"name");var O,P,M,L,U=S;if(ev("("),ev("stream",!0)&&(P=!0),!ea.test(S=em())||(O=S,ev(")"),ev("returns"),ev("("),ev("stream",!0)&&(L=!0),!ea.test(S=em())))throw eR(S);M=S,ev(")");var V=new K(U,N,O,M,P,L);V.comment=R,eB(V,function(T){if("option"===T)eK(V,T),ev(";");else throw eR(T)}),T.add(V)}function eZ(T,S){if(!ea.test(S=em()))throw eR(S,"reference");var R=S;eB(null,function(S){switch(S){case"required":case"repeated":eV(T,S,R);break;case"optional":"proto3"===eS?eV(T,"proto3_optional",R):eV(T,"optional",R);break;default:if("proto2"===eS||!ea.test(S))throw eR(S);eg(S),eV(T,"optional",R)}})}for(;null!==(eu=em());)switch(eu){case"package":if(!eT)throw eR(eu);ex();break;case"import":if(!eT)throw eR(eu);eP();break;case"syntax":if(!eT)throw eR(eu);eM();break;case"edition":if(!eT)throw eR(eu);eL();break;case"option":eK(eE,eu),ev(";",!0);break;default:if(eF(eE,eu)){eT=!1;continue}throw eR(eu)}return eI(),eo.filename=null,{package:ec,imports:ed,weakImports:eh,root:S}}},8645:(T,S,R)=>{"use strict";T.exports=U;var N,O=R(86416),P=O.LongBits,M=O.utf8;function L(T,S){return RangeError("index out of range: "+T.pos+" + "+(S||1)+" > "+T.len)}function U(T){this.buf=T,this.pos=0,this.len=T.length}var V="undefined"!=typeof Uint8Array?function(T){if(T instanceof Uint8Array||Array.isArray(T))return new U(T);throw Error("illegal buffer")}:function(T){if(Array.isArray(T))return new U(T);throw Error("illegal buffer")},$=function(){return O.Buffer?function(T){return(U.create=function(T){return O.Buffer.isBuffer(T)?new N(T):V(T)})(T)}:V};function K(){var T=new P(0,0),S=0;if(this.len-this.pos>4){for(;S<4;++S)if(T.lo=(T.lo|(127&this.buf[this.pos])<<7*S)>>>0,this.buf[this.pos++]<128)return T;if(T.lo=(T.lo|(127&this.buf[this.pos])<<28)>>>0,T.hi=(T.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return T;S=0}else{for(;S<3;++S){if(this.pos>=this.len)throw L(this);if(T.lo=(T.lo|(127&this.buf[this.pos])<<7*S)>>>0,this.buf[this.pos++]<128)return T}return T.lo=(T.lo|(127&this.buf[this.pos++])<<7*S)>>>0,T}if(this.len-this.pos>4){for(;S<5;++S)if(T.hi=(T.hi|(127&this.buf[this.pos])<<7*S+3)>>>0,this.buf[this.pos++]<128)return T}else for(;S<5;++S){if(this.pos>=this.len)throw L(this);if(T.hi=(T.hi|(127&this.buf[this.pos])<<7*S+3)>>>0,this.buf[this.pos++]<128)return T}throw Error("invalid varint encoding")}function W(T,S){return(T[S-4]|T[S-3]<<8|T[S-2]<<16|T[S-1]<<24)>>>0}function Q(){if(this.pos+8>this.len)throw L(this,8);return new P(W(this.buf,this.pos+=4),W(this.buf,this.pos+=4))}U.create=$(),U.prototype._slice=O.Array.prototype.subarray||O.Array.prototype.slice,U.prototype.uint32=function(){var T=4294967295;return function(){if(T=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(T=(T|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(T=(T|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(T=(T|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(T=(T|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return T;if((this.pos+=5)>this.len)throw this.pos=this.len,L(this,10);return T}}(),U.prototype.int32=function(){return 0|this.uint32()},U.prototype.sint32=function(){var T=this.uint32();return T>>>1^-(1&T)|0},U.prototype.bool=function(){return 0!==this.uint32()},U.prototype.fixed32=function(){if(this.pos+4>this.len)throw L(this,4);return W(this.buf,this.pos+=4)},U.prototype.sfixed32=function(){if(this.pos+4>this.len)throw L(this,4);return 0|W(this.buf,this.pos+=4)},U.prototype.float=function(){if(this.pos+4>this.len)throw L(this,4);var T=O.float.readFloatLE(this.buf,this.pos);return this.pos+=4,T},U.prototype.double=function(){if(this.pos+8>this.len)throw L(this,4);var T=O.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,T},U.prototype.bytes=function(){var T=this.uint32(),S=this.pos,R=this.pos+T;if(R>this.len)throw L(this,T);if(this.pos+=T,Array.isArray(this.buf))return this.buf.slice(S,R);if(S===R){var N=O.Buffer;return N?N.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,S,R)},U.prototype.string=function(){var T=this.bytes();return M.read(T,0,T.length)},U.prototype.skip=function(T){if("number"==typeof T){if(this.pos+T>this.len)throw L(this,T);this.pos+=T}else do if(this.pos>=this.len)throw L(this);while(128&this.buf[this.pos++]);return this},U.prototype.skipType=function(T){switch(T){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(T=7&this.uint32());)this.skipType(T);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+T+" at offset "+this.pos)}return this},U._configure=function(T){N=T,U.create=$(),N._configure();var S=O.Long?"toLong":"toNumber";O.merge(U.prototype,{int64:function(){return K.call(this)[S](!1)},uint64:function(){return K.call(this)[S](!0)},sint64:function(){return K.call(this).zzDecode()[S](!1)},fixed64:function(){return Q.call(this)[S](!0)},sfixed64:function(){return Q.call(this)[S](!1)}})}},2126:(T,S,R)=>{"use strict";T.exports=P;var N=R(8645);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(86416);function P(T){N.call(this,T)}P._configure=function(){O.Buffer&&(P.prototype._slice=O.Buffer.prototype.slice)},P.prototype.string=function(){var T=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+T,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+T,this.len))},P._configure()},34955:(T,S,R)=>{"use strict";T.exports=K;var N,O,P,M=R(44622);((K.prototype=Object.create(M.prototype)).constructor=K).className="Root";var L=R(92548),U=R(33982),V=R(85677),$=R(18289);function K(T){M.call(this,"",T),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function W(){}K.fromJSON=function(T,S){return S||(S=new K),T.options&&S.setOptions(T.options),S.addJSON(T.nested).resolveAll()},K.prototype.resolvePath=$.path.resolve,K.prototype.fetch=$.fetch,K.prototype.load=function T(S,R,N){"function"==typeof R&&(N=R,R=void 0);var M=this;if(!N)return $.asPromise(T,M,S,R);var L=N===W;function U(T,S){if(N){if(L)throw T;S&&S.resolveAll();var R=N;N=null,R(T,S)}}function V(T){var S=T.lastIndexOf("google/protobuf/");if(S>-1){var R=T.substring(S);if(R in P)return R}return null}function K(T,S){try{if($.isString(S)&&"{"===S.charAt(0)&&(S=JSON.parse(S)),$.isString(S)){O.filename=T;var N,P=O(S,M,R),K=0;if(P.imports)for(;K<P.imports.length;++K)(N=V(P.imports[K])||M.resolvePath(T,P.imports[K]))&&Q(N);if(P.weakImports)for(K=0;K<P.weakImports.length;++K)(N=V(P.weakImports[K])||M.resolvePath(T,P.weakImports[K]))&&Q(N,!0)}else M.setOptions(S.options).addJSON(S.nested)}catch(T){U(T)}L||Y||U(null,M)}function Q(T,S){if(T=V(T)||T,!(M.files.indexOf(T)>-1)){if(M.files.push(T),T in P){L?K(T,P[T]):(++Y,setTimeout(function(){--Y,K(T,P[T])}));return}if(L){var R;try{R=$.fs.readFileSync(T).toString("utf8")}catch(T){S||U(T);return}K(T,R)}else++Y,M.fetch(T,function(R,O){if(--Y,N){if(R){S?Y||U(null,M):U(R);return}K(T,O)}})}}var Y=0;$.isString(S)&&(S=[S]);for(var X,Z=0;Z<S.length;++Z)(X=M.resolvePath("",S[Z]))&&Q(X);return L?M.resolveAll():Y||U(null,M),M},K.prototype.loadSync=function(T,S){if(!$.isNode)throw Error("not supported");return this.load(T,S,W)},K.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(T){return"'extend "+T.extend+"' in "+T.parent.fullName}).join(", "));return M.prototype.resolveAll.call(this)};var Q=/^[A-Z]/;function Y(T,S){var R=S.parent.lookup(S.extend);if(R){var N=new L(S.fullName,S.id,S.type,S.rule,void 0,S.options);return!!R.get(N.name)||(N.declaringField=S,S.extensionField=N,R.add(N),!0)}return!1}K.prototype._handleAdd=function(T){if(T instanceof L)void 0===T.extend||T.extensionField||Y(this,T)||this.deferred.push(T);else if(T instanceof U)Q.test(T.name)&&(T.parent[T.name]=T.values);else if(!(T instanceof V)){if(T instanceof N)for(var S=0;S<this.deferred.length;)Y(this,this.deferred[S])?this.deferred.splice(S,1):++S;for(var R=0;R<T.nestedArray.length;++R)this._handleAdd(T._nestedArray[R]);Q.test(T.name)&&(T.parent[T.name]=T)}(T instanceof N||T instanceof U||T instanceof L)&&(this._fullyQualifiedObjects[T.fullName]=T)},K.prototype._handleRemove=function(T){if(T instanceof L){if(void 0!==T.extend){if(T.extensionField)T.extensionField.parent.remove(T.extensionField),T.extensionField=null;else{var S=this.deferred.indexOf(T);S>-1&&this.deferred.splice(S,1)}}}else if(T instanceof U)Q.test(T.name)&&delete T.parent[T.name];else if(T instanceof M){for(var R=0;R<T.nestedArray.length;++R)this._handleRemove(T._nestedArray[R]);Q.test(T.name)&&delete T.parent[T.name]}delete this._fullyQualifiedObjects[T.fullName]},K._configure=function(T,S,R){N=T,O=S,P=R}},43675:T=>{"use strict";T.exports={}},84415:(T,S,R)=>{"use strict";S.Service=R(49861)},49861:(T,S,R)=>{"use strict";T.exports=O;var N=R(86416);function O(T,S,R){if("function"!=typeof T)throw TypeError("rpcImpl must be a function");N.EventEmitter.call(this),this.rpcImpl=T,this.requestDelimited=!!S,this.responseDelimited=!!R}(O.prototype=Object.create(N.EventEmitter.prototype)).constructor=O,O.prototype.rpcCall=function T(S,R,O,P,M){if(!P)throw TypeError("request must be specified");var L=this;if(!M)return N.asPromise(T,L,S,R,O,P);if(!L.rpcImpl){setTimeout(function(){M(Error("already ended"))},0);return}try{return L.rpcImpl(S,R[L.requestDelimited?"encodeDelimited":"encode"](P).finish(),function(T,R){if(T)return L.emit("error",T,S),M(T);if(null===R){L.end(!0);return}if(!(R instanceof O))try{R=O[L.responseDelimited?"decodeDelimited":"decode"](R)}catch(T){return L.emit("error",T,S),M(T)}return L.emit("data",R,S),M(null,R)})}catch(T){L.emit("error",T,S),setTimeout(function(){M(T)},0);return}},O.prototype.end=function(T){return this.rpcImpl&&(T||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},26962:(T,S,R)=>{"use strict";T.exports=L;var N=R(44622);((L.prototype=Object.create(N.prototype)).constructor=L).className="Service";var O=R(3055),P=R(18289),M=R(84415);function L(T,S){N.call(this,T,S),this.methods={},this._methodsArray=null}function U(T){return T._methodsArray=null,T}L.fromJSON=function(T,S){var R=new L(T,S.options);if(S.methods)for(var N=Object.keys(S.methods),P=0;P<N.length;++P)R.add(O.fromJSON(N[P],S.methods[N[P]]));return S.nested&&R.addJSON(S.nested),S.edition&&(R._edition=S.edition),R.comment=S.comment,R._defaultEdition="proto3",R},L.prototype.toJSON=function(T){var S=N.prototype.toJSON.call(this,T),R=!!T&&!!T.keepComments;return P.toObject(["edition",this._editionToJSON(),"options",S&&S.options||void 0,"methods",N.arrayToJSON(this.methodsArray,T)||{},"nested",S&&S.nested||void 0,"comment",R?this.comment:void 0])},Object.defineProperty(L.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=P.toArray(this.methods))}}),L.prototype.get=function(T){return this.methods[T]||N.prototype.get.call(this,T)},L.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;N.prototype.resolve.call(this);for(var T=this.methodsArray,S=0;S<T.length;++S)T[S].resolve();return this},L.prototype._resolveFeaturesRecursive=function(T){return this._needsRecursiveFeatureResolution&&(T=this._edition||T,N.prototype._resolveFeaturesRecursive.call(this,T),this.methodsArray.forEach(S=>{S._resolveFeaturesRecursive(T)})),this},L.prototype.add=function(T){if(this.get(T.name))throw Error("duplicate name '"+T.name+"' in "+this);return T instanceof O?(this.methods[T.name]=T,T.parent=this,U(this)):N.prototype.add.call(this,T)},L.prototype.remove=function(T){if(T instanceof O){if(this.methods[T.name]!==T)throw Error(T+" is not a member of "+this);return delete this.methods[T.name],T.parent=null,U(this)}return N.prototype.remove.call(this,T)},L.prototype.create=function(T,S,R){for(var N,O=new M.Service(T,S,R),L=0;L<this.methodsArray.length;++L){var U=P.lcFirst((N=this._methodsArray[L]).resolve().name).replace(/[^$\w_]/g,"");O[U]=P.codegen(["r","c"],P.isReserved(U)?U+"_":U)("return this.rpcCall(m,q,s,r,c)")({m:N,q:N.resolvedRequestType.ctor,s:N.resolvedResponseType.ctor})}return O}},89468:T=>{"use strict";T.exports=K;var S=/[\s{}=;:[\],'"()<>]/g,R=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,N=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,O=/^ *[*/]+ */,P=/^\s*\*?\/*/,M=/\n/g,L=/\s/,U=/\\(.?)/g,V={0:"\x00",r:"\r",n:"\n",t:"	"};function $(T){return T.replace(U,function(T,S){switch(S){case"\\":case"":return S;default:return V[S]||""}})}function K(T,U){T=T.toString();var V=0,K=T.length,W=1,Q=0,Y={},X=[],Z=null;function ee(T){return Error("illegal "+T+" (line "+W+")")}function et(){var S="'"===Z?N:R;S.lastIndex=V-1;var O=S.exec(T);if(!O)throw ee("string");return V=S.lastIndex,eo(Z),Z=null,$(O[1])}function er(S){return T.charAt(S)}function en(S,R,N){var L,V,$={type:T.charAt(S++),lineEmpty:!1,leading:N},K=S-(L=U?2:3);do if(--K<0||"\n"===(V=T.charAt(K))){$.lineEmpty=!0;break}while(" "===V||"	"===V);for(var X=T.substring(S,R).split(M),Z=0;Z<X.length;++Z)X[Z]=X[Z].replace(U?P:O,"").trim();$.text=X.join("\n").trim(),Y[W]=$,Q=W}function ei(S){var R=es(S),N=T.substring(S,R);return/^\s*\/\//.test(N)}function es(T){for(var S=T;S<K&&"\n"!==er(S);)S++;return S}function ea(){if(X.length>0)return X.shift();if(Z)return et();var R,N,O,P,M,$=0===V;do{if(V===K)return null;for(R=!1;L.test(O=er(V));)if("\n"===O&&($=!0,++W),++V===K)return null;if("/"===er(V)){if(++V===K)throw ee("comment");if("/"===er(V)){if(U){if(P=V,M=!1,ei(V-1)){M=!0;do if((V=es(V))===K||(V++,!$))break;while(ei(V))}else V=Math.min(K,es(V)+1);M&&(en(P,V,$),$=!0),W++,R=!0}else{for(M="/"===er(P=V+1);"\n"!==er(++V);)if(V===K)return null;++V,M&&(en(P,V-1,$),$=!0),++W,R=!0}}else{if("*"!==(O=er(V)))return"/";P=V+1,M=U||"*"===er(P);do{if("\n"===O&&++W,++V===K)throw ee("comment");N=O,O=er(V)}while("*"!==N||"/"!==O);++V,M&&(en(P,V-2,$),$=!0),R=!0}}}while(R);var Q=V;if(S.lastIndex=0,!S.test(er(Q++)))for(;Q<K&&!S.test(er(Q));)++Q;var Y=T.substring(V,V=Q);return('"'===Y||"'"===Y)&&(Z=Y),Y}function eo(T){X.push(T)}function eu(){if(!X.length){var T=ea();if(null===T)return null;eo(T)}return X[0]}function ec(T,S){var R=eu();if(R===T)return ea(),!0;if(!S)throw ee("token '"+R+"', '"+T+"' expected");return!1}function ed(T){var S,R=null;return void 0===T?(S=Y[W-1],delete Y[W-1],S&&(U||"*"===S.type||S.lineEmpty)&&(R=S.leading?S.text:null)):(Q<T&&eu(),S=Y[T],delete Y[T],S&&!S.lineEmpty&&(U||"/"===S.type)&&(R=S.leading?null:S.text)),R}return Object.defineProperty({next:ea,peek:eu,push:eo,skip:ec,cmnt:ed},"line",{get:function(){return W}})}K.unescape=$},69396:(T,S,R)=>{"use strict";T.exports=et;var N=R(44622);((et.prototype=Object.create(N.prototype)).constructor=et).className="Type";var O=R(33982),P=R(85677),M=R(92548),L=R(30372),U=R(26962),V=R(55326),$=R(8645),K=R(47474),W=R(18289),Q=R(67337),Y=R(98983),X=R(31181),Z=R(5944),ee=R(82969);function et(T,S){N.call(this,T,S),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function er(T){return T._fieldsById=T._fieldsArray=T._oneofsArray=null,delete T.encode,delete T.decode,delete T.verify,T}Object.defineProperties(et.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var T=Object.keys(this.fields),S=0;S<T.length;++S){var R=this.fields[T[S]],N=R.id;if(this._fieldsById[N])throw Error("duplicate id "+N+" in "+this);this._fieldsById[N]=R}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=W.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=W.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=et.generateConstructor(this)())},set:function(T){var S=T.prototype;S instanceof V||((T.prototype=new V).constructor=T,W.merge(T.prototype,S)),T.$type=T.prototype.$type=this,W.merge(T,V,!0),this._ctor=T;for(var R=0;R<this.fieldsArray.length;++R)this._fieldsArray[R].resolve();var N={};for(R=0;R<this.oneofsArray.length;++R)N[this._oneofsArray[R].resolve().name]={get:W.oneOfGetter(this._oneofsArray[R].oneof),set:W.oneOfSetter(this._oneofsArray[R].oneof)};R&&Object.defineProperties(T.prototype,N)}}}),et.generateConstructor=function(T){for(var S,R=W.codegen(["p"],T.name),N=0;N<T.fieldsArray.length;++N)(S=T._fieldsArray[N]).map?R("this%s={}",W.safeProp(S.name)):S.repeated&&R("this%s=[]",W.safeProp(S.name));return R("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},et.fromJSON=function(T,S){var R=new et(T,S.options);R.extensions=S.extensions,R.reserved=S.reserved;for(var V=Object.keys(S.fields),$=0;$<V.length;++$)R.add((void 0!==S.fields[V[$]].keyType?L.fromJSON:M.fromJSON)(V[$],S.fields[V[$]]));if(S.oneofs)for(V=Object.keys(S.oneofs),$=0;$<V.length;++$)R.add(P.fromJSON(V[$],S.oneofs[V[$]]));if(S.nested)for(V=Object.keys(S.nested),$=0;$<V.length;++$){var K=S.nested[V[$]];R.add((void 0!==K.id?M.fromJSON:void 0!==K.fields?et.fromJSON:void 0!==K.values?O.fromJSON:void 0!==K.methods?U.fromJSON:N.fromJSON)(V[$],K))}return S.extensions&&S.extensions.length&&(R.extensions=S.extensions),S.reserved&&S.reserved.length&&(R.reserved=S.reserved),S.group&&(R.group=!0),S.comment&&(R.comment=S.comment),S.edition&&(R._edition=S.edition),R._defaultEdition="proto3",R},et.prototype.toJSON=function(T){var S=N.prototype.toJSON.call(this,T),R=!!T&&!!T.keepComments;return W.toObject(["edition",this._editionToJSON(),"options",S&&S.options||void 0,"oneofs",N.arrayToJSON(this.oneofsArray,T),"fields",N.arrayToJSON(this.fieldsArray.filter(function(T){return!T.declaringField}),T)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",S&&S.nested||void 0,"comment",R?this.comment:void 0])},et.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;N.prototype.resolveAll.call(this);var T=this.oneofsArray;for(R=0;R<T.length;)T[R++].resolve();for(var S=this.fieldsArray,R=0;R<S.length;)S[R++].resolve();return this},et.prototype._resolveFeaturesRecursive=function(T){return this._needsRecursiveFeatureResolution&&(T=this._edition||T,N.prototype._resolveFeaturesRecursive.call(this,T),this.oneofsArray.forEach(S=>{S._resolveFeatures(T)}),this.fieldsArray.forEach(S=>{S._resolveFeatures(T)})),this},et.prototype.get=function(T){return this.fields[T]||this.oneofs&&this.oneofs[T]||this.nested&&this.nested[T]||null},et.prototype.add=function(T){if(this.get(T.name))throw Error("duplicate name '"+T.name+"' in "+this);if(T instanceof M&&void 0===T.extend){if(this._fieldsById?this._fieldsById[T.id]:this.fieldsById[T.id])throw Error("duplicate id "+T.id+" in "+this);if(this.isReservedId(T.id))throw Error("id "+T.id+" is reserved in "+this);if(this.isReservedName(T.name))throw Error("name '"+T.name+"' is reserved in "+this);return T.parent&&T.parent.remove(T),this.fields[T.name]=T,T.message=this,T.onAdd(this),er(this)}return T instanceof P?(this.oneofs||(this.oneofs={}),this.oneofs[T.name]=T,T.onAdd(this),er(this)):N.prototype.add.call(this,T)},et.prototype.remove=function(T){if(T instanceof M&&void 0===T.extend){if(!this.fields||this.fields[T.name]!==T)throw Error(T+" is not a member of "+this);return delete this.fields[T.name],T.parent=null,T.onRemove(this),er(this)}if(T instanceof P){if(!this.oneofs||this.oneofs[T.name]!==T)throw Error(T+" is not a member of "+this);return delete this.oneofs[T.name],T.parent=null,T.onRemove(this),er(this)}return N.prototype.remove.call(this,T)},et.prototype.isReservedId=function(T){return N.isReservedId(this.reserved,T)},et.prototype.isReservedName=function(T){return N.isReservedName(this.reserved,T)},et.prototype.create=function(T){return new this.ctor(T)},et.prototype.setup=function(){for(var T=this.fullName,S=[],R=0;R<this.fieldsArray.length;++R)S.push(this._fieldsArray[R].resolve().resolvedType);this.encode=Q(this)({Writer:K,types:S,util:W}),this.decode=Y(this)({Reader:$,types:S,util:W}),this.verify=X(this)({types:S,util:W}),this.fromObject=Z.fromObject(this)({types:S,util:W}),this.toObject=Z.toObject(this)({types:S,util:W});var N=ee[T];if(N){var O=Object.create(this);O.fromObject=this.fromObject,this.fromObject=N.fromObject.bind(O),O.toObject=this.toObject,this.toObject=N.toObject.bind(O)}return this},et.prototype.encode=function(T,S){return this.setup().encode(T,S)},et.prototype.encodeDelimited=function(T,S){return this.encode(T,S&&S.len?S.fork():S).ldelim()},et.prototype.decode=function(T,S){return this.setup().decode(T,S)},et.prototype.decodeDelimited=function(T){return T instanceof $||(T=$.create(T)),this.decode(T,T.uint32())},et.prototype.verify=function(T){return this.setup().verify(T)},et.prototype.fromObject=function(T){return this.setup().fromObject(T)},et.prototype.toObject=function(T,S){return this.setup().toObject(T,S)},et.d=function(T){return function(S){W.decorateType(S,T)}}},31627:(T,S,R)=>{"use strict";var N=S,O=R(18289),P=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function M(T,S){var R=0,N={};for(S|=0;R<T.length;)N[P[R+S]]=T[R++];return N}N.basic=M([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),N.defaults=M([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",O.emptyArray,null]),N.long=M([0,0,0,1,1],7),N.mapKey=M([0,0,0,5,5,0,0,0,1,1,0,2],2),N.packed=M([1,5,0,0,0,5,5,0,0,0,1,1,0])},18289:(T,S,R)=>{"use strict";var N,O,P=T.exports=R(86416),M=R(43675);P.codegen=R(52012),P.fetch=R(63035),P.path=R(29986),P.fs=P.inquire("fs"),P.toArray=function(T){if(T){for(var S=Object.keys(T),R=Array(S.length),N=0;N<S.length;)R[N]=T[S[N++]];return R}return[]},P.toObject=function(T){for(var S={},R=0;R<T.length;){var N=T[R++],O=T[R++];void 0!==O&&(S[N]=O)}return S};var L=/\\/g,U=/"/g;P.isReserved=function(T){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(T)},P.safeProp=function(T){return!/^[$\w_]+$/.test(T)||P.isReserved(T)?'["'+T.replace(L,"\\\\").replace(U,'\\"')+'"]':"."+T},P.ucFirst=function(T){return T.charAt(0).toUpperCase()+T.substring(1)};var V=/_([a-z])/g;P.camelCase=function(T){return T.substring(0,1)+T.substring(1).replace(V,function(T,S){return S.toUpperCase()})},P.compareFieldsById=function(T,S){return T.id-S.id},P.decorateType=function(T,S){if(T.$type)return S&&T.$type.name!==S&&(P.decorateRoot.remove(T.$type),T.$type.name=S,P.decorateRoot.add(T.$type)),T.$type;N||(N=R(69396));var O=new N(S||T.name);return P.decorateRoot.add(O),O.ctor=T,Object.defineProperty(T,"$type",{value:O,enumerable:!1}),Object.defineProperty(T.prototype,"$type",{value:O,enumerable:!1}),O};var $=0;P.decorateEnum=function(T){if(T.$type)return T.$type;O||(O=R(33982));var S=new O("Enum"+$++,T);return P.decorateRoot.add(S),Object.defineProperty(T,"$type",{value:S,enumerable:!1}),S},P.setProperty=function(T,S,R,N){function O(T,S,R){var P=S.shift();if("__proto__"===P||"prototype"===P)return T;if(S.length>0)T[P]=O(T[P]||{},S,R);else{var M=T[P];if(M&&N)return T;M&&(R=[].concat(M).concat(R)),T[P]=R}return T}if("object"!=typeof T)throw TypeError("dst must be an object");if(!S)throw TypeError("path must be specified");return O(T,S=S.split("."),R)},Object.defineProperty(P,"decorateRoot",{get:function(){return M.decorated||(M.decorated=new(R(34955)))}})},59535:(T,S,R)=>{"use strict";T.exports=O;var N=R(86416);function O(T,S){this.lo=T>>>0,this.hi=S>>>0}var P=O.zero=new O(0,0);P.toNumber=function(){return 0},P.zzEncode=P.zzDecode=function(){return this},P.length=function(){return 1};var M=O.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";O.fromNumber=function(T){if(0===T)return P;var S=T<0;S&&(T=-T);var R=T>>>0,N=(T-R)/4294967296>>>0;return S&&(N=~N>>>0,R=~R>>>0,++R>4294967295&&(R=0,++N>4294967295&&(N=0))),new O(R,N)},O.from=function(T){if("number"==typeof T)return O.fromNumber(T);if(N.isString(T)){if(!N.Long)return O.fromNumber(parseInt(T,10));T=N.Long.fromString(T)}return T.low||T.high?new O(T.low>>>0,T.high>>>0):P},O.prototype.toNumber=function(T){if(!T&&this.hi>>>31){var S=~this.lo+1>>>0,R=~this.hi>>>0;return S||(R=R+1>>>0),-(S+4294967296*R)}return this.lo+4294967296*this.hi},O.prototype.toLong=function(T){return N.Long?new N.Long(0|this.lo,0|this.hi,!!T):{low:0|this.lo,high:0|this.hi,unsigned:!!T}};var L=String.prototype.charCodeAt;O.fromHash=function(T){return T===M?P:new O((L.call(T,0)|L.call(T,1)<<8|L.call(T,2)<<16|L.call(T,3)<<24)>>>0,(L.call(T,4)|L.call(T,5)<<8|L.call(T,6)<<16|L.call(T,7)<<24)>>>0)},O.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},O.prototype.zzEncode=function(){var T=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^T)>>>0,this.lo=(this.lo<<1^T)>>>0,this},O.prototype.zzDecode=function(){var T=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^T)>>>0,this.hi=(this.hi>>>1^T)>>>0,this},O.prototype.length=function(){var T=this.lo,S=(this.lo>>>28|this.hi<<4)>>>0,R=this.hi>>>24;return 0===R?0===S?T<16384?T<128?1:2:T<2097152?3:4:S<16384?S<128?5:6:S<2097152?7:8:R<128?9:10}},86416:function(T,S,R){"use strict";var N=S;function O(T,S,R){for(var N=Object.keys(S),O=0;O<N.length;++O)void 0!==T[N[O]]&&R||(T[N[O]]=S[N[O]]);return T}function P(T){function S(T,R){if(!(this instanceof S))return new S(T,R);Object.defineProperty(this,"message",{get:function(){return T}}),Error.captureStackTrace?Error.captureStackTrace(this,S):Object.defineProperty(this,"stack",{value:Error().stack||""}),R&&O(this,R)}return S.prototype=Object.create(Error.prototype,{constructor:{value:S,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return T},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),S}N.asPromise=R(70799),N.base64=R(92130),N.EventEmitter=R(80854),N.float=R(14324),N.inquire=R(20449),N.utf8=R(78131),N.pool=R(56035),N.LongBits=R(59535),N.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),N.global=N.isNode&&global||"undefined"!=typeof self&&self||this,N.emptyArray=Object.freeze?Object.freeze([]):[],N.emptyObject=Object.freeze?Object.freeze({}):{},N.isInteger=Number.isInteger||function(T){return"number"==typeof T&&isFinite(T)&&Math.floor(T)===T},N.isString=function(T){return"string"==typeof T||T instanceof String},N.isObject=function(T){return T&&"object"==typeof T},N.isset=N.isSet=function(T,S){var R=T[S];return!!(null!=R&&T.hasOwnProperty(S))&&("object"!=typeof R||(Array.isArray(R)?R.length:Object.keys(R).length)>0)},N.Buffer=function(){try{var T=N.inquire("buffer").Buffer;return T.prototype.utf8Write?T:null}catch(T){return null}}(),N._Buffer_from=null,N._Buffer_allocUnsafe=null,N.newBuffer=function(T){return"number"==typeof T?N.Buffer?N._Buffer_allocUnsafe(T):new N.Array(T):N.Buffer?N._Buffer_from(T):"undefined"==typeof Uint8Array?T:new Uint8Array(T)},N.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,N.Long=N.global.dcodeIO&&N.global.dcodeIO.Long||N.global.Long||N.inquire("long"),N.key2Re=/^true|false|0|1$/,N.key32Re=/^-?(?:0|[1-9][0-9]*)$/,N.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,N.longToHash=function(T){return T?N.LongBits.from(T).toHash():N.LongBits.zeroHash},N.longFromHash=function(T,S){var R=N.LongBits.fromHash(T);return N.Long?N.Long.fromBits(R.lo,R.hi,S):R.toNumber(!!S)},N.merge=O,N.lcFirst=function(T){return T.charAt(0).toLowerCase()+T.substring(1)},N.newError=P,N.ProtocolError=P("ProtocolError"),N.oneOfGetter=function(T){for(var S={},R=0;R<T.length;++R)S[T[R]]=1;return function(){for(var T=Object.keys(this),R=T.length-1;R>-1;--R)if(1===S[T[R]]&&void 0!==this[T[R]]&&null!==this[T[R]])return T[R]}},N.oneOfSetter=function(T){return function(S){for(var R=0;R<T.length;++R)T[R]!==S&&delete this[T[R]]}},N.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},N._configure=function(){var T=N.Buffer;if(!T){N._Buffer_from=N._Buffer_allocUnsafe=null;return}N._Buffer_from=T.from!==Uint8Array.from&&T.from||function(S,R){return new T(S,R)},N._Buffer_allocUnsafe=T.allocUnsafe||function(S){return new T(S)}}},31181:(T,S,R)=>{"use strict";T.exports=U;var N=R(33982),O=R(18289);function P(T,S){return T.name+": "+S+(T.repeated&&"array"!==S?"[]":T.map&&"object"!==S?"{k:"+T.keyType+"}":"")+" expected"}function M(T,S,R,O){if(S.resolvedType){if(S.resolvedType instanceof N){T("switch(%s){",O)("default:")("return%j",P(S,"enum value"));for(var M=Object.keys(S.resolvedType.values),L=0;L<M.length;++L)T("case %i:",S.resolvedType.values[M[L]]);T("break")("}")}else T("{")("var e=types[%i].verify(%s);",R,O)("if(e)")("return%j+e",S.name+".")("}")}else switch(S.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":T("if(!util.isInteger(%s))",O)("return%j",P(S,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":T("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",O,O,O,O)("return%j",P(S,"integer|Long"));break;case"float":case"double":T('if(typeof %s!=="number")',O)("return%j",P(S,"number"));break;case"bool":T('if(typeof %s!=="boolean")',O)("return%j",P(S,"boolean"));break;case"string":T("if(!util.isString(%s))",O)("return%j",P(S,"string"));break;case"bytes":T('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',O,O,O)("return%j",P(S,"buffer"))}return T}function L(T,S,R){switch(S.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":T("if(!util.key32Re.test(%s))",R)("return%j",P(S,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":T("if(!util.key64Re.test(%s))",R)("return%j",P(S,"integer|Long key"));break;case"bool":T("if(!util.key2Re.test(%s))",R)("return%j",P(S,"boolean key"))}return T}function U(T){var S=O.codegen(["m"],T.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),R=T.oneofsArray,N={};R.length&&S("var p={}");for(var U=0;U<T.fieldsArray.length;++U){var V=T._fieldsArray[U].resolve(),$="m"+O.safeProp(V.name);if(V.optional&&S("if(%s!=null&&m.hasOwnProperty(%j)){",$,V.name),V.map)S("if(!util.isObject(%s))",$)("return%j",P(V,"object"))("var k=Object.keys(%s)",$)("for(var i=0;i<k.length;++i){"),L(S,V,"k[i]"),M(S,V,U,$+"[k[i]]")("}");else if(V.repeated)S("if(!Array.isArray(%s))",$)("return%j",P(V,"array"))("for(var i=0;i<%s.length;++i){",$),M(S,V,U,$+"[i]")("}");else{if(V.partOf){var K=O.safeProp(V.partOf.name);1===N[V.partOf.name]&&S("if(p%s===1)",K)("return%j",V.partOf.name+": multiple values"),N[V.partOf.name]=1,S("p%s=1",K)}M(S,V,U,$)}V.optional&&S("}")}return S("return null")}},82969:(T,S,R)=>{"use strict";var N=S,O=R(55326);N[".google.protobuf.Any"]={fromObject:function(T){if(T&&T["@type"]){var S=T["@type"].substring(T["@type"].lastIndexOf("/")+1),R=this.lookup(S);if(R){var N="."===T["@type"].charAt(0)?T["@type"].slice(1):T["@type"];return -1===N.indexOf("/")&&(N="/"+N),this.create({type_url:N,value:R.encode(R.fromObject(T)).finish()})}}return this.fromObject(T)},toObject:function(T,S){var R="type.googleapis.com/",N="",P="";if(S&&S.json&&T.type_url&&T.value){P=T.type_url.substring(T.type_url.lastIndexOf("/")+1),N=T.type_url.substring(0,T.type_url.lastIndexOf("/")+1);var M=this.lookup(P);M&&(T=M.decode(T.value))}if(!(T instanceof this.ctor)&&T instanceof O){var L=T.$type.toObject(T,S),U="."===T.$type.fullName[0]?T.$type.fullName.slice(1):T.$type.fullName;return""===N&&(N=R),P=N+U,L["@type"]=P,L}return this.toObject(T,S)}}},47474:(T,S,R)=>{"use strict";T.exports=K;var N,O=R(86416),P=O.LongBits,M=O.base64,L=O.utf8;function U(T,S,R){this.fn=T,this.len=S,this.next=void 0,this.val=R}function V(){}function $(T){this.head=T.head,this.tail=T.tail,this.len=T.len,this.next=T.states}function K(){this.len=0,this.head=new U(V,0,0),this.tail=this.head,this.states=null}var W=function(){return O.Buffer?function(){return(K.create=function(){return new N})()}:function(){return new K}};function Q(T,S,R){S[R]=255&T}function Y(T,S,R){for(;T>127;)S[R++]=127&T|128,T>>>=7;S[R]=T}function X(T,S){this.len=T,this.next=void 0,this.val=S}function Z(T,S,R){for(;T.hi;)S[R++]=127&T.lo|128,T.lo=(T.lo>>>7|T.hi<<25)>>>0,T.hi>>>=7;for(;T.lo>127;)S[R++]=127&T.lo|128,T.lo=T.lo>>>7;S[R++]=T.lo}function ee(T,S,R){S[R]=255&T,S[R+1]=T>>>8&255,S[R+2]=T>>>16&255,S[R+3]=T>>>24}K.create=W(),K.alloc=function(T){return new O.Array(T)},O.Array!==Array&&(K.alloc=O.pool(K.alloc,O.Array.prototype.subarray)),K.prototype._push=function(T,S,R){return this.tail=this.tail.next=new U(T,S,R),this.len+=S,this},X.prototype=Object.create(U.prototype),X.prototype.fn=Y,K.prototype.uint32=function(T){return this.len+=(this.tail=this.tail.next=new X((T>>>=0)<128?1:T<16384?2:T<2097152?3:T<268435456?4:5,T)).len,this},K.prototype.int32=function(T){return T<0?this._push(Z,10,P.fromNumber(T)):this.uint32(T)},K.prototype.sint32=function(T){return this.uint32((T<<1^T>>31)>>>0)},K.prototype.uint64=function(T){var S=P.from(T);return this._push(Z,S.length(),S)},K.prototype.int64=K.prototype.uint64,K.prototype.sint64=function(T){var S=P.from(T).zzEncode();return this._push(Z,S.length(),S)},K.prototype.bool=function(T){return this._push(Q,1,T?1:0)},K.prototype.fixed32=function(T){return this._push(ee,4,T>>>0)},K.prototype.sfixed32=K.prototype.fixed32,K.prototype.fixed64=function(T){var S=P.from(T);return this._push(ee,4,S.lo)._push(ee,4,S.hi)},K.prototype.sfixed64=K.prototype.fixed64,K.prototype.float=function(T){return this._push(O.float.writeFloatLE,4,T)},K.prototype.double=function(T){return this._push(O.float.writeDoubleLE,8,T)};var et=O.Array.prototype.set?function(T,S,R){S.set(T,R)}:function(T,S,R){for(var N=0;N<T.length;++N)S[R+N]=T[N]};K.prototype.bytes=function(T){var S=T.length>>>0;if(!S)return this._push(Q,1,0);if(O.isString(T)){var R=K.alloc(S=M.length(T));M.decode(T,R,0),T=R}return this.uint32(S)._push(et,S,T)},K.prototype.string=function(T){var S=L.length(T);return S?this.uint32(S)._push(L.write,S,T):this._push(Q,1,0)},K.prototype.fork=function(){return this.states=new $(this),this.head=this.tail=new U(V,0,0),this.len=0,this},K.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new U(V,0,0),this.len=0),this},K.prototype.ldelim=function(){var T=this.head,S=this.tail,R=this.len;return this.reset().uint32(R),R&&(this.tail.next=T.next,this.tail=S,this.len+=R),this},K.prototype.finish=function(){for(var T=this.head.next,S=this.constructor.alloc(this.len),R=0;T;)T.fn(T.val,S,R),R+=T.len,T=T.next;return S},K._configure=function(T){N=T,K.create=W(),N._configure()}},96985:(T,S,R)=>{"use strict";T.exports=P;var N=R(47474);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(86416);function P(){N.call(this)}function M(T,S,R){T.length<40?O.utf8.write(T,S,R):S.utf8Write?S.utf8Write(T,R):S.write(T,R)}P._configure=function(){P.alloc=O._Buffer_allocUnsafe,P.writeBytesBuffer=O.Buffer&&O.Buffer.prototype instanceof Uint8Array&&"set"===O.Buffer.prototype.set.name?function(T,S,R){S.set(T,R)}:function(T,S,R){if(T.copy)T.copy(S,R,0,T.length);else for(var N=0;N<T.length;)S[R++]=T[N++]}},P.prototype.bytes=function(T){O.isString(T)&&(T=O._Buffer_from(T,"base64"));var S=T.length>>>0;return this.uint32(S),S&&this._push(P.writeBytesBuffer,S,T),this},P.prototype.string=function(T){var S=O.Buffer.byteLength(T);return this.uint32(S),S&&this._push(M,S,T),this},P._configure()},31468:function(T,S){var R;!function(N,O){function P(T){return T.default||T}void 0!==(R=(function(){var T={};return O(T),P(T)}).apply(S,[]))&&(T.exports=R)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(T){"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.default=void 0;/**
     * @license
     * Copyright 2009 The Closure Library Authors
     * Copyright 2020 Daniel Wirtz / The long.js Authors.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * SPDX-License-Identifier: Apache-2.0
     */var S=null;try{S=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function R(T,S,R){this.low=0|T,this.high=0|S,this.unsigned=!!R}function N(T){return!0===(T&&T.__isLong__)}function O(T){var S=Math.clz32(T&-T);return T?31-S:S}R.prototype.__isLong__,Object.defineProperty(R.prototype,"__isLong__",{value:!0}),R.isLong=N;var P={},M={};function L(T,S){var R,N,O;return S?(T>>>=0,(O=0<=T&&T<256)&&(N=M[T]))?N:(R=V(T,0,!0),O&&(M[T]=R),R):(T|=0,(O=-128<=T&&T<128)&&(N=P[T]))?N:(R=V(T,T<0?-1:0,!1),O&&(P[T]=R),R)}function U(T,S){if(isNaN(T))return S?et:ee;if(S){if(T<0)return et;if(T>=Y)return ea}else{if(T<=-X)return eo;if(T+1>=X)return es}return T<0?U(-T,S).neg():V(T%Q|0,T/Q|0,S)}function V(T,S,N){return new R(T,S,N)}R.fromInt=L,R.fromNumber=U,R.fromBits=V;var $=Math.pow;function K(T,S,R){if(0===T.length)throw Error("empty string");if("number"==typeof S?(R=S,S=!1):S=!!S,"NaN"===T||"Infinity"===T||"+Infinity"===T||"-Infinity"===T)return S?et:ee;if((R=R||10)<2||36<R)throw RangeError("radix");if((N=T.indexOf("-"))>0)throw Error("interior hyphen");if(0===N)return K(T.substring(1),S,R).neg();for(var N,O=U($(R,8)),P=ee,M=0;M<T.length;M+=8){var L=Math.min(8,T.length-M),V=parseInt(T.substring(M,M+L),R);if(L<8){var W=U($(R,L));P=P.mul(W).add(U(V))}else P=(P=P.mul(O)).add(U(V))}return P.unsigned=S,P}function W(T,S){return"number"==typeof T?U(T,S):"string"==typeof T?K(T,S):V(T.low,T.high,"boolean"==typeof S?S:T.unsigned)}R.fromString=K,R.fromValue=W;var Q=4294967296,Y=18446744073709552e3,X=0x7fffffffffffffff,Z=L(16777216),ee=L(0);R.ZERO=ee;var et=L(0,!0);R.UZERO=et;var er=L(1);R.ONE=er;var en=L(1,!0);R.UONE=en;var ei=L(-1);R.NEG_ONE=ei;var es=V(-1,2147483647,!1);R.MAX_VALUE=es;var ea=V(-1,-1,!0);R.MAX_UNSIGNED_VALUE=ea;var eo=V(0,-2147483648,!1);R.MIN_VALUE=eo;var eu=R.prototype;eu.toInt=function(){return this.unsigned?this.low>>>0:this.low},eu.toNumber=function(){return this.unsigned?(this.high>>>0)*Q+(this.low>>>0):this.high*Q+(this.low>>>0)},eu.toString=function(T){if((T=T||10)<2||36<T)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(eo))return"-"+this.neg().toString(T);var S=U(T),R=this.div(S),N=R.mul(S).sub(this);return R.toString(T)+N.toInt().toString(T)}for(var O=U($(T,6),this.unsigned),P=this,M="";;){var L=P.div(O),V=(P.sub(L.mul(O)).toInt()>>>0).toString(T);if((P=L).isZero())return V+M;for(;V.length<6;)V="0"+V;M=""+V+M}},eu.getHighBits=function(){return this.high},eu.getHighBitsUnsigned=function(){return this.high>>>0},eu.getLowBits=function(){return this.low},eu.getLowBitsUnsigned=function(){return this.low>>>0},eu.getNumBitsAbs=function(){if(this.isNegative())return this.eq(eo)?64:this.neg().getNumBitsAbs();for(var T=0!=this.high?this.high:this.low,S=31;S>0&&(T&1<<S)==0;S--);return 0!=this.high?S+33:S+1},eu.isSafeInteger=function(){var T=this.high>>21;return!T||!this.unsigned&&-1===T&&!(0===this.low&&-2097152===this.high)},eu.isZero=function(){return 0===this.high&&0===this.low},eu.eqz=eu.isZero,eu.isNegative=function(){return!this.unsigned&&this.high<0},eu.isPositive=function(){return this.unsigned||this.high>=0},eu.isOdd=function(){return(1&this.low)==1},eu.isEven=function(){return(1&this.low)==0},eu.equals=function(T){return N(T)||(T=W(T)),(this.unsigned===T.unsigned||this.high>>>31!=1||T.high>>>31!=1)&&this.high===T.high&&this.low===T.low},eu.eq=eu.equals,eu.notEquals=function(T){return!this.eq(T)},eu.neq=eu.notEquals,eu.ne=eu.notEquals,eu.lessThan=function(T){return 0>this.comp(T)},eu.lt=eu.lessThan,eu.lessThanOrEqual=function(T){return 0>=this.comp(T)},eu.lte=eu.lessThanOrEqual,eu.le=eu.lessThanOrEqual,eu.greaterThan=function(T){return this.comp(T)>0},eu.gt=eu.greaterThan,eu.greaterThanOrEqual=function(T){return this.comp(T)>=0},eu.gte=eu.greaterThanOrEqual,eu.ge=eu.greaterThanOrEqual,eu.compare=function(T){if(N(T)||(T=W(T)),this.eq(T))return 0;var S=this.isNegative(),R=T.isNegative();return S&&!R?-1:!S&&R?1:this.unsigned?T.high>>>0>this.high>>>0||T.high===this.high&&T.low>>>0>this.low>>>0?-1:1:this.sub(T).isNegative()?-1:1},eu.comp=eu.compare,eu.negate=function(){return!this.unsigned&&this.eq(eo)?eo:this.not().add(er)},eu.neg=eu.negate,eu.add=function(T){N(T)||(T=W(T));var S,R,O=this.high>>>16,P=65535&this.high,M=this.low>>>16,L=65535&this.low,U=T.high>>>16,$=65535&T.high,K=T.low>>>16,Q=65535&T.low,Y=0,X=0;return S=0+((R=0+(L+Q))>>>16),R&=65535,S+=M+K,X+=S>>>16,S&=65535,X+=P+$,Y+=X>>>16,X&=65535,Y+=O+U,V(S<<16|R,(Y&=65535)<<16|X,this.unsigned)},eu.subtract=function(T){return N(T)||(T=W(T)),this.add(T.neg())},eu.sub=eu.subtract,eu.multiply=function(T){if(this.isZero())return this;if(N(T)||(T=W(T)),S)return V(S.mul(this.low,this.high,T.low,T.high),S.get_high(),this.unsigned);if(T.isZero())return this.unsigned?et:ee;if(this.eq(eo))return T.isOdd()?eo:ee;if(T.eq(eo))return this.isOdd()?eo:ee;if(this.isNegative())return T.isNegative()?this.neg().mul(T.neg()):this.neg().mul(T).neg();if(T.isNegative())return this.mul(T.neg()).neg();if(this.lt(Z)&&T.lt(Z))return U(this.toNumber()*T.toNumber(),this.unsigned);var R,O,P=this.high>>>16,M=65535&this.high,L=this.low>>>16,$=65535&this.low,K=T.high>>>16,Q=65535&T.high,Y=T.low>>>16,X=65535&T.low,er=0,en=0;return R=0+((O=0+$*X)>>>16),O&=65535,R+=L*X,en+=R>>>16,R&=65535,R+=$*Y,en+=R>>>16,R&=65535,en+=M*X,er+=en>>>16,en&=65535,en+=L*Y,er+=en>>>16,en&=65535,en+=$*Q,er+=en>>>16,en&=65535,er+=P*X+M*Y+L*Q+$*K,V(R<<16|O,(er&=65535)<<16|en,this.unsigned)},eu.mul=eu.multiply,eu.divide=function(T){if(N(T)||(T=W(T)),T.isZero())throw Error("division by zero");if(S){var R,O,P;return this.unsigned||-2147483648!==this.high||-1!==T.low||-1!==T.high?V((this.unsigned?S.div_u:S.div_s)(this.low,this.high,T.low,T.high),S.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?et:ee;if(this.unsigned){if(T.unsigned||(T=T.toUnsigned()),T.gt(this))return et;if(T.gt(this.shru(1)))return en;P=et}else{if(this.eq(eo))return T.eq(er)||T.eq(ei)?eo:T.eq(eo)?er:(R=this.shr(1).div(T).shl(1)).eq(ee)?T.isNegative()?er:ei:(O=this.sub(T.mul(R)),P=R.add(O.div(T)));if(T.eq(eo))return this.unsigned?et:ee;if(this.isNegative())return T.isNegative()?this.neg().div(T.neg()):this.neg().div(T).neg();if(T.isNegative())return this.div(T.neg()).neg();P=ee}for(O=this;O.gte(T);){for(var M=Math.ceil(Math.log(R=Math.max(1,Math.floor(O.toNumber()/T.toNumber())))/Math.LN2),L=M<=48?1:$(2,M-48),K=U(R),Q=K.mul(T);Q.isNegative()||Q.gt(O);)R-=L,Q=(K=U(R,this.unsigned)).mul(T);K.isZero()&&(K=er),P=P.add(K),O=O.sub(Q)}return P},eu.div=eu.divide,eu.modulo=function(T){return(N(T)||(T=W(T)),S)?V((this.unsigned?S.rem_u:S.rem_s)(this.low,this.high,T.low,T.high),S.get_high(),this.unsigned):this.sub(this.div(T).mul(T))},eu.mod=eu.modulo,eu.rem=eu.modulo,eu.not=function(){return V(~this.low,~this.high,this.unsigned)},eu.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},eu.clz=eu.countLeadingZeros,eu.countTrailingZeros=function(){return this.low?O(this.low):O(this.high)+32},eu.ctz=eu.countTrailingZeros,eu.and=function(T){return N(T)||(T=W(T)),V(this.low&T.low,this.high&T.high,this.unsigned)},eu.or=function(T){return N(T)||(T=W(T)),V(this.low|T.low,this.high|T.high,this.unsigned)},eu.xor=function(T){return N(T)||(T=W(T)),V(this.low^T.low,this.high^T.high,this.unsigned)},eu.shiftLeft=function(T){return(N(T)&&(T=T.toInt()),0==(T&=63))?this:T<32?V(this.low<<T,this.high<<T|this.low>>>32-T,this.unsigned):V(0,this.low<<T-32,this.unsigned)},eu.shl=eu.shiftLeft,eu.shiftRight=function(T){return(N(T)&&(T=T.toInt()),0==(T&=63))?this:T<32?V(this.low>>>T|this.high<<32-T,this.high>>T,this.unsigned):V(this.high>>T-32,this.high>=0?0:-1,this.unsigned)},eu.shr=eu.shiftRight,eu.shiftRightUnsigned=function(T){return(N(T)&&(T=T.toInt()),0==(T&=63))?this:T<32?V(this.low>>>T|this.high<<32-T,this.high>>>T,this.unsigned):32===T?V(this.high,0,this.unsigned):V(this.high>>>T-32,0,this.unsigned)},eu.shru=eu.shiftRightUnsigned,eu.shr_u=eu.shiftRightUnsigned,eu.rotateLeft=function(T){var S;return(N(T)&&(T=T.toInt()),0==(T&=63))?this:32===T?V(this.high,this.low,this.unsigned):T<32?(S=32-T,V(this.low<<T|this.high>>>S,this.high<<T|this.low>>>S,this.unsigned)):(T-=32,S=32-T,V(this.high<<T|this.low>>>S,this.low<<T|this.high>>>S,this.unsigned))},eu.rotl=eu.rotateLeft,eu.rotateRight=function(T){var S;return(N(T)&&(T=T.toInt()),0==(T&=63))?this:32===T?V(this.high,this.low,this.unsigned):T<32?(S=32-T,V(this.high<<S|this.low>>>T,this.low<<S|this.high>>>T,this.unsigned)):(T-=32,S=32-T,V(this.low<<S|this.high>>>T,this.high<<S|this.low>>>T,this.unsigned))},eu.rotr=eu.rotateRight,eu.toSigned=function(){return this.unsigned?V(this.low,this.high,!1):this},eu.toUnsigned=function(){return this.unsigned?this:V(this.low,this.high,!0)},eu.toBytes=function(T){return T?this.toBytesLE():this.toBytesBE()},eu.toBytesLE=function(){var T=this.high,S=this.low;return[255&S,S>>>8&255,S>>>16&255,S>>>24,255&T,T>>>8&255,T>>>16&255,T>>>24]},eu.toBytesBE=function(){var T=this.high,S=this.low;return[T>>>24,T>>>16&255,T>>>8&255,255&T,S>>>24,S>>>16&255,S>>>8&255,255&S]},R.fromBytes=function(T,S,N){return N?R.fromBytesLE(T,S):R.fromBytesBE(T,S)},R.fromBytesLE=function(T,S){return new R(T[0]|T[1]<<8|T[2]<<16|T[3]<<24,T[4]|T[5]<<8|T[6]<<16|T[7]<<24,S)},R.fromBytesBE=function(T,S){return new R(T[4]<<24|T[5]<<16|T[6]<<8|T[7],T[0]<<24|T[1]<<16|T[2]<<8|T[3],S)},"function"==typeof BigInt&&(R.fromBigInt=function(T,S){return V(Number(BigInt.asIntN(32,T)),Number(BigInt.asIntN(32,T>>BigInt(32))),S)},R.fromValue=function(T,S){return"bigint"==typeof T?R.fromBigInt(T,S):W(T,S)},eu.toBigInt=function(){var T=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|T}),T.default=R})},95285:(T,S,R)=>{"use strict";let N,O;R.d(S,{Jn:()=>eD,qX:()=>eI,rh:()=>eR,Xd:()=>eC,Mq:()=>ex,ZF:()=>eO,KN:()=>eP});var P=R(47059),M=R(71954),L=R(61006);let U=(T,S)=>S.some(S=>T instanceof S);function V(){return N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $(){return O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let K=new WeakMap,W=new WeakMap,Q=new WeakMap,Y=new WeakMap,X=new WeakMap;function Z(T){let S=new Promise((S,R)=>{let N=()=>{T.removeEventListener("success",O),T.removeEventListener("error",P)},O=()=>{S(es(T.result)),N()},P=()=>{R(T.error),N()};T.addEventListener("success",O),T.addEventListener("error",P)});return S.then(S=>{S instanceof IDBCursor&&K.set(S,T)}).catch(()=>{}),X.set(S,T),S}function ee(T){if(W.has(T))return;let S=new Promise((S,R)=>{let N=()=>{T.removeEventListener("complete",O),T.removeEventListener("error",P),T.removeEventListener("abort",P)},O=()=>{S(),N()},P=()=>{R(T.error||new DOMException("AbortError","AbortError")),N()};T.addEventListener("complete",O),T.addEventListener("error",P),T.addEventListener("abort",P)});W.set(T,S)}let et={get(T,S,R){if(T instanceof IDBTransaction){if("done"===S)return W.get(T);if("objectStoreNames"===S)return T.objectStoreNames||Q.get(T);if("store"===S)return R.objectStoreNames[1]?void 0:R.objectStore(R.objectStoreNames[0])}return es(T[S])},set:(T,S,R)=>(T[S]=R,!0),has:(T,S)=>T instanceof IDBTransaction&&("done"===S||"store"===S)||S in T};function er(T){et=T(et)}function en(T){return T!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?$().includes(T)?function(...S){return T.apply(ea(this),S),es(K.get(this))}:function(...S){return es(T.apply(ea(this),S))}:function(S,...R){let N=T.call(ea(this),S,...R);return Q.set(N,S.sort?S.sort():[S]),es(N)}}function ei(T){return"function"==typeof T?en(T):(T instanceof IDBTransaction&&ee(T),U(T,V()))?new Proxy(T,et):T}function es(T){if(T instanceof IDBRequest)return Z(T);if(Y.has(T))return Y.get(T);let S=ei(T);return S!==T&&(Y.set(T,S),X.set(S,T)),S}let ea=T=>X.get(T);function eo(T,S,{blocked:R,upgrade:N,blocking:O,terminated:P}={}){let M=indexedDB.open(T,S),L=es(M);return N&&M.addEventListener("upgradeneeded",T=>{N(es(M.result),T.oldVersion,T.newVersion,es(M.transaction),T)}),R&&M.addEventListener("blocked",T=>R(T.oldVersion,T.newVersion,T)),L.then(T=>{P&&T.addEventListener("close",()=>P()),O&&T.addEventListener("versionchange",T=>O(T.oldVersion,T.newVersion,T))}).catch(()=>{}),L}let eu=["get","getKey","getAll","getAllKeys","count"],ec=["put","add","delete","clear"],ed=new Map;function eh(T,S){if(!(T instanceof IDBDatabase&&!(S in T)&&"string"==typeof S))return;if(ed.get(S))return ed.get(S);let R=S.replace(/FromIndex$/,""),N=S!==R,O=ec.includes(R);if(!(R in(N?IDBIndex:IDBObjectStore).prototype)||!(O||eu.includes(R)))return;let P=async function(T,...S){let P=this.transaction(T,O?"readwrite":"readonly"),M=P.store;return N&&(M=M.index(S.shift())),(await Promise.all([M[R](...S),O&&P.done]))[0]};return ed.set(S,P),P}er(T=>({...T,get:(S,R,N)=>eh(S,R)||T.get(S,R,N),has:(S,R)=>!!eh(S,R)||T.has(S,R)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(T){this.container=T}getPlatformInfoString(){return this.container.getProviders().map(T=>{if(!ef(T))return null;{let S=T.getImmediate();return`${S.library}/${S.version}`}}).filter(T=>T).join(" ")}}function ef(T){let S=T.getComponent();return(null==S?void 0:S.type)==="VERSION"}let em="@firebase/app",eg="0.13.2",ey=new M.Yd("@firebase/app"),ev="11.10.0",eb="[DEFAULT]",eT={[em]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eS=new Map,eE=new Map,e_=new Map;function ew(T,S){try{T.container.addComponent(S)}catch(R){ey.debug(`Component ${S.name} failed to register with FirebaseApp ${T.name}`,R)}}function eC(T){let S=T.name;if(e_.has(S))return ey.debug(`There were multiple attempts to register component ${S}.`),!1;for(let R of(e_.set(S,T),eS.values()))ew(R,T);for(let S of eE.values())ew(S,T);return!0}function eI(T,S){let R=T.container.getProvider("heartbeat").getImmediate({optional:!0});return R&&R.triggerHeartbeat(),T.container.getProvider(S)}function eR(T){return null!=T&&void 0!==T.settings}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ek={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},eN=new L.LL("app","Firebase",ek);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eA{constructor(T,S,R){this._isDeleted=!1,this._options=Object.assign({},T),this._config=Object.assign({},S),this._name=S.name,this._automaticDataCollectionEnabled=S.automaticDataCollectionEnabled,this._container=R,this.container.addComponent(new P.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(T){this.checkDestroyed(),this._automaticDataCollectionEnabled=T}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(T){this._isDeleted=T}checkDestroyed(){if(this.isDeleted)throw eN.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eD=ev;function eO(T,S={}){let R=T;"object"!=typeof S&&(S={name:S});let N=Object.assign({name:eb,automaticDataCollectionEnabled:!0},S),O=N.name;if("string"!=typeof O||!O)throw eN.create("bad-app-name",{appName:String(O)});if(R||(R=(0,L.aH)()),!R)throw eN.create("no-options");let M=eS.get(O);if(M){if((0,L.vZ)(R,M.options)&&(0,L.vZ)(N,M.config))return M;throw eN.create("duplicate-app",{appName:O})}let U=new P.H0(O);for(let T of e_.values())U.addComponent(T);let V=new eA(R,N,U);return eS.set(O,V),V}function ex(T=eb){let S=eS.get(T);if(!S&&T===eb&&(0,L.aH)())return eO();if(!S)throw eN.create("no-app",{appName:T});return S}function eP(T,S,R){var N;let O=null!==(N=eT[T])&&void 0!==N?N:T;R&&(O+=`-${R}`);let M=O.match(/\s|\//),L=S.match(/\s|\//);if(M||L){let T=[`Unable to register library "${O}" with version "${S}":`];M&&T.push(`library name "${O}" contains illegal characters (whitespace or "/")`),M&&L&&T.push("and"),L&&T.push(`version name "${S}" contains illegal characters (whitespace or "/")`),ey.warn(T.join(" "));return}eC(new P.wA(`${O}-version`,()=>({library:O,version:S}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eM="firebase-heartbeat-database",eL=1,eF="firebase-heartbeat-store",eB=null;function eU(){return eB||(eB=eo(eM,eL,{upgrade:(T,S)=>{if(0===S)try{T.createObjectStore(eF)}catch(T){}}}).catch(T=>{throw eN.create("idb-open",{originalErrorMessage:T.message})})),eB}async function eV(T){try{let S=(await eU()).transaction(eF),R=await S.objectStore(eF).get(ez(T));return await S.done,R}catch(T){if(T instanceof L.ZR)ey.warn(T.message);else{let S=eN.create("idb-get",{originalErrorMessage:null==T?void 0:T.message});ey.warn(S.message)}}}async function ej(T,S){try{let R=(await eU()).transaction(eF,"readwrite"),N=R.objectStore(eF);await N.put(S,ez(T)),await R.done}catch(T){if(T instanceof L.ZR)ey.warn(T.message);else{let S=eN.create("idb-set",{originalErrorMessage:null==T?void 0:T.message});ey.warn(S.message)}}}function ez(T){return`${T.name}!${T.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eq=1024,eG=30;class e${constructor(T){this.container=T,this._heartbeatsCache=null;let S=this.container.getProvider("app").getImmediate();this._storage=new eW(S),this._heartbeatsCachePromise=this._storage.read().then(T=>(this._heartbeatsCache=T,T))}async triggerHeartbeat(){var T,S;try{let R=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),N=eK();if((null===(T=this._heartbeatsCache)||void 0===T?void 0:T.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(S=this._heartbeatsCache)||void 0===S?void 0:S.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===N||this._heartbeatsCache.heartbeats.some(T=>T.date===N))return;if(this._heartbeatsCache.heartbeats.push({date:N,agent:R}),this._heartbeatsCache.heartbeats.length>eG){let T=eY(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(T,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(T){ey.warn(T)}}async getHeartbeatsHeader(){var T;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(T=this._heartbeatsCache)||void 0===T?void 0:T.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let S=eK(),{heartbeatsToSend:R,unsentEntries:N}=eH(this._heartbeatsCache.heartbeats),O=(0,L.L)(JSON.stringify({version:2,heartbeats:R}));return this._heartbeatsCache.lastSentHeartbeatDate=S,N.length>0?(this._heartbeatsCache.heartbeats=N,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),O}catch(T){return ey.warn(T),""}}}function eK(){return new Date().toISOString().substring(0,10)}function eH(T,S=eq){let R=[],N=T.slice();for(let O of T){let T=R.find(T=>T.agent===O.agent);if(T){if(T.dates.push(O.date),eQ(R)>S){T.dates.pop();break}}else if(R.push({agent:O.agent,dates:[O.date]}),eQ(R)>S){R.pop();break}N=N.slice(1)}return{heartbeatsToSend:R,unsentEntries:N}}class eW{constructor(T){this.app=T,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,L.hl)()&&(0,L.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let T=await eV(this.app);return(null==T?void 0:T.heartbeats)?T:{heartbeats:[]}}}async overwrite(T){var S;if(await this._canUseIndexedDBPromise){let R=await this.read();return ej(this.app,{lastSentHeartbeatDate:null!==(S=T.lastSentHeartbeatDate)&&void 0!==S?S:R.lastSentHeartbeatDate,heartbeats:T.heartbeats})}}async add(T){var S;if(await this._canUseIndexedDBPromise){let R=await this.read();return ej(this.app,{lastSentHeartbeatDate:null!==(S=T.lastSentHeartbeatDate)&&void 0!==S?S:R.lastSentHeartbeatDate,heartbeats:[...R.heartbeats,...T.heartbeats]})}}}function eQ(T){return(0,L.L)(JSON.stringify({version:2,heartbeats:T})).length}function eY(T){if(0===T.length)return -1;let S=0,R=T[0].date;for(let N=1;N<T.length;N++)T[N].date<R&&(R=T[N].date,S=N);return S}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(T){eC(new P.wA("platform-logger",T=>new ep(T),"PRIVATE")),eC(new P.wA("heartbeat",T=>new e$(T),"PRIVATE")),eP(em,eg,""),eP(em,eg,"esm2017"),eP("fire-js","")})(0)},47059:(T,S,R)=>{"use strict";R.d(S,{H0:()=>V,wA:()=>O});var N=R(61006);class O{constructor(T,S,R){this.name=T,this.instanceFactory=S,this.type=R,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(T){return this.instantiationMode=T,this}setMultipleInstances(T){return this.multipleInstances=T,this}setServiceProps(T){return this.serviceProps=T,this}setInstanceCreatedCallback(T){return this.onInstanceCreated=T,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(T,S){this.name=T,this.container=S,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(T){let S=this.normalizeInstanceIdentifier(T);if(!this.instancesDeferred.has(S)){let T=new N.BH;if(this.instancesDeferred.set(S,T),this.isInitialized(S)||this.shouldAutoInitialize())try{let R=this.getOrInitializeService({instanceIdentifier:S});R&&T.resolve(R)}catch(T){}}return this.instancesDeferred.get(S).promise}getImmediate(T){var S;let R=this.normalizeInstanceIdentifier(null==T?void 0:T.identifier),N=null!==(S=null==T?void 0:T.optional)&&void 0!==S&&S;if(this.isInitialized(R)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:R})}catch(T){if(N)return null;throw T}else{if(N)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(T){if(T.name!==this.name)throw Error(`Mismatching Component ${T.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=T,this.shouldAutoInitialize()){if(U(T))try{this.getOrInitializeService({instanceIdentifier:P})}catch(T){}for(let[T,S]of this.instancesDeferred.entries()){let R=this.normalizeInstanceIdentifier(T);try{let T=this.getOrInitializeService({instanceIdentifier:R});S.resolve(T)}catch(T){}}}}clearInstance(T=P){this.instancesDeferred.delete(T),this.instancesOptions.delete(T),this.instances.delete(T)}async delete(){let T=Array.from(this.instances.values());await Promise.all([...T.filter(T=>"INTERNAL"in T).map(T=>T.INTERNAL.delete()),...T.filter(T=>"_delete"in T).map(T=>T._delete())])}isComponentSet(){return null!=this.component}isInitialized(T=P){return this.instances.has(T)}getOptions(T=P){return this.instancesOptions.get(T)||{}}initialize(T={}){let{options:S={}}=T,R=this.normalizeInstanceIdentifier(T.instanceIdentifier);if(this.isInitialized(R))throw Error(`${this.name}(${R}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let N=this.getOrInitializeService({instanceIdentifier:R,options:S});for(let[T,S]of this.instancesDeferred.entries())R===this.normalizeInstanceIdentifier(T)&&S.resolve(N);return N}onInit(T,S){var R;let N=this.normalizeInstanceIdentifier(S),O=null!==(R=this.onInitCallbacks.get(N))&&void 0!==R?R:new Set;O.add(T),this.onInitCallbacks.set(N,O);let P=this.instances.get(N);return P&&T(P,N),()=>{O.delete(T)}}invokeOnInitCallbacks(T,S){let R=this.onInitCallbacks.get(S);if(R)for(let N of R)try{N(T,S)}catch(T){}}getOrInitializeService({instanceIdentifier:T,options:S={}}){let R=this.instances.get(T);if(!R&&this.component&&(R=this.component.instanceFactory(this.container,{instanceIdentifier:L(T),options:S}),this.instances.set(T,R),this.instancesOptions.set(T,S),this.invokeOnInitCallbacks(R,T),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,T,R)}catch(T){}return R||null}normalizeInstanceIdentifier(T=P){return this.component?this.component.multipleInstances?T:P:T}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function L(T){return T===P?void 0:T}function U(T){return"EAGER"===T.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(T){this.name=T,this.providers=new Map}addComponent(T){let S=this.getProvider(T.name);if(S.isComponentSet())throw Error(`Component ${T.name} has already been registered with ${this.name}`);S.setComponent(T)}addOrOverwriteComponent(T){this.getProvider(T.name).isComponentSet()&&this.providers.delete(T.name),this.addComponent(T)}getProvider(T){if(this.providers.has(T))return this.providers.get(T);let S=new M(T,this);return this.providers.set(T,S),S}getProviders(){return Array.from(this.providers.values())}}},71954:(T,S,R)=>{"use strict";var N;R.d(S,{Yd:()=>V,in:()=>N});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O=[];!function(T){T[T.DEBUG=0]="DEBUG",T[T.VERBOSE=1]="VERBOSE",T[T.INFO=2]="INFO",T[T.WARN=3]="WARN",T[T.ERROR=4]="ERROR",T[T.SILENT=5]="SILENT"}(N||(N={}));let P={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},M=N.INFO,L={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},U=(T,S,...R)=>{if(S<T.logLevel)return;let N=new Date().toISOString(),O=L[S];if(O)console[O](`[${N}]  ${T.name}:`,...R);else throw Error(`Attempted to log a message with an invalid logType (value: ${S})`)};class V{constructor(T){this.name=T,this._logLevel=M,this._logHandler=U,this._userLogHandler=null,O.push(this)}get logLevel(){return this._logLevel}set logLevel(T){if(!(T in N))throw TypeError(`Invalid value "${T}" assigned to \`logLevel\``);this._logLevel=T}setLogLevel(T){this._logLevel="string"==typeof T?P[T]:T}get logHandler(){return this._logHandler}set logHandler(T){if("function"!=typeof T)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=T}get userLogHandler(){return this._userLogHandler}set userLogHandler(T){this._userLogHandler=T}debug(...T){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...T),this._logHandler(this,N.DEBUG,...T)}log(...T){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...T),this._logHandler(this,N.VERBOSE,...T)}info(...T){this._userLogHandler&&this._userLogHandler(this,N.INFO,...T),this._logHandler(this,N.INFO,...T)}warn(...T){this._userLogHandler&&this._userLogHandler(this,N.WARN,...T),this._logHandler(this,N.WARN,...T)}error(...T){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...T),this._logHandler(this,N.ERROR,...T)}}},61006:(T,S,R)=>{"use strict";R.d(S,{BH:()=>en,LL:()=>eT,ZR:()=>eb,tV:()=>K,L:()=>$,Sg:()=>ea,ne:()=>ek,vZ:()=>e_,pd:()=>eR,aH:()=>er,q4:()=>ee,P0:()=>et,m9:()=>eO,z$:()=>eu,ru:()=>ep,Xx:()=>ei,L_:()=>eh,hl:()=>eg,uI:()=>ec,b$:()=>ef,G6:()=>em,Uo:()=>es,xO:()=>eC,zd:()=>eI,dp:()=>eo,eu:()=>ey});let N=()=>void 0,O={NODE_CLIENT:!1},P=function(T){let S=[],R=0;for(let N=0;N<T.length;N++){let O=T.charCodeAt(N);O<128?S[R++]=O:(O<2048?S[R++]=O>>6|192:((64512&O)==55296&&N+1<T.length&&(64512&T.charCodeAt(N+1))==56320?(O=65536+((1023&O)<<10)+(1023&T.charCodeAt(++N)),S[R++]=O>>18|240,S[R++]=O>>12&63|128):S[R++]=O>>12|224,S[R++]=O>>6&63|128),S[R++]=63&O|128)}return S},M=function(T){let S=[],R=0,N=0;for(;R<T.length;){let O=T[R++];if(O<128)S[N++]=String.fromCharCode(O);else if(O>191&&O<224){let P=T[R++];S[N++]=String.fromCharCode((31&O)<<6|63&P)}else if(O>239&&O<365){let P=((7&O)<<18|(63&T[R++])<<12|(63&T[R++])<<6|63&T[R++])-65536;S[N++]=String.fromCharCode(55296+(P>>10)),S[N++]=String.fromCharCode(56320+(1023&P))}else{let P=T[R++],M=T[R++];S[N++]=String.fromCharCode((15&O)<<12|(63&P)<<6|63&M)}}return S.join("")},L={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(T,S){if(!Array.isArray(T))throw Error("encodeByteArray takes an array as a parameter");this.init_();let R=S?this.byteToCharMapWebSafe_:this.byteToCharMap_,N=[];for(let S=0;S<T.length;S+=3){let O=T[S],P=S+1<T.length,M=P?T[S+1]:0,L=S+2<T.length,U=L?T[S+2]:0,V=O>>2,$=(3&O)<<4|M>>4,K=(15&M)<<2|U>>6,W=63&U;L||(W=64,P||(K=64)),N.push(R[V],R[$],R[K],R[W])}return N.join("")},encodeString(T,S){return this.HAS_NATIVE_SUPPORT&&!S?btoa(T):this.encodeByteArray(P(T),S)},decodeString(T,S){return this.HAS_NATIVE_SUPPORT&&!S?atob(T):M(this.decodeStringToByteArray(T,S))},decodeStringToByteArray(T,S){this.init_();let R=S?this.charToByteMapWebSafe_:this.charToByteMap_,N=[];for(let S=0;S<T.length;){let O=R[T.charAt(S++)],P=S<T.length?R[T.charAt(S)]:0,M=++S<T.length?R[T.charAt(S)]:64,L=++S<T.length?R[T.charAt(S)]:64;if(++S,null==O||null==P||null==M||null==L)throw new U;let V=O<<2|P>>4;if(N.push(V),64!==M){let T=P<<4&240|M>>2;if(N.push(T),64!==L){let T=M<<6&192|L;N.push(T)}}}return N},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let T=0;T<this.ENCODED_VALS.length;T++)this.byteToCharMap_[T]=this.ENCODED_VALS.charAt(T),this.charToByteMap_[this.byteToCharMap_[T]]=T,this.byteToCharMapWebSafe_[T]=this.ENCODED_VALS_WEBSAFE.charAt(T),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[T]]=T,T>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(T)]=T,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(T)]=T)}}};class U extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let V=function(T){let S=P(T);return L.encodeByteArray(S,!0)},$=function(T){return V(T).replace(/\./g,"")},K=function(T){try{return L.decodeString(T,!0)}catch(T){}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(){if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Q=()=>W().__FIREBASE_DEFAULTS__,Y=()=>{if("undefined"==typeof process||void 0===process.env)return;let T=process.env.__FIREBASE_DEFAULTS__;if(T)return JSON.parse(T)},X=()=>{let T;if("undefined"==typeof document)return;try{T=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(T){return}let S=T&&K(T[1]);return S&&JSON.parse(S)},Z=()=>{try{return N()||Q()||Y()||X()}catch(T){return}},ee=T=>{var S,R;return null===(R=null===(S=Z())||void 0===S?void 0:S.emulatorHosts)||void 0===R?void 0:R[T]},et=T=>{let S=ee(T);if(!S)return;let R=S.lastIndexOf(":");if(R<=0||R+1===S.length)throw Error(`Invalid host ${S} with no separate hostname and port!`);let N=parseInt(S.substring(R+1),10);return"["===S[0]?[S.substring(1,R-1),N]:[S.substring(0,R),N]},er=()=>{var T;return null===(T=Z())||void 0===T?void 0:T.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((T,S)=>{this.resolve=T,this.reject=S})}wrapCallback(T){return(S,R)=>{S?this.reject(S):this.resolve(R),"function"==typeof T&&(this.promise.catch(()=>{}),1===T.length?T(S):T(S,R))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ei(T){try{return(T.startsWith("http://")||T.startsWith("https://")?new URL(T).hostname:T).endsWith(".cloudworkstations.dev")}catch(T){return!1}}async function es(T){return(await fetch(T,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ea(T,S){if(T.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let R={alg:"none",type:"JWT"},N=S||"demo-project",O=T.iat||0,P=T.sub||T.user_id;if(!P)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let M=Object.assign({iss:`https://securetoken.google.com/${N}`,aud:N,iat:O,exp:O+3600,auth_time:O,sub:P,user_id:P,firebase:{sign_in_provider:"custom",identities:{}}},T),L="";return[$(JSON.stringify(R)),$(JSON.stringify(M)),L].join(".")}function eo(T,S){}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eu(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ec(){return!1}function ed(){var T;let S=null===(T=Z())||void 0===T?void 0:T.forceEnvironment;if("node"===S)return!0;if("browser"===S)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(T){return!1}}function eh(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function ep(){let T="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof T&&void 0!==T.id}function ef(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function em(){return!ed()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eg(){try{return"object"==typeof indexedDB}catch(T){return!1}}function ey(){return new Promise((T,S)=>{try{let R=!0,N="validate-browser-context-for-indexeddb-analytics-module",O=self.indexedDB.open(N);O.onsuccess=()=>{O.result.close(),R||self.indexedDB.deleteDatabase(N),T(!0)},O.onupgradeneeded=()=>{R=!1},O.onerror=()=>{var T;S((null===(T=O.error)||void 0===T?void 0:T.message)||"")}}catch(T){S(T)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ev="FirebaseError";class eb extends Error{constructor(T,S,R){super(S),this.code=T,this.customData=R,this.name=ev,Object.setPrototypeOf(this,eb.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eT.prototype.create)}}class eT{constructor(T,S,R){this.service=T,this.serviceName=S,this.errors=R}create(T,...S){let R=S[0]||{},N=`${this.service}/${T}`,O=this.errors[T],P=O?eS(O,R):"Error",M=`${this.serviceName}: ${P} (${N}).`;return new eb(N,M,R)}}function eS(T,S){return T.replace(eE,(T,R)=>{let N=S[R];return null!=N?String(N):`<${R}?>`})}let eE=/\{\$([^}]+)}/g;function e_(T,S){if(T===S)return!0;let R=Object.keys(T),N=Object.keys(S);for(let O of R){if(!N.includes(O))return!1;let R=T[O],P=S[O];if(ew(R)&&ew(P)){if(!e_(R,P))return!1}else if(R!==P)return!1}for(let T of N)if(!R.includes(T))return!1;return!0}function ew(T){return null!==T&&"object"==typeof T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(T){let S=[];for(let[R,N]of Object.entries(T))Array.isArray(N)?N.forEach(T=>{S.push(encodeURIComponent(R)+"="+encodeURIComponent(T))}):S.push(encodeURIComponent(R)+"="+encodeURIComponent(N));return S.length?"&"+S.join("&"):""}function eI(T){let S={};return T.replace(/^\?/,"").split("&").forEach(T=>{if(T){let[R,N]=T.split("=");S[decodeURIComponent(R)]=decodeURIComponent(N)}}),S}function eR(T){let S=T.indexOf("?");if(!S)return"";let R=T.indexOf("#",S);return T.substring(S,R>0?R:void 0)}function ek(T,S){let R=new eN(T,S);return R.subscribe.bind(R)}class eN{constructor(T,S){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=S,this.task.then(()=>{T(this)}).catch(T=>{this.error(T)})}next(T){this.forEachObserver(S=>{S.next(T)})}error(T){this.forEachObserver(S=>{S.error(T)}),this.close(T)}complete(){this.forEachObserver(T=>{T.complete()}),this.close()}subscribe(T,S,R){let N;if(void 0===T&&void 0===S&&void 0===R)throw Error("Missing Observer.");void 0===(N=eA(T,["next","error","complete"])?T:{next:T,error:S,complete:R}).next&&(N.next=eD),void 0===N.error&&(N.error=eD),void 0===N.complete&&(N.complete=eD);let O=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?N.error(this.finalError):N.complete()}catch(T){}}),this.observers.push(N),O}unsubscribeOne(T){void 0!==this.observers&&void 0!==this.observers[T]&&(delete this.observers[T],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(T){if(!this.finalized)for(let S=0;S<this.observers.length;S++)this.sendOne(S,T)}sendOne(T,S){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[T])try{S(this.observers[T])}catch(T){}})}close(T){this.finalized||(this.finalized=!0,void 0!==T&&(this.finalError=T),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eA(T,S){if("object"!=typeof T||null===T)return!1;for(let R of S)if(R in T&&"function"==typeof T[R])return!0;return!1}function eD(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eO(T){return T&&T._delegate?T._delegate:T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */O.NODE_CLIENT=!0},76041:(T,S,R)=>{"use strict";R.d(S,{ZF:()=>N.ZF});var N=R(95285),O="firebase",P="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(0,N.KN)(O,P,"app")},48853:(T,S,R)=>{"use strict";R.d(S,{lI:()=>rt,v0:()=>t6,$g:()=>t7});var N=R(95285),O=R(61006);function P(T,S){var R={};for(var N in T)Object.prototype.hasOwnProperty.call(T,N)&&0>S.indexOf(N)&&(R[N]=T[N]);if(null!=T&&"function"==typeof Object.getOwnPropertySymbols)for(var O=0,N=Object.getOwnPropertySymbols(T);O<N.length;O++)0>S.indexOf(N[O])&&Object.prototype.propertyIsEnumerable.call(T,N[O])&&(R[N[O]]=T[N[O]]);return R}Object.create,Object.create;var M=("function"==typeof SuppressedError&&SuppressedError,R(47059)),L=R(71954);function U(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let V=U,$=new O.LL("auth","Firebase",U()),K=new L.Yd("@firebase/auth");function W(T,...S){K.logLevel<=L.in.WARN&&K.warn(`Auth (${N.Jn}): ${T}`,...S)}function Q(T,...S){K.logLevel<=L.in.ERROR&&K.error(`Auth (${N.Jn}): ${T}`,...S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y(T,...S){throw et(T,...S)}function X(T,...S){return et(T,...S)}function Z(T,S,R){let N=Object.assign(Object.assign({},V()),{[S]:R});return new O.LL("auth","Firebase",N).create(S,{appName:T.name})}function ee(T){return Z(T,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function et(T,...S){if("string"!=typeof T){let R=S[0],N=[...S.slice(1)];return N[0]&&(N[0].appName=T.name),T._errorFactory.create(R,...N)}return $.create(T,...S)}function er(T,S,...R){if(!T)throw et(S,...R)}function en(T){let S="INTERNAL ASSERTION FAILED: "+T;throw Q(S),Error(S)}function ei(T,S){T||en(S)}function es(){return"http:"===ea()||"https:"===ea()}function ea(){var T;return"undefined"!=typeof self&&(null===(T=self.location)||void 0===T?void 0:T.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(es()||(0,O.ru)()||"connection"in navigator))||navigator.onLine}function eu(){if("undefined"==typeof navigator)return null;let T=navigator;return T.languages&&T.languages[0]||T.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(T,S){this.shortDelay=T,this.longDelay=S,ei(S>T,"Short delay should be less than long delay!"),this.isMobile=(0,O.uI)()||(0,O.b$)()}get(){return eo()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ed(T,S){ei(T.emulator,"Emulator should always be set here");let{url:R}=T.emulator;return S?`${R}${S.startsWith("/")?S.slice(1):S}`:R}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{static initialize(T,S,R){this.fetchImpl=T,S&&(this.headersImpl=S),R&&(this.responseImpl=R)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void en("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void en("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void en("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ep={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ef=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],em=new ec(3e4,6e4);function eg(T,S){return T.tenantId&&!S.tenantId?Object.assign(Object.assign({},S),{tenantId:T.tenantId}):S}async function ey(T,S,R,N,P={}){return ev(T,P,async()=>{let P={},M={};N&&("GET"===S?M=N:P={body:JSON.stringify(N)});let L=(0,O.xO)(Object.assign({key:T.config.apiKey},M)).slice(1),U=await T._getAdditionalHeaders();U["Content-Type"]="application/json",T.languageCode&&(U["X-Firebase-Locale"]=T.languageCode);let V=Object.assign({method:S,headers:U},P);return(0,O.L_)()||(V.referrerPolicy="no-referrer"),T.emulatorConfig&&(0,O.Xx)(T.emulatorConfig.host)&&(V.credentials="include"),eh.fetch()(await eT(T,T.config.apiHost,R,L),V)})}async function ev(T,S,R){T._canInitEmulator=!1;let N=Object.assign(Object.assign({},ep),S);try{let S=new eE(T),O=await Promise.race([R(),S.promise]);S.clearNetworkTimeout();let P=await O.json();if("needConfirmation"in P)throw e_(T,"account-exists-with-different-credential",P);if(O.ok&&!("errorMessage"in P))return P;{let[S,R]=(O.ok?P.errorMessage:P.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===S)throw e_(T,"credential-already-in-use",P);if("EMAIL_EXISTS"===S)throw e_(T,"email-already-in-use",P);if("USER_DISABLED"===S)throw e_(T,"user-disabled",P);let M=N[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(R)throw Z(T,M,R);Y(T,M)}}catch(S){if(S instanceof O.ZR)throw S;Y(T,"network-request-failed",{message:String(S)})}}async function eb(T,S,R,N,O={}){let P=await ey(T,S,R,N,O);return"mfaPendingCredential"in P&&Y(T,"multi-factor-auth-required",{_serverResponse:P}),P}async function eT(T,S,R,N){let O=`${S}${R}?${N}`,P=T,M=P.config.emulator?ed(T.config,O):`${T.config.apiScheme}://${O}`;return ef.includes(R)&&(await P._persistenceManagerAvailable,"COOKIE"===P._getPersistenceType())?P._getPersistence()._getFinalTarget(M).toString():M}function eS(T){switch(T){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class eE{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(T){this.auth=T,this.timer=null,this.promise=new Promise((T,S)=>{this.timer=setTimeout(()=>S(X(this.auth,"network-request-failed")),em.get())})}}function e_(T,S,R){let N={appName:T.name};R.email&&(N.email=R.email),R.phoneNumber&&(N.phoneNumber=R.phoneNumber);let O=X(T,S,N);return O.customData._tokenResponse=R,O}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(T){return void 0!==T&&void 0!==T.enterprise}class eC{constructor(T){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===T.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=T.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=T.recaptchaEnforcementState}getProviderEnforcementState(T){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let S of this.recaptchaEnforcementState)if(S.provider&&S.provider===T)return eS(S.enforcementState);return null}isProviderEnabled(T){return"ENFORCE"===this.getProviderEnforcementState(T)||"AUDIT"===this.getProviderEnforcementState(T)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eI(T,S){return ey(T,"GET","/v2/recaptchaConfig",eg(T,S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eR(T,S){return ey(T,"POST","/v1/accounts:delete",S)}async function ek(T,S){return ey(T,"POST","/v1/accounts:lookup",S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(T){if(T)try{let S=new Date(Number(T));if(!isNaN(S.getTime()))return S.toUTCString()}catch(T){}}async function eA(T,S=!1){let R=(0,O.m9)(T),N=await R.getIdToken(S),P=eO(N);er(P&&P.exp&&P.auth_time&&P.iat,R.auth,"internal-error");let M="object"==typeof P.firebase?P.firebase:void 0,L=null==M?void 0:M.sign_in_provider;return{claims:P,token:N,authTime:eN(eD(P.auth_time)),issuedAtTime:eN(eD(P.iat)),expirationTime:eN(eD(P.exp)),signInProvider:L||null,signInSecondFactor:(null==M?void 0:M.sign_in_second_factor)||null}}function eD(T){return 1e3*Number(T)}function eO(T){let[S,R,N]=T.split(".");if(void 0===S||void 0===R||void 0===N)return Q("JWT malformed, contained fewer than 3 sections"),null;try{let T=(0,O.tV)(R);if(!T)return Q("Failed to decode base64 JWT payload"),null;return JSON.parse(T)}catch(T){return Q("Caught error parsing JWT payload as JSON",null==T?void 0:T.toString()),null}}function ex(T){let S=eO(T);return er(S,"internal-error"),er(void 0!==S.exp,"internal-error"),er(void 0!==S.iat,"internal-error"),Number(S.exp)-Number(S.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eP(T,S,R=!1){if(R)return S;try{return await S}catch(S){throw S instanceof O.ZR&&eM(S)&&T.auth.currentUser===T&&await T.auth.signOut(),S}}function eM({code:T}){return"auth/user-disabled"===T||"auth/user-token-expired"===T}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(T){this.user=T,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(T){var S;if(!T)return this.errorBackoff=3e4,Math.max(0,(null!==(S=this.user.stsTokenManager.expirationTime)&&void 0!==S?S:0)-Date.now()-3e5);{let T=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),T}}schedule(T=!1){if(!this.isRunning)return;let S=this.getInterval(T);this.timerId=setTimeout(async()=>{await this.iteration()},S)}async iteration(){try{await this.user.getIdToken(!0)}catch(T){(null==T?void 0:T.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eF{constructor(T,S){this.createdAt=T,this.lastLoginAt=S,this._initializeTime()}_initializeTime(){this.lastSignInTime=eN(this.lastLoginAt),this.creationTime=eN(this.createdAt)}_copy(T){this.createdAt=T.createdAt,this.lastLoginAt=T.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eB(T){var S;let R=T.auth,N=await T.getIdToken(),O=await eP(T,ek(R,{idToken:N}));er(null==O?void 0:O.users.length,R,"internal-error");let P=O.users[0];T._notifyReloadListener(P);let M=(null===(S=P.providerUserInfo)||void 0===S?void 0:S.length)?ej(P.providerUserInfo):[],L=eV(T.providerData,M),U=T.isAnonymous,V=!(T.email&&P.passwordHash)&&!(null==L?void 0:L.length),$=!!U&&V;Object.assign(T,{uid:P.localId,displayName:P.displayName||null,photoURL:P.photoUrl||null,email:P.email||null,emailVerified:P.emailVerified||!1,phoneNumber:P.phoneNumber||null,tenantId:P.tenantId||null,providerData:L,metadata:new eF(P.createdAt,P.lastLoginAt),isAnonymous:$})}async function eU(T){let S=(0,O.m9)(T);await eB(S),await S.auth._persistUserIfCurrent(S),S.auth._notifyListenersIfCurrent(S)}function eV(T,S){return[...T.filter(T=>!S.some(S=>S.providerId===T.providerId)),...S]}function ej(T){return T.map(T=>{var{providerId:S}=T,R=P(T,["providerId"]);return{providerId:S,uid:R.rawId||"",displayName:R.displayName||null,email:R.email||null,phoneNumber:R.phoneNumber||null,photoURL:R.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ez(T,S){let R=await ev(T,{},async()=>{let R=(0,O.xO)({grant_type:"refresh_token",refresh_token:S}).slice(1),{tokenApiHost:N,apiKey:P}=T.config,M=await eT(T,N,"/v1/token",`key=${P}`),L=await T._getAdditionalHeaders();L["Content-Type"]="application/x-www-form-urlencoded";let U={method:"POST",headers:L,body:R};return T.emulatorConfig&&(0,O.Xx)(T.emulatorConfig.host)&&(U.credentials="include"),eh.fetch()(M,U)});return{accessToken:R.access_token,expiresIn:R.expires_in,refreshToken:R.refresh_token}}async function eq(T,S){return ey(T,"POST","/v2/accounts:revokeToken",eg(T,S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eG{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(T){er(T.idToken,"internal-error"),er(void 0!==T.idToken,"internal-error"),er(void 0!==T.refreshToken,"internal-error");let S="expiresIn"in T&&void 0!==T.expiresIn?Number(T.expiresIn):ex(T.idToken);this.updateTokensAndExpiration(T.idToken,T.refreshToken,S)}updateFromIdToken(T){er(0!==T.length,"internal-error");let S=ex(T);this.updateTokensAndExpiration(T,null,S)}async getToken(T,S=!1){return S||!this.accessToken||this.isExpired?(er(this.refreshToken,T,"user-token-expired"),this.refreshToken)?(await this.refresh(T,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(T,S){let{accessToken:R,refreshToken:N,expiresIn:O}=await ez(T,S);this.updateTokensAndExpiration(R,N,Number(O))}updateTokensAndExpiration(T,S,R){this.refreshToken=S||null,this.accessToken=T||null,this.expirationTime=Date.now()+1e3*R}static fromJSON(T,S){let{refreshToken:R,accessToken:N,expirationTime:O}=S,P=new eG;return R&&(er("string"==typeof R,"internal-error",{appName:T}),P.refreshToken=R),N&&(er("string"==typeof N,"internal-error",{appName:T}),P.accessToken=N),O&&(er("number"==typeof O,"internal-error",{appName:T}),P.expirationTime=O),P}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(T){this.accessToken=T.accessToken,this.refreshToken=T.refreshToken,this.expirationTime=T.expirationTime}_clone(){return Object.assign(new eG,this.toJSON())}_performRefresh(){return en("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e$(T,S){er("string"==typeof T||void 0===T,"internal-error",{appName:S})}class eK{constructor(T){var{uid:S,auth:R,stsTokenManager:N}=T,O=P(T,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new eL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=S,this.auth=R,this.stsTokenManager=N,this.accessToken=N.accessToken,this.displayName=O.displayName||null,this.email=O.email||null,this.emailVerified=O.emailVerified||!1,this.phoneNumber=O.phoneNumber||null,this.photoURL=O.photoURL||null,this.isAnonymous=O.isAnonymous||!1,this.tenantId=O.tenantId||null,this.providerData=O.providerData?[...O.providerData]:[],this.metadata=new eF(O.createdAt||void 0,O.lastLoginAt||void 0)}async getIdToken(T){let S=await eP(this,this.stsTokenManager.getToken(this.auth,T));return er(S,this.auth,"internal-error"),this.accessToken!==S&&(this.accessToken=S,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),S}getIdTokenResult(T){return eA(this,T)}reload(){return eU(this)}_assign(T){this!==T&&(er(this.uid===T.uid,this.auth,"internal-error"),this.displayName=T.displayName,this.photoURL=T.photoURL,this.email=T.email,this.emailVerified=T.emailVerified,this.phoneNumber=T.phoneNumber,this.isAnonymous=T.isAnonymous,this.tenantId=T.tenantId,this.providerData=T.providerData.map(T=>Object.assign({},T)),this.metadata._copy(T.metadata),this.stsTokenManager._assign(T.stsTokenManager))}_clone(T){let S=new eK(Object.assign(Object.assign({},this),{auth:T,stsTokenManager:this.stsTokenManager._clone()}));return S.metadata._copy(this.metadata),S}_onReload(T){er(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=T,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(T){this.reloadListener?this.reloadListener(T):this.reloadUserInfo=T}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(T,S=!1){let R=!1;T.idToken&&T.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(T),R=!0),S&&await eB(this),await this.auth._persistUserIfCurrent(this),R&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,N.rh)(this.auth.app))return Promise.reject(ee(this.auth));let T=await this.getIdToken();return await eP(this,eR(this.auth,{idToken:T})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(T=>Object.assign({},T)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(T,S){var R,N,O,P,M,L,U,V;let $=null!==(R=S.displayName)&&void 0!==R?R:void 0,K=null!==(N=S.email)&&void 0!==N?N:void 0,W=null!==(O=S.phoneNumber)&&void 0!==O?O:void 0,Q=null!==(P=S.photoURL)&&void 0!==P?P:void 0,Y=null!==(M=S.tenantId)&&void 0!==M?M:void 0,X=null!==(L=S._redirectEventId)&&void 0!==L?L:void 0,Z=null!==(U=S.createdAt)&&void 0!==U?U:void 0,ee=null!==(V=S.lastLoginAt)&&void 0!==V?V:void 0,{uid:et,emailVerified:en,isAnonymous:ei,providerData:es,stsTokenManager:ea}=S;er(et&&ea,T,"internal-error");let eo=eG.fromJSON(this.name,ea);er("string"==typeof et,T,"internal-error"),e$($,T.name),e$(K,T.name),er("boolean"==typeof en,T,"internal-error"),er("boolean"==typeof ei,T,"internal-error"),e$(W,T.name),e$(Q,T.name),e$(Y,T.name),e$(X,T.name),e$(Z,T.name),e$(ee,T.name);let eu=new eK({uid:et,auth:T,email:K,emailVerified:en,displayName:$,isAnonymous:ei,photoURL:Q,phoneNumber:W,tenantId:Y,stsTokenManager:eo,createdAt:Z,lastLoginAt:ee});return es&&Array.isArray(es)&&(eu.providerData=es.map(T=>Object.assign({},T))),X&&(eu._redirectEventId=X),eu}static async _fromIdTokenResponse(T,S,R=!1){let N=new eG;N.updateFromServerResponse(S);let O=new eK({uid:S.localId,auth:T,stsTokenManager:N,isAnonymous:R});return await eB(O),O}static async _fromGetAccountInfoResponse(T,S,R){let N=S.users[0];er(void 0!==N.localId,"internal-error");let O=void 0!==N.providerUserInfo?ej(N.providerUserInfo):[],P=!(N.email&&N.passwordHash)&&!(null==O?void 0:O.length),M=new eG;M.updateFromIdToken(R);let L=new eK({uid:N.localId,auth:T,stsTokenManager:M,isAnonymous:P});return Object.assign(L,{uid:N.localId,displayName:N.displayName||null,photoURL:N.photoUrl||null,email:N.email||null,emailVerified:N.emailVerified||!1,phoneNumber:N.phoneNumber||null,tenantId:N.tenantId||null,providerData:O,metadata:new eF(N.createdAt,N.lastLoginAt),isAnonymous:!(N.email&&N.passwordHash)&&!(null==O?void 0:O.length)}),L}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eH=new Map;function eW(T){ei(T instanceof Function,"Expected a class definition");let S=eH.get(T);return S?ei(S instanceof T,"Instance stored in cache mismatched with class"):(S=new T,eH.set(T,S)),S}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eQ{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(T,S){this.storage[T]=S}async _get(T){let S=this.storage[T];return void 0===S?null:S}async _remove(T){delete this.storage[T]}_addListener(T,S){}_removeListener(T,S){}}eQ.type="NONE";let eY=eQ;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eJ(T,S,R){return`firebase:${T}:${S}:${R}`}class eX{constructor(T,S,R){this.persistence=T,this.auth=S,this.userKey=R;let{config:N,name:O}=this.auth;this.fullUserKey=eJ(this.userKey,N.apiKey,O),this.fullPersistenceKey=eJ("persistence",N.apiKey,O),this.boundEventHandler=S._onStorageEvent.bind(S),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(T){return this.persistence._set(this.fullUserKey,T.toJSON())}async getCurrentUser(){let T=await this.persistence._get(this.fullUserKey);if(!T)return null;if("string"==typeof T){let S=await ek(this.auth,{idToken:T}).catch(()=>void 0);return S?eK._fromGetAccountInfoResponse(this.auth,S,T):null}return eK._fromJSON(this.auth,T)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(T){if(this.persistence===T)return;let S=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=T,S)return this.setCurrentUser(S)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(T,S,R="authUser"){if(!S.length)return new eX(eW(eY),T,R);let N=(await Promise.all(S.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T),O=N[0]||eW(eY),P=eJ(R,T.config.apiKey,T.name),M=null;for(let R of S)try{let S=await R._get(P);if(S){let N;if("string"==typeof S){let R=await ek(T,{idToken:S}).catch(()=>void 0);if(!R)break;N=await eK._fromGetAccountInfoResponse(T,R,S)}else N=eK._fromJSON(T,S);R!==O&&(M=N),O=R;break}}catch(T){}let L=N.filter(T=>T._shouldAllowMigration);return O._shouldAllowMigration&&L.length&&(O=L[0],M&&await O._set(P,M.toJSON()),await Promise.all(S.map(async T=>{if(T!==O)try{await T._remove(P)}catch(T){}}))),new eX(O,T,R)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eZ(T){let S=T.toLowerCase();if(S.includes("opera/")||S.includes("opr/")||S.includes("opios/"))return"Opera";if(e3(S))return"IEMobile";if(S.includes("msie")||S.includes("trident/"))return"IE";{if(S.includes("edge/"))return"Edge";if(e0(S))return"Firefox";if(S.includes("silk/"))return"Silk";if(e6(S))return"Blackberry";if(e9(S))return"Webos";if(e1(S))return"Safari";if((S.includes("chrome/")||e2(S))&&!S.includes("edge/"))return"Chrome";if(e4(S))return"Android";let R=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,N=T.match(R);if((null==N?void 0:N.length)===2)return N[1]}return"Other"}function e0(T=(0,O.z$)()){return/firefox\//i.test(T)}function e1(T=(0,O.z$)()){let S=T.toLowerCase();return S.includes("safari/")&&!S.includes("chrome/")&&!S.includes("crios/")&&!S.includes("android")}function e2(T=(0,O.z$)()){return/crios\//i.test(T)}function e3(T=(0,O.z$)()){return/iemobile/i.test(T)}function e4(T=(0,O.z$)()){return/android/i.test(T)}function e6(T=(0,O.z$)()){return/blackberry/i.test(T)}function e9(T=(0,O.z$)()){return/webos/i.test(T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e5(T,S=[]){let R;switch(T){case"Browser":R=eZ((0,O.z$)());break;case"Worker":R=`${eZ((0,O.z$)())}-${T}`;break;default:R=T}let P=S.length?S.join(","):"FirebaseCore-web";return`${R}/JsCore/${N.Jn}/${P}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e8{constructor(T){this.auth=T,this.queue=[]}pushCallback(T,S){let R=S=>new Promise((R,N)=>{try{let N=T(S);R(N)}catch(T){N(T)}});R.onAbort=S,this.queue.push(R);let N=this.queue.length-1;return()=>{this.queue[N]=()=>Promise.resolve()}}async runMiddleware(T){if(this.auth.currentUser===T)return;let S=[];try{for(let R of this.queue)await R(T),R.onAbort&&S.push(R.onAbort)}catch(T){for(let T of(S.reverse(),S))try{T()}catch(T){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==T?void 0:T.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e7(T,S={}){return ey(T,"GET","/v2/passwordPolicy",eg(T,S))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let te=6;class tt{constructor(T){var S,R,N,O;let P=T.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(S=P.minPasswordLength)&&void 0!==S?S:te,P.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=P.maxPasswordLength),void 0!==P.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=P.containsLowercaseCharacter),void 0!==P.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=P.containsUppercaseCharacter),void 0!==P.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=P.containsNumericCharacter),void 0!==P.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=P.containsNonAlphanumericCharacter),this.enforcementState=T.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(N=null===(R=T.allowedNonAlphanumericCharacters)||void 0===R?void 0:R.join(""))&&void 0!==N?N:"",this.forceUpgradeOnSignin=null!==(O=T.forceUpgradeOnSignin)&&void 0!==O&&O,this.schemaVersion=T.schemaVersion}validatePassword(T){var S,R,N,O,P,M;let L={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(T,L),this.validatePasswordCharacterOptions(T,L),L.isValid&&(L.isValid=null===(S=L.meetsMinPasswordLength)||void 0===S||S),L.isValid&&(L.isValid=null===(R=L.meetsMaxPasswordLength)||void 0===R||R),L.isValid&&(L.isValid=null===(N=L.containsLowercaseLetter)||void 0===N||N),L.isValid&&(L.isValid=null===(O=L.containsUppercaseLetter)||void 0===O||O),L.isValid&&(L.isValid=null===(P=L.containsNumericCharacter)||void 0===P||P),L.isValid&&(L.isValid=null===(M=L.containsNonAlphanumericCharacter)||void 0===M||M),L}validatePasswordLengthOptions(T,S){let R=this.customStrengthOptions.minPasswordLength,N=this.customStrengthOptions.maxPasswordLength;R&&(S.meetsMinPasswordLength=T.length>=R),N&&(S.meetsMaxPasswordLength=T.length<=N)}validatePasswordCharacterOptions(T,S){let R;this.updatePasswordCharacterOptionsStatuses(S,!1,!1,!1,!1);for(let N=0;N<T.length;N++)R=T.charAt(N),this.updatePasswordCharacterOptionsStatuses(S,R>="a"&&R<="z",R>="A"&&R<="Z",R>="0"&&R<="9",this.allowedNonAlphanumericCharacters.includes(R))}updatePasswordCharacterOptionsStatuses(T,S,R,N,O){this.customStrengthOptions.containsLowercaseLetter&&(T.containsLowercaseLetter||(T.containsLowercaseLetter=S)),this.customStrengthOptions.containsUppercaseLetter&&(T.containsUppercaseLetter||(T.containsUppercaseLetter=R)),this.customStrengthOptions.containsNumericCharacter&&(T.containsNumericCharacter||(T.containsNumericCharacter=N)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(T.containsNonAlphanumericCharacter||(T.containsNonAlphanumericCharacter=O))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(T,S,R,N){this.app=T,this.heartbeatServiceProvider=S,this.appCheckServiceProvider=R,this.config=N,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ts(this),this.idTokenSubscription=new ts(this),this.beforeStateQueue=new e8(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=T.name,this.clientVersion=N.sdkClientVersion,this._persistenceManagerAvailable=new Promise(T=>this._resolvePersistenceManagerAvailable=T)}_initializeWithPersistence(T,S){return S&&(this._popupRedirectResolver=eW(S)),this._initializationPromise=this.queue(async()=>{var R,N,O;if(!this._deleted&&(this.persistenceManager=await eX.create(this,T),null===(R=this._resolvePersistenceManagerAvailable)||void 0===R||R.call(this),!this._deleted)){if(null===(N=this._popupRedirectResolver)||void 0===N?void 0:N._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(T){}await this.initializeCurrentUser(S),this.lastNotifiedUid=(null===(O=this.currentUser)||void 0===O?void 0:O.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let T=await this.assertedPersistence.getCurrentUser();if(this.currentUser||T){if(this.currentUser&&T&&this.currentUser.uid===T.uid){this._currentUser._assign(T),await this.currentUser.getIdToken();return}await this._updateCurrentUser(T,!0)}}async initializeCurrentUserFromIdToken(T){try{let S=await ek(this,{idToken:T}),R=await eK._fromGetAccountInfoResponse(this,S,T);await this.directlySetCurrentUser(R)}catch(T){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(T){var S;if((0,N.rh)(this.app)){let T=this.app.settings.authIdToken;return T?new Promise(S=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(T).then(S,S))}):this.directlySetCurrentUser(null)}let R=await this.assertedPersistence.getCurrentUser(),O=R,P=!1;if(T&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let R=null===(S=this.redirectUser)||void 0===S?void 0:S._redirectEventId,N=null==O?void 0:O._redirectEventId,M=await this.tryRedirectSignIn(T);(!R||R===N)&&(null==M?void 0:M.user)&&(O=M.user,P=!0)}if(!O)return this.directlySetCurrentUser(null);if(!O._redirectEventId){if(P)try{await this.beforeStateQueue.runMiddleware(O)}catch(T){O=R,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(T))}return O?this.reloadAndSetCurrentUserOrClear(O):this.directlySetCurrentUser(null)}return(er(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===O._redirectEventId)?this.directlySetCurrentUser(O):this.reloadAndSetCurrentUserOrClear(O)}async tryRedirectSignIn(T){let S=null;try{S=await this._popupRedirectResolver._completeRedirectFn(this,T,!0)}catch(T){await this._setRedirectUser(null)}return S}async reloadAndSetCurrentUserOrClear(T){try{await eB(T)}catch(T){if((null==T?void 0:T.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(T)}useDeviceLanguage(){this.languageCode=eu()}async _delete(){this._deleted=!0}async updateCurrentUser(T){if((0,N.rh)(this.app))return Promise.reject(ee(this));let S=T?(0,O.m9)(T):null;return S&&er(S.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(S&&S._clone(this))}async _updateCurrentUser(T,S=!1){if(!this._deleted)return T&&er(this.tenantId===T.tenantId,this,"tenant-id-mismatch"),S||await this.beforeStateQueue.runMiddleware(T),this.queue(async()=>{await this.directlySetCurrentUser(T),this.notifyAuthListeners()})}async signOut(){return(0,N.rh)(this.app)?Promise.reject(ee(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(T){return(0,N.rh)(this.app)?Promise.reject(ee(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eW(T))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(T){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let S=this._getPasswordPolicyInternal();return S.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):S.validatePassword(T)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let T=new tt(await e7(this));null===this.tenantId?this._projectPasswordPolicy=T:this._tenantPasswordPolicies[this.tenantId]=T}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(T){this._errorFactory=new O.LL("auth","Firebase",T())}onAuthStateChanged(T,S,R){return this.registerStateListener(this.authStateSubscription,T,S,R)}beforeAuthStateChanged(T,S){return this.beforeStateQueue.pushCallback(T,S)}onIdTokenChanged(T,S,R){return this.registerStateListener(this.idTokenSubscription,T,S,R)}authStateReady(){return new Promise((T,S)=>{if(this.currentUser)T();else{let R=this.onAuthStateChanged(()=>{R(),T()},S)}})}async revokeAccessToken(T){if(this.currentUser){let S={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:T,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(S.tenantId=this.tenantId),await eq(this,S)}}toJSON(){var T;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(T=this._currentUser)||void 0===T?void 0:T.toJSON()}}async _setRedirectUser(T,S){let R=await this.getOrInitRedirectPersistenceManager(S);return null===T?R.removeCurrentUser():R.setCurrentUser(T)}async getOrInitRedirectPersistenceManager(T){if(!this.redirectPersistenceManager){let S=T&&eW(T)||this._popupRedirectResolver;er(S,this,"argument-error"),this.redirectPersistenceManager=await eX.create(this,[eW(S._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(T){var S,R;return(this._isInitialized&&await this.queue(async()=>{}),(null===(S=this._currentUser)||void 0===S?void 0:S._redirectEventId)===T)?this._currentUser:(null===(R=this.redirectUser)||void 0===R?void 0:R._redirectEventId)===T?this.redirectUser:null}async _persistUserIfCurrent(T){if(T===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(T))}_notifyListenersIfCurrent(T){T===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var T,S;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let R=null!==(S=null===(T=this.currentUser)||void 0===T?void 0:T.uid)&&void 0!==S?S:null;this.lastNotifiedUid!==R&&(this.lastNotifiedUid=R,this.authStateSubscription.next(this.currentUser))}registerStateListener(T,S,R,N){if(this._deleted)return()=>{};let O="function"==typeof S?S:S.next.bind(S),P=!1,M=this._isInitialized?Promise.resolve():this._initializationPromise;if(er(M,this,"internal-error"),M.then(()=>{P||O(this.currentUser)}),"function"==typeof S){let O=T.addObserver(S,R,N);return()=>{P=!0,O()}}{let R=T.addObserver(S);return()=>{P=!0,R()}}}async directlySetCurrentUser(T){this.currentUser&&this.currentUser!==T&&this._currentUser._stopProactiveRefresh(),T&&this.isProactiveRefreshEnabled&&T._startProactiveRefresh(),this.currentUser=T,T?await this.assertedPersistence.setCurrentUser(T):await this.assertedPersistence.removeCurrentUser()}queue(T){return this.operations=this.operations.then(T,T),this.operations}get assertedPersistence(){return er(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(T){!T||this.frameworks.includes(T)||(this.frameworks.push(T),this.frameworks.sort(),this.clientVersion=e5(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var T;let S={"X-Client-Version":this.clientVersion};this.app.options.appId&&(S["X-Firebase-gmpid"]=this.app.options.appId);let R=await (null===(T=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===T?void 0:T.getHeartbeatsHeader());R&&(S["X-Firebase-Client"]=R);let N=await this._getAppCheckToken();return N&&(S["X-Firebase-AppCheck"]=N),S}async _getAppCheckToken(){var T;if((0,N.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let S=await (null===(T=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===T?void 0:T.getToken());return(null==S?void 0:S.error)&&W(`Error while retrieving App Check token: ${S.error}`),null==S?void 0:S.token}}function ti(T){return(0,O.m9)(T)}class ts{constructor(T){this.auth=T,this.observer=null,this.addObserver=(0,O.ne)(T=>this.observer=T)}get next(){return er(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(){this.enterprise=new tl}ready(T){T()}execute(T,S){return Promise.resolve("token")}render(T,S){return""}}class tl{ready(T){T()}execute(T,S){return Promise.resolve("token")}render(T,S){return""}}let tu="recaptcha-enterprise",tc="NO_RECAPTCHA";class td{constructor(T){this.type=tu,this.auth=ti(T)}async verify(T="verify",S=!1){async function R(T){if(!S){if(null==T.tenantId&&null!=T._agentRecaptchaConfig)return T._agentRecaptchaConfig.siteKey;if(null!=T.tenantId&&void 0!==T._tenantRecaptchaConfigs[T.tenantId])return T._tenantRecaptchaConfigs[T.tenantId].siteKey}return new Promise(async(S,R)=>{eI(T,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(N=>{if(void 0===N.recaptchaKey)R(Error("recaptcha Enterprise site key undefined"));else{let R=new eC(N);return null==T.tenantId?T._agentRecaptchaConfig=R:T._tenantRecaptchaConfigs[T.tenantId]=R,S(R.siteKey)}}).catch(T=>{R(T)})})}function N(S,R,N){let O=window.grecaptcha;ew(O)?O.enterprise.ready(()=>{O.enterprise.execute(S,{action:T}).then(T=>{R(T)}).catch(()=>{R(tc)})}):N(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ta().execute("siteKey",{action:"verify"}):new Promise((T,O)=>{R(this.auth).then(R=>{if(!S&&ew(window.grecaptcha))N(R,T,O);else{O(Error("RecaptchaVerifier is only supported in browser"));return}}).catch(T=>{O(T)})})}}async function th(T,S,R,N=!1,O=!1){let P;let M=new td(T);if(O)P=tc;else try{P=await M.verify(R)}catch(T){P=await M.verify(R,!0)}let L=Object.assign({},S);if("mfaSmsEnrollment"===R||"mfaSmsSignIn"===R){if("phoneEnrollmentInfo"in L){let T=L.phoneEnrollmentInfo.phoneNumber,S=L.phoneEnrollmentInfo.recaptchaToken;Object.assign(L,{phoneEnrollmentInfo:{phoneNumber:T,recaptchaToken:S,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in L){let T=L.phoneSignInInfo.recaptchaToken;Object.assign(L,{phoneSignInInfo:{recaptchaToken:T,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return L}return N?Object.assign(L,{captchaResp:P}):Object.assign(L,{captchaResponse:P}),Object.assign(L,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(L,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),L}async function tp(T,S,R,N,O){var P,M;if("EMAIL_PASSWORD_PROVIDER"===O){if(null===(P=T._getRecaptchaConfig())||void 0===P||!P.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return N(T,S).catch(async O=>{if("auth/missing-recaptcha-token"!==O.code)return Promise.reject(O);{let O=await th(T,S,R,"getOobCode"===R);return N(T,O)}});{let O=await th(T,S,R,"getOobCode"===R);return N(T,O)}}if("PHONE_PROVIDER"!==O)return Promise.reject(O+" provider is not supported.");if(null===(M=T._getRecaptchaConfig())||void 0===M?void 0:M.isProviderEnabled("PHONE_PROVIDER")){let O=await th(T,S,R);return N(T,O).catch(async O=>{var P;if((null===(P=T._getRecaptchaConfig())||void 0===P?void 0:P.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===O.code||"auth/invalid-app-credential"===O.code)){let O=await th(T,S,R,!1,!0);return N(T,O)}return Promise.reject(O)})}{let O=await th(T,S,R,!1,!0);return N(T,O)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tf(T,S){let R=(0,N.qX)(T,"auth");if(R.isInitialized()){let T=R.getImmediate(),N=R.getOptions();if((0,O.vZ)(N,null!=S?S:{}))return T;Y(T,"already-initialized")}return R.initialize({options:S})}function tm(T,S){let R=(null==S?void 0:S.persistence)||[],N=(Array.isArray(R)?R:[R]).map(eW);(null==S?void 0:S.errorMap)&&T._updateErrorMap(S.errorMap),T._initializeWithPersistence(N,null==S?void 0:S.popupRedirectResolver)}function tg(T,S,R){let N=ti(T);er(/^https?:\/\//.test(S),N,"invalid-emulator-scheme");let P=!!(null==R?void 0:R.disableWarnings),M=ty(S),{host:L,port:U}=tv(S),V=null===U?"":`:${U}`,$={url:`${M}//${L}${V}/`},K=Object.freeze({host:L,port:U,protocol:M.replace(":",""),options:Object.freeze({disableWarnings:P})});if(!N._canInitEmulator){er(N.config.emulator&&N.emulatorConfig,N,"emulator-config-failed"),er((0,O.vZ)($,N.config.emulator)&&(0,O.vZ)(K,N.emulatorConfig),N,"emulator-config-failed");return}N.config.emulator=$,N.emulatorConfig=K,N.settings.appVerificationDisabledForTesting=!0,(0,O.Xx)(L)&&((0,O.Uo)(`${M}//${L}${V}`),(0,O.dp)("Auth",!0))}function ty(T){let S=T.indexOf(":");return S<0?"":T.substr(0,S+1)}function tv(T){let S=ty(T),R=/(\/\/)?([^?#/]+)/.exec(T.substr(S.length));if(!R)return{host:"",port:null};let N=R[2].split("@").pop()||"",O=/^(\[[^\]]+\])(:|$)/.exec(N);if(O){let T=O[1];return{host:T,port:tb(N.substr(T.length+1))}}{let[T,S]=N.split(":");return{host:T,port:tb(S)}}}function tb(T){if(!T)return null;let S=Number(T);return isNaN(S)?null:S}function tT(){}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(T,S){this.providerId=T,this.signInMethod=S}toJSON(){return en("not implemented")}_getIdTokenResponse(T){return en("not implemented")}_linkToIdToken(T,S){return en("not implemented")}_getReauthenticationResolver(T){return en("not implemented")}}async function tE(T,S){return ey(T,"POST","/v1/accounts:signUp",S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t_(T,S){return eb(T,"POST","/v1/accounts:signInWithPassword",eg(T,S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tw(T,S){return eb(T,"POST","/v1/accounts:signInWithEmailLink",eg(T,S))}async function tC(T,S){return eb(T,"POST","/v1/accounts:signInWithEmailLink",eg(T,S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI extends tS{constructor(T,S,R,N=null){super("password",R),this._email=T,this._password=S,this._tenantId=N}static _fromEmailAndPassword(T,S){return new tI(T,S,"password")}static _fromEmailAndCode(T,S,R=null){return new tI(T,S,"emailLink",R)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(T){let S="string"==typeof T?JSON.parse(T):T;if((null==S?void 0:S.email)&&(null==S?void 0:S.password)){if("password"===S.signInMethod)return this._fromEmailAndPassword(S.email,S.password);if("emailLink"===S.signInMethod)return this._fromEmailAndCode(S.email,S.password,S.tenantId)}return null}async _getIdTokenResponse(T){switch(this.signInMethod){case"password":return tp(T,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",t_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tw(T,{email:this._email,oobCode:this._password});default:Y(T,"internal-error")}}async _linkToIdToken(T,S){switch(this.signInMethod){case"password":return tp(T,{idToken:S,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",tE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tC(T,{idToken:S,email:this._email,oobCode:this._password});default:Y(T,"internal-error")}}_getReauthenticationResolver(T){return this._getIdTokenResponse(T)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(T,S){return eb(T,"POST","/v1/accounts:signInWithIdp",eg(T,S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tk="http://localhost";class tN extends tS{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(T){let S=new tN(T.providerId,T.signInMethod);return T.idToken||T.accessToken?(T.idToken&&(S.idToken=T.idToken),T.accessToken&&(S.accessToken=T.accessToken),T.nonce&&!T.pendingToken&&(S.nonce=T.nonce),T.pendingToken&&(S.pendingToken=T.pendingToken)):T.oauthToken&&T.oauthTokenSecret?(S.accessToken=T.oauthToken,S.secret=T.oauthTokenSecret):Y("argument-error"),S}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(T){let S="string"==typeof T?JSON.parse(T):T,{providerId:R,signInMethod:N}=S,O=P(S,["providerId","signInMethod"]);if(!R||!N)return null;let M=new tN(R,N);return M.idToken=O.idToken||void 0,M.accessToken=O.accessToken||void 0,M.secret=O.secret,M.nonce=O.nonce,M.pendingToken=O.pendingToken||null,M}_getIdTokenResponse(T){return tR(T,this.buildRequest())}_linkToIdToken(T,S){let R=this.buildRequest();return R.idToken=S,tR(T,R)}_getReauthenticationResolver(T){let S=this.buildRequest();return S.autoCreate=!1,tR(T,S)}buildRequest(){let T={requestUri:tk,returnSecureToken:!0};if(this.pendingToken)T.pendingToken=this.pendingToken;else{let S={};this.idToken&&(S.id_token=this.idToken),this.accessToken&&(S.access_token=this.accessToken),this.secret&&(S.oauth_token_secret=this.secret),S.providerId=this.providerId,this.nonce&&!this.pendingToken&&(S.nonce=this.nonce),T.postBody=(0,O.xO)(S)}return T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tA(T){switch(T){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tD(T){let S=(0,O.zd)((0,O.pd)(T)).link,R=S?(0,O.zd)((0,O.pd)(S)).deep_link_id:null,N=(0,O.zd)((0,O.pd)(T)).deep_link_id;return(N?(0,O.zd)((0,O.pd)(N)).link:null)||N||R||S||T}class tO{constructor(T){var S,R,N,P,M,L;let U=(0,O.zd)((0,O.pd)(T)),V=null!==(S=U.apiKey)&&void 0!==S?S:null,$=null!==(R=U.oobCode)&&void 0!==R?R:null,K=tA(null!==(N=U.mode)&&void 0!==N?N:null);er(V&&$&&K,"argument-error"),this.apiKey=V,this.operation=K,this.code=$,this.continueUrl=null!==(P=U.continueUrl)&&void 0!==P?P:null,this.languageCode=null!==(M=U.lang)&&void 0!==M?M:null,this.tenantId=null!==(L=U.tenantId)&&void 0!==L?L:null}static parseLink(T){let S=tD(T);try{return new tO(S)}catch(T){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(){this.providerId=tP.PROVIDER_ID}static credential(T,S){return tI._fromEmailAndPassword(T,S)}static credentialWithLink(T,S){let R=tO.parseLink(S);return er(R,"argument-error"),tI._fromEmailAndCode(T,R.code,R.tenantId)}}tP.PROVIDER_ID="password",tP.EMAIL_PASSWORD_SIGN_IN_METHOD="password",tP.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(T){this.providerId=T,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(T){this.defaultLanguageCode=T}setCustomParameters(T){return this.customParameters=T,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tL extends tM{constructor(){super(...arguments),this.scopes=[]}addScope(T){return this.scopes.includes(T)||this.scopes.push(T),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tF extends tL{constructor(){super("facebook.com")}static credential(T){return tN._fromParams({providerId:tF.PROVIDER_ID,signInMethod:tF.FACEBOOK_SIGN_IN_METHOD,accessToken:T})}static credentialFromResult(T){return tF.credentialFromTaggedObject(T)}static credentialFromError(T){return tF.credentialFromTaggedObject(T.customData||{})}static credentialFromTaggedObject({_tokenResponse:T}){if(!T||!("oauthAccessToken"in T)||!T.oauthAccessToken)return null;try{return tF.credential(T.oauthAccessToken)}catch(T){return null}}}tF.FACEBOOK_SIGN_IN_METHOD="facebook.com",tF.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tB extends tL{constructor(){super("google.com"),this.addScope("profile")}static credential(T,S){return tN._fromParams({providerId:tB.PROVIDER_ID,signInMethod:tB.GOOGLE_SIGN_IN_METHOD,idToken:T,accessToken:S})}static credentialFromResult(T){return tB.credentialFromTaggedObject(T)}static credentialFromError(T){return tB.credentialFromTaggedObject(T.customData||{})}static credentialFromTaggedObject({_tokenResponse:T}){if(!T)return null;let{oauthIdToken:S,oauthAccessToken:R}=T;if(!S&&!R)return null;try{return tB.credential(S,R)}catch(T){return null}}}tB.GOOGLE_SIGN_IN_METHOD="google.com",tB.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tU extends tL{constructor(){super("github.com")}static credential(T){return tN._fromParams({providerId:tU.PROVIDER_ID,signInMethod:tU.GITHUB_SIGN_IN_METHOD,accessToken:T})}static credentialFromResult(T){return tU.credentialFromTaggedObject(T)}static credentialFromError(T){return tU.credentialFromTaggedObject(T.customData||{})}static credentialFromTaggedObject({_tokenResponse:T}){if(!T||!("oauthAccessToken"in T)||!T.oauthAccessToken)return null;try{return tU.credential(T.oauthAccessToken)}catch(T){return null}}}tU.GITHUB_SIGN_IN_METHOD="github.com",tU.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV extends tL{constructor(){super("twitter.com")}static credential(T,S){return tN._fromParams({providerId:tV.PROVIDER_ID,signInMethod:tV.TWITTER_SIGN_IN_METHOD,oauthToken:T,oauthTokenSecret:S})}static credentialFromResult(T){return tV.credentialFromTaggedObject(T)}static credentialFromError(T){return tV.credentialFromTaggedObject(T.customData||{})}static credentialFromTaggedObject({_tokenResponse:T}){if(!T)return null;let{oauthAccessToken:S,oauthTokenSecret:R}=T;if(!S||!R)return null;try{return tV.credential(S,R)}catch(T){return null}}}tV.TWITTER_SIGN_IN_METHOD="twitter.com",tV.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(T){this.user=T.user,this.providerId=T.providerId,this._tokenResponse=T._tokenResponse,this.operationType=T.operationType}static async _fromIdTokenResponse(T,S,R,N=!1){return new tj({user:await eK._fromIdTokenResponse(T,R,N),providerId:tz(R),_tokenResponse:R,operationType:S})}static async _forOperation(T,S,R){return await T._updateTokensIfNecessary(R,!0),new tj({user:T,providerId:tz(R),_tokenResponse:R,operationType:S})}}function tz(T){return T.providerId?T.providerId:"phoneNumber"in T?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tq extends null{constructor(T,S,R,N){var O;super(S.code,S.message),this.operationType=R,this.user=N,Object.setPrototypeOf(this,tq.prototype),this.customData={appName:T.name,tenantId:null!==(O=T.tenantId)&&void 0!==O?O:void 0,_serverResponse:S.customData._serverResponse,operationType:R}}static _fromErrorAndOperation(T,S,R,N){return new tq(T,S,R,N)}}function tG(T,S,R,N){return("reauthenticate"===S?R._getReauthenticationResolver(T):R._getIdTokenResponse(T)).catch(R=>{if("auth/multi-factor-auth-required"===R.code)throw tq._fromErrorAndOperation(T,R,S,N);throw R})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(T,S){this.factorId=T,this.uid=S.mfaEnrollmentId,this.enrollmentTime=new Date(S.enrolledAt).toUTCString(),this.displayName=S.displayName}static _fromServerResponse(T,S){return"phoneInfo"in S?tK._fromServerResponse(T,S):"totpInfo"in S?tH._fromServerResponse(T,S):Y(T,"internal-error")}}class tK extends null{constructor(T){super("phone",T),this.phoneNumber=T.phoneInfo}static _fromServerResponse(T,S){return new tK(S)}}class tH extends null{constructor(T){super("totp",T)}static _fromServerResponse(T,S){return new tH(S)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tW{constructor(T,S,R){this.type=T,this.credential=S,this.user=R}static _fromIdtoken(T,S){return new tW("enroll",T,S)}static _fromMfaPendingCredential(T){return new tW("signin",T)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(T){var S,R;if(null==T?void 0:T.multiFactorSession){if(null===(S=T.multiFactorSession)||void 0===S?void 0:S.pendingCredential)return tW._fromMfaPendingCredential(T.multiFactorSession.pendingCredential);if(null===(R=T.multiFactorSession)||void 0===R?void 0:R.idToken)return tW._fromIdtoken(T.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tQ{constructor(T,S,R){this.session=T,this.hints=S,this.signInResolver=R}static _fromError(T,S){let R=ti(T),N=S.customData._serverResponse,O=(N.mfaInfo||[]).map(T=>t$._fromServerResponse(R,T));er(N.mfaPendingCredential,R,"internal-error");let P=tW._fromMfaPendingCredential(N.mfaPendingCredential);return new tQ(P,O,async T=>{let O=await T._process(R,P);delete N.mfaInfo,delete N.mfaPendingCredential;let M=Object.assign(Object.assign({},N),{idToken:O.idToken,refreshToken:O.refreshToken});switch(S.operationType){case"signIn":let L=await tj._fromIdTokenResponse(R,S.operationType,M);return await R._updateCurrentUser(L.user),L;case"reauthenticate":return er(S.user,R,"internal-error"),tj._forOperation(S.user,S.operationType,M);default:Y(R,"internal-error")}})}async resolveSignIn(T){let S=T;return this.signInResolver(S)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tY(T,S){return ey(T,"POST","/v2/accounts/mfaEnrollment:start",eg(T,S))}function tJ(T,S){return ey(T,"POST","/v2/accounts/mfaEnrollment:finalize",eg(T,S))}function tX(T,S){return ey(T,"POST","/v2/accounts/mfaEnrollment:withdraw",eg(T,S))}class tZ{constructor(T){this.user=T,this.enrolledFactors=[],T._onReload(S=>{S.mfaInfo&&(this.enrolledFactors=S.mfaInfo.map(S=>t$._fromServerResponse(T.auth,S)))})}static _fromUser(T){return new tZ(T)}async getSession(){return tW._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(T,S){let R=T,N=await this.getSession(),O=await eP(this.user,R._process(this.user.auth,N,S));return await this.user._updateTokensIfNecessary(O),this.user.reload()}async unenroll(T){let S="string"==typeof T?T:T.uid,R=await this.user.getIdToken();try{let T=await eP(this.user,tX(this.user.auth,{idToken:R,mfaEnrollmentId:S}));this.enrolledFactors=this.enrolledFactors.filter(({uid:T})=>T!==S),await this.user._updateTokensIfNecessary(T),await this.user.reload()}catch(T){throw T}}}new WeakMap;var t0="@firebase/auth",t1="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(T){this.auth=T,this.internalListeners=new Map}getUid(){var T;return this.assertAuthConfigured(),(null===(T=this.auth.currentUser)||void 0===T?void 0:T.uid)||null}async getToken(T){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(T)}:null}addAuthTokenListener(T){if(this.assertAuthConfigured(),this.internalListeners.has(T))return;let S=this.auth.onIdTokenChanged(S=>{T((null==S?void 0:S.stsTokenManager.accessToken)||null)});this.internalListeners.set(T,S),this.updateProactiveRefresh()}removeAuthTokenListener(T){this.assertAuthConfigured();let S=this.internalListeners.get(T);S&&(this.internalListeners.delete(T),S(),this.updateProactiveRefresh())}assertAuthConfigured(){er(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t3(T){switch(T){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function t4(T){(0,N.Xd)(new M.wA("auth",(S,{options:R})=>{let N=S.getProvider("app").getImmediate(),O=S.getProvider("heartbeat"),P=S.getProvider("app-check-internal"),{apiKey:M,authDomain:L}=N.options;er(M&&!M.includes(":"),"invalid-api-key",{appName:N.name});let U=new tr(N,O,P,{apiKey:M,authDomain:L,clientPlatform:T,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:e5(T)});return tm(U,R),U},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((T,S,R)=>{T.getProvider("auth-internal").initialize()})),(0,N.Xd)(new M.wA("auth-internal",T=>new t2(ti(T.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,N.KN)(t0,t1,t3(T)),(0,N.KN)(t0,t1,"esm2017")}function t6(T=(0,N.Mq)()){let S=(0,N.qX)(T,"auth");if(S.isInitialized())return S.getImmediate();let R=tf(T),P=(0,O.q4)("auth");return P&&tg(R,`http://${P}`),R}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */eh.initialize(fetch,Headers,Response),t4("Node");let t9=X("operation-not-supported-in-this-environment");async function t5(){throw t9}class t8{constructor(){throw t9}}let t7=t5,rt=t8;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(T,S){return ey(T,"POST","/v2/accounts/mfaSignIn:finalize",eg(T,S))}tr.prototype.setPersistence=async()=>{};class rn{constructor(T){this.factorId=T}_process(T,S,R){switch(S.type){case"enroll":return this._finalizeEnroll(T,S.credential,R);case"signin":return this._finalizeSignIn(T,S.credential);default:return en("unexpected MultiFactorSessionType")}}}class ri{static assertionForEnrollment(T,S){return rs._fromSecret(T,S)}static assertionForSignIn(T,S){return rs._fromEnrollmentId(T,S)}static async generateSecret(T){var S;let R=T;er(void 0!==(null===(S=R.user)||void 0===S?void 0:S.auth),"internal-error");let N=await tY(R.user.auth,{idToken:R.credential,totpEnrollmentInfo:{}});return ra._fromStartTotpMfaEnrollmentResponse(N,R.user.auth)}}ri.FACTOR_ID="totp";class rs extends rn{constructor(T,S,R){super("totp"),this.otp=T,this.enrollmentId=S,this.secret=R}static _fromSecret(T,S){return new rs(S,void 0,T)}static _fromEnrollmentId(T,S){return new rs(S,T)}async _finalizeEnroll(T,S,R){return er(void 0!==this.secret,T,"argument-error"),tJ(T,{idToken:S,displayName:R,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(T,S){er(void 0!==this.enrollmentId&&void 0!==this.otp,T,"argument-error");let R={verificationCode:this.otp};return rr(T,{mfaPendingCredential:S,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:R})}}class ra{constructor(T,S,R,N,O,P,M){this.sessionInfo=P,this.auth=M,this.secretKey=T,this.hashingAlgorithm=S,this.codeLength=R,this.codeIntervalSeconds=N,this.enrollmentCompletionDeadline=O}static _fromStartTotpMfaEnrollmentResponse(T,S){return new ra(T.totpSessionInfo.sharedSecretKey,T.totpSessionInfo.hashingAlgorithm,T.totpSessionInfo.verificationCodeLength,T.totpSessionInfo.periodSec,new Date(T.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),T.totpSessionInfo.sessionInfo,S)}_makeTotpVerificationInfo(T){return{sessionInfo:this.sessionInfo,verificationCode:T}}generateQrCodeUrl(T,S){var R;let N=!1;return(ro(T)||ro(S))&&(N=!0),N&&(ro(T)&&(T=(null===(R=this.auth.currentUser)||void 0===R?void 0:R.email)||"unknownuser"),ro(S)&&(S=this.auth.name)),`otpauth://totp/${S}:${T}?secret=${this.secretKey}&issuer=${S}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ro(T){return void 0===T||(null==T?void 0:T.length)===0}},87097:(T,S,R)=>{"use strict";R.d(S,{ET:()=>yl,hJ:()=>mB,oe:()=>yo,JU:()=>mU,QT:()=>yn,PL:()=>ys,ad:()=>m$,nP:()=>ym,b9:()=>gM,cf:()=>yu,Xo:()=>gx,IO:()=>gk,r7:()=>ya,ar:()=>gA,qs:()=>yg});var N,O,P,M,L=R(95285),U=R(47059),V=R(71954),$=R(73837),K=R(61006),W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Q={};(function(){function T(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function S(T,S,R){R||(R=0);var N=Array(16);if("string"==typeof S)for(var O=0;16>O;++O)N[O]=S.charCodeAt(R++)|S.charCodeAt(R++)<<8|S.charCodeAt(R++)<<16|S.charCodeAt(R++)<<24;else for(O=0;16>O;++O)N[O]=S[R++]|S[R++]<<8|S[R++]<<16|S[R++]<<24;S=T.g[0],R=T.g[1],O=T.g[2];var P=T.g[3],M=S+(P^R&(O^P))+N[0]+3614090360&4294967295;M=P+(O^(S=R+(M<<7&4294967295|M>>>25))&(R^O))+N[1]+3905402710&4294967295,M=O+(R^(P=S+(M<<12&4294967295|M>>>20))&(S^R))+N[2]+606105819&4294967295,M=R+(S^(O=P+(M<<17&4294967295|M>>>15))&(P^S))+N[3]+3250441966&4294967295,M=S+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[4]+4118548399&4294967295,M=P+(O^(S=R+(M<<7&4294967295|M>>>25))&(R^O))+N[5]+1200080426&4294967295,M=O+(R^(P=S+(M<<12&4294967295|M>>>20))&(S^R))+N[6]+2821735955&4294967295,M=R+(S^(O=P+(M<<17&4294967295|M>>>15))&(P^S))+N[7]+4249261313&4294967295,M=S+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[8]+1770035416&4294967295,M=P+(O^(S=R+(M<<7&4294967295|M>>>25))&(R^O))+N[9]+2336552879&4294967295,M=O+(R^(P=S+(M<<12&4294967295|M>>>20))&(S^R))+N[10]+4294925233&4294967295,M=R+(S^(O=P+(M<<17&4294967295|M>>>15))&(P^S))+N[11]+2304563134&4294967295,M=S+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[12]+1804603682&4294967295,M=P+(O^(S=R+(M<<7&4294967295|M>>>25))&(R^O))+N[13]+4254626195&4294967295,M=O+(R^(P=S+(M<<12&4294967295|M>>>20))&(S^R))+N[14]+2792965006&4294967295,M=R+(S^(O=P+(M<<17&4294967295|M>>>15))&(P^S))+N[15]+1236535329&4294967295,R=O+(M<<22&4294967295|M>>>10),M=S+(O^P&(R^O))+N[1]+4129170786&4294967295,S=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(S^R))+N[6]+3225465664&4294967295,P=S+(M<<9&4294967295|M>>>23),M=O+(S^R&(P^S))+N[11]+643717713&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^S&(O^P))+N[0]+3921069994&4294967295,R=O+(M<<20&4294967295|M>>>12),M=S+(O^P&(R^O))+N[5]+3593408605&4294967295,S=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(S^R))+N[10]+38016083&4294967295,P=S+(M<<9&4294967295|M>>>23),M=O+(S^R&(P^S))+N[15]+3634488961&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^S&(O^P))+N[4]+3889429448&4294967295,R=O+(M<<20&4294967295|M>>>12),M=S+(O^P&(R^O))+N[9]+568446438&4294967295,S=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(S^R))+N[14]+3275163606&4294967295,P=S+(M<<9&4294967295|M>>>23),M=O+(S^R&(P^S))+N[3]+4107603335&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^S&(O^P))+N[8]+1163531501&4294967295,R=O+(M<<20&4294967295|M>>>12),M=S+(O^P&(R^O))+N[13]+2850285829&4294967295,S=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(S^R))+N[2]+4243563512&4294967295,P=S+(M<<9&4294967295|M>>>23),M=O+(S^R&(P^S))+N[7]+1735328473&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^S&(O^P))+N[12]+2368359562&4294967295,M=S+((R=O+(M<<20&4294967295|M>>>12))^O^P)+N[5]+4294588738&4294967295,M=P+((S=R+(M<<4&4294967295|M>>>28))^R^O)+N[8]+2272392833&4294967295,M=O+((P=S+(M<<11&4294967295|M>>>21))^S^R)+N[11]+1839030562&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^S)+N[14]+4259657740&4294967295,M=S+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[1]+2763975236&4294967295,M=P+((S=R+(M<<4&4294967295|M>>>28))^R^O)+N[4]+1272893353&4294967295,M=O+((P=S+(M<<11&4294967295|M>>>21))^S^R)+N[7]+4139469664&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^S)+N[10]+3200236656&4294967295,M=S+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[13]+681279174&4294967295,M=P+((S=R+(M<<4&4294967295|M>>>28))^R^O)+N[0]+3936430074&4294967295,M=O+((P=S+(M<<11&4294967295|M>>>21))^S^R)+N[3]+3572445317&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^S)+N[6]+76029189&4294967295,M=S+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[9]+3654602809&4294967295,M=P+((S=R+(M<<4&4294967295|M>>>28))^R^O)+N[12]+3873151461&4294967295,M=O+((P=S+(M<<11&4294967295|M>>>21))^S^R)+N[15]+530742520&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^S)+N[2]+3299628645&4294967295,R=O+(M<<23&4294967295|M>>>9),M=S+(O^(R|~P))+N[0]+4096336452&4294967295,S=R+(M<<6&4294967295|M>>>26),M=P+(R^(S|~O))+N[7]+1126891415&4294967295,P=S+(M<<10&4294967295|M>>>22),M=O+(S^(P|~R))+N[14]+2878612391&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~S))+N[5]+4237533241&4294967295,R=O+(M<<21&4294967295|M>>>11),M=S+(O^(R|~P))+N[12]+1700485571&4294967295,S=R+(M<<6&4294967295|M>>>26),M=P+(R^(S|~O))+N[3]+2399980690&4294967295,P=S+(M<<10&4294967295|M>>>22),M=O+(S^(P|~R))+N[10]+4293915773&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~S))+N[1]+2240044497&4294967295,R=O+(M<<21&4294967295|M>>>11),M=S+(O^(R|~P))+N[8]+1873313359&4294967295,S=R+(M<<6&4294967295|M>>>26),M=P+(R^(S|~O))+N[15]+4264355552&4294967295,P=S+(M<<10&4294967295|M>>>22),M=O+(S^(P|~R))+N[6]+2734768916&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~S))+N[13]+1309151649&4294967295,R=O+(M<<21&4294967295|M>>>11),M=S+(O^(R|~P))+N[4]+4149444226&4294967295,S=R+(M<<6&4294967295|M>>>26),M=P+(R^(S|~O))+N[11]+3174756917&4294967295,P=S+(M<<10&4294967295|M>>>22),M=O+(S^(P|~R))+N[2]+718787259&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~S))+N[9]+3951481745&4294967295,T.g[0]=T.g[0]+S&4294967295,T.g[1]=T.g[1]+(O+(M<<21&4294967295|M>>>11))&4294967295,T.g[2]=T.g[2]+O&4294967295,T.g[3]=T.g[3]+P&4294967295}function R(T,S){var R=L;return Object.prototype.hasOwnProperty.call(R,T)?R[T]:R[T]=S(T)}function P(T,S){this.h=S;for(var R=[],N=!0,O=T.length-1;0<=O;O--){var P=0|T[O];N&&P==S||(R[O]=P,N=!1)}this.g=R}(function(T,S){function R(){}R.prototype=S.prototype,T.D=S.prototype,T.prototype=new R,T.prototype.constructor=T,T.C=function(T,R,N){for(var O=Array(arguments.length-2),P=2;P<arguments.length;P++)O[P-2]=arguments[P];return S.prototype[R].apply(T,O)}})(T,function(){this.blockSize=-1}),T.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},T.prototype.u=function(T,R){void 0===R&&(R=T.length);for(var N=R-this.blockSize,O=this.B,P=this.h,M=0;M<R;){if(0==P)for(;M<=N;)S(this,T,M),M+=this.blockSize;if("string"==typeof T){for(;M<R;)if(O[P++]=T.charCodeAt(M++),P==this.blockSize){S(this,O),P=0;break}}else for(;M<R;)if(O[P++]=T[M++],P==this.blockSize){S(this,O),P=0;break}}this.h=P,this.o+=R},T.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var S=1;S<T.length-8;++S)T[S]=0;var R=8*this.o;for(S=T.length-8;S<T.length;++S)T[S]=255&R,R/=256;for(this.u(T),T=Array(16),S=R=0;4>S;++S)for(var N=0;32>N;N+=8)T[R++]=this.g[S]>>>N&255;return T};var M,L={};function U(T){return -128<=T&&128>T?R(T,function(T){return new P([0|T],0>T?-1:0)}):new P([0|T],0>T?-1:0)}function V(T){if(isNaN(T)||!isFinite(T))return K;if(0>T)return ee(V(-T));for(var S=[],R=1,N=0;T>=R;N++)S[N]=T/R|0,R*=4294967296;return new P(S,0)}function $(T,S){if(0==T.length)throw Error("number format error: empty string");if(2>(S=S||10)||36<S)throw Error("radix out of range: "+S);if("-"==T.charAt(0))return ee($(T.substring(1),S));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=V(Math.pow(S,8)),N=K,O=0;O<T.length;O+=8){var P=Math.min(8,T.length-O),M=parseInt(T.substring(O,O+P),S);8>P?(P=V(Math.pow(S,P)),N=N.j(P).add(V(M))):N=(N=N.j(R)).add(V(M))}return N}var K=U(0),W=U(1),Y=U(16777216);function X(T){if(0!=T.h)return!1;for(var S=0;S<T.g.length;S++)if(0!=T.g[S])return!1;return!0}function Z(T){return -1==T.h}function ee(T){for(var S=T.g.length,R=[],N=0;N<S;N++)R[N]=~T.g[N];return new P(R,~T.h).add(W)}function et(T,S){return T.add(ee(S))}function er(T,S){for(;(65535&T[S])!=T[S];)T[S+1]+=T[S]>>>16,T[S]&=65535,S++}function en(T,S){this.g=T,this.h=S}function ei(T,S){if(X(S))throw Error("division by zero");if(X(T))return new en(K,K);if(Z(T))return S=ei(ee(T),S),new en(ee(S.g),ee(S.h));if(Z(S))return S=ei(T,ee(S)),new en(ee(S.g),S.h);if(30<T.g.length){if(Z(T)||Z(S))throw Error("slowDivide_ only works with positive integers.");for(var R=W,N=S;0>=N.l(T);)R=es(R),N=es(N);var O=ea(R,1),P=ea(N,1);for(N=ea(N,2),R=ea(R,2);!X(N);){var M=P.add(N);0>=M.l(T)&&(O=O.add(R),P=M),N=ea(N,1),R=ea(R,1)}return S=et(T,O.j(S)),new en(O,S)}for(O=K;0<=T.l(S);){for(N=48>=(N=Math.ceil(Math.log(R=Math.max(1,Math.floor(T.m()/S.m())))/Math.LN2))?1:Math.pow(2,N-48),M=(P=V(R)).j(S);Z(M)||0<M.l(T);)R-=N,M=(P=V(R)).j(S);X(P)&&(P=W),O=O.add(P),T=et(T,M)}return new en(O,T)}function es(T){for(var S=T.g.length+1,R=[],N=0;N<S;N++)R[N]=T.i(N)<<1|T.i(N-1)>>>31;return new P(R,T.h)}function ea(T,S){var R=S>>5;S%=32;for(var N=T.g.length-R,O=[],M=0;M<N;M++)O[M]=0<S?T.i(M+R)>>>S|T.i(M+R+1)<<32-S:T.i(M+R);return new P(O,T.h)}(M=P.prototype).m=function(){if(Z(this))return-ee(this).m();for(var T=0,S=1,R=0;R<this.g.length;R++){var N=this.i(R);T+=(0<=N?N:4294967296+N)*S,S*=4294967296}return T},M.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(X(this))return"0";if(Z(this))return"-"+ee(this).toString(T);for(var S=V(Math.pow(T,6)),R=this,N="";;){var O=ei(R,S).g,P=((0<(R=et(R,O.j(S))).g.length?R.g[0]:R.h)>>>0).toString(T);if(X(R=O))return P+N;for(;6>P.length;)P="0"+P;N=P+N}},M.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},M.l=function(T){return Z(T=et(this,T))?-1:X(T)?0:1},M.abs=function(){return Z(this)?ee(this):this},M.add=function(T){for(var S=Math.max(this.g.length,T.g.length),R=[],N=0,O=0;O<=S;O++){var M=N+(65535&this.i(O))+(65535&T.i(O)),L=(M>>>16)+(this.i(O)>>>16)+(T.i(O)>>>16);N=L>>>16,M&=65535,L&=65535,R[O]=L<<16|M}return new P(R,-2147483648&R[R.length-1]?-1:0)},M.j=function(T){if(X(this)||X(T))return K;if(Z(this))return Z(T)?ee(this).j(ee(T)):ee(ee(this).j(T));if(Z(T))return ee(this.j(ee(T)));if(0>this.l(Y)&&0>T.l(Y))return V(this.m()*T.m());for(var S=this.g.length+T.g.length,R=[],N=0;N<2*S;N++)R[N]=0;for(N=0;N<this.g.length;N++)for(var O=0;O<T.g.length;O++){var M=this.i(N)>>>16,L=65535&this.i(N),U=T.i(O)>>>16,$=65535&T.i(O);R[2*N+2*O]+=L*$,er(R,2*N+2*O),R[2*N+2*O+1]+=M*$,er(R,2*N+2*O+1),R[2*N+2*O+1]+=L*U,er(R,2*N+2*O+1),R[2*N+2*O+2]+=M*U,er(R,2*N+2*O+2)}for(N=0;N<S;N++)R[N]=R[2*N+1]<<16|R[2*N];for(N=S;N<2*S;N++)R[N]=0;return new P(R,0)},M.A=function(T){return ei(this,T).h},M.and=function(T){for(var S=Math.max(this.g.length,T.g.length),R=[],N=0;N<S;N++)R[N]=this.i(N)&T.i(N);return new P(R,this.h&T.h)},M.or=function(T){for(var S=Math.max(this.g.length,T.g.length),R=[],N=0;N<S;N++)R[N]=this.i(N)|T.i(N);return new P(R,this.h|T.h)},M.xor=function(T){for(var S=Math.max(this.g.length,T.g.length),R=[],N=0;N<S;N++)R[N]=this.i(N)^T.i(N);return new P(R,this.h^T.h)},T.prototype.digest=T.prototype.v,T.prototype.reset=T.prototype.s,T.prototype.update=T.prototype.u,O=Q.Md5=T,P.prototype.add=P.prototype.add,P.prototype.multiply=P.prototype.j,P.prototype.modulo=P.prototype.A,P.prototype.compare=P.prototype.l,P.prototype.toNumber=P.prototype.m,P.prototype.toString=P.prototype.toString,P.prototype.getBits=P.prototype.i,P.fromNumber=V,P.fromString=$,N=Q.Integer=P}).apply(void 0!==W?W:"undefined"!=typeof self?self:{});var Y=R(6113),X=R(22165),Z=R(58715);let ee="@firebase/firestore",et="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(T){this.uid=T}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(T){return T.uid===this.uid}}er.UNAUTHENTICATED=new er(null),er.GOOGLE_CREDENTIALS=new er("google-credentials-uid"),er.FIRST_PARTY=new er("first-party-uid"),er.MOCK_USER=new er("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let en="11.10.0";function ei(T){en=T}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(T){return(0,$.inspect)(T,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ea=new V.Yd("@firebase/firestore");function eo(){return ea.logLevel}function eu(T,...S){if(ea.logLevel<=V.in.DEBUG){let R=S.map(eh);ea.debug(`Firestore (${en}): ${T}`,...R)}}function ec(T,...S){if(ea.logLevel<=V.in.ERROR){let R=S.map(eh);ea.error(`Firestore (${en}): ${T}`,...R)}}function ed(T,...S){if(ea.logLevel<=V.in.WARN){let R=S.map(eh);ea.warn(`Firestore (${en}): ${T}`,...R)}}function eh(T){if("string"==typeof T)return T;try{return es(T)}catch(S){return T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ep(T,S,R){let N="Unexpected state";"string"==typeof S?N=S:R=S,ef(T,N,R)}function ef(T,S,R){let N=`FIRESTORE (${en}) INTERNAL ASSERTION FAILED: ${S} (ID: ${T.toString(16)})`;if(void 0!==R)try{let T=JSON.stringify(R);N+=" CONTEXT: "+T}catch(T){N+=" CONTEXT: "+R}throw ec(N),Error(N)}function em(T,S,R,N){let O="Unexpected state";"string"==typeof R?O=R:N=R,T||ef(S,O,N)}function eg(T,S){return T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ey={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ev extends K.ZR{constructor(T,S){super(T,S),this.code=T,this.message=S,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(){this.promise=new Promise((T,S)=>{this.resolve=T,this.reject=S})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT{constructor(T,S){this.user=S,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${T}`)}}class eS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(T,S){T.enqueueRetryable(()=>S(er.UNAUTHENTICATED))}shutdown(){}}class eE{constructor(T){this.token=T,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(T,S){this.changeListener=S,T.enqueueRetryable(()=>S(this.token.user))}shutdown(){this.changeListener=null}}class e_{constructor(T){this.authProvider=T,this.currentUser=er.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(T,S){em(void 0===this.tokenListener,42304);let R=this.tokenCounter,N=T=>this.tokenCounter!==R?(R=this.tokenCounter,S(T)):Promise.resolve(),O=new eb;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),O.resolve(),O=new eb,T.enqueueRetryable(()=>N(this.currentUser))};let P=()=>{let S=O;T.enqueueRetryable(async()=>{await S.promise,await N(this.currentUser)})},M=T=>{eu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=T,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),P())};this.authProvider.onInit(T=>M(T)),setTimeout(()=>{if(!this.auth){let T=this.authProvider.getImmediate({optional:!0});T?M(T):(eu("FirebaseAuthCredentialsProvider","Auth not yet detected"),O.resolve(),O=new eb)}},0),P()}getToken(){let T=this.tokenCounter,S=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(S).then(S=>this.tokenCounter!==T?(eu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):S?(em("string"==typeof S.accessToken,31837,{tokenData:S}),new eT(S.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let T=this.auth&&this.auth.getUid();return em(null===T||"string"==typeof T,2055,{currentUid:T}),new er(T)}}class ew{constructor(T,S,R){this.sessionIndex=T,this.iamToken=S,this.authTokenFactory=R,this.type="FirstParty",this.user=er.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let T=this.getAuthToken();return T&&this._headers.set("Authorization",T),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class eC{constructor(T,S,R){this.sessionIndex=T,this.iamToken=S,this.authTokenFactory=R}getToken(){return Promise.resolve(new ew(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(T,S){T.enqueueRetryable(()=>S(er.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class eI{constructor(T){this.value=T,this.type="AppCheck",this.headers=new Map,T&&T.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class eR{constructor(T,S){this.appCheckProvider=S,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,L.rh)(T)&&T.settings.appCheckToken&&(this.serverAppAppCheckToken=T.settings.appCheckToken)}start(T,S){em(void 0===this.tokenListener,3512);let R=T=>{null!=T.error&&eu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${T.error.message}`);let R=T.token!==this.latestAppCheckToken;return this.latestAppCheckToken=T.token,eu("FirebaseAppCheckTokenProvider",`Received ${R?"new":"existing"} token.`),R?S(T.token):Promise.resolve()};this.tokenListener=S=>{T.enqueueRetryable(()=>R(S))};let N=T=>{eu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=T,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(T=>N(T)),setTimeout(()=>{if(!this.appCheck){let T=this.appCheckProvider.getImmediate({optional:!0});T?N(T):eu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new eI(this.serverAppAppCheckToken));let T=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(T).then(T=>T?(em("string"==typeof T.token,44558,{tokenResult:T}),this.latestAppCheckToken=T.token,new eI(T.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function ek(T){if(!T)return new eS;switch(T.type){case"firstParty":return new eC(T.sessionIndex||"0",T.iamToken||null,T.authTokenFactory||null);case"provider":return T.client;default:throw new ev(ey.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(T){return(0,Y.randomBytes)(T)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eA(){return new $.TextEncoder}function eD(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{static newId(){let T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",S=Math.floor(256/T.length)*T.length,R="",N=20;for(;R.length<N;){let O=eN(40);for(let P=0;P<O.length;++P)R.length<N&&O[P]<S&&(R+=T.charAt(O[P]%T.length))}return R}}function ex(T,S){return T<S?-1:T>S?1:0}function eP(T,S){let R=0;for(;R<T.length&&R<S.length;){let N=T.codePointAt(R),O=S.codePointAt(R);if(N!==O){if(N<128&&O<128)return ex(N,O);{let P=eA(),M=eL(P.encode(eM(T,R)),P.encode(eM(S,R)));if(0!==M)return M;return ex(N,O)}}R+=N>65535?2:1}return ex(T.length,S.length)}function eM(T,S){return T.codePointAt(S)>65535?T.substring(S,S+2):T.substring(S,S+1)}function eL(T,S){for(let R=0;R<T.length&&R<S.length;++R)if(T[R]!==S[R])return ex(T[R],S[R]);return ex(T.length,S.length)}function eF(T,S,R){return T.length===S.length&&T.every((T,N)=>R(T,S[N]))}function eB(T){return T+"\x00"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eU="__name__";class eV{constructor(T,S,R){void 0===S?S=0:S>T.length&&ep(637,{offset:S,range:T.length}),void 0===R?R=T.length-S:R>T.length-S&&ep(1746,{length:R,range:T.length-S}),this.segments=T,this.offset=S,this.len=R}get length(){return this.len}isEqual(T){return 0===eV.comparator(this,T)}child(T){let S=this.segments.slice(this.offset,this.limit());return T instanceof eV?T.forEach(T=>{S.push(T)}):S.push(T),this.construct(S)}limit(){return this.offset+this.length}popFirst(T){return T=void 0===T?1:T,this.construct(this.segments,this.offset+T,this.length-T)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(T){return this.segments[this.offset+T]}isEmpty(){return 0===this.length}isPrefixOf(T){if(T.length<this.length)return!1;for(let S=0;S<this.length;S++)if(this.get(S)!==T.get(S))return!1;return!0}isImmediateParentOf(T){if(this.length+1!==T.length)return!1;for(let S=0;S<this.length;S++)if(this.get(S)!==T.get(S))return!1;return!0}forEach(T){for(let S=this.offset,R=this.limit();S<R;S++)T(this.segments[S])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(T,S){let R=Math.min(T.length,S.length);for(let N=0;N<R;N++){let R=eV.compareSegments(T.get(N),S.get(N));if(0!==R)return R}return ex(T.length,S.length)}static compareSegments(T,S){let R=eV.isNumericId(T),N=eV.isNumericId(S);return R&&!N?-1:!R&&N?1:R&&N?eV.extractNumericId(T).compare(eV.extractNumericId(S)):eP(T,S)}static isNumericId(T){return T.startsWith("__id")&&T.endsWith("__")}static extractNumericId(T){return N.fromString(T.substring(4,T.length-2))}}class ej extends eV{construct(T,S,R){return new ej(T,S,R)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...T){let S=[];for(let R of T){if(R.indexOf("//")>=0)throw new ev(ey.INVALID_ARGUMENT,`Invalid segment (${R}). Paths must not contain // in them.`);S.push(...R.split("/").filter(T=>T.length>0))}return new ej(S)}static emptyPath(){return new ej([])}}let ez=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eq extends eV{construct(T,S,R){return new eq(T,S,R)}static isValidIdentifier(T){return ez.test(T)}canonicalString(){return this.toArray().map(T=>(T=T.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eq.isValidIdentifier(T)||(T="`"+T+"`"),T)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===eU}static keyField(){return new eq([eU])}static fromServerFormat(T){let S=[],R="",N=0,O=()=>{if(0===R.length)throw new ev(ey.INVALID_ARGUMENT,`Invalid field path (${T}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);S.push(R),R=""},P=!1;for(;N<T.length;){let S=T[N];if("\\"===S){if(N+1===T.length)throw new ev(ey.INVALID_ARGUMENT,"Path has trailing escape character: "+T);let S=T[N+1];if(!("\\"===S||"."===S||"`"===S))throw new ev(ey.INVALID_ARGUMENT,"Path has invalid escape sequence: "+T);R+=S,N+=2}else"`"===S?P=!P:"."!==S||P?R+=S:O(),N++}if(O(),P)throw new ev(ey.INVALID_ARGUMENT,"Unterminated ` in path: "+T);return new eq(S)}static emptyPath(){return new eq([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eG{constructor(T){this.path=T}static fromPath(T){return new eG(ej.fromString(T))}static fromName(T){return new eG(ej.fromString(T).popFirst(5))}static empty(){return new eG(ej.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(T){return this.path.length>=2&&this.path.get(this.path.length-2)===T}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(T){return null!==T&&0===ej.comparator(this.path,T.path)}toString(){return this.path.toString()}static comparator(T,S){return ej.comparator(T.path,S.path)}static isDocumentKey(T){return T.length%2==0}static fromSegments(T){return new eG(new ej(T.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e$(T,S,R){if(!R)throw new ev(ey.INVALID_ARGUMENT,`Function ${T}() cannot be called with an empty ${S}.`)}function eK(T,S,R,N){if(!0===S&&!0===N)throw new ev(ey.INVALID_ARGUMENT,`${T} and ${R} cannot be used together.`)}function eH(T){if(!eG.isDocumentKey(T))throw new ev(ey.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${T} has ${T.length}.`)}function eW(T){if(eG.isDocumentKey(T))throw new ev(ey.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${T} has ${T.length}.`)}function eQ(T){return"object"==typeof T&&null!==T&&(Object.getPrototypeOf(T)===Object.prototype||null===Object.getPrototypeOf(T))}function eY(T){if(void 0===T)return"undefined";if(null===T)return"null";if("string"==typeof T)return T.length>20&&(T=`${T.substring(0,20)}...`),JSON.stringify(T);if("number"==typeof T||"boolean"==typeof T)return""+T;if("object"==typeof T){if(T instanceof Array)return"an array";{let S=eJ(T);return S?`a custom ${S} object`:"an object"}}if("function"==typeof T)return"a function";return ep(12329,{type:typeof T})}function eJ(T){return T.constructor?T.constructor.name:null}function eX(T,S){if("_delegate"in T&&(T=T._delegate),!(T instanceof S)){if(S.name===T.constructor.name)throw new ev(ey.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let R=eY(T);throw new ev(ey.INVALID_ARGUMENT,`Expected type '${S.name}', but it was: ${R}`)}}return T}function eZ(T,S){if(S<=0)throw new ev(ey.INVALID_ARGUMENT,`Function ${T}() requires a positive number, but it was: ${S}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e0(T,S){let R={typeString:T};return S&&(R.value=S),R}function e1(T,S){let R;if(!eQ(T))throw new ev(ey.INVALID_ARGUMENT,"JSON must be an object");for(let N in S)if(S[N]){let O=S[N].typeString,P="value"in S[N]?{value:S[N].value}:void 0;if(!(N in T)){R=`JSON missing required field: '${N}'`;break}let M=T[N];if(O&&typeof M!==O){R=`JSON field '${N}' must be a ${O}.`;break}if(void 0!==P&&M!==P.value){R=`Expected '${N}' field to equal '${P.value}'`;break}}if(R)throw new ev(ey.INVALID_ARGUMENT,R);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e2=-62135596800,e3=1e6;class e4{static now(){return e4.fromMillis(Date.now())}static fromDate(T){return e4.fromMillis(T.getTime())}static fromMillis(T){let S=Math.floor(T/1e3),R=Math.floor((T-1e3*S)*e3);return new e4(S,R)}constructor(T,S){if(this.seconds=T,this.nanoseconds=S,S<0||S>=1e9)throw new ev(ey.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+S);if(T<e2||T>=253402300800)throw new ev(ey.INVALID_ARGUMENT,"Timestamp seconds out of range: "+T)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/e3}_compareTo(T){return this.seconds===T.seconds?ex(this.nanoseconds,T.nanoseconds):ex(this.seconds,T.seconds)}isEqual(T){return T.seconds===this.seconds&&T.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:e4._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(T){if(e1(T,e4._jsonSchema))return new e4(T.seconds,T.nanoseconds)}valueOf(){return String(this.seconds-e2).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}e4._jsonSchemaVersion="firestore/timestamp/1.0",e4._jsonSchema={type:e0("string",e4._jsonSchemaVersion),seconds:e0("number"),nanoseconds:e0("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6{static fromTimestamp(T){return new e6(T)}static min(){return new e6(new e4(0,0))}static max(){return new e6(new e4(253402300799,1e9-1))}constructor(T){this.timestamp=T}compareTo(T){return this.timestamp._compareTo(T.timestamp)}isEqual(T){return this.timestamp.isEqual(T.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e9=-1,e5=0;class e8{constructor(T,S,R,N){this.indexId=T,this.collectionGroup=S,this.fields=R,this.indexState=N}}function e7(T){return T.fields.find(T=>2===T.kind)}function te(T){return T.fields.filter(T=>2!==T.kind)}function tt(T){let S=te(T);return 0===S.length?0:S[S.length-1].kind}function tr(T,S){let R=ex(T.collectionGroup,S.collectionGroup);if(0!==R)return R;for(let N=0;N<Math.min(T.fields.length,S.fields.length);++N)if(0!==(R=ta(T.fields[N],S.fields[N])))return R;return ex(T.fields.length,S.fields.length)}function ti(T){return`id=${T.indexId}|cg=${T.collectionGroup}|f=${T.fields.map(T=>`${T.fieldPath}:${T.kind}`).join(",")}`}e8.UNKNOWN_ID=-1;class ts{constructor(T,S){this.fieldPath=T,this.kind=S}}function ta(T,S){let R=eq.comparator(T.fieldPath,S.fieldPath);return 0!==R?R:ex(T.kind,S.kind)}class tl{constructor(T,S){this.sequenceNumber=T,this.offset=S}static empty(){return new tl(e5,td.min())}}function tu(T,S){let R=T.toTimestamp().seconds,N=T.toTimestamp().nanoseconds+1;return new td(e6.fromTimestamp(1e9===N?new e4(R+1,0):new e4(R,N)),eG.empty(),S)}function tc(T){return new td(T.readTime,T.key,e9)}class td{constructor(T,S,R){this.readTime=T,this.documentKey=S,this.largestBatchId=R}static min(){return new td(e6.min(),eG.empty(),e9)}static max(){return new td(e6.max(),eG.empty(),e9)}}function th(T,S){let R=T.readTime.compareTo(S.readTime);return 0!==R||0!==(R=eG.comparator(T.documentKey,S.documentKey))?R:ex(T.largestBatchId,S.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(T){this.onCommittedListeners.push(T)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(T=>T())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tm(T){if(T.code===ey.FAILED_PRECONDITION&&T.message===tp)eu("LocalStore","Unexpectedly lost primary lease");else throw T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(T){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,T(T=>{this.isDone=!0,this.result=T,this.nextCallback&&this.nextCallback(T)},T=>{this.isDone=!0,this.error=T,this.catchCallback&&this.catchCallback(T)})}catch(T){return this.next(void 0,T)}next(T,S){return(this.callbackAttached&&ep(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(S,this.error):this.wrapSuccess(T,this.result):new tg((R,N)=>{this.nextCallback=S=>{this.wrapSuccess(T,S).next(R,N)},this.catchCallback=T=>{this.wrapFailure(S,T).next(R,N)}})}toPromise(){return new Promise((T,S)=>{this.next(T,S)})}wrapUserFunction(T){try{let S=T();if(S instanceof tg)return S;return tg.resolve(S)}catch(T){return tg.reject(T)}}wrapSuccess(T,S){return T?this.wrapUserFunction(()=>T(S)):tg.resolve(S)}wrapFailure(T,S){return T?this.wrapUserFunction(()=>T(S)):tg.reject(S)}static resolve(T){return new tg((S,R)=>{S(T)})}static reject(T){return new tg((S,R)=>{R(T)})}static waitFor(T){return new tg((S,R)=>{let N=0,O=0,P=!1;T.forEach(T=>{++N,T.next(()=>{++O,P&&O===N&&S()},T=>R(T))}),P=!0,O===N&&S()})}static or(T){let S=tg.resolve(!1);for(let R of T)S=S.next(T=>T?tg.resolve(T):R());return S}static forEach(T,S){let R=[];return T.forEach((T,N)=>{R.push(S.call(this,T,N))}),this.waitFor(R)}static mapArray(T,S){return new tg((R,N)=>{let O=T.length,P=Array(O),M=0;for(let L=0;L<O;L++){let U=L;S(T[U]).next(T=>{P[U]=T,++M===O&&R(P)},T=>N(T))}})}static doWhile(T,S){return new tg((R,N)=>{let O=()=>{!0===T()?S().next(()=>{O()},N):R()};O()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ty="SimpleDb",tv=3;class tb{static open(T,S,R,N){try{return new tb(S,T.transaction(N,R))}catch(T){throw new t_(S,T)}}constructor(T,S){this.action=T,this.transaction=S,this.aborted=!1,this.completionDeferred=new eb,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{S.error?this.completionDeferred.reject(new t_(T,S.error)):this.completionDeferred.resolve()},this.transaction.onerror=S=>{let R=tk(S.target.error);this.completionDeferred.reject(new t_(T,R))}}get completionPromise(){return this.completionDeferred.promise}abort(T){T&&this.completionDeferred.reject(T),this.aborted||(eu(ty,"Aborting transaction:",T?T.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let T=this.transaction;this.aborted||"function"!=typeof T.commit||T.commit()}store(T){return new tC(this.transaction.objectStore(T))}}class tT{static delete(T){return eu(ty,"Removing database:",T),tI(getGlobal().indexedDB.deleteDatabase(T)).toPromise()}static isAvailable(){if(!isIndexedDBAvailable())return!1;if(tT.isMockPersistence())return!0;let T=getUA(),S=tT.getIOSVersion(T),R=0<S&&S<10,N=tS(T),O=0<N&&N<4.5;return!(T.indexOf("MSIE ")>0||T.indexOf("Trident/")>0||T.indexOf("Edge/")>0)&&!R&&!O}static isMockPersistence(){var T;return"undefined"!=typeof process&&(null===(T=process.env)||void 0===T?void 0:T.USE_MOCK_PERSISTENCE)==="YES"}static getStore(T,S){return T.store(S)}static getIOSVersion(T){let S=T.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(S?S[1].split("_").slice(0,2).join("."):"-1")}constructor(T,S,R){this.name=T,this.version=S,this.schemaConverter=R,this.lastClosedDbVersion=null,12.2===tT.getIOSVersion(getUA())&&ec("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(T){return this.db||(eu(ty,"Opening database:",this.name),this.db=await new Promise((S,R)=>{let N=indexedDB.open(this.name,this.version);N.onsuccess=T=>{S(T.target.result)},N.onblocked=()=>{R(new t_(T,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},N.onerror=S=>{let N=S.target.error;"VersionError"===N.name?R(new ev(ey.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===N.name?R(new ev(ey.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+N)):R(new t_(T,N))},N.onupgradeneeded=T=>{eu(ty,'Database "'+this.name+'" requires upgrade from version:',T.oldVersion);let S=T.target.result;if(null!==this.lastClosedDbVersion&&this.lastClosedDbVersion!==T.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.lastClosedDbVersion}, event.oldVersion=${T.oldVersion}, event.newVersion=${T.newVersion}, db.version=${S.version}`);this.schemaConverter.createOrUpgrade(S,N.transaction,T.oldVersion,this.version).next(()=>{eu(ty,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",T=>{let S=T.target;this.lastClosedDbVersion=S.version},{passive:!0})),this.db.addEventListener("versionchange",T=>{var S;null===T.newVersion&&(ed('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null===(S=this.databaseDeletedListener)||void 0===S||S.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(T){if(this.databaseDeletedListener)throw Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=T}async runTransaction(T,S,R,N){let O="readonly"===S,P=0;for(;;){++P;try{this.db=await this.ensureDb(T);let S=tb.open(this.db,T,O?"readonly":"readwrite",R),P=N(S).next(T=>(S.maybeCommit(),T)).catch(T=>(S.abort(T),tg.reject(T))).toPromise();return P.catch(()=>{}),await S.completionPromise,P}catch(R){let T=R,S="FirebaseError"!==T.name&&P<tv;if(eu(ty,"Transaction failed with error:",T.message,"Retrying:",S),this.close(),!S)return Promise.reject(T)}}}close(){this.db&&this.db.close(),this.db=void 0}}function tS(T){let S=T.match(/Android ([\d.]+)/i);return Number(S?S[1].split(".").slice(0,2).join("."):"-1")}class tE{constructor(T){this.dbCursor=T,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(T){this.dbCursor=T}done(){this.shouldStop=!0}skip(T){this.nextKey=T}delete(){return tI(this.dbCursor.delete())}}class t_ extends null{constructor(T,S){super(ey.UNAVAILABLE,`IndexedDB transaction '${T}' failed: ${S}`),this.name="IndexedDbTransactionError"}}function tw(T){return"IndexedDbTransactionError"===T.name}class tC{constructor(T){this.store=T}put(T,S){let R;return void 0!==S?(eu(ty,"PUT",this.store.name,T,S),R=this.store.put(S,T)):(eu(ty,"PUT",this.store.name,"<auto-key>",T),R=this.store.put(T)),tI(R)}add(T){return eu(ty,"ADD",this.store.name,T,T),tI(this.store.add(T))}get(T){return tI(this.store.get(T)).next(S=>(void 0===S&&(S=null),eu(ty,"GET",this.store.name,T,S),S))}delete(T){return eu(ty,"DELETE",this.store.name,T),tI(this.store.delete(T))}count(){return eu(ty,"COUNT",this.store.name),tI(this.store.count())}loadAll(T,S){let R=this.options(T,S),N=R.index?this.store.index(R.index):this.store;if("function"==typeof N.getAll){let T=N.getAll(R.range);return new tg((S,R)=>{T.onerror=T=>{R(T.target.error)},T.onsuccess=T=>{S(T.target.result)}})}{let T=this.cursor(R),S=[];return this.iterateCursor(T,(T,R)=>{S.push(R)}).next(()=>S)}}loadFirst(T,S){let R=this.store.getAll(T,null===S?void 0:S);return new tg((T,S)=>{R.onerror=T=>{S(T.target.error)},R.onsuccess=S=>{T(S.target.result)}})}deleteAll(T,S){eu(ty,"DELETE ALL",this.store.name);let R=this.options(T,S);R.keysOnly=!1;let N=this.cursor(R);return this.iterateCursor(N,(T,S,R)=>R.delete())}iterate(T,S){let R;S?R=T:(R={},S=T);let N=this.cursor(R);return this.iterateCursor(N,S)}iterateSerial(T){let S=this.cursor({});return new tg((R,N)=>{S.onerror=T=>{N(tk(T.target.error))},S.onsuccess=S=>{let N=S.target.result;if(!N){R();return}T(N.primaryKey,N.value).next(T=>{T?N.continue():R()})}})}iterateCursor(T,S){let R=[];return new tg((N,O)=>{T.onerror=T=>{O(T.target.error)},T.onsuccess=T=>{let O=T.target.result;if(!O){N();return}let P=new tE(O),M=S(O.primaryKey,O.value,P);if(M instanceof tg){let T=M.catch(T=>(P.done(),tg.reject(T)));R.push(T)}P.isDone?N():null===P.skipToKey?O.continue():O.continue(P.skipToKey)}}).next(()=>tg.waitFor(R))}options(T,S){let R;return void 0!==T&&("string"==typeof T?R=T:S=T),{index:R,range:S}}cursor(T){let S="next";if(T.reverse&&(S="prev"),!T.index)return this.store.openCursor(T.range,S);{let R=this.store.index(T.index);return T.keysOnly?R.openKeyCursor(T.range,S):R.openCursor(T.range,S)}}}function tI(T){return new tg((S,R)=>{T.onsuccess=T=>{S(T.target.result)},T.onerror=T=>{R(tk(T.target.error))}})}let tR=!1;function tk(T){let S=tT.getIOSVersion(getUA());if(S>=12.2&&S<13){let S="An internal error was encountered in the Indexed Database server";if(T.message.indexOf(S)>=0){let T=new ev("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${S}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tR||(tR=!0,setTimeout(()=>{throw T},0)),T}}return T}let tN="IndexBackfiller",tA=null,tD=null,tO=50;class tP{constructor(T,S){this.asyncQueue=T,this.backfiller=S,this.task=null}start(){this.schedule(tA)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(T){eu(tN,`Scheduled in ${T}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",T,async()=>{this.task=null;try{let T=await this.backfiller.backfill();eu(tN,`Documents written: ${T}`)}catch(T){tw(T)?eu(tN,"Ignoring IndexedDB error during index backfill: ",T):await tm(T)}await this.schedule(tD)})}}class tM{constructor(T,S){this.localStore=T,this.persistence=S}async backfill(T=tO){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",S=>this.writeIndexEntries(S,T))}writeIndexEntries(T,S){let R=new Set,N=S,O=!0;return tg.doWhile(()=>!0===O&&N>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(T).next(S=>{if(!(null===S||R.has(S)))return eu(tN,`Processing collection: ${S}`),this.writeEntriesForCollectionGroup(T,S,N).next(T=>{N-=T,R.add(S)});O=!1})).next(()=>S-N)}writeEntriesForCollectionGroup(T,S,R){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(T,S).next(N=>this.localStore.localDocuments.getNextDocuments(T,S,N,R).next(R=>{let O=R.changes;return this.localStore.indexManager.updateIndexEntries(T,O).next(()=>this.getNewOffset(N,R)).next(R=>(eu(tN,`Updating offset: ${R}`),this.localStore.indexManager.updateCollectionGroup(T,S,R))).next(()=>O.size)}))}getNewOffset(T,S){let R=T;return S.changes.forEach((T,S)=>{let N=tc(S);th(N,R)>0&&(R=N)}),new td(R.readTime,R.documentKey,Math.max(S.batchId,T.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tL{constructor(T,S){this.previousValue=T,S&&(S.sequenceNumberHandler=T=>this.setPreviousValue(T),this.writeNewSequenceNumber=T=>S.writeSequenceNumber(T))}setPreviousValue(T){return this.previousValue=Math.max(T,this.previousValue),this.previousValue}next(){let T=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(T),T}}tL.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tF="\x01",tB="\x01",tU="\x10",tV="\x11";function tj(T){let S="";for(let R=0;R<T.length;R++)S.length>0&&(S=tq(S)),S=tz(T.get(R),S);return tq(S)}function tz(T,S){let R=S,N=T.length;for(let S=0;S<N;S++){let N=T.charAt(S);switch(N){case"\x00":R+=tF+tU;break;case tF:R+=tF+tV;break;default:R+=N}}return R}function tq(T){return T+tF+tB}function tG(T){let S=T.length;if(em(S>=2,64408,{path:T}),2===S)return em(T.charAt(0)===tF&&T.charAt(1)===tB,56145,{path:T}),ej.emptyPath();let R=S-2,N=[],O="";for(let P=0;P<S;){let S=T.indexOf(tF,P);switch((S<0||S>R)&&ep(50515,{path:T}),T.charAt(S+1)){case tB:let M;let L=T.substring(P,S);0===O.length?M=L:(O+=L,M=O,O=""),N.push(M);break;case tU:O+=T.substring(P,S)+"\x00";break;case tV:O+=T.substring(P,S+1);break;default:ep(61167,{path:T})}P=S+2}return new ej(N)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let t$="remoteDocuments",tK="owner",tH="owner",tW="mutationQueues",tQ="userId",tY="mutations",tJ="batchId",tX="userMutationsIndex",tZ=null;function t0(T){return[T]}function t1(T,S){return[T,tj(S)]}function t2(T,S,R){return[T,tj(S),R]}let t3={},t4="documentMutations",t6="remoteDocumentsV14",t9=null,t5="documentKeyIndex",t8=null,t7="collectionGroupIndex",rt=null,rr="remoteDocumentGlobal",rn="remoteDocumentGlobalKey",ri="targets",rs="targetId",ra="queryTargetsIndex",ro=null,rl="targetDocuments",ru=null,rc="documentTargetsIndex",rd=null,rh="targetGlobalKey",rp="targetGlobal",rf="collectionParents",rm=null,rg="clientMetadata",ry="clientId",rv="bundles",rb="bundleId",rT="namedQueries",rS="name",rE="indexConfiguration",r_="indexId",rw="collectionGroupIndex",rC="collectionGroup",rI="indexState",rR=null,rk="sequenceNumberIndex",rN=null,rA="indexEntries",rD=null,rO="documentKeyIndex",rx=null,rP="documentOverlays",rM=null,rL="collectionPathOverlayIndex",rF=null,rB="collectionGroupOverlayIndex",rU=null,rV="globals",rj="name",rz=[tW,tY,t4,t$,ri,tK,rp,rl,rg,rr,rf,rv,rT],rq=[...rz,rP],rG=[tW,tY,t4,t6,ri,tK,rp,rl,rg,rr,rf,rv,rT,rP],r$=rG,rK=[...r$,rE,rI,rA],rH=null,rW=[...rK,rV],rQ=null;function rY(T){return 18===T?rQ:17===T?rW:16===T?rH:15===T?rK:14===T?r$:13===T?rG:12===T?rq:11===T?rz:void ep(60245)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rJ extends null{constructor(T,S){super(),this.simpleDbTransaction=T,this.currentSequenceNumber=S}}function rX(T,S){let R=eg(T);return tT.getStore(R.simpleDbTransaction,S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rZ(T){let S=0;for(let R in T)Object.prototype.hasOwnProperty.call(T,R)&&S++;return S}function r0(T,S){for(let R in T)Object.prototype.hasOwnProperty.call(T,R)&&S(R,T[R])}function r1(T){for(let S in T)if(Object.prototype.hasOwnProperty.call(T,S))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(T,S){this.comparator=T,this.root=S||r4.EMPTY}insert(T,S){return new r2(this.comparator,this.root.insert(T,S,this.comparator).copy(null,null,r4.BLACK,null,null))}remove(T){return new r2(this.comparator,this.root.remove(T,this.comparator).copy(null,null,r4.BLACK,null,null))}get(T){let S=this.root;for(;!S.isEmpty();){let R=this.comparator(T,S.key);if(0===R)return S.value;R<0?S=S.left:R>0&&(S=S.right)}return null}indexOf(T){let S=0,R=this.root;for(;!R.isEmpty();){let N=this.comparator(T,R.key);if(0===N)return S+R.left.size;N<0?R=R.left:(S+=R.left.size+1,R=R.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(T){return this.root.inorderTraversal(T)}forEach(T){this.inorderTraversal((S,R)=>(T(S,R),!1))}toString(){let T=[];return this.inorderTraversal((S,R)=>(T.push(`${S}:${R}`),!1)),`{${T.join(", ")}}`}reverseTraversal(T){return this.root.reverseTraversal(T)}getIterator(){return new r3(this.root,null,this.comparator,!1)}getIteratorFrom(T){return new r3(this.root,T,this.comparator,!1)}getReverseIterator(){return new r3(this.root,null,this.comparator,!0)}getReverseIteratorFrom(T){return new r3(this.root,T,this.comparator,!0)}}class r3{constructor(T,S,R,N){this.isReverse=N,this.nodeStack=[];let O=1;for(;!T.isEmpty();)if(O=S?R(T.key,S):1,S&&N&&(O*=-1),O<0)T=this.isReverse?T.left:T.right;else if(0===O){this.nodeStack.push(T);break}else this.nodeStack.push(T),T=this.isReverse?T.right:T.left}getNext(){let T=this.nodeStack.pop(),S={key:T.key,value:T.value};if(this.isReverse)for(T=T.left;!T.isEmpty();)this.nodeStack.push(T),T=T.right;else for(T=T.right;!T.isEmpty();)this.nodeStack.push(T),T=T.left;return S}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let T=this.nodeStack[this.nodeStack.length-1];return{key:T.key,value:T.value}}}class r4{constructor(T,S,R,N,O){this.key=T,this.value=S,this.color=null!=R?R:r4.RED,this.left=null!=N?N:r4.EMPTY,this.right=null!=O?O:r4.EMPTY,this.size=this.left.size+1+this.right.size}copy(T,S,R,N,O){return new r4(null!=T?T:this.key,null!=S?S:this.value,null!=R?R:this.color,null!=N?N:this.left,null!=O?O:this.right)}isEmpty(){return!1}inorderTraversal(T){return this.left.inorderTraversal(T)||T(this.key,this.value)||this.right.inorderTraversal(T)}reverseTraversal(T){return this.right.reverseTraversal(T)||T(this.key,this.value)||this.left.reverseTraversal(T)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(T,S,R){let N=this,O=R(T,N.key);return(N=O<0?N.copy(null,null,null,N.left.insert(T,S,R),null):0===O?N.copy(null,S,null,null,null):N.copy(null,null,null,null,N.right.insert(T,S,R))).fixUp()}removeMin(){if(this.left.isEmpty())return r4.EMPTY;let T=this;return T.left.isRed()||T.left.left.isRed()||(T=T.moveRedLeft()),(T=T.copy(null,null,null,T.left.removeMin(),null)).fixUp()}remove(T,S){let R;let N=this;if(0>S(T,N.key))N.left.isEmpty()||N.left.isRed()||N.left.left.isRed()||(N=N.moveRedLeft()),N=N.copy(null,null,null,N.left.remove(T,S),null);else{if(N.left.isRed()&&(N=N.rotateRight()),N.right.isEmpty()||N.right.isRed()||N.right.left.isRed()||(N=N.moveRedRight()),0===S(T,N.key)){if(N.right.isEmpty())return r4.EMPTY;R=N.right.min(),N=N.copy(R.key,R.value,null,null,N.right.removeMin())}N=N.copy(null,null,null,null,N.right.remove(T,S))}return N.fixUp()}isRed(){return this.color}fixUp(){let T=this;return T.right.isRed()&&!T.left.isRed()&&(T=T.rotateLeft()),T.left.isRed()&&T.left.left.isRed()&&(T=T.rotateRight()),T.left.isRed()&&T.right.isRed()&&(T=T.colorFlip()),T}moveRedLeft(){let T=this.colorFlip();return T.right.left.isRed()&&(T=(T=(T=T.copy(null,null,null,null,T.right.rotateRight())).rotateLeft()).colorFlip()),T}moveRedRight(){let T=this.colorFlip();return T.left.left.isRed()&&(T=(T=T.rotateRight()).colorFlip()),T}rotateLeft(){let T=this.copy(null,null,r4.RED,null,this.right.left);return this.right.copy(null,null,this.color,T,null)}rotateRight(){let T=this.copy(null,null,r4.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,T)}colorFlip(){let T=this.left.copy(null,null,!this.left.color,null,null),S=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,T,S)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ep(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ep(14113,{key:this.key,value:this.value});let T=this.left.check();if(T===this.right.check())return T+(this.isRed()?0:1);throw ep(27949)}}r4.EMPTY=null,r4.RED=!0,r4.BLACK=!1;class r6{constructor(){this.size=0}get key(){throw ep(57766)}get value(){throw ep(16141)}get color(){throw ep(16727)}get left(){throw ep(29726)}get right(){throw ep(36894)}copy(T,S,R,N,O){return this}insert(T,S,R){return new r4(T,S)}remove(T,S){return this}isEmpty(){return!0}inorderTraversal(T){return!1}reverseTraversal(T){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}r4.EMPTY=new r6;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r9{constructor(T){this.comparator=T,this.data=new r2(this.comparator)}has(T){return null!==this.data.get(T)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(T){return this.data.indexOf(T)}forEach(T){this.data.inorderTraversal((S,R)=>(T(S),!1))}forEachInRange(T,S){let R=this.data.getIteratorFrom(T[0]);for(;R.hasNext();){let N=R.getNext();if(this.comparator(N.key,T[1])>=0)return;S(N.key)}}forEachWhile(T,S){let R;for(R=void 0!==S?this.data.getIteratorFrom(S):this.data.getIterator();R.hasNext();)if(!T(R.getNext().key))return}firstAfterOrEqual(T){let S=this.data.getIteratorFrom(T);return S.hasNext()?S.getNext().key:null}getIterator(){return new r5(this.data.getIterator())}getIteratorFrom(T){return new r5(this.data.getIteratorFrom(T))}add(T){return this.copy(this.data.remove(T).insert(T,!0))}delete(T){return this.has(T)?this.copy(this.data.remove(T)):this}isEmpty(){return this.data.isEmpty()}unionWith(T){let S=this;return S.size<T.size&&(S=T,T=this),T.forEach(T=>{S=S.add(T)}),S}isEqual(T){if(!(T instanceof r9)||this.size!==T.size)return!1;let S=this.data.getIterator(),R=T.data.getIterator();for(;S.hasNext();){let T=S.getNext().key,N=R.getNext().key;if(0!==this.comparator(T,N))return!1}return!0}toArray(){let T=[];return this.forEach(S=>{T.push(S)}),T}toString(){let T=[];return this.forEach(S=>T.push(S)),"SortedSet("+T.toString()+")"}copy(T){let S=new r9(this.comparator);return S.data=T,S}}class r5{constructor(T){this.iter=T}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function r8(T,S,R,N,O){let P=T.getIterator(),M=S.getIterator(),L=r7(P),U=r7(M);for(;L||U;){let T=!1,S=!1;if(L&&U){let N=R(L,U);N<0?S=!0:N>0&&(T=!0)}else null!=L?S=!0:T=!0;T?(N(U),U=r7(M)):S?(O(L),L=r7(P)):(L=r7(P),U=r7(M))}}function r7(T){return T.hasNext()?T.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(T){this.fields=T,T.sort(eq.comparator)}static empty(){return new ne([])}unionWith(T){let S=new r9(eq.comparator);for(let T of this.fields)S=S.add(T);for(let R of T)S=S.add(R);return new ne(S.toArray())}covers(T){for(let S of this.fields)if(S.isPrefixOf(T))return!0;return!1}isEqual(T){return eF(this.fields,T.fields,(T,S)=>T.isEqual(S))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(T){return Buffer.from(T,"base64").toString("binary")}function nn(T){return Buffer.from(T,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(T){this.binaryString=T}static fromBase64String(T){return new ni(nt(T))}static fromUint8Array(T){return new ni(na(T))}[Symbol.iterator](){let T=0;return{next:()=>T<this.binaryString.length?{value:this.binaryString.charCodeAt(T++),done:!1}:{value:void 0,done:!0}}}toBase64(){return nn(this.binaryString)}toUint8Array(){return no(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(T){return ex(this.binaryString,T.binaryString)}isEqual(T){return this.binaryString===T.binaryString}}function na(T){let S="";for(let R=0;R<T.length;++R)S+=String.fromCharCode(T[R]);return S}function no(T){let S=new Uint8Array(T.length);for(let R=0;R<T.length;R++)S[R]=T.charCodeAt(R);return S}ni.EMPTY_BYTE_STRING=new ni("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nc(T){if(em(!!T,39018),"string"==typeof T){let S=0,R=nu.exec(T);if(em(!!R,46558,{timestamp:T}),R[1]){let T=R[1];S=Number(T=(T+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(T).getTime()/1e3),nanos:S}}return{seconds:nd(T.seconds),nanos:nd(T.nanos)}}function nd(T){return"number"==typeof T?T:"string"==typeof T?Number(T):0}function nh(T){return"string"==typeof T?ni.fromBase64String(T):ni.fromUint8Array(T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let np="server_timestamp",nf="__type__",nm="__previous_value__",ng="__local_write_time__";function ny(T){var S,R;return(null===(R=((null===(S=null==T?void 0:T.mapValue)||void 0===S?void 0:S.fields)||{})[nf])||void 0===R?void 0:R.stringValue)===np}function nv(T,S){let R={fields:{[nf]:{stringValue:np},[ng]:{timestampValue:{seconds:T.seconds,nanos:T.nanoseconds}}}};return S&&ny(S)&&(S=nb(S)),S&&(R.fields[nm]=S),{mapValue:R}}function nb(T){let S=T.mapValue.fields[nm];return ny(S)?nb(S):S}function nT(T){let S=nc(T.mapValue.fields[ng].timestampValue);return new e4(S.seconds,S.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nS{constructor(T,S,R,N,O,P,M,L,U,V){this.databaseId=T,this.appId=S,this.persistenceKey=R,this.host=N,this.ssl=O,this.forceLongPolling=P,this.autoDetectLongPolling=M,this.longPollingOptions=L,this.useFetchStreams=U,this.isUsingEmulator=V}}let nE="(default)";class n_{constructor(T,S){this.projectId=T,this.database=S||nE}static empty(){return new n_("","")}get isDefaultDatabase(){return this.database===nE}isEqual(T){return T instanceof n_&&T.projectId===this.projectId&&T.database===this.database}}function nw(T,S){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new ev(ey.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new n_(T.options.projectId,S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nC=-1;function nI(T){return null==T}function nR(T){return 0===T&&1/T==-1/0}function nk(T){return"number"==typeof T&&Number.isInteger(T)&&!nR(T)&&T<=Number.MAX_SAFE_INTEGER&&T>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nN="__type__",nA="__max__",nD={mapValue:{fields:{__type__:{stringValue:nA}}}},nO="__vector__",nx="value",nP={nullValue:"NULL_VALUE"};function nM(T){return"nullValue"in T?0:"booleanValue"in T?1:"integerValue"in T||"doubleValue"in T?2:"timestampValue"in T?3:"stringValue"in T?5:"bytesValue"in T?6:"referenceValue"in T?7:"geoPointValue"in T?8:"arrayValue"in T?9:"mapValue"in T?ny(T)?4:im(T)?9007199254740991:ih(T)?10:11:ep(28295,{value:T})}function nL(T,S){if(T===S)return!0;let R=nM(T);if(R!==nM(S))return!1;switch(R){case 0:case 9007199254740991:return!0;case 1:return T.booleanValue===S.booleanValue;case 4:return nT(T).isEqual(nT(S));case 3:return nF(T,S);case 5:return T.stringValue===S.stringValue;case 6:return nU(T,S);case 7:return T.referenceValue===S.referenceValue;case 8:return nB(T,S);case 2:return nV(T,S);case 9:return eF(T.arrayValue.values||[],S.arrayValue.values||[],nL);case 10:case 11:return nj(T,S);default:return ep(52216,{left:T})}}function nF(T,S){if("string"==typeof T.timestampValue&&"string"==typeof S.timestampValue&&T.timestampValue.length===S.timestampValue.length)return T.timestampValue===S.timestampValue;let R=nc(T.timestampValue),N=nc(S.timestampValue);return R.seconds===N.seconds&&R.nanos===N.nanos}function nB(T,S){return nd(T.geoPointValue.latitude)===nd(S.geoPointValue.latitude)&&nd(T.geoPointValue.longitude)===nd(S.geoPointValue.longitude)}function nU(T,S){return nh(T.bytesValue).isEqual(nh(S.bytesValue))}function nV(T,S){if("integerValue"in T&&"integerValue"in S)return nd(T.integerValue)===nd(S.integerValue);if("doubleValue"in T&&"doubleValue"in S){let R=nd(T.doubleValue),N=nd(S.doubleValue);return R===N?nR(R)===nR(N):isNaN(R)&&isNaN(N)}return!1}function nj(T,S){let R=T.mapValue.fields||{},N=S.mapValue.fields||{};if(rZ(R)!==rZ(N))return!1;for(let T in R)if(R.hasOwnProperty(T)&&(void 0===N[T]||!nL(R[T],N[T])))return!1;return!0}function nz(T,S){return void 0!==(T.values||[]).find(T=>nL(T,S))}function nq(T,S){if(T===S)return 0;let R=nM(T),N=nM(S);if(R!==N)return ex(R,N);switch(R){case 0:case 9007199254740991:return 0;case 1:return ex(T.booleanValue,S.booleanValue);case 2:return nG(T,S);case 3:return n$(T.timestampValue,S.timestampValue);case 4:return n$(nT(T),nT(S));case 5:return eP(T.stringValue,S.stringValue);case 6:return nW(T.bytesValue,S.bytesValue);case 7:return nK(T.referenceValue,S.referenceValue);case 8:return nH(T.geoPointValue,S.geoPointValue);case 9:return nQ(T.arrayValue,S.arrayValue);case 10:return nY(T.mapValue,S.mapValue);case 11:return nJ(T.mapValue,S.mapValue);default:throw ep(23264,{leftType:R})}}function nG(T,S){let R=nd(T.integerValue||T.doubleValue),N=nd(S.integerValue||S.doubleValue);return R<N?-1:R>N?1:R===N?0:isNaN(R)?isNaN(N)?0:-1:1}function n$(T,S){if("string"==typeof T&&"string"==typeof S&&T.length===S.length)return ex(T,S);let R=nc(T),N=nc(S),O=ex(R.seconds,N.seconds);return 0!==O?O:ex(R.nanos,N.nanos)}function nK(T,S){let R=T.split("/"),N=S.split("/");for(let T=0;T<R.length&&T<N.length;T++){let S=ex(R[T],N[T]);if(0!==S)return S}return ex(R.length,N.length)}function nH(T,S){let R=ex(nd(T.latitude),nd(S.latitude));return 0!==R?R:ex(nd(T.longitude),nd(S.longitude))}function nW(T,S){let R=nh(T),N=nh(S);return R.compareTo(N)}function nQ(T,S){let R=T.values||[],N=S.values||[];for(let T=0;T<R.length&&T<N.length;++T){let S=nq(R[T],N[T]);if(S)return S}return ex(R.length,N.length)}function nY(T,S){var R,N,O,P;let M=T.fields||{},L=S.fields||{},U=null===(R=M[nx])||void 0===R?void 0:R.arrayValue,V=null===(N=L[nx])||void 0===N?void 0:N.arrayValue,$=ex((null===(O=null==U?void 0:U.values)||void 0===O?void 0:O.length)||0,(null===(P=null==V?void 0:V.values)||void 0===P?void 0:P.length)||0);return 0!==$?$:nQ(U,V)}function nJ(T,S){if(T===nD.mapValue&&S===nD.mapValue)return 0;if(T===nD.mapValue)return 1;if(S===nD.mapValue)return -1;let R=T.fields||{},N=Object.keys(R),O=S.fields||{},P=Object.keys(O);N.sort(),P.sort();for(let T=0;T<N.length&&T<P.length;++T){let S=eP(N[T],P[T]);if(0!==S)return S;let M=nq(R[N[T]],O[P[T]]);if(0!==M)return M}return ex(N.length,P.length)}function nX(T){return nZ(T)}function nZ(T){if("nullValue"in T)return"null";if("booleanValue"in T)return""+T.booleanValue;if("integerValue"in T)return""+T.integerValue;if("doubleValue"in T)return""+T.doubleValue;if("timestampValue"in T)return n3(T.timestampValue);if("stringValue"in T)return T.stringValue;if("bytesValue"in T)return n0(T.bytesValue);else if("referenceValue"in T)return n6(T.referenceValue);else if("geoPointValue"in T)return n4(T.geoPointValue);else if("arrayValue"in T)return n5(T.arrayValue);else if("mapValue"in T)return n9(T.mapValue);else return ep(61005,{value:T})}function n0(T){return nh(T).toBase64()}function n3(T){let S=nc(T);return`time(${S.seconds},${S.nanos})`}function n4(T){return`geo(${T.latitude},${T.longitude})`}function n6(T){return eG.fromName(T).toString()}function n9(T){let S=Object.keys(T.fields||{}).sort(),R="{",N=!0;for(let O of S)N?N=!1:R+=",",R+=`${O}:${nZ(T.fields[O])}`;return R+"}"}function n5(T){let S="[",R=!0;for(let N of T.values||[])R?R=!1:S+=",",S+=nZ(N);return S+"]"}function n8(T){switch(nM(T)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let S=nb(T);return S?16+n8(S):16;case 5:return 2*T.stringValue.length;case 6:return nh(T.bytesValue).approximateByteSize();case 7:return T.referenceValue.length;case 9:return ie(T.arrayValue);case 10:case 11:return n7(T.mapValue);default:throw ep(13486,{value:T})}}function n7(T){let S=0;return r0(T.fields,(T,R)=>{S+=T.length+n8(R)}),S}function ie(T){return(T.values||[]).reduce((T,S)=>T+n8(S),0)}function ir(T,S){return{referenceValue:`projects/${T.projectId}/databases/${T.database}/documents/${S.path.canonicalString()}`}}function ii(T){return!!T&&"integerValue"in T}function is(T){return!!T&&"doubleValue"in T}function ia(T){return ii(T)||is(T)}function io(T){return!!T&&"arrayValue"in T}function il(T){return!!T&&"nullValue"in T}function iu(T){return!!T&&"doubleValue"in T&&isNaN(Number(T.doubleValue))}function ic(T){return!!T&&"mapValue"in T}function ih(T){var S,R;return(null===(R=((null===(S=null==T?void 0:T.mapValue)||void 0===S?void 0:S.fields)||{})[nN])||void 0===R?void 0:R.stringValue)===nO}function ip(T){if(T.geoPointValue)return{geoPointValue:Object.assign({},T.geoPointValue)};if(T.timestampValue&&"object"==typeof T.timestampValue)return{timestampValue:Object.assign({},T.timestampValue)};if(T.mapValue){let S={mapValue:{fields:{}}};return r0(T.mapValue.fields,(T,R)=>S.mapValue.fields[T]=ip(R)),S}{if(!T.arrayValue)return Object.assign({},T);let S={arrayValue:{values:[]}};for(let R=0;R<(T.arrayValue.values||[]).length;++R)S.arrayValue.values[R]=ip(T.arrayValue.values[R]);return S}}function im(T){return(((T.mapValue||{}).fields||{}).__type__||{}).stringValue===nA}let ig={mapValue:{fields:{[nN]:{stringValue:nO},[nx]:{arrayValue:{}}}}};function iy(T){if("nullValue"in T)return nP;if("booleanValue"in T)return{booleanValue:!1};if("integerValue"in T||"doubleValue"in T)return{doubleValue:NaN};if("timestampValue"in T)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in T)return{stringValue:""};if("bytesValue"in T)return{bytesValue:""};if("referenceValue"in T)return ir(n_.empty(),eG.empty());else if("geoPointValue"in T)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in T)return{arrayValue:{}};else if(!("mapValue"in T))return ep(35942,{value:T});else return ih(T)?ig:{mapValue:{}}}function iv(T){if("nullValue"in T)return{booleanValue:!1};if("booleanValue"in T)return{doubleValue:NaN};if("integerValue"in T||"doubleValue"in T)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in T)return{stringValue:""};if("stringValue"in T)return{bytesValue:""};if("bytesValue"in T)return ir(n_.empty(),eG.empty());if("referenceValue"in T)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in T)return{arrayValue:{}};else if("arrayValue"in T)return ig;else if(!("mapValue"in T))return ep(61959,{value:T});else return ih(T)?{mapValue:{}}:nD}function ib(T,S){let R=nq(T.value,S.value);return 0!==R?R:T.inclusive&&!S.inclusive?-1:!T.inclusive&&S.inclusive?1:0}function iT(T,S){let R=nq(T.value,S.value);return 0!==R?R:T.inclusive&&!S.inclusive?1:!T.inclusive&&S.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(T){this.value=T}static empty(){return new iS({mapValue:{}})}field(T){if(T.isEmpty())return this.value;{let S=this.value;for(let R=0;R<T.length-1;++R)if(!ic(S=(S.mapValue.fields||{})[T.get(R)]))return null;return(S=(S.mapValue.fields||{})[T.lastSegment()])||null}}set(T,S){this.getFieldsMap(T.popLast())[T.lastSegment()]=ip(S)}setAll(T){let S=eq.emptyPath(),R={},N=[];T.forEach((T,O)=>{if(!S.isImmediateParentOf(O)){let T=this.getFieldsMap(S);this.applyChanges(T,R,N),R={},N=[],S=O.popLast()}T?R[O.lastSegment()]=ip(T):N.push(O.lastSegment())});let O=this.getFieldsMap(S);this.applyChanges(O,R,N)}delete(T){let S=this.field(T.popLast());ic(S)&&S.mapValue.fields&&delete S.mapValue.fields[T.lastSegment()]}isEqual(T){return nL(this.value,T.value)}getFieldsMap(T){let S=this.value;S.mapValue.fields||(S.mapValue={fields:{}});for(let R=0;R<T.length;++R){let N=S.mapValue.fields[T.get(R)];ic(N)&&N.mapValue.fields||(N={mapValue:{fields:{}}},S.mapValue.fields[T.get(R)]=N),S=N}return S.mapValue.fields}applyChanges(T,S,R){for(let N of(r0(S,(S,R)=>T[S]=R),R))delete T[N]}clone(){return new iS(ip(this.value))}}function iE(T){let S=[];return r0(T.fields,(T,R)=>{let N=new eq([T]);if(ic(R)){let T=iE(R.mapValue).fields;if(0===T.length)S.push(N);else for(let R of T)S.push(N.child(R))}else S.push(N)}),new ne(S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(T,S,R,N,O,P,M){this.key=T,this.documentType=S,this.version=R,this.readTime=N,this.createTime=O,this.data=P,this.documentState=M}static newInvalidDocument(T){return new i_(T,0,e6.min(),e6.min(),e6.min(),iS.empty(),0)}static newFoundDocument(T,S,R,N){return new i_(T,1,S,e6.min(),R,N,0)}static newNoDocument(T,S){return new i_(T,2,S,e6.min(),e6.min(),iS.empty(),0)}static newUnknownDocument(T,S){return new i_(T,3,S,e6.min(),e6.min(),iS.empty(),2)}convertToFoundDocument(T,S){return this.createTime.isEqual(e6.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=T),this.version=T,this.documentType=1,this.data=S,this.documentState=0,this}convertToNoDocument(T){return this.version=T,this.documentType=2,this.data=iS.empty(),this.documentState=0,this}convertToUnknownDocument(T){return this.version=T,this.documentType=3,this.data=iS.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=e6.min(),this}setReadTime(T){return this.readTime=T,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(T){return T instanceof i_&&this.key.isEqual(T.key)&&this.version.isEqual(T.version)&&this.documentType===T.documentType&&this.documentState===T.documentState&&this.data.isEqual(T.data)}mutableCopy(){return new i_(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function iw(T,S,R){let N=S.data.field(T),O=R.data.field(T);return null!==N&&null!==O?nq(N,O):ep(42886)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(T,S){this.position=T,this.inclusive=S}}function iI(T,S,R){let N=0;for(let O=0;O<T.position.length;O++){let P=S[O],M=T.position[O];if(N=P.field.isKeyField()?eG.comparator(eG.fromName(M.referenceValue),R.key):nq(M,R.data.field(P.field)),"desc"===P.dir&&(N*=-1),0!==N)break}return N}function iR(T,S,R){let N=iI(T,S,R);return T.inclusive?N>=0:N>0}function ik(T,S,R){let N=iI(T,S,R);return T.inclusive?N<=0:N<0}function iN(T,S){if(null===T)return null===S;if(null===S||T.inclusive!==S.inclusive||T.position.length!==S.position.length)return!1;for(let R=0;R<T.position.length;R++)if(!nL(T.position[R],S.position[R]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(T,S="asc"){this.field=T,this.dir=S}}function iD(T){return T.field.canonicalString()+T.dir}function iO(T){return`${T.field.canonicalString()} (${T.dir})`}function ix(T,S){return T.dir===S.dir&&T.field.isEqual(S.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{}class iM extends iP{constructor(T,S,R){super(),this.field=T,this.op=S,this.value=R}static create(T,S,R){return T.isKeyField()?"in"===S||"not-in"===S?this.createKeyFieldInFilter(T,S,R):new iQ(T,S,R):"array-contains"===S?new iZ(T,R):"in"===S?new i0(T,R):"not-in"===S?new i1(T,R):"array-contains-any"===S?new i2(T,R):new iM(T,S,R)}static createKeyFieldInFilter(T,S,R){return"in"===S?new iY(T,R):new iJ(T,R)}matches(T){let S=T.data.field(this.field);return"!="===this.op?null!==S&&void 0===S.nullValue&&this.matchesComparison(nq(S,this.value)):null!==S&&nM(this.value)===nM(S)&&this.matchesComparison(nq(S,this.value))}matchesComparison(T){switch(this.op){case"<":return T<0;case"<=":return T<=0;case"==":return 0===T;case"!=":return 0!==T;case">":return T>0;case">=":return T>=0;default:return ep(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class iL extends iP{constructor(T,S){super(),this.filters=T,this.op=S,this.memoizedFlattenedFilters=null}static create(T,S){return new iL(T,S)}matches(T){return iF(this)?void 0===this.filters.find(S=>!S.matches(T)):void 0!==this.filters.find(S=>S.matches(T))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((T,S)=>T.concat(S.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function iF(T){return"and"===T.op}function iB(T){return"or"===T.op}function iU(T){return iV(T)&&iF(T)}function iV(T){for(let S of T.filters)if(S instanceof iL)return!1;return!0}function ij(T){if(T instanceof iM)return T.field.canonicalString()+T.op.toString()+nX(T.value);if(iU(T))return T.filters.map(T=>ij(T)).join(",");{let S=T.filters.map(T=>ij(T)).join(",");return`${T.op}(${S})`}}function iz(T,S){return T instanceof iM?iq(T,S):T instanceof iL?iG(T,S):void ep(19439)}function iq(T,S){return S instanceof iM&&T.op===S.op&&T.field.isEqual(S.field)&&nL(T.value,S.value)}function iG(T,S){return S instanceof iL&&T.op===S.op&&T.filters.length===S.filters.length&&T.filters.reduce((T,R,N)=>T&&iz(R,S.filters[N]),!0)}function i$(T,S){let R=T.filters.concat(S);return iL.create(R,T.op)}function iK(T){return T instanceof iM?iW(T):T instanceof iL?iH(T):"Filter"}function iH(T){return T.op.toString()+" {"+T.getFilters().map(iK).join(" ,")+"}"}function iW(T){return`${T.field.canonicalString()} ${T.op} ${nX(T.value)}`}class iQ extends iM{constructor(T,S,R){super(T,S,R),this.key=eG.fromName(R.referenceValue)}matches(T){let S=eG.comparator(T.key,this.key);return this.matchesComparison(S)}}class iY extends iM{constructor(T,S){super(T,"in",S),this.keys=iX("in",S)}matches(T){return this.keys.some(S=>S.isEqual(T.key))}}class iJ extends iM{constructor(T,S){super(T,"not-in",S),this.keys=iX("not-in",S)}matches(T){return!this.keys.some(S=>S.isEqual(T.key))}}function iX(T,S){var R;return((null===(R=S.arrayValue)||void 0===R?void 0:R.values)||[]).map(T=>eG.fromName(T.referenceValue))}class iZ extends iM{constructor(T,S){super(T,"array-contains",S)}matches(T){let S=T.data.field(this.field);return io(S)&&nz(S.arrayValue,this.value)}}class i0 extends iM{constructor(T,S){super(T,"in",S)}matches(T){let S=T.data.field(this.field);return null!==S&&nz(this.value.arrayValue,S)}}class i1 extends iM{constructor(T,S){super(T,"not-in",S)}matches(T){if(nz(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let S=T.data.field(this.field);return null!==S&&void 0===S.nullValue&&!nz(this.value.arrayValue,S)}}class i2 extends iM{constructor(T,S){super(T,"array-contains-any",S)}matches(T){let S=T.data.field(this.field);return!!io(S)&&!!S.arrayValue.values&&S.arrayValue.values.some(T=>nz(this.value.arrayValue,T))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(T,S=null,R=[],N=[],O=null,P=null,M=null){this.path=T,this.collectionGroup=S,this.orderBy=R,this.filters=N,this.limit=O,this.startAt=P,this.endAt=M,this.memoizedCanonicalId=null}}function i4(T,S=null,R=[],N=[],O=null,P=null,M=null){return new i3(T,S,R,N,O,P,M)}function i6(T){let S=eg(T);if(null===S.memoizedCanonicalId){let T=S.path.canonicalString();null!==S.collectionGroup&&(T+="|cg:"+S.collectionGroup),T+="|f:"+S.filters.map(T=>ij(T)).join(",")+"|ob:"+S.orderBy.map(T=>iD(T)).join(","),nI(S.limit)||(T+="|l:"+S.limit),S.startAt&&(T+="|lb:"+(S.startAt.inclusive?"b:":"a:")+S.startAt.position.map(T=>nX(T)).join(",")),S.endAt&&(T+="|ub:"+(S.endAt.inclusive?"a:":"b:")+S.endAt.position.map(T=>nX(T)).join(",")),S.memoizedCanonicalId=T}return S.memoizedCanonicalId}function i9(T){let S=T.path.canonicalString();return null!==T.collectionGroup&&(S+=" collectionGroup="+T.collectionGroup),T.filters.length>0&&(S+=`, filters: [${T.filters.map(T=>iK(T)).join(", ")}]`),nI(T.limit)||(S+=", limit: "+T.limit),T.orderBy.length>0&&(S+=`, orderBy: [${T.orderBy.map(T=>iO(T)).join(", ")}]`),T.startAt&&(S+=", startAt: "+(T.startAt.inclusive?"b:":"a:")+T.startAt.position.map(T=>nX(T)).join(",")),T.endAt&&(S+=", endAt: "+(T.endAt.inclusive?"a:":"b:")+T.endAt.position.map(T=>nX(T)).join(",")),`Target(${S})`}function i5(T,S){if(T.limit!==S.limit||T.orderBy.length!==S.orderBy.length)return!1;for(let R=0;R<T.orderBy.length;R++)if(!ix(T.orderBy[R],S.orderBy[R]))return!1;if(T.filters.length!==S.filters.length)return!1;for(let R=0;R<T.filters.length;R++)if(!iz(T.filters[R],S.filters[R]))return!1;return!!(T.collectionGroup===S.collectionGroup&&T.path.isEqual(S.path)&&iN(T.startAt,S.startAt))&&iN(T.endAt,S.endAt)}function i8(T){return eG.isDocumentKey(T.path)&&null===T.collectionGroup&&0===T.filters.length}function i7(T,S){return T.filters.filter(T=>T instanceof iM&&T.field.isEqual(S))}function se(T,S){let R=e7(S);if(void 0===R)return null;for(let S of i7(T,R.fieldPath))switch(S.op){case"array-contains-any":return S.value.arrayValue.values||[];case"array-contains":return[S.value]}return null}function st(T,S){let R=new Map;for(let N of te(S))for(let S of i7(T,N.fieldPath))switch(S.op){case"==":case"in":R.set(N.fieldPath.canonicalString(),S.value);break;case"not-in":case"!=":return R.set(N.fieldPath.canonicalString(),S.value),Array.from(R.values())}return null}function sr(T,S){let R=[],N=!0;for(let O of te(S)){let S=0===O.kind?si(T,O.fieldPath,T.startAt):ss(T,O.fieldPath,T.startAt);R.push(S.value),N&&(N=S.inclusive)}return new iC(R,N)}function sn(T,S){let R=[],N=!0;for(let O of te(S)){let S=0===O.kind?ss(T,O.fieldPath,T.endAt):si(T,O.fieldPath,T.endAt);R.push(S.value),N&&(N=S.inclusive)}return new iC(R,N)}function si(T,S,R){let N=nP,O=!0;for(let R of i7(T,S)){let T=nP,S=!0;switch(R.op){case"<":case"<=":T=iy(R.value);break;case"==":case"in":case">=":T=R.value;break;case">":T=R.value,S=!1;break;case"!=":case"not-in":T=nP}0>ib({value:N,inclusive:O},{value:T,inclusive:S})&&(N=T,O=S)}if(null!==R){for(let P=0;P<T.orderBy.length;++P)if(T.orderBy[P].field.isEqual(S)){let T=R.position[P];0>ib({value:N,inclusive:O},{value:T,inclusive:R.inclusive})&&(N=T,O=R.inclusive);break}}return{value:N,inclusive:O}}function ss(T,S,R){let N=nD,O=!0;for(let R of i7(T,S)){let T=nD,S=!0;switch(R.op){case">=":case">":T=iv(R.value),S=!1;break;case"==":case"in":case"<=":T=R.value;break;case"<":T=R.value,S=!1;break;case"!=":case"not-in":T=nD}iT({value:N,inclusive:O},{value:T,inclusive:S})>0&&(N=T,O=S)}if(null!==R){for(let P=0;P<T.orderBy.length;++P)if(T.orderBy[P].field.isEqual(S)){let T=R.position[P];iT({value:N,inclusive:O},{value:T,inclusive:R.inclusive})>0&&(N=T,O=R.inclusive);break}}return{value:N,inclusive:O}}function sa(T){let S=new r9(eq.comparator),R=!1;for(let N of T.filters)for(let T of N.getFlattenedFilters())T.field.isKeyField()||("array-contains"===T.op||"array-contains-any"===T.op?R=!0:S=S.add(T.field));for(let R of T.orderBy)R.field.isKeyField()||(S=S.add(R.field));return S.size+(R?1:0)}function so(T){return null!==T.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(T,S=null,R=[],N=[],O=null,P="F",M=null,L=null){this.path=T,this.collectionGroup=S,this.explicitOrderBy=R,this.filters=N,this.limit=O,this.limitType=P,this.startAt=M,this.endAt=L,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function su(T,S,R,N,O,P,M,L){return new sl(T,S,R,N,O,P,M,L)}function sc(T){return new sl(T)}function sd(T,S){return new sl(S,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}function sh(T){return 0===T.filters.length&&null===T.limit&&null==T.startAt&&null==T.endAt&&(0===T.explicitOrderBy.length||1===T.explicitOrderBy.length&&T.explicitOrderBy[0].field.isKeyField())}function sp(T){let S=new r9(eq.comparator);return T.filters.forEach(T=>{T.getFlattenedFilters().forEach(T=>{T.isInequality()&&(S=S.add(T.field))})}),S}function sf(T){return eG.isDocumentKey(T.path)&&null===T.collectionGroup&&0===T.filters.length}function sm(T){return null!==T.collectionGroup}function sg(T){let S=eg(T);if(null===S.memoizedNormalizedOrderBy){S.memoizedNormalizedOrderBy=[];let T=new Set;for(let R of S.explicitOrderBy)S.memoizedNormalizedOrderBy.push(R),T.add(R.field.canonicalString());let R=S.explicitOrderBy.length>0?S.explicitOrderBy[S.explicitOrderBy.length-1].dir:"asc";sp(S).forEach(N=>{T.has(N.canonicalString())||N.isKeyField()||S.memoizedNormalizedOrderBy.push(new iA(N,R))}),T.has(eq.keyField().canonicalString())||S.memoizedNormalizedOrderBy.push(new iA(eq.keyField(),R))}return S.memoizedNormalizedOrderBy}function sy(T){let S=eg(T);return S.memoizedTarget||(S.memoizedTarget=sb(S,sg(T))),S.memoizedTarget}function sv(T){let S=eg(T);return S.memoizedAggregateTarget||(S.memoizedAggregateTarget=sb(S,T.explicitOrderBy)),S.memoizedAggregateTarget}function sb(T,S){if("F"===T.limitType)return i4(T.path,T.collectionGroup,S,T.filters,T.limit,T.startAt,T.endAt);{S=S.map(T=>{let S="desc"===T.dir?"asc":"desc";return new iA(T.field,S)});let R=T.endAt?new iC(T.endAt.position,T.endAt.inclusive):null,N=T.startAt?new iC(T.startAt.position,T.startAt.inclusive):null;return i4(T.path,T.collectionGroup,S,T.filters,T.limit,R,N)}}function sT(T,S){let R=T.filters.concat([S]);return new sl(T.path,T.collectionGroup,T.explicitOrderBy.slice(),R,T.limit,T.limitType,T.startAt,T.endAt)}function sS(T,S){let R=T.explicitOrderBy.concat([S]);return new sl(T.path,T.collectionGroup,R,T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)}function sE(T,S,R){return new sl(T.path,T.collectionGroup,T.explicitOrderBy.slice(),T.filters.slice(),S,R,T.startAt,T.endAt)}function s_(T,S){return new sl(T.path,T.collectionGroup,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,S,T.endAt)}function sw(T,S){return new sl(T.path,T.collectionGroup,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,S)}function sC(T,S){return i5(sy(T),sy(S))&&T.limitType===S.limitType}function sI(T){return`${i6(sy(T))}|lt:${T.limitType}`}function sR(T){return`Query(target=${i9(sy(T))}; limitType=${T.limitType})`}function sk(T,S){return S.isFoundDocument()&&sN(T,S)&&sA(T,S)&&sD(T,S)&&sO(T,S)}function sN(T,S){let R=S.key.path;return null!==T.collectionGroup?S.key.hasCollectionId(T.collectionGroup)&&T.path.isPrefixOf(R):eG.isDocumentKey(T.path)?T.path.isEqual(R):T.path.isImmediateParentOf(R)}function sA(T,S){for(let R of sg(T))if(!R.field.isKeyField()&&null===S.data.field(R.field))return!1;return!0}function sD(T,S){for(let R of T.filters)if(!R.matches(S))return!1;return!0}function sO(T,S){return(!T.startAt||!!ik(T.startAt,sg(T),S))&&(!T.endAt||!!iR(T.endAt,sg(T),S))}function sx(T){return T.collectionGroup||(T.path.length%2==1?T.path.lastSegment():T.path.get(T.path.length-2))}function sP(T){return(S,R)=>{let N=!1;for(let O of sg(T)){let T=sM(O,S,R);if(0!==T)return T;N=N||O.field.isKeyField()}return 0}}function sM(T,S,R){let N=T.field.isKeyField()?eG.comparator(S.key,R.key):iw(T.field,S,R);switch(T.dir){case"asc":return N;case"desc":return -1*N;default:return ep(19790,{direction:T.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sL{constructor(T,S){this.mapKeyFn=T,this.equalsFn=S,this.inner={},this.innerSize=0}get(T){let S=this.mapKeyFn(T),R=this.inner[S];if(void 0!==R){for(let[S,N]of R)if(this.equalsFn(S,T))return N}}has(T){return void 0!==this.get(T)}set(T,S){let R=this.mapKeyFn(T),N=this.inner[R];if(void 0===N){this.inner[R]=[[T,S]],this.innerSize++;return}for(let R=0;R<N.length;R++)if(this.equalsFn(N[R][0],T)){N[R]=[T,S];return}N.push([T,S]),this.innerSize++}delete(T){let S=this.mapKeyFn(T),R=this.inner[S];if(void 0===R)return!1;for(let N=0;N<R.length;N++)if(this.equalsFn(R[N][0],T))return 1===R.length?delete this.inner[S]:R.splice(N,1),this.innerSize--,!0;return!1}forEach(T){r0(this.inner,(S,R)=>{for(let[S,N]of R)T(S,N)})}isEmpty(){return r1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sF=new r2(eG.comparator);function sB(){return sF}let sU=new r2(eG.comparator);function sV(...T){let S=sU;for(let R of T)S=S.insert(R.key,R);return S}function sj(){return s$()}function sz(T){let S=sU;return T.forEach((T,R)=>S=S.insert(T,R.overlayedDocument)),S}function sq(){return s$()}function sG(){return s$()}function s$(){return new sL(T=>T.toString(),(T,S)=>T.isEqual(S))}let sK=new r2(eG.comparator);function sH(){return sK}let sW=new r9(eG.comparator);function sQ(...T){let S=sW;for(let R of T)S=S.add(R);return S}let sY=new r9(ex);function sJ(){return sY}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sX(T,S){if(T.useProto3Json){if(isNaN(S))return{doubleValue:"NaN"};if(S===1/0)return{doubleValue:"Infinity"};if(S===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nR(S)?"-0":S}}function sZ(T){return{integerValue:""+T}}function s0(T,S){return nk(S)?sZ(S):sX(T,S)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(){this._=void 0}}function s2(T,S,R){return T instanceof s9?nv(R,S):T instanceof s5?s8(T,S):T instanceof s7?ae(T,S):ar(T,S)}function s3(T,S,R){return T instanceof s5?s8(T,S):T instanceof s7?ae(T,S):R}function s4(T,S){return T instanceof at?ia(S)?S:{integerValue:0}:null}function s6(T,S){return T instanceof s5&&S instanceof s5||T instanceof s7&&S instanceof s7?eF(T.elements,S.elements,nL):T instanceof at&&S instanceof at?nL(T.operand,S.operand):T instanceof s9&&S instanceof s9}class s9 extends s1{}class s5 extends s1{constructor(T){super(),this.elements=T}}function s8(T,S){let R=ai(S);for(let S of T.elements)R.some(T=>nL(T,S))||R.push(S);return{arrayValue:{values:R}}}class s7 extends s1{constructor(T){super(),this.elements=T}}function ae(T,S){let R=ai(S);for(let S of T.elements)R=R.filter(T=>!nL(T,S));return{arrayValue:{values:R}}}class at extends s1{constructor(T,S){super(),this.serializer=T,this.operand=S}}function ar(T,S){let R=s4(T,S),N=an(R)+an(T.operand);return ii(R)&&ii(T.operand)?sZ(N):sX(T.serializer,N)}function an(T){return nd(T.integerValue||T.doubleValue)}function ai(T){return io(T)&&T.arrayValue.values?T.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(T,S){this.field=T,this.transform=S}}function aa(T,S){return T.field.isEqual(S.field)&&s6(T.transform,S.transform)}function ao(T,S){return void 0===T&&void 0===S||!!T&&!!S&&eF(T,S,(T,S)=>aa(T,S))}class al{constructor(T,S){this.version=T,this.transformResults=S}}class au{constructor(T,S){this.updateTime=T,this.exists=S}static none(){return new au}static exists(T){return new au(void 0,T)}static updateTime(T){return new au(T)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(T){return this.exists===T.exists&&(this.updateTime?!!T.updateTime&&this.updateTime.isEqual(T.updateTime):!T.updateTime)}}function ac(T,S){return void 0!==T.updateTime?S.isFoundDocument()&&S.version.isEqual(T.updateTime):void 0===T.exists||T.exists===S.isFoundDocument()}class ad{}function ah(T,S){if(!T.hasLocalMutations||S&&0===S.fields.length)return null;if(null===S)return T.isNoDocument()?new aI(T.key,au.none()):new ay(T.key,T.data,au.none());{let R=T.data,N=iS.empty(),O=new r9(eq.comparator);for(let T of S.fields)if(!O.has(T)){let S=R.field(T);null===S&&T.length>1&&(T=T.popLast(),S=R.field(T)),null===S?N.delete(T):N.set(T,S),O=O.add(T)}return new aT(T.key,N,new ne(O.toArray()),au.none())}}function ap(T,S,R){T instanceof ay?av(T,S,R):T instanceof aT?aS(T,S,R):aR(T,S,R)}function af(T,S,R,N){return T instanceof ay?ab(T,S,R,N):T instanceof aT?aE(T,S,R,N):ak(T,S,R)}function am(T,S){let R=null;for(let N of T.fieldTransforms){let T=S.data.field(N.field),O=s4(N.transform,T||null);null!=O&&(null===R&&(R=iS.empty()),R.set(N.field,O))}return R||null}function ag(T,S){return!!(T.type===S.type&&T.key.isEqual(S.key)&&T.precondition.isEqual(S.precondition)&&ao(T.fieldTransforms,S.fieldTransforms))&&(0===T.type?T.value.isEqual(S.value):1!==T.type||T.data.isEqual(S.data)&&T.fieldMask.isEqual(S.fieldMask))}class ay extends ad{constructor(T,S,R,N=[]){super(),this.key=T,this.value=S,this.precondition=R,this.fieldTransforms=N,this.type=0}getFieldMask(){return null}}function av(T,S,R){let N=T.value.clone(),O=aw(T.fieldTransforms,S,R.transformResults);N.setAll(O),S.convertToFoundDocument(R.version,N).setHasCommittedMutations()}function ab(T,S,R,N){if(!ac(T.precondition,S))return R;let O=T.value.clone(),P=aC(T.fieldTransforms,N,S);return O.setAll(P),S.convertToFoundDocument(S.version,O).setHasLocalMutations(),null}class aT extends ad{constructor(T,S,R,N,O=[]){super(),this.key=T,this.data=S,this.fieldMask=R,this.precondition=N,this.fieldTransforms=O,this.type=1}getFieldMask(){return this.fieldMask}}function aS(T,S,R){if(!ac(T.precondition,S)){S.convertToUnknownDocument(R.version);return}let N=aw(T.fieldTransforms,S,R.transformResults),O=S.data;O.setAll(a_(T)),O.setAll(N),S.convertToFoundDocument(R.version,O).setHasCommittedMutations()}function aE(T,S,R,N){if(!ac(T.precondition,S))return R;let O=aC(T.fieldTransforms,N,S),P=S.data;return(P.setAll(a_(T)),P.setAll(O),S.convertToFoundDocument(S.version,P).setHasLocalMutations(),null===R)?null:R.unionWith(T.fieldMask.fields).unionWith(T.fieldTransforms.map(T=>T.field))}function a_(T){let S=new Map;return T.fieldMask.fields.forEach(R=>{if(!R.isEmpty()){let N=T.data.field(R);S.set(R,N)}}),S}function aw(T,S,R){let N=new Map;em(T.length===R.length,32656,{serverTransformResultCount:R.length,fieldTransformCount:T.length});for(let O=0;O<R.length;O++){let P=T[O],M=P.transform,L=S.data.field(P.field);N.set(P.field,s3(M,L,R[O]))}return N}function aC(T,S,R){let N=new Map;for(let O of T){let T=O.transform,P=R.data.field(O.field);N.set(O.field,s2(T,P,S))}return N}class aI extends ad{constructor(T,S){super(),this.key=T,this.precondition=S,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function aR(T,S,R){S.convertToNoDocument(R.version).setHasCommittedMutations()}function ak(T,S,R){return ac(T.precondition,S)?(S.convertToNoDocument(S.version).setHasLocalMutations(),null):R}class aN extends ad{constructor(T,S){super(),this.key=T,this.precondition=S,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(T,S,R,N){this.batchId=T,this.localWriteTime=S,this.baseMutations=R,this.mutations=N}applyToRemoteDocument(T,S){let R=S.mutationResults;for(let S=0;S<this.mutations.length;S++){let N=this.mutations[S];N.key.isEqual(T.key)&&ap(N,T,R[S])}}applyToLocalView(T,S){for(let R of this.baseMutations)R.key.isEqual(T.key)&&(S=af(R,T,S,this.localWriteTime));for(let R of this.mutations)R.key.isEqual(T.key)&&(S=af(R,T,S,this.localWriteTime));return S}applyToLocalDocumentSet(T,S){let R=sG();return this.mutations.forEach(N=>{let O=T.get(N.key),P=O.overlayedDocument,M=this.applyToLocalView(P,O.mutatedFields),L=ah(P,M=S.has(N.key)?null:M);null!==L&&R.set(N.key,L),P.isValidDocument()||P.convertToNoDocument(e6.min())}),R}keys(){return this.mutations.reduce((T,S)=>T.add(S.key),sQ())}isEqual(T){return this.batchId===T.batchId&&eF(this.mutations,T.mutations,(T,S)=>ag(T,S))&&eF(this.baseMutations,T.baseMutations,(T,S)=>ag(T,S))}}class aD{constructor(T,S,R,N){this.batch=T,this.commitVersion=S,this.mutationResults=R,this.docVersions=N}static from(T,S,R){em(T.mutations.length===R.length,58842,{mutationsSent:T.mutations.length,resultsReceived:R.length});let N=sH(),O=T.mutations;for(let T=0;T<O.length;T++)N=N.insert(O[T].key,R[T].version);return new aD(T,S,R,N)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(T,S){this.largestBatchId=T,this.mutation=S}getKey(){return this.mutation.key}isEqual(T){return null!==T&&this.mutation===T.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(T,S){this.count=T,this.unchangedNames=S}}function aP(T){switch(T){case ey.OK:return ep(64938);case ey.CANCELLED:case ey.UNKNOWN:case ey.DEADLINE_EXCEEDED:case ey.RESOURCE_EXHAUSTED:case ey.INTERNAL:case ey.UNAVAILABLE:case ey.UNAUTHENTICATED:return!1;case ey.INVALID_ARGUMENT:case ey.NOT_FOUND:case ey.ALREADY_EXISTS:case ey.PERMISSION_DENIED:case ey.FAILED_PRECONDITION:case ey.ABORTED:case ey.OUT_OF_RANGE:case ey.UNIMPLEMENTED:case ey.DATA_LOSS:return!0;default:return ep(15467,{code:T})}}function aM(T){return aP(T)&&T!==ey.ABORTED}function aL(T){if(void 0===T)return ec("GRPC error has no .code"),ey.UNKNOWN;switch(T){case P.OK:return ey.OK;case P.CANCELLED:return ey.CANCELLED;case P.UNKNOWN:return ey.UNKNOWN;case P.DEADLINE_EXCEEDED:return ey.DEADLINE_EXCEEDED;case P.RESOURCE_EXHAUSTED:return ey.RESOURCE_EXHAUSTED;case P.INTERNAL:return ey.INTERNAL;case P.UNAVAILABLE:return ey.UNAVAILABLE;case P.UNAUTHENTICATED:return ey.UNAUTHENTICATED;case P.INVALID_ARGUMENT:return ey.INVALID_ARGUMENT;case P.NOT_FOUND:return ey.NOT_FOUND;case P.ALREADY_EXISTS:return ey.ALREADY_EXISTS;case P.PERMISSION_DENIED:return ey.PERMISSION_DENIED;case P.FAILED_PRECONDITION:return ey.FAILED_PRECONDITION;case P.ABORTED:return ey.ABORTED;case P.OUT_OF_RANGE:return ey.OUT_OF_RANGE;case P.UNIMPLEMENTED:return ey.UNIMPLEMENTED;case P.DATA_LOSS:return ey.DATA_LOSS;default:return ep(39323,{code:T})}}!function(T){T[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS"}(P||(P={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aF extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aB=null,aU=new N([4294967295,4294967295],0);function aV(T){let S=eA().encode(T),R=new O;return R.update(S),new Uint8Array(R.digest())}function aj(T){let S=new DataView(T.buffer),R=S.getUint32(0,!0),O=S.getUint32(4,!0),P=S.getUint32(8,!0),M=S.getUint32(12,!0);return[new N([R,O],0),new N([P,M],0)]}class az{constructor(T,S,R){if(this.bitmap=T,this.padding=S,this.hashCount=R,S<0||S>=8)throw new aq(`Invalid padding: ${S}`);if(R<0||T.length>0&&0===this.hashCount)throw new aq(`Invalid hash count: ${R}`);if(0===T.length&&0!==S)throw new aq(`Invalid padding when bitmap length is 0: ${S}`);this.bitCount=8*T.length-S,this.bitCountInInteger=N.fromNumber(this.bitCount)}getBitIndex(T,S,R){let O=T.add(S.multiply(N.fromNumber(R)));return 1===O.compare(aU)&&(O=new N([O.getBits(0),O.getBits(1)],0)),O.modulo(this.bitCountInInteger).toNumber()}isBitSet(T){return(this.bitmap[Math.floor(T/8)]&1<<T%8)!=0}mightContain(T){if(0===this.bitCount)return!1;let[S,R]=aj(aV(T));for(let T=0;T<this.hashCount;T++){let N=this.getBitIndex(S,R,T);if(!this.isBitSet(N))return!1}return!0}static create(T,S,R){let N=T%8==0?0:8-T%8,O=new az(new Uint8Array(Math.ceil(T/8)),N,S);return R.forEach(T=>O.insert(T)),O}insert(T){if(0===this.bitCount)return;let[S,R]=aj(aV(T));for(let T=0;T<this.hashCount;T++){let N=this.getBitIndex(S,R,T);this.setBit(N)}}setBit(T){let S=Math.floor(T/8),R=T%8;this.bitmap[S]|=1<<R}}class aq extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aG{constructor(T,S,R,N,O){this.snapshotVersion=T,this.targetChanges=S,this.targetMismatches=R,this.documentUpdates=N,this.resolvedLimboDocuments=O}static createSynthesizedRemoteEventForCurrentChange(T,S,R){let N=new Map;return N.set(T,a$.createSynthesizedTargetChangeForCurrentChange(T,S,R)),new aG(e6.min(),N,new r2(ex),sB(),sQ())}}class a${constructor(T,S,R,N,O){this.resumeToken=T,this.current=S,this.addedDocuments=R,this.modifiedDocuments=N,this.removedDocuments=O}static createSynthesizedTargetChangeForCurrentChange(T,S,R){return new a$(R,S,sQ(),sQ(),sQ())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aK{constructor(T,S,R,N){this.updatedTargetIds=T,this.removedTargetIds=S,this.key=R,this.newDoc=N}}class aH{constructor(T,S){this.targetId=T,this.existenceFilter=S}}class aW{constructor(T,S,R=ni.EMPTY_BYTE_STRING,N=null){this.state=T,this.targetIds=S,this.resumeToken=R,this.cause=N}}class aQ{constructor(){this.pendingResponses=0,this.documentChanges=aZ(),this._resumeToken=ni.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(T){T.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=T)}toTargetChange(){let T=sQ(),S=sQ(),R=sQ();return this.documentChanges.forEach((N,O)=>{switch(O){case 0:T=T.add(N);break;case 2:S=S.add(N);break;case 1:R=R.add(N);break;default:ep(38017,{changeType:O})}}),new a$(this._resumeToken,this._current,T,S,R)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=aZ()}addDocumentChange(T,S){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(T,S)}removeDocumentChange(T){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(T)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,em(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let aY="WatchChangeAggregator";class aJ{constructor(T){this.metadataProvider=T,this.targetStates=new Map,this.pendingDocumentUpdates=sB(),this.pendingDocumentUpdatesByTarget=aX(),this.pendingDocumentTargetMapping=aX(),this.pendingTargetResets=new r2(ex)}handleDocumentChange(T){for(let S of T.updatedTargetIds)T.newDoc&&T.newDoc.isFoundDocument()?this.addDocumentToTarget(S,T.newDoc):this.removeDocumentFromTarget(S,T.key,T.newDoc);for(let S of T.removedTargetIds)this.removeDocumentFromTarget(S,T.key,T.newDoc)}handleTargetChange(T){this.forEachTarget(T,S=>{let R=this.ensureTargetState(S);switch(T.state){case 0:this.isActiveTarget(S)&&R.updateResumeToken(T.resumeToken);break;case 1:R.recordTargetResponse(),R.isPending||R.clearPendingChanges(),R.updateResumeToken(T.resumeToken);break;case 2:R.recordTargetResponse(),R.isPending||this.removeTarget(S);break;case 3:this.isActiveTarget(S)&&(R.markCurrent(),R.updateResumeToken(T.resumeToken));break;case 4:this.isActiveTarget(S)&&(this.resetTarget(S),R.updateResumeToken(T.resumeToken));break;default:ep(56790,{state:T.state})}})}forEachTarget(T,S){T.targetIds.length>0?T.targetIds.forEach(S):this.targetStates.forEach((T,R)=>{this.isActiveTarget(R)&&S(R)})}handleExistenceFilter(T){let S=T.targetId,R=T.existenceFilter.count,N=this.targetDataForActiveTarget(S);if(N){let O=N.target;if(i8(O)){if(0===R){let T=new eG(O.path);this.removeDocumentFromTarget(S,T,i_.newNoDocument(T,e6.min()))}else em(1===R,20013,{expectedCount:R})}else{let N=this.getCurrentDocumentCountForTarget(S);if(N!==R){let R=this.parseBloomFilter(T),O=R?this.applyBloomFilter(R,T,N):1;if(0!==O){this.resetTarget(S);let T=2===O?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(S,T)}null==aB||aB.notifyOnExistenceFilterMismatch(a0(N,T.existenceFilter,this.metadataProvider.getDatabaseId(),R,O))}}}}parseBloomFilter(T){let S,R;let N=T.existenceFilter.unchangedNames;if(!N||!N.bits)return null;let{bits:{bitmap:O="",padding:P=0},hashCount:M=0}=N;try{S=nh(O).toUint8Array()}catch(T){if(T instanceof aF)return ed("Decoding the base64 bloom filter in existence filter failed ("+T.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw T}try{R=new az(S,P,M)}catch(T){return T instanceof aq?ed("BloomFilter error: ",T):ed("Applying bloom filter failed: ",T),null}return 0===R.bitCount?null:R}applyBloomFilter(T,S,R){return S.existenceFilter.count===R-this.filterRemovedDocuments(T,S.targetId)?0:2}filterRemovedDocuments(T,S){let R=this.metadataProvider.getRemoteKeysForTarget(S),N=0;return R.forEach(R=>{let O=this.metadataProvider.getDatabaseId(),P=`projects/${O.projectId}/databases/${O.database}/documents/${R.path.canonicalString()}`;!T.mightContain(P)&&(this.removeDocumentFromTarget(S,R,null),N++)}),N}createRemoteEvent(T){let S=new Map;this.targetStates.forEach((R,N)=>{let O=this.targetDataForActiveTarget(N);if(O){if(R.current&&i8(O.target)){let S=new eG(O.target.path);this.ensureDocumentUpdateByTarget(S).has(N)||this.targetContainsDocument(N,S)||this.removeDocumentFromTarget(N,S,i_.newNoDocument(S,T))}R.hasPendingChanges&&(S.set(N,R.toTargetChange()),R.clearPendingChanges())}});let R=sQ();this.pendingDocumentTargetMapping.forEach((T,S)=>{let N=!0;S.forEachWhile(T=>{let S=this.targetDataForActiveTarget(T);return!S||"TargetPurposeLimboResolution"===S.purpose||(N=!1,!1)}),N&&(R=R.add(T))}),this.pendingDocumentUpdates.forEach((S,R)=>R.setReadTime(T));let N=new aG(T,S,this.pendingTargetResets,this.pendingDocumentUpdates,R);return this.pendingDocumentUpdates=sB(),this.pendingDocumentUpdatesByTarget=aX(),this.pendingDocumentTargetMapping=aX(),this.pendingTargetResets=new r2(ex),N}addDocumentToTarget(T,S){if(!this.isActiveTarget(T))return;let R=this.targetContainsDocument(T,S.key)?2:0;this.ensureTargetState(T).addDocumentChange(S.key,R),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(S.key,S),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(S.key,this.ensureDocumentUpdateByTarget(S.key).add(T)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(S.key,this.ensureDocumentTargetMapping(S.key).add(T))}removeDocumentFromTarget(T,S,R){if(!this.isActiveTarget(T))return;let N=this.ensureTargetState(T);this.targetContainsDocument(T,S)?N.addDocumentChange(S,1):N.removeDocumentChange(S),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(S,this.ensureDocumentTargetMapping(S).delete(T)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(S,this.ensureDocumentTargetMapping(S).add(T)),R&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(S,R))}removeTarget(T){this.targetStates.delete(T)}getCurrentDocumentCountForTarget(T){let S=this.ensureTargetState(T).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(T).size+S.addedDocuments.size-S.removedDocuments.size}recordPendingTargetRequest(T){this.ensureTargetState(T).recordPendingTargetRequest()}ensureTargetState(T){let S=this.targetStates.get(T);return S||(S=new aQ,this.targetStates.set(T,S)),S}ensureDocumentTargetMapping(T){let S=this.pendingDocumentTargetMapping.get(T);return S||(S=new r9(ex),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T,S)),S}ensureDocumentUpdateByTarget(T){let S=this.pendingDocumentUpdatesByTarget.get(T);return S||(S=new r9(ex),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(T,S)),S}isActiveTarget(T){let S=null!==this.targetDataForActiveTarget(T);return S||eu(aY,"Detected inactive target",T),S}targetDataForActiveTarget(T){let S=this.targetStates.get(T);return S&&S.isPending?null:this.metadataProvider.getTargetDataForTarget(T)}resetTarget(T){this.targetStates.set(T,new aQ),this.metadataProvider.getRemoteKeysForTarget(T).forEach(S=>{this.removeDocumentFromTarget(T,S,null)})}targetContainsDocument(T,S){return this.metadataProvider.getRemoteKeysForTarget(T).has(S)}}function aX(){return new r2(eG.comparator)}function aZ(){return new r2(eG.comparator)}function a0(T,S,R,N,O){var P,M,L,U,V,$;let K={localCacheCount:T,existenceFilterCount:S.count,databaseId:R.database,projectId:R.projectId},W=S.unchangedNames;return W&&(K.bloomFilter={applied:0===O,hashCount:null!==(P=null==W?void 0:W.hashCount)&&void 0!==P?P:0,bitmapLength:null!==(U=null===(L=null===(M=null==W?void 0:W.bits)||void 0===M?void 0:M.bitmap)||void 0===L?void 0:L.length)&&void 0!==U?U:0,padding:null!==($=null===(V=null==W?void 0:W.bits)||void 0===V?void 0:V.padding)&&void 0!==$?$:0,mightContain:T=>{var S;return null!==(S=null==N?void 0:N.mightContain(T))&&void 0!==S&&S}}),K}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let a1=(()=>{let T={};return T.asc="ASCENDING",T.desc="DESCENDING",T})(),a2=(()=>{let T={};return T["<"]="LESS_THAN",T["<="]="LESS_THAN_OR_EQUAL",T[">"]="GREATER_THAN",T[">="]="GREATER_THAN_OR_EQUAL",T["=="]="EQUAL",T["!="]="NOT_EQUAL",T["array-contains"]="ARRAY_CONTAINS",T.in="IN",T["not-in"]="NOT_IN",T["array-contains-any"]="ARRAY_CONTAINS_ANY",T})(),a3=(()=>{let T={};return T.and="AND",T.or="OR",T})();class a4{constructor(T,S){this.databaseId=T,this.useProto3Json=S}}function a6(T){return new ev(void 0===T.code?ey.UNKNOWN:aL(T.code),T.message||"")}function a9(T,S){return T.useProto3Json||nI(S)?S:{value:S}}function a5(T){let S;return nI(S="object"==typeof T?T.value:T)?null:S}function a8(T,S){if(!T.useProto3Json)return{seconds:""+S.seconds,nanos:S.nanoseconds};{let T=new Date(1e3*S.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),R=("000000000"+S.nanoseconds).slice(-9);return`${T}.${R}Z`}}function a7(T){let S=nc(T);return new e4(S.seconds,S.nanos)}function oe(T,S){return T.useProto3Json?S.toBase64():S.toUint8Array()}function ot(T,S){return T.useProto3Json?(em(void 0===S||"string"==typeof S,58123),ni.fromBase64String(S||"")):(em(void 0===S||S instanceof Buffer||S instanceof Uint8Array,16193),ni.fromUint8Array(S||new Uint8Array))}function or(T,S){return a8(T,S.toTimestamp())}function on(T){return em(!!T,49232),e6.fromTimestamp(a7(T))}function oi(T,S){return oa(T,S).canonicalString()}function oa(T,S){let R=of(T).child("documents");return void 0===S?R:R.child(S)}function oo(T){let S=ej.fromString(T);return em(la(S),10190,{key:S.toString()}),S}function ol(T,S){return oi(T.databaseId,S.path)}function ou(T,S){let R=oo(S);if(R.get(1)!==T.databaseId.projectId)throw new ev(ey.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+R.get(1)+" vs "+T.databaseId.projectId);if(R.get(3)!==T.databaseId.database)throw new ev(ey.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+R.get(3)+" vs "+T.databaseId.database);return new eG(om(R))}function oc(T,S){return oi(T.databaseId,S)}function od(T){let S=oo(T);return 4===S.length?ej.emptyPath():om(S)}function oh(T){return new ej(["projects",T.databaseId.projectId,"databases",T.databaseId.database]).canonicalString()}function of(T){return new ej(["projects",T.projectId,"databases",T.database])}function om(T){return em(T.length>4&&"documents"===T.get(4),29091,{key:T.toString()}),T.popFirst(5)}function og(T,S,R){return{name:ol(T,S),fields:R.value.mapValue.fields}}function oy(T,S){return{name:ol(T,S.key),fields:S.data.value.mapValue.fields,updateTime:a8(T,S.version.toTimestamp()),createTime:a8(T,S.createTime.toTimestamp())}}function ov(T,S,R){let N=ou(T,S.name),O=on(S.updateTime),P=S.createTime?on(S.createTime):e6.min(),M=new iS({mapValue:{fields:S.fields}}),L=i_.newFoundDocument(N,O,P,M);return R&&L.setHasCommittedMutations(),R?L.setHasCommittedMutations():L}function ob(T,S){em(!!S.found,43571),S.found.name,S.found.updateTime;let R=ou(T,S.found.name),N=on(S.found.updateTime),O=S.found.createTime?on(S.found.createTime):e6.min(),P=new iS({mapValue:{fields:S.found.fields}});return i_.newFoundDocument(R,N,O,P)}function oT(T,S){em(!!S.missing,3894),em(!!S.readTime,22933);let R=ou(T,S.missing),N=on(S.readTime);return i_.newNoDocument(R,N)}function oS(T,S){return"found"in S?ob(T,S):"missing"in S?oT(T,S):ep(7234,{result:S})}function oE(T,S){let R;if("targetChange"in S){S.targetChange;let N=o_(S.targetChange.targetChangeType||"NO_CHANGE"),O=S.targetChange.targetIds||[],P=ot(T,S.targetChange.resumeToken),M=S.targetChange.cause;R=new aW(N,O,P,M&&a6(M)||null)}else if("documentChange"in S){S.documentChange;let N=S.documentChange;N.document,N.document.name,N.document.updateTime;let O=ou(T,N.document.name),P=on(N.document.updateTime),M=N.document.createTime?on(N.document.createTime):e6.min(),L=new iS({mapValue:{fields:N.document.fields}}),U=i_.newFoundDocument(O,P,M,L);R=new aK(N.targetIds||[],N.removedTargetIds||[],U.key,U)}else if("documentDelete"in S){S.documentDelete;let N=S.documentDelete;N.document;let O=ou(T,N.document),P=N.readTime?on(N.readTime):e6.min(),M=i_.newNoDocument(O,P);R=new aK([],N.removedTargetIds||[],M.key,M)}else if("documentRemove"in S){S.documentRemove;let N=S.documentRemove;N.document;let O=ou(T,N.document);R=new aK([],N.removedTargetIds||[],O,null)}else{if(!("filter"in S))return ep(11601,{change:S});S.filter;let T=S.filter;T.targetId;let{count:N=0,unchangedNames:O}=T,P=new ax(N,O);R=new aH(T.targetId,P)}return R}function o_(T){return"NO_CHANGE"===T?0:"ADD"===T?1:"REMOVE"===T?2:"CURRENT"===T?3:"RESET"===T?4:ep(39313,{state:T})}function ow(T){if(!("targetChange"in T))return e6.min();let S=T.targetChange;return S.targetIds&&S.targetIds.length||!S.readTime?e6.min():on(S.readTime)}function oC(T,S){let R;if(S instanceof ay)R={update:og(T,S.key,S.value)};else if(S instanceof aI)R={delete:ol(T,S.key)};else if(S instanceof aT)R={update:og(T,S.key,S.data),updateMask:li(S.fieldMask)};else{if(!(S instanceof aN))return ep(16599,{mutationType:S.type});R={verify:ol(T,S.key)}}return S.fieldTransforms.length>0&&(R.updateTransforms=S.fieldTransforms.map(S=>oD(T,S))),S.precondition.isNone||(R.currentDocument=oR(T,S.precondition)),R}function oI(T,S){let R=S.currentDocument?ok(S.currentDocument):au.none(),N=S.updateTransforms?S.updateTransforms.map(S=>oO(T,S)):[];if(S.update){S.update.name;let O=ou(T,S.update.name),P=new iS({mapValue:{fields:S.update.fields}});return S.updateMask?new aT(O,P,ls(S.updateMask),R,N):new ay(O,P,R,N)}return S.delete?new aI(ou(T,S.delete),R):S.verify?new aN(ou(T,S.verify),R):ep(1463,{proto:S})}function oR(T,S){return void 0!==S.updateTime?{updateTime:or(T,S.updateTime)}:void 0!==S.exists?{exists:S.exists}:ep(27497)}function ok(T){return void 0!==T.updateTime?au.updateTime(on(T.updateTime)):void 0!==T.exists?au.exists(T.exists):au.none()}function oN(T,S){let R=T.updateTime?on(T.updateTime):on(S);return R.isEqual(e6.min())&&(R=on(S)),new al(R,T.transformResults||[])}function oA(T,S){return T&&T.length>0?(em(void 0!==S,14353),T.map(T=>oN(T,S))):[]}function oD(T,S){let R=S.transform;if(R instanceof s9)return{fieldPath:S.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(R instanceof s5)return{fieldPath:S.field.canonicalString(),appendMissingElements:{values:R.elements}};if(R instanceof s7)return{fieldPath:S.field.canonicalString(),removeAllFromArray:{values:R.elements}};if(R instanceof at)return{fieldPath:S.field.canonicalString(),increment:R.operand};throw ep(20930,{transform:S.transform})}function oO(T,S){let R=null;return"setToServerValue"in S?(em("REQUEST_TIME"===S.setToServerValue,16630,{proto:S}),R=new s9):"appendMissingElements"in S?R=new s5(S.appendMissingElements.values||[]):"removeAllFromArray"in S?R=new s7(S.removeAllFromArray.values||[]):"increment"in S?R=new at(T,S.increment):ep(16584,{proto:S}),new as(eq.fromServerFormat(S.fieldPath),R)}function ox(T,S){return{documents:[oc(T,S.path)]}}function oP(T){let S=T.documents.length;return em(1===S,1966,{count:S}),sy(sc(od(T.documents[0])))}function oM(T,S){let R;let N={structuredQuery:{}},O=S.path;null!==S.collectionGroup?(R=O,N.structuredQuery.from=[{collectionId:S.collectionGroup,allDescendants:!0}]):(R=O.popLast(),N.structuredQuery.from=[{collectionId:O.lastSegment()}]),N.parent=oc(T,R);let P=oz(S.filters);P&&(N.structuredQuery.where=P);let M=o$(S.orderBy);M&&(N.structuredQuery.orderBy=M);let L=a9(T,S.limit);return null!==L&&(N.structuredQuery.limit=L),S.startAt&&(N.structuredQuery.startAt=oH(S.startAt)),S.endAt&&(N.structuredQuery.endAt=oW(S.endAt)),{queryTarget:N,parent:R}}function oL(T,S,R,N){let{queryTarget:O,parent:P}=oM(T,S),M={},L=[],U=0;return R.forEach(T=>{let S=N?T.alias:`aggregate_${U++}`;M[S]=T.alias,"count"===T.aggregateType?L.push({alias:S,count:{}}):"avg"===T.aggregateType?L.push({alias:S,avg:{field:o3(T.fieldPath)}}):"sum"===T.aggregateType&&L.push({alias:S,sum:{field:o3(T.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:L,structuredQuery:O.structuredQuery},parent:O.parent},aliasMap:M,parent:P}}function oF(T){let S=od(T.parent),R=T.structuredQuery,N=R.from?R.from.length:0,O=null;if(N>0){em(1===N,65062);let T=R.from[0];T.allDescendants?O=T.collectionId:S=S.child(T.collectionId)}let P=[];R.where&&(P=oq(R.where));let M=[];R.orderBy&&(M=oK(R.orderBy));let L=null;R.limit&&(L=a5(R.limit));let U=null;R.startAt&&(U=oQ(R.startAt));let V=null;return R.endAt&&(V=oY(R.endAt)),su(S,O,M,P,L,"F",U,V)}function oB(T){return sy(oF(T))}function oU(T,S){let R=oV(S.purpose);return null==R?null:{"goog-listen-tags":R}}function oV(T){switch(T){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ep(28987,{purpose:T})}}function oj(T,S){let R;let N=S.target;if((R=i8(N)?{documents:ox(T,N)}:{query:oM(T,N).queryTarget}).targetId=S.targetId,S.resumeToken.approximateByteSize()>0){R.resumeToken=oe(T,S.resumeToken);let N=a9(T,S.expectedCount);null!==N&&(R.expectedCount=N)}else if(S.snapshotVersion.compareTo(e6.min())>0){R.readTime=a8(T,S.snapshotVersion.toTimestamp());let N=a9(T,S.expectedCount);null!==N&&(R.expectedCount=N)}return R}function oz(T){if(0!==T.length)return o5(iL.create(T,"and"))}function oq(T){let S=oG(T);return S instanceof iL&&iU(S)?S.getFilters():[S]}function oG(T){return void 0!==T.unaryFilter?lt(T):void 0!==T.fieldFilter?lr(T):void 0!==T.compositeFilter?ln(T):ep(30097,{filter:T})}function o$(T){if(0!==T.length)return T.map(T=>o6(T))}function oK(T){return T.map(T=>o9(T))}function oH(T){return{before:T.inclusive,values:T.position}}function oW(T){return{before:!T.inclusive,values:T.position}}function oQ(T){let S=!!T.before;return new iC(T.values||[],S)}function oY(T){let S=!T.before;return new iC(T.values||[],S)}function oJ(T){return a1[T]}function oX(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function oZ(T){return a2[T]}function o0(T){return a3[T]}function o1(T){switch(T){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ep(58110);default:return ep(50506)}}function o2(T){switch(T){case"AND":return"and";case"OR":return"or";default:return ep(1026)}}function o3(T){return{fieldPath:T.canonicalString()}}function o4(T){return eq.fromServerFormat(T.fieldPath)}function o6(T){return{field:o3(T.field),direction:oJ(T.dir)}}function o9(T){return new iA(o4(T.field),oX(T.direction))}function o5(T){return T instanceof iM?o7(T):T instanceof iL?o8(T):ep(54877,{filter:T})}function o8(T){let S=T.getFilters().map(T=>o5(T));return 1===S.length?S[0]:{compositeFilter:{op:o0(T.op),filters:S}}}function o7(T){if("=="===T.op){if(iu(T.value))return{unaryFilter:{field:o3(T.field),op:"IS_NAN"}};if(il(T.value))return{unaryFilter:{field:o3(T.field),op:"IS_NULL"}}}else if("!="===T.op){if(iu(T.value))return{unaryFilter:{field:o3(T.field),op:"IS_NOT_NAN"}};if(il(T.value))return{unaryFilter:{field:o3(T.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:o3(T.field),op:oZ(T.op),value:T.value}}}function lt(T){switch(T.unaryFilter.op){case"IS_NAN":let S=o4(T.unaryFilter.field);return iM.create(S,"==",{doubleValue:NaN});case"IS_NULL":let R=o4(T.unaryFilter.field);return iM.create(R,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let N=o4(T.unaryFilter.field);return iM.create(N,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let O=o4(T.unaryFilter.field);return iM.create(O,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ep(61313);default:return ep(60726)}}function lr(T){return iM.create(o4(T.fieldFilter.field),o1(T.fieldFilter.op),T.fieldFilter.value)}function ln(T){return iL.create(T.compositeFilter.filters.map(T=>oG(T)),o2(T.compositeFilter.op))}function li(T){let S=[];return T.fields.forEach(T=>S.push(T.canonicalString())),{fieldPaths:S}}function ls(T){return new ne((T.fieldPaths||[]).map(T=>eq.fromServerFormat(T)))}function la(T){return T.length>=4&&"projects"===T.get(0)&&"databases"===T.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(T,S,R,N,O=e6.min(),P=e6.min(),M=ni.EMPTY_BYTE_STRING,L=null){this.target=T,this.targetId=S,this.purpose=R,this.sequenceNumber=N,this.snapshotVersion=O,this.lastLimboFreeSnapshotVersion=P,this.resumeToken=M,this.expectedCount=L}withSequenceNumber(T){return new ll(this.target,this.targetId,this.purpose,T,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(T,S){return new ll(this.target,this.targetId,this.purpose,this.sequenceNumber,S,this.lastLimboFreeSnapshotVersion,T,null)}withExpectedCount(T){return new ll(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,T)}withLastLimboFreeSnapshotVersion(T){return new ll(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,T,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(T){this.remoteSerializer=T}}function lc(T,S){let R;if(S.document)R=ov(T.remoteSerializer,S.document,!!S.hasCommittedMutations);else if(S.noDocument){let T=eG.fromSegments(S.noDocument.path),N=lm(S.noDocument.readTime);R=i_.newNoDocument(T,N),S.hasCommittedMutations&&R.setHasCommittedMutations()}else{if(!S.unknownDocument)return ep(56709);let T=eG.fromSegments(S.unknownDocument.path),N=lm(S.unknownDocument.version);R=i_.newUnknownDocument(T,N)}return S.readTime&&R.setReadTime(lp(S.readTime)),R}function ld(T,S){let R=S.key,N={prefixPath:R.getCollectionPath().popLast().toArray(),collectionGroup:R.collectionGroup,documentId:R.path.lastSegment(),readTime:lh(S.readTime),hasCommittedMutations:S.hasCommittedMutations};if(S.isFoundDocument())N.document=oy(T.remoteSerializer,S);else if(S.isNoDocument())N.noDocument={path:R.path.toArray(),readTime:lf(S.version)};else{if(!S.isUnknownDocument())return ep(57904,{document:S});N.unknownDocument={path:R.path.toArray(),version:lf(S.version)}}return N}function lh(T){let S=T.toTimestamp();return[S.seconds,S.nanoseconds]}function lp(T){let S=new e4(T[0],T[1]);return e6.fromTimestamp(S)}function lf(T){let S=T.toTimestamp();return{seconds:S.seconds,nanoseconds:S.nanoseconds}}function lm(T){let S=new e4(T.seconds,T.nanoseconds);return e6.fromTimestamp(S)}function lg(T,S,R){let N=R.baseMutations.map(S=>oC(T.remoteSerializer,S)),O=R.mutations.map(S=>oC(T.remoteSerializer,S));return{userId:S,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:N,mutations:O}}function ly(T,S){let R=(S.baseMutations||[]).map(S=>oI(T.remoteSerializer,S));for(let T=0;T<S.mutations.length-1;++T){let R=S.mutations[T];if(T+1<S.mutations.length&&void 0!==S.mutations[T+1].transform){let N=S.mutations[T+1];R.updateTransforms=N.transform.fieldTransforms,S.mutations.splice(T+1,1),++T}}let N=S.mutations.map(S=>oI(T.remoteSerializer,S)),O=e4.fromMillis(S.localWriteTimeMs);return new aA(S.batchId,O,R,N)}function lv(T){let S;let R=lm(T.readTime),N=void 0!==T.lastLimboFreeSnapshotVersion?lm(T.lastLimboFreeSnapshotVersion):e6.min();return new ll(S=lT(T.query)?oP(T.query):oB(T.query),T.targetId,"TargetPurposeListen",T.lastListenSequenceNumber,R,N,ni.fromBase64String(T.resumeToken))}function lb(T,S){let R;let N=lf(S.snapshotVersion),O=lf(S.lastLimboFreeSnapshotVersion);R=i8(S.target)?ox(T.remoteSerializer,S.target):oM(T.remoteSerializer,S.target).queryTarget;let P=S.resumeToken.toBase64();return{targetId:S.targetId,canonicalId:i6(S.target),readTime:N,resumeToken:P,lastListenSequenceNumber:S.sequenceNumber,lastLimboFreeSnapshotVersion:O,query:R}}function lT(T){return void 0!==T.documents}function lS(T){return{id:T.bundleId,createTime:lm(T.createTime),version:T.version}}function lE(T){return{bundleId:T.id,createTime:lf(on(T.createTime)),version:T.version}}function l_(T){return{name:T.name,query:lC(T.bundledQuery),readTime:lm(T.readTime)}}function lw(T){return{name:T.name,readTime:lf(on(T.readTime)),bundledQuery:T.bundledQuery}}function lC(T){let S=oF({parent:T.parent,structuredQuery:T.structuredQuery});return"LAST"===T.limitType?sE(S,S.limit,"L"):S}function lI(T){return{name:T.name,query:lC(T.bundledQuery),readTime:on(T.readTime)}}function lR(T){return{id:T.id,version:T.version,createTime:on(T.createTime)}}function lk(T,S){return new aO(S.largestBatchId,oI(T.remoteSerializer,S.overlayMutation))}function lN(T,S,R){let[N,O,P]=lA(S,R.mutation.key);return{userId:S,collectionPath:O,documentId:P,collectionGroup:R.mutation.key.getCollectionGroup(),largestBatchId:R.largestBatchId,overlayMutation:oC(T.remoteSerializer,R.mutation)}}function lA(T,S){let R=S.path.lastSegment();return[T,tj(S.path.popLast()),R]}function lD(T){return{indexId:T.indexId,collectionGroup:T.collectionGroup,fields:T.fields.map(T=>[T.fieldPath.canonicalString(),T.kind])}}function lO(T,S){let R=S?new tl(S.sequenceNumber,new td(lm(S.readTime),new eG(tG(S.documentKey)),S.largestBatchId)):tl.empty(),N=T.fields.map(([T,S])=>new ts(eq.fromServerFormat(T),S));return new e8(T.indexId,T.collectionGroup,N,R)}function lx(T,S,R,N){return{indexId:T,uid:S,sequenceNumber:R,readTime:lf(N.readTime),documentKey:tj(N.documentKey.path),largestBatchId:N.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{getBundleMetadata(T,S){return lM(T).get(S).next(T=>{if(T)return lS(T)})}saveBundleMetadata(T,S){return lM(T).put(lE(S))}getNamedQuery(T,S){return lL(T).get(S).next(T=>{if(T)return l_(T)})}saveNamedQuery(T,S){return lL(T).put(lw(S))}}function lM(T){return rX(T,rv)}function lL(T){return rX(T,rT)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lF{constructor(T,S){this.serializer=T,this.userId=S}static forUser(T,S){return new lF(T,S.uid||"")}getOverlay(T,S){return lB(T).get(lA(this.userId,S)).next(T=>T?lk(this.serializer,T):null)}getOverlays(T,S){let R=sq();return tg.forEach(S,S=>this.getOverlay(T,S).next(T=>{null!==T&&R.set(S,T)})).next(()=>R)}saveOverlays(T,S,R){let N=[];return R.forEach((R,O)=>{let P=new aO(S,O);N.push(this.saveOverlay(T,P))}),tg.waitFor(N)}removeOverlaysForBatchId(T,S,R){let N=new Set;S.forEach(T=>N.add(tj(T.getCollectionPath())));let O=[];return N.forEach(S=>{let N=IDBKeyRange.bound([this.userId,S,R],[this.userId,S,R+1],!1,!0);O.push(lB(T).deleteAll(rL,N))}),tg.waitFor(O)}getOverlaysForCollection(T,S,R){let N=sq(),O=tj(S),P=IDBKeyRange.bound([this.userId,O,R],[this.userId,O,Number.POSITIVE_INFINITY],!0);return lB(T).loadAll(rL,P).next(T=>{for(let S of T){let T=lk(this.serializer,S);N.set(T.getKey(),T)}return N})}getOverlaysForCollectionGroup(T,S,R,N){let O;let P=sq(),M=IDBKeyRange.bound([this.userId,S,R],[this.userId,S,Number.POSITIVE_INFINITY],!0);return lB(T).iterate({index:rB,range:M},(T,S,R)=>{let M=lk(this.serializer,S);P.size()<N||M.largestBatchId===O?(P.set(M.getKey(),M),O=M.largestBatchId):R.done()}).next(()=>P)}saveOverlay(T,S){return lB(T).put(lN(this.serializer,this.userId,S))}}function lB(T){return rX(T,rP)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{globalsStore(T){return rX(T,rV)}getSessionToken(T){return this.globalsStore(T).get("sessionToken").next(T=>{let S=null==T?void 0:T.value;return S?ni.fromUint8Array(S):ni.EMPTY_BYTE_STRING})}setSessionToken(T,S){return this.globalsStore(T).put({name:"sessionToken",value:S.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lV=5,lj=10,lz=13,lq=15,lG=20,l$=25,lK=30,lH=37,lW=45,lQ=50,lY=53,lJ=55,lX=60,lZ=2;class l0{constructor(){}writeIndexValue(T,S){this.writeIndexValueAux(T,S),S.writeInfinity()}writeIndexValueAux(T,S){if("nullValue"in T)this.writeValueTypeLabel(S,lV);else if("booleanValue"in T)this.writeValueTypeLabel(S,lj),S.writeNumber(T.booleanValue?1:0);else if("integerValue"in T)this.writeValueTypeLabel(S,lq),S.writeNumber(nd(T.integerValue));else if("doubleValue"in T){let R=nd(T.doubleValue);isNaN(R)?this.writeValueTypeLabel(S,lz):(this.writeValueTypeLabel(S,lq),nR(R)?S.writeNumber(0):S.writeNumber(R))}else if("timestampValue"in T){let R=T.timestampValue;this.writeValueTypeLabel(S,lG),"string"==typeof R&&(R=nc(R)),S.writeString(`${R.seconds||""}`),S.writeNumber(R.nanos||0)}else if("stringValue"in T)this.writeIndexString(T.stringValue,S),this.writeTruncationMarker(S);else if("bytesValue"in T)this.writeValueTypeLabel(S,lK),S.writeBytes(nh(T.bytesValue)),this.writeTruncationMarker(S);else if("referenceValue"in T)this.writeIndexEntityRef(T.referenceValue,S);else if("geoPointValue"in T){let R=T.geoPointValue;this.writeValueTypeLabel(S,lW),S.writeNumber(R.latitude||0),S.writeNumber(R.longitude||0)}else"mapValue"in T?im(T)?this.writeValueTypeLabel(S,Number.MAX_SAFE_INTEGER):ih(T)?this.writeIndexVector(T.mapValue,S):(this.writeIndexMap(T.mapValue,S),this.writeTruncationMarker(S)):"arrayValue"in T?(this.writeIndexArray(T.arrayValue,S),this.writeTruncationMarker(S)):ep(19022,{indexValue:T})}writeIndexString(T,S){this.writeValueTypeLabel(S,l$),this.writeUnlabeledIndexString(T,S)}writeUnlabeledIndexString(T,S){S.writeString(T)}writeIndexMap(T,S){let R=T.fields||{};for(let T of(this.writeValueTypeLabel(S,lJ),Object.keys(R)))this.writeIndexString(T,S),this.writeIndexValueAux(R[T],S)}writeIndexVector(T,S){var R,N;let O=T.fields||{};this.writeValueTypeLabel(S,lY);let P=nx,M=(null===(N=null===(R=O[P].arrayValue)||void 0===R?void 0:R.values)||void 0===N?void 0:N.length)||0;this.writeValueTypeLabel(S,lq),S.writeNumber(nd(M)),this.writeIndexString(P,S),this.writeIndexValueAux(O[P],S)}writeIndexArray(T,S){let R=T.values||[];for(let T of(this.writeValueTypeLabel(S,lQ),R))this.writeIndexValueAux(T,S)}writeIndexEntityRef(T,S){this.writeValueTypeLabel(S,lH),eG.fromName(T).path.forEach(T=>{this.writeValueTypeLabel(S,lX),this.writeUnlabeledIndexString(T,S)})}writeValueTypeLabel(T,S){T.writeNumber(S)}writeTruncationMarker(T){T.writeNumber(lZ)}}l0.INSTANCE=new l0;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let l1="\uD800",l2="\uDBFF",l3=0,l4=255,l6=1,l9=255,l5=255,l8=0,l7=64,ue=8,ut=1024;function ur(T){let S=new DataView(new ArrayBuffer(8));return S.setFloat64(0,T,!1),new Uint8Array(S.buffer)}function un(T){if(0===T)return 8;let S=0;return T>>4==0&&(S+=4,T<<=4),T>>6==0&&(S+=2,T<<=2),T>>7==0&&(S+=1),S}function ui(T){let S=0;for(let R=0;R<8;++R){let N=un(255&T[R]);if(S+=N,8!==N)break}return S}function us(T){return Math.ceil((l7-ui(T))/ue)}class uo{constructor(){this.buffer=new Uint8Array(ut),this.position=0}writeBytesAscending(T){let S=T[Symbol.iterator](),R=S.next();for(;!R.done;)this.writeByteAscending(R.value),R=S.next();this.writeSeparatorAscending()}writeBytesDescending(T){let S=T[Symbol.iterator](),R=S.next();for(;!R.done;)this.writeByteDescending(R.value),R=S.next();this.writeSeparatorDescending()}writeUtf8Ascending(T){for(let S of T){let T=S.charCodeAt(0);if(T<128)this.writeByteAscending(T);else if(T<2048)this.writeByteAscending(960|T>>>6),this.writeByteAscending(128|63&T);else if(S<l1||l2<S)this.writeByteAscending(480|T>>>12),this.writeByteAscending(128|63&T>>>6),this.writeByteAscending(128|63&T);else{let T=S.codePointAt(0);this.writeByteAscending(240|T>>>18),this.writeByteAscending(128|63&T>>>12),this.writeByteAscending(128|63&T>>>6),this.writeByteAscending(128|63&T)}}this.writeSeparatorAscending()}writeUtf8Descending(T){for(let S of T){let T=S.charCodeAt(0);if(T<128)this.writeByteDescending(T);else if(T<2048)this.writeByteDescending(960|T>>>6),this.writeByteDescending(128|63&T);else if(S<l1||l2<S)this.writeByteDescending(480|T>>>12),this.writeByteDescending(128|63&T>>>6),this.writeByteDescending(128|63&T);else{let T=S.codePointAt(0);this.writeByteDescending(240|T>>>18),this.writeByteDescending(128|63&T>>>12),this.writeByteDescending(128|63&T>>>6),this.writeByteDescending(128|63&T)}}this.writeSeparatorDescending()}writeNumberAscending(T){let S=this.toOrderedBits(T),R=us(S);this.ensureAvailable(1+R),this.buffer[this.position++]=255&R;for(let T=S.length-R;T<S.length;++T)this.buffer[this.position++]=255&S[T]}writeNumberDescending(T){let S=this.toOrderedBits(T),R=us(S);this.ensureAvailable(1+R),this.buffer[this.position++]=~(255&R);for(let T=S.length-R;T<S.length;++T)this.buffer[this.position++]=~(255&S[T])}writeInfinityAscending(){this.writeEscapedByteAscending(l9),this.writeEscapedByteAscending(l5)}writeInfinityDescending(){this.writeEscapedByteDescending(l9),this.writeEscapedByteDescending(l5)}reset(){this.position=0}seed(T){this.ensureAvailable(T.length),this.buffer.set(T,this.position),this.position+=T.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(T){let S=ur(T),R=(128&S[0])!=0;S[0]^=R?255:128;for(let T=1;T<S.length;++T)S[T]^=R?255:0;return S}writeByteAscending(T){let S=255&T;S===l3?(this.writeEscapedByteAscending(l3),this.writeEscapedByteAscending(l4)):S===l9?(this.writeEscapedByteAscending(l9),this.writeEscapedByteAscending(l8)):this.writeEscapedByteAscending(S)}writeByteDescending(T){let S=255&T;S===l3?(this.writeEscapedByteDescending(l3),this.writeEscapedByteDescending(l4)):S===l9?(this.writeEscapedByteDescending(l9),this.writeEscapedByteDescending(l8)):this.writeEscapedByteDescending(T)}writeSeparatorAscending(){this.writeEscapedByteAscending(l3),this.writeEscapedByteAscending(l6)}writeSeparatorDescending(){this.writeEscapedByteDescending(l3),this.writeEscapedByteDescending(l6)}writeEscapedByteAscending(T){this.ensureAvailable(1),this.buffer[this.position++]=T}writeEscapedByteDescending(T){this.ensureAvailable(1),this.buffer[this.position++]=~T}ensureAvailable(T){let S=T+this.position;if(S<=this.buffer.length)return;let R=2*this.buffer.length;R<S&&(R=S);let N=new Uint8Array(R);N.set(this.buffer),this.buffer=N}}class ul{constructor(T){this.orderedCode=T}writeBytes(T){this.orderedCode.writeBytesAscending(T)}writeString(T){this.orderedCode.writeUtf8Ascending(T)}writeNumber(T){this.orderedCode.writeNumberAscending(T)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class uu{constructor(T){this.orderedCode=T}writeBytes(T){this.orderedCode.writeBytesDescending(T)}writeString(T){this.orderedCode.writeUtf8Descending(T)}writeNumber(T){this.orderedCode.writeNumberDescending(T)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class uc{constructor(){this.orderedCode=new uo,this.ascending=new ul(this.orderedCode),this.descending=new uu(this.orderedCode)}seed(T){this.orderedCode.seed(T)}forKind(T){return 0===T?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(T,S,R,N){this._indexId=T,this._documentKey=S,this._arrayValue=R,this._directionalValue=N}successor(){let T=this._directionalValue.length,S=0===T||255===this._directionalValue[T-1]?T+1:T,R=new Uint8Array(S);return R.set(this._directionalValue,0),S!==T?R.set([0],this._directionalValue.length):++R[R.length-1],new ud(this._indexId,this._documentKey,this._arrayValue,R)}dbIndexEntry(T,S,R){return{indexId:this._indexId,uid:T,arrayValue:uf(this._arrayValue),directionalValue:uf(this._directionalValue),orderedDocumentKey:uf(S),documentKey:R.path.toArray()}}dbIndexEntryKey(T,S,R){let N=this.dbIndexEntry(T,S,R);return[N.indexId,N.uid,N.arrayValue,N.directionalValue,N.orderedDocumentKey,N.documentKey]}}function uh(T,S){let R=T._indexId-S._indexId;return 0!==R||0!==(R=up(T._arrayValue,S._arrayValue))||0!==(R=up(T._directionalValue,S._directionalValue))?R:eG.comparator(T._documentKey,S._documentKey)}function up(T,S){for(let R=0;R<T.length&&R<S.length;++R){let N=T[R]-S[R];if(0!==N)return N}return T.length-S.length}function uf(T){return isSafariOrWebkit()?ug(T):T}function um(T){return"string"!=typeof T?T:uy(T)}function ug(T){let S="";for(let R=0;R<T.length;R++)S+=String.fromCharCode(T[R]);return S}function uy(T){let S=new Uint8Array(T.length);for(let R=0;R<T.length;R++)S[R]=T.charCodeAt(R);return S}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(T){for(let S of(this.inequalityFilters=new r9((T,S)=>eq.comparator(T.field,S.field)),this.collectionId=null!=T.collectionGroup?T.collectionGroup:T.path.lastSegment(),this.orderBys=T.orderBy,this.equalityFilters=[],T.filters)){let T=S;T.isInequality()?this.inequalityFilters=this.inequalityFilters.add(T):this.equalityFilters.push(T)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(T){if(em(T.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let S=e7(T);if(void 0!==S&&!this.hasMatchingEqualityFilter(S))return!1;let R=te(T),N=new Set,O=0,P=0;for(;O<R.length;++O)if(this.hasMatchingEqualityFilter(R[O]))N=N.add(R[O].fieldPath.canonicalString());else break;if(O===R.length)return!0;if(this.inequalityFilters.size>0){let T=this.inequalityFilters.getIterator().getNext();if(!N.has(T.field.canonicalString())){let S=R[O];if(!this.matchesFilter(T,S)||!this.matchesOrderBy(this.orderBys[P++],S))return!1}++O}for(;O<R.length;++O){let T=R[O];if(P>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[P++],T))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let T=new r9(eq.comparator),S=[];for(let R of this.equalityFilters)if(!R.field.isKeyField()){if("array-contains"===R.op||"array-contains-any"===R.op)S.push(new ts(R.field,2));else{if(T.has(R.field))continue;T=T.add(R.field),S.push(new ts(R.field,0))}}for(let R of this.orderBys)R.field.isKeyField()||T.has(R.field)||(T=T.add(R.field),S.push(new ts(R.field,"asc"===R.dir?0:1)));return new e8(e8.UNKNOWN_ID,this.collectionId,S,tl.empty())}hasMatchingEqualityFilter(T){for(let S of this.equalityFilters)if(this.matchesFilter(S,T))return!0;return!1}matchesFilter(T,S){if(void 0===T||!T.field.isEqual(S.fieldPath))return!1;let R="array-contains"===T.op||"array-contains-any"===T.op;return 2===S.kind===R}matchesOrderBy(T,S){return!!T.field.isEqual(S.fieldPath)&&(0===S.kind&&"asc"===T.dir||1===S.kind&&"desc"===T.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ub(T){var S,R;if(em(T instanceof iM||T instanceof iL,20012),T instanceof iM){if(!(T instanceof i0))return T;{let N=(null===(R=null===(S=T.value.arrayValue)||void 0===S?void 0:S.values)||void 0===R?void 0:R.map(S=>iM.create(T.field,"==",S)))||[];return iL.create(N,"or")}}let N=T.filters.map(T=>ub(T));return iL.create(N,T.op)}function uT(T){if(0===T.getFilters().length)return[];let S=uC(ub(T));return(em(u_(S),7391),uS(S)||uE(S))?[S]:S.getFilters()}function uS(T){return T instanceof iM}function uE(T){return T instanceof iL&&iU(T)}function u_(T){return uS(T)||uE(T)||uw(T)}function uw(T){if(T instanceof iL&&iB(T)){for(let S of T.getFilters())if(!uS(S)&&!uE(S))return!1;return!0}return!1}function uC(T){if(em(T instanceof iM||T instanceof iL,34018),T instanceof iM)return T;if(1===T.filters.length)return uC(T.filters[0]);let S=T.filters.map(T=>uC(T)),R=iL.create(S,T.op);return u_(R=uA(R))?R:(em(R instanceof iL,64498),em(iF(R),40251),em(R.filters.length>1,57927),R.filters.reduce((T,S)=>uI(T,S)))}function uI(T,S){let R;return em(T instanceof iM||T instanceof iL,38388),em(S instanceof iM||S instanceof iL,25473),uA(R=T instanceof iM?S instanceof iM?uR(T,S):uN(T,S):S instanceof iM?uN(S,T):uk(T,S))}function uR(T,S){return iL.create([T,S],"and")}function uk(T,S){if(em(T.filters.length>0&&S.filters.length>0,48005),iF(T)&&iF(S))return i$(T,S.getFilters());let R=iB(T)?T:S,N=iB(T)?S:T,O=R.filters.map(T=>uI(T,N));return iL.create(O,"or")}function uN(T,S){if(iF(S))return i$(S,T.getFilters());{let R=S.filters.map(S=>uI(T,S));return iL.create(R,"or")}}function uA(T){if(em(T instanceof iM||T instanceof iL,11850),T instanceof iM)return T;let S=T.getFilters();if(1===S.length)return uA(S[0]);if(iV(T))return T;let R=S.map(T=>uA(T)),N=[];return(R.forEach(S=>{S instanceof iM?N.push(S):S instanceof iL&&(S.op===T.op?N.push(...S.filters):N.push(S))}),1===N.length)?N[0]:iL.create(N,T.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(){this.collectionParentIndex=new uO}addToCollectionParentIndex(T,S){return this.collectionParentIndex.add(S),tg.resolve()}getCollectionParents(T,S){return tg.resolve(this.collectionParentIndex.getEntries(S))}addFieldIndex(T,S){return tg.resolve()}deleteFieldIndex(T,S){return tg.resolve()}deleteAllFieldIndexes(T){return tg.resolve()}createTargetIndexes(T,S){return tg.resolve()}getDocumentsMatchingTarget(T,S){return tg.resolve(null)}getIndexType(T,S){return tg.resolve(0)}getFieldIndexes(T,S){return tg.resolve([])}getNextCollectionGroupToUpdate(T){return tg.resolve(null)}getMinOffset(T,S){return tg.resolve(td.min())}getMinOffsetFromCollectionGroup(T,S){return tg.resolve(td.min())}updateCollectionGroup(T,S,R){return tg.resolve()}updateIndexEntries(T,S){return tg.resolve()}}class uO{constructor(){this.index={}}add(T){let S=T.lastSegment(),R=T.popLast(),N=this.index[S]||new r9(ej.comparator),O=!N.has(R);return this.index[S]=N.add(R),O}has(T){let S=T.lastSegment(),R=T.popLast(),N=this.index[S];return N&&N.has(R)}getEntries(T){return(this.index[T]||new r9(ej.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ux="IndexedDbIndexManager",uP=new Uint8Array(0);class uM{constructor(T,S){this.databaseId=S,this.collectionParentsCache=new uO,this.targetToDnfSubTargets=new sL(T=>i6(T),(T,S)=>i5(T,S)),this.uid=T.uid||""}addToCollectionParentIndex(T,S){if(!this.collectionParentsCache.has(S)){let R=S.lastSegment(),N=S.popLast();T.addOnCommittedListener(()=>{this.collectionParentsCache.add(S)});let O={collectionId:R,parent:tj(N)};return uL(T).put(O)}return tg.resolve()}getCollectionParents(T,S){let R=[],N=IDBKeyRange.bound([S,""],[eB(S),""],!1,!0);return uL(T).loadAll(N).next(T=>{for(let N of T){if(N.collectionId!==S)break;R.push(tG(N.parent))}return R})}addFieldIndex(T,S){let R=uB(T),N=lD(S);delete N.indexId;let O=R.add(N);if(!S.indexState)return O.next();{let R=uU(T);return O.next(T=>{R.put(lx(T,this.uid,S.indexState.sequenceNumber,S.indexState.offset))})}}deleteFieldIndex(T,S){let R=uB(T),N=uU(T),O=uF(T);return R.delete(S.indexId).next(()=>N.delete(IDBKeyRange.bound([S.indexId],[S.indexId+1],!1,!0))).next(()=>O.delete(IDBKeyRange.bound([S.indexId],[S.indexId+1],!1,!0)))}deleteAllFieldIndexes(T){let S=uB(T),R=uF(T),N=uU(T);return S.deleteAll().next(()=>R.deleteAll()).next(()=>N.deleteAll())}createTargetIndexes(T,S){return tg.forEach(this.getSubTargets(S),S=>this.getIndexType(T,S).next(R=>{if(0===R||1===R){let R=new uv(S).buildTargetIndex();if(null!=R)return this.addFieldIndex(T,R)}}))}getDocumentsMatchingTarget(T,S){let R=uF(T),N=!0,O=new Map;return tg.forEach(this.getSubTargets(S),S=>this.getFieldIndex(T,S).next(T=>{N&&(N=!!T),O.set(S,T)})).next(()=>{if(!N)return tg.resolve(null);{let T=sQ(),N=[];return tg.forEach(O,(O,P)=>{eu(ux,`Using index ${ti(O)} to execute ${i6(S)}`);let M=se(P,O),L=st(P,O),U=sr(P,O),V=sn(P,O),$=this.encodeBound(O,P,U),K=this.encodeBound(O,P,V),W=this.encodeValues(O,P,L),Q=this.generateIndexRanges(O.indexId,M,$,U.inclusive,K,V.inclusive,W);return tg.forEach(Q,O=>R.loadFirst(O,S.limit).next(S=>{S.forEach(S=>{let R=eG.fromSegments(S.documentKey);T.has(R)||(T=T.add(R),N.push(R))})}))}).next(()=>N)}})}getSubTargets(T){let S=this.targetToDnfSubTargets.get(T);return S||(S=0===T.filters.length?[T]:uT(iL.create(T.filters,"and")).map(S=>i4(T.path,T.collectionGroup,T.orderBy,S.getFilters(),T.limit,T.startAt,T.endAt)),this.targetToDnfSubTargets.set(T,S)),S}generateIndexRanges(T,S,R,N,O,P,M){let L=(null!=S?S.length:1)*Math.max(R.length,O.length),U=L/(null!=S?S.length:1),V=[];for(let $=0;$<L;++$){let L=S?this.encodeSingleElement(S[$/U]):uP,K=this.generateLowerBound(T,L,R[$%U],N),W=this.generateUpperBound(T,L,O[$%U],P),Q=M.map(S=>this.generateLowerBound(T,L,S,!0));V.push(...this.createRange(K,W,Q))}return V}generateLowerBound(T,S,R,N){let O=new ud(T,eG.empty(),S,R);return N?O:O.successor()}generateUpperBound(T,S,R,N){let O=new ud(T,eG.empty(),S,R);return N?O.successor():O}getFieldIndex(T,S){let R=new uv(S),N=null!=S.collectionGroup?S.collectionGroup:S.path.lastSegment();return this.getFieldIndexes(T,N).next(T=>{let S=null;for(let N of T)R.servedByIndex(N)&&(!S||N.fields.length>S.fields.length)&&(S=N);return S})}getIndexType(T,S){let R=2,N=this.getSubTargets(S);return tg.forEach(N,S=>this.getFieldIndex(T,S).next(T=>{T?0!==R&&T.fields.length<sa(S)&&(R=1):R=0})).next(()=>so(S)&&N.length>1&&2===R?1:R)}encodeDirectionalElements(T,S){let R=new uc;for(let N of te(T)){let T=S.data.field(N.fieldPath);if(null==T)return null;let O=R.forKind(N.kind);l0.INSTANCE.writeIndexValue(T,O)}return R.encodedBytes()}encodeSingleElement(T){let S=new uc;return l0.INSTANCE.writeIndexValue(T,S.forKind(0)),S.encodedBytes()}encodeDirectionalKey(T,S){let R=new uc;return l0.INSTANCE.writeIndexValue(ir(this.databaseId,S),R.forKind(tt(T))),R.encodedBytes()}encodeValues(T,S,R){if(null===R)return[];let N=[];N.push(new uc);let O=0;for(let P of te(T)){let T=R[O++];for(let R of N)if(this.isInFilter(S,P.fieldPath)&&io(T))N=this.expandIndexValues(N,P,T);else{let S=R.forKind(P.kind);l0.INSTANCE.writeIndexValue(T,S)}}return this.getEncodedBytes(N)}encodeBound(T,S,R){return this.encodeValues(T,S,R.position)}getEncodedBytes(T){let S=[];for(let R=0;R<T.length;++R)S[R]=T[R].encodedBytes();return S}expandIndexValues(T,S,R){let N=[...T],O=[];for(let T of R.arrayValue.values||[])for(let R of N){let N=new uc;N.seed(R.encodedBytes()),l0.INSTANCE.writeIndexValue(T,N.forKind(S.kind)),O.push(N)}return O}isInFilter(T,S){return!!T.filters.find(T=>T instanceof iM&&T.field.isEqual(S)&&("in"===T.op||"not-in"===T.op))}getFieldIndexes(T,S){let R=uB(T),N=uU(T);return(S?R.loadAll(rw,IDBKeyRange.bound(S,S)):R.loadAll()).next(T=>{let S=[];return tg.forEach(T,T=>N.get([T.indexId,this.uid]).next(R=>{S.push(lO(T,R))})).next(()=>S)})}getNextCollectionGroupToUpdate(T){return this.getFieldIndexes(T).next(T=>0===T.length?null:(T.sort((T,S)=>{let R=T.indexState.sequenceNumber-S.indexState.sequenceNumber;return 0!==R?R:ex(T.collectionGroup,S.collectionGroup)}),T[0].collectionGroup))}updateCollectionGroup(T,S,R){let N=uB(T),O=uU(T);return this.getNextSequenceNumber(T).next(T=>N.loadAll(rw,IDBKeyRange.bound(S,S)).next(S=>tg.forEach(S,S=>O.put(lx(S.indexId,this.uid,T,R)))))}updateIndexEntries(T,S){let R=new Map;return tg.forEach(S,(S,N)=>{let O=R.get(S.collectionGroup);return(O?tg.resolve(O):this.getFieldIndexes(T,S.collectionGroup)).next(O=>(R.set(S.collectionGroup,O),tg.forEach(O,R=>this.getExistingIndexEntries(T,S,R).next(S=>{let O=this.computeIndexEntries(N,R);return S.isEqual(O)?tg.resolve():this.updateEntries(T,N,R,S,O)}))))})}addIndexEntry(T,S,R,N){return uF(T).put(N.dbIndexEntry(this.uid,this.encodeDirectionalKey(R,S.key),S.key))}deleteIndexEntry(T,S,R,N){return uF(T).delete(N.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(R,S.key),S.key))}getExistingIndexEntries(T,S,R){let N=uF(T),O=new r9(uh);return N.iterate({index:rO,range:IDBKeyRange.only([R.indexId,this.uid,uf(this.encodeDirectionalKey(R,S))])},(T,N)=>{O=O.add(new ud(R.indexId,S,um(N.arrayValue),um(N.directionalValue)))}).next(()=>O)}computeIndexEntries(T,S){let R=new r9(uh),N=this.encodeDirectionalElements(S,T);if(null==N)return R;let O=e7(S);if(null!=O){let P=T.data.field(O.fieldPath);if(io(P))for(let O of P.arrayValue.values||[])R=R.add(new ud(S.indexId,T.key,this.encodeSingleElement(O),N))}else R=R.add(new ud(S.indexId,T.key,uP,N));return R}updateEntries(T,S,R,N,O){eu(ux,"Updating index entries for document '%s'",S.key);let P=[];return r8(N,O,uh,N=>{P.push(this.addIndexEntry(T,S,R,N))},N=>{P.push(this.deleteIndexEntry(T,S,R,N))}),tg.waitFor(P)}getNextSequenceNumber(T){let S=1;return uU(T).iterate({index:rk,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(T,R,N)=>{N.done(),S=R.sequenceNumber+1}).next(()=>S)}createRange(T,S,R){R=R.sort((T,S)=>uh(T,S)).filter((T,S,R)=>!S||0!==uh(T,R[S-1]));let N=[];for(let O of(N.push(T),R)){let R=uh(O,T),P=uh(O,S);if(0===R)N[0]=T.successor();else if(R>0&&P<0)N.push(O),N.push(O.successor());else if(P>0)break}N.push(S);let O=[];for(let T=0;T<N.length;T+=2){if(this.isRangeMatchable(N[T],N[T+1]))return[];let S=N[T].dbIndexEntryKey(this.uid,uP,eG.empty()),R=N[T+1].dbIndexEntryKey(this.uid,uP,eG.empty());O.push(IDBKeyRange.bound(S,R))}return O}isRangeMatchable(T,S){return uh(T,S)>0}getMinOffsetFromCollectionGroup(T,S){return this.getFieldIndexes(T,S).next(uV)}getMinOffset(T,S){return tg.mapArray(this.getSubTargets(S),S=>this.getFieldIndex(T,S).next(T=>T||ep(44426))).next(uV)}}function uL(T){return rX(T,rf)}function uF(T){return rX(T,rA)}function uB(T){return rX(T,rE)}function uU(T){return rX(T,rI)}function uV(T){em(0!==T.length,28825);let S=T[0].indexState.offset,R=S.largestBatchId;for(let N=1;N<T.length;N++){let O=T[N].indexState.offset;0>th(O,S)&&(S=O),R<O.largestBatchId&&(R=O.largestBatchId)}return new td(S.readTime,S.documentKey,R)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uj(T,S,R){let N=T.store(tY),O=T.store(t4),P=[],M=IDBKeyRange.only(R.batchId),L=0,U=N.iterate({range:M},(T,S,R)=>(L++,R.delete()));P.push(U.next(()=>{em(1===L,47070,{batchId:R.batchId})}));let V=[];for(let T of R.mutations){let N=t2(S,T.key.path,R.batchId);P.push(O.delete(N)),V.push(T.key)}return tg.waitFor(P).next(()=>V)}function uz(T){let S;if(!T)return 0;if(T.document)S=T.document;else if(T.unknownDocument)S=T.unknownDocument;else if(T.noDocument)S=T.noDocument;else throw ep(14731);return JSON.stringify(S).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uq{constructor(T,S,R,N){this.userId=T,this.serializer=S,this.indexManager=R,this.referenceDelegate=N,this.documentKeysByBatchId={}}static forUser(T,S,R,N){return em(""!==T.uid,64387),new uq(T.isAuthenticated()?T.uid:"",S,R,N)}checkEmpty(T){let S=!0,R=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return uK(T).iterate({index:tX,range:R},(T,R,N)=>{S=!1,N.done()}).next(()=>S)}addMutationBatch(T,S,R,N){let O=uH(T),P=uK(T);return P.add({}).next(M=>{em("number"==typeof M,49019);let L=new aA(M,S,R,N),U=lg(this.serializer,this.userId,L),V=[],$=new r9((T,S)=>ex(T.canonicalString(),S.canonicalString()));for(let T of N){let S=t2(this.userId,T.key.path,M);$=$.add(T.key.path.popLast()),V.push(P.put(U)),V.push(O.put(S,t3))}return $.forEach(S=>{V.push(this.indexManager.addToCollectionParentIndex(T,S))}),T.addOnCommittedListener(()=>{this.documentKeysByBatchId[M]=L.keys()}),tg.waitFor(V).next(()=>L)})}lookupMutationBatch(T,S){return uK(T).get(S).next(T=>T?(em(T.userId===this.userId,48,"Unexpected user for mutation batch",{userId:T.userId,batchId:S}),ly(this.serializer,T)):null)}lookupMutationKeys(T,S){return this.documentKeysByBatchId[S]?tg.resolve(this.documentKeysByBatchId[S]):this.lookupMutationBatch(T,S).next(T=>{if(!T)return null;{let R=T.keys();return this.documentKeysByBatchId[S]=R,R}})}getNextMutationBatchAfterBatchId(T,S){let R=S+1,N=IDBKeyRange.lowerBound([this.userId,R]),O=null;return uK(T).iterate({index:tX,range:N},(T,S,N)=>{S.userId===this.userId&&(em(S.batchId>=R,47524,{nextBatchId:R}),O=ly(this.serializer,S)),N.done()}).next(()=>O)}getHighestUnacknowledgedBatchId(T){let S=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),R=nC;return uK(T).iterate({index:tX,range:S,reverse:!0},(T,S,N)=>{R=S.batchId,N.done()}).next(()=>R)}getAllMutationBatches(T){let S=IDBKeyRange.bound([this.userId,nC],[this.userId,Number.POSITIVE_INFINITY]);return uK(T).loadAll(tX,S).next(T=>T.map(T=>ly(this.serializer,T)))}getAllMutationBatchesAffectingDocumentKey(T,S){let R=t1(this.userId,S.path),N=IDBKeyRange.lowerBound(R),O=[];return uH(T).iterate({range:N},(R,N,P)=>{let[M,L,U]=R,V=tG(L);if(M!==this.userId||!S.path.isEqual(V)){P.done();return}return uK(T).get(U).next(T=>{if(!T)throw ep(61480,{indexKey:R,batchId:U});em(T.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:T.userId,batchId:U}),O.push(ly(this.serializer,T))})}).next(()=>O)}getAllMutationBatchesAffectingDocumentKeys(T,S){let R=new r9(ex),N=[];return S.forEach(S=>{let O=t1(this.userId,S.path),P=IDBKeyRange.lowerBound(O),M=uH(T).iterate({range:P},(T,N,O)=>{let[P,M,L]=T,U=tG(M);if(P!==this.userId||!S.path.isEqual(U)){O.done();return}R=R.add(L)});N.push(M)}),tg.waitFor(N).next(()=>this.lookupMutationBatches(T,R))}getAllMutationBatchesAffectingQuery(T,S){let R=S.path,N=R.length+1,O=t1(this.userId,R),P=IDBKeyRange.lowerBound(O),M=new r9(ex);return uH(T).iterate({range:P},(T,S,O)=>{let[P,L,U]=T,V=tG(L);if(P!==this.userId||!R.isPrefixOf(V)){O.done();return}V.length===N&&(M=M.add(U))}).next(()=>this.lookupMutationBatches(T,M))}lookupMutationBatches(T,S){let R=[],N=[];return S.forEach(S=>{N.push(uK(T).get(S).next(T=>{if(null===T)throw ep(35274,{batchId:S});em(T.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:T.userId,batchId:S}),R.push(ly(this.serializer,T))}))}),tg.waitFor(N).next(()=>R)}removeMutationBatch(T,S){return uj(T.simpleDbTransaction,this.userId,S).next(R=>(T.addOnCommittedListener(()=>{this.removeCachedMutationKeys(S.batchId)}),tg.forEach(R,S=>this.referenceDelegate.markPotentiallyOrphaned(T,S))))}removeCachedMutationKeys(T){delete this.documentKeysByBatchId[T]}performConsistencyCheck(T){return this.checkEmpty(T).next(S=>{if(!S)return tg.resolve();let R=IDBKeyRange.lowerBound(t0(this.userId)),N=[];return uH(T).iterate({range:R},(T,S,R)=>{if(T[0]!==this.userId){R.done();return}{let S=tG(T[1]);N.push(S)}}).next(()=>{em(0===N.length,56720,{danglingKeys:N.map(T=>T.canonicalString())})})})}containsKey(T,S){return uG(T,this.userId,S)}getMutationQueueMetadata(T){return uW(T).get(this.userId).next(T=>T||{userId:this.userId,lastAcknowledgedBatchId:nC,lastStreamToken:""})}}function uG(T,S,R){let N=t1(S,R.path),O=N[1],P=IDBKeyRange.lowerBound(N),M=!1;return uH(T).iterate({range:P,keysOnly:!0},(T,R,N)=>{let[P,L,U]=T;P===S&&L===O&&(M=!0),N.done()}).next(()=>M)}function u$(T,S){let R=!1;return uW(T).iterateSerial(N=>uG(T,N,S).next(T=>(T&&(R=!0),tg.resolve(!T)))).next(()=>R)}function uK(T){return rX(T,tY)}function uH(T){return rX(T,t4)}function uW(T){return rX(T,tW)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uQ=2;class uY{constructor(T){this.lastId=T}next(){return this.lastId+=uQ,this.lastId}static forTargetCache(){return new uY(2-uQ)}static forSyncEngine(){return new uY(1-uQ)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uJ{constructor(T,S){this.referenceDelegate=T,this.serializer=S}allocateTargetId(T){return this.retrieveMetadata(T).next(S=>{let R=new uY(S.highestTargetId);return S.highestTargetId=R.next(),this.saveMetadata(T,S).next(()=>S.highestTargetId)})}getLastRemoteSnapshotVersion(T){return this.retrieveMetadata(T).next(T=>e6.fromTimestamp(new e4(T.lastRemoteSnapshotVersion.seconds,T.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(T){return this.retrieveMetadata(T).next(T=>T.highestListenSequenceNumber)}setTargetsMetadata(T,S,R){return this.retrieveMetadata(T).next(N=>(N.highestListenSequenceNumber=S,R&&(N.lastRemoteSnapshotVersion=R.toTimestamp()),S>N.highestListenSequenceNumber&&(N.highestListenSequenceNumber=S),this.saveMetadata(T,N)))}addTargetData(T,S){return this.saveTargetData(T,S).next(()=>this.retrieveMetadata(T).next(R=>(R.targetCount+=1,this.updateMetadataFromTargetData(S,R),this.saveMetadata(T,R))))}updateTargetData(T,S){return this.saveTargetData(T,S)}removeTargetData(T,S){return this.removeMatchingKeysForTargetId(T,S.targetId).next(()=>uX(T).delete(S.targetId)).next(()=>this.retrieveMetadata(T)).next(S=>(em(S.targetCount>0,8065),S.targetCount-=1,this.saveMetadata(T,S)))}removeTargets(T,S,R){let N=0,O=[];return uX(T).iterate((P,M)=>{let L=lv(M);L.sequenceNumber<=S&&null===R.get(L.targetId)&&(N++,O.push(this.removeTargetData(T,L)))}).next(()=>tg.waitFor(O)).next(()=>N)}forEachTarget(T,S){return uX(T).iterate((T,R)=>{S(lv(R))})}retrieveMetadata(T){return uZ(T).get(rh).next(T=>(em(null!==T,2888),T))}saveMetadata(T,S){return uZ(T).put(rh,S)}saveTargetData(T,S){return uX(T).put(lb(this.serializer,S))}updateMetadataFromTargetData(T,S){let R=!1;return T.targetId>S.highestTargetId&&(S.highestTargetId=T.targetId,R=!0),T.sequenceNumber>S.highestListenSequenceNumber&&(S.highestListenSequenceNumber=T.sequenceNumber,R=!0),R}getTargetCount(T){return this.retrieveMetadata(T).next(T=>T.targetCount)}getTargetData(T,S){let R=i6(S),N=IDBKeyRange.bound([R,Number.NEGATIVE_INFINITY],[R,Number.POSITIVE_INFINITY]),O=null;return uX(T).iterate({range:N,index:ra},(T,R,N)=>{let P=lv(R);i5(S,P.target)&&(O=P,N.done())}).next(()=>O)}addMatchingKeys(T,S,R){let N=[],O=u0(T);return S.forEach(S=>{let P=tj(S.path);N.push(O.put({targetId:R,path:P})),N.push(this.referenceDelegate.addReference(T,R,S))}),tg.waitFor(N)}removeMatchingKeys(T,S,R){let N=u0(T);return tg.forEach(S,S=>{let O=tj(S.path);return tg.waitFor([N.delete([R,O]),this.referenceDelegate.removeReference(T,R,S)])})}removeMatchingKeysForTargetId(T,S){let R=u0(T),N=IDBKeyRange.bound([S],[S+1],!1,!0);return R.delete(N)}getMatchingKeysForTargetId(T,S){let R=IDBKeyRange.bound([S],[S+1],!1,!0),N=u0(T),O=sQ();return N.iterate({range:R,keysOnly:!0},(T,S,R)=>{let N=new eG(tG(T[1]));O=O.add(N)}).next(()=>O)}containsKey(T,S){let R=tj(S.path),N=IDBKeyRange.bound([R],[eB(R)],!1,!0),O=0;return u0(T).iterate({index:rc,keysOnly:!0,range:N},([T,S],R,N)=>{0!==T&&(O++,N.done())}).next(()=>O>0)}getTargetDataForTarget(T,S){return uX(T).get(S).next(T=>T?lv(T):null)}}function uX(T){return rX(T,ri)}function uZ(T){return rX(T,rp)}function u0(T){return rX(T,rl)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},u2=-1,u3=41943040;class u4{static withCacheSize(T){return new u4(T,u4.DEFAULT_COLLECTION_PERCENTILE,u4.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(T,S,R){this.cacheSizeCollectionThreshold=T,this.percentileToCollect=S,this.maximumSequenceNumbersToCollect=R}}u4.DEFAULT_COLLECTION_PERCENTILE=10,u4.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,u4.DEFAULT=new u4(u3,u4.DEFAULT_COLLECTION_PERCENTILE,u4.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),u4.DISABLED=new u4(u2,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let u6="LruGarbageCollector",u9=1048576,u5=6e4,u8=3e5;function u7([T,S],[R,N]){let O=ex(T,R);return 0===O?ex(S,N):O}class ce{constructor(T){this.maxElements=T,this.buffer=new r9(u7),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(T){let S=[T,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(S);else{let T=this.buffer.last();0>u7(S,T)&&(this.buffer=this.buffer.delete(T).add(S))}}get maxValue(){return this.buffer.last()[0]}}class ct{constructor(T,S,R){this.garbageCollector=T,this.asyncQueue=S,this.localStore=R,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==u2&&this.scheduleGC(u5)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(T){eu(u6,`Garbage collection scheduled in ${T}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",T,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(T){tw(T)?eu(u6,"Ignoring IndexedDB error during garbage collection: ",T):await tm(T)}await this.scheduleGC(u8)})}}class cr{constructor(T,S){this.delegate=T,this.params=S}calculateTargetCount(T,S){return this.delegate.getSequenceNumberCount(T).next(T=>Math.floor(S/100*T))}nthSequenceNumber(T,S){if(0===S)return tg.resolve(tL.INVALID);let R=new ce(S);return this.delegate.forEachTarget(T,T=>R.addElement(T.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(T,T=>R.addElement(T))).next(()=>R.maxValue)}removeTargets(T,S,R){return this.delegate.removeTargets(T,S,R)}removeOrphanedDocuments(T,S){return this.delegate.removeOrphanedDocuments(T,S)}collect(T,S){return this.params.cacheSizeCollectionThreshold===u2?(eu("LruGarbageCollector","Garbage collection skipped; disabled"),tg.resolve(u1)):this.getCacheSize(T).next(R=>R<this.params.cacheSizeCollectionThreshold?(eu("LruGarbageCollector",`Garbage collection skipped; Cache size ${R} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),u1):this.runGarbageCollection(T,S))}getCacheSize(T){return this.delegate.getCacheSize(T)}runGarbageCollection(T,S){let R,N,O,P,M,L,U;let $=Date.now();return this.calculateTargetCount(T,this.params.percentileToCollect).next(S=>(S>this.params.maximumSequenceNumbersToCollect?(eu("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${S}`),N=this.params.maximumSequenceNumbersToCollect):N=S,P=Date.now(),this.nthSequenceNumber(T,N))).next(N=>(R=N,M=Date.now(),this.removeTargets(T,R,S))).next(S=>(O=S,L=Date.now(),this.removeOrphanedDocuments(T,R))).next(T=>(U=Date.now(),eo()<=V.in.DEBUG&&eu("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${P-$}ms
	Determined least recently used ${N} in ${M-P}ms
	Removed ${O} targets in ${L-M}ms
	Removed ${T} documents in ${U-L}ms
Total Duration: ${U-$}ms`),tg.resolve({didRun:!0,sequenceNumbersCollected:N,targetsRemoved:O,documentsRemoved:T})))}}function cn(T,S){return new cr(T,S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(T,S){this.db=T,this.garbageCollector=cn(this,S)}getSequenceNumberCount(T){let S=this.orphanedDocumentCount(T);return this.db.getTargetCache().getTargetCount(T).next(T=>S.next(S=>T+S))}orphanedDocumentCount(T){let S=0;return this.forEachOrphanedDocumentSequenceNumber(T,T=>{S++}).next(()=>S)}forEachTarget(T,S){return this.db.getTargetCache().forEachTarget(T,S)}forEachOrphanedDocumentSequenceNumber(T,S){return this.forEachOrphanedDocument(T,(T,R)=>S(R))}addReference(T,S,R){return co(T,R)}removeReference(T,S,R){return co(T,R)}removeTargets(T,S,R){return this.db.getTargetCache().removeTargets(T,S,R)}markPotentiallyOrphaned(T,S){return co(T,S)}isPinned(T,S){return u$(T,S)}removeOrphanedDocuments(T,S){let R=this.db.getRemoteDocumentCache().newChangeBuffer(),N=[],O=0;return this.forEachOrphanedDocument(T,(P,M)=>{if(M<=S){let S=this.isPinned(T,P).next(S=>{if(!S)return O++,R.getEntry(T,P).next(()=>(R.removeEntry(P,e6.min()),u0(T).delete(cs(P))))});N.push(S)}}).next(()=>tg.waitFor(N)).next(()=>R.apply(T)).next(()=>O)}removeTarget(T,S){let R=S.withSequenceNumber(T.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(T,R)}updateLimboDocument(T,S){return co(T,S)}forEachOrphanedDocument(T,S){let R;let N=u0(T),O=tL.INVALID;return N.iterate({index:rc},([T,N],{path:P,sequenceNumber:M})=>{0===T?(O!==tL.INVALID&&S(new eG(tG(R)),O),O=M,R=P):O=tL.INVALID}).next(()=>{O!==tL.INVALID&&S(new eG(tG(R)),O)})}getCacheSize(T){return this.db.getRemoteDocumentCache().getSize(T)}}function cs(T){return[0,tj(T.path)]}function ca(T,S){return{targetId:0,path:tj(T.path),sequenceNumber:S}}function co(T,S){return u0(T).put(ca(S,T.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(){this.changes=new sL(T=>T.toString(),(T,S)=>T.isEqual(S)),this.changesApplied=!1}addEntry(T){this.assertNotApplied(),this.changes.set(T.key,T)}removeEntry(T,S){this.assertNotApplied(),this.changes.set(T,i_.newInvalidDocument(T).setReadTime(S))}getEntry(T,S){this.assertNotApplied();let R=this.changes.get(S);return void 0!==R?tg.resolve(R):this.getFromCache(T,S)}getEntries(T,S){return this.getAllFromCache(T,S)}apply(T){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(T)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(T){this.serializer=T}setIndexManager(T){this.indexManager=T}addEntry(T,S,R){return cp(T).put(R)}removeEntry(T,S,R){return cp(T).delete(cm(S,R))}updateMetadata(T,S){return this.getMetadata(T).next(R=>(R.byteSize+=S,this.setMetadata(T,R)))}getEntry(T,S){let R=i_.newInvalidDocument(S);return cp(T).iterate({index:t5,range:IDBKeyRange.only(cf(S))},(T,N)=>{R=this.maybeDecodeDocument(S,N)}).next(()=>R)}getSizedEntry(T,S){let R={size:0,document:i_.newInvalidDocument(S)};return cp(T).iterate({index:t5,range:IDBKeyRange.only(cf(S))},(T,N)=>{R={document:this.maybeDecodeDocument(S,N),size:uz(N)}}).next(()=>R)}getEntries(T,S){let R=sB();return this.forEachDbEntry(T,S,(T,S)=>{let N=this.maybeDecodeDocument(T,S);R=R.insert(T,N)}).next(()=>R)}getSizedEntries(T,S){let R=sB(),N=new r2(eG.comparator);return this.forEachDbEntry(T,S,(T,S)=>{let O=this.maybeDecodeDocument(T,S);R=R.insert(T,O),N=N.insert(T,uz(S))}).next(()=>({documents:R,sizeMap:N}))}forEachDbEntry(T,S,R){if(S.isEmpty())return tg.resolve();let N=new r9(cv);S.forEach(T=>N=N.add(T));let O=IDBKeyRange.bound(cf(N.first()),cf(N.last())),P=N.getIterator(),M=P.getNext();return cp(T).iterate({index:t5,range:O},(T,S,N)=>{let O=eG.fromSegments([...S.prefixPath,S.collectionGroup,S.documentId]);for(;M&&0>cv(M,O);)R(M,null),M=P.getNext();M&&M.isEqual(O)&&(R(M,S),M=P.hasNext()?P.getNext():null),M?N.skip(cf(M)):N.done()}).next(()=>{for(;M;)R(M,null),M=P.hasNext()?P.getNext():null})}getDocumentsMatchingQuery(T,S,R,N,O){let P=S.path,M=[P.popLast().toArray(),P.lastSegment(),lh(R.readTime),R.documentKey.path.isEmpty()?"":R.documentKey.path.lastSegment()],L=[P.popLast().toArray(),P.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return cp(T).loadAll(IDBKeyRange.bound(M,L,!0)).next(T=>{null==O||O.incrementDocumentReadCount(T.length);let R=sB();for(let O of T){let T=this.maybeDecodeDocument(eG.fromSegments(O.prefixPath.concat(O.collectionGroup,O.documentId)),O);T.isFoundDocument()&&(sk(S,T)||N.has(T.key))&&(R=R.insert(T.key,T))}return R})}getAllFromCollectionGroup(T,S,R,N){let O=sB(),P=cy(S,R),M=cy(S,td.max());return cp(T).iterate({index:t7,range:IDBKeyRange.bound(P,M,!0)},(T,S,R)=>{let P=this.maybeDecodeDocument(eG.fromSegments(S.prefixPath.concat(S.collectionGroup,S.documentId)),S);(O=O.insert(P.key,P)).size===N&&R.done()}).next(()=>O)}newChangeBuffer(T){return new cd(this,!!T&&T.trackRemovals)}getSize(T){return this.getMetadata(T).next(T=>T.byteSize)}getMetadata(T){return ch(T).get(rn).next(T=>(em(!!T,20021),T))}setMetadata(T,S){return ch(T).put(rn,S)}maybeDecodeDocument(T,S){if(S){let T=lc(this.serializer,S);if(!(T.isNoDocument()&&T.version.isEqual(e6.min())))return T}return i_.newInvalidDocument(T)}}function cc(T){return new cu(T)}class cd extends null{constructor(T,S){super(),this.documentCache=T,this.trackRemovals=S,this.documentStates=new sL(T=>T.toString(),(T,S)=>T.isEqual(S))}applyChanges(T){let S=[],R=0,N=new r9((T,S)=>ex(T.canonicalString(),S.canonicalString()));return this.changes.forEach((O,P)=>{let M=this.documentStates.get(O);if(S.push(this.documentCache.removeEntry(T,O,M.readTime)),P.isValidDocument()){let L=ld(this.documentCache.serializer,P);N=N.add(O.path.popLast());let U=uz(L);R+=U-M.size,S.push(this.documentCache.addEntry(T,O,L))}else if(R-=M.size,this.trackRemovals){let R=ld(this.documentCache.serializer,P.convertToNoDocument(e6.min()));S.push(this.documentCache.addEntry(T,O,R))}}),N.forEach(R=>{S.push(this.documentCache.indexManager.addToCollectionParentIndex(T,R))}),S.push(this.documentCache.updateMetadata(T,R)),tg.waitFor(S)}getFromCache(T,S){return this.documentCache.getSizedEntry(T,S).next(T=>(this.documentStates.set(S,{size:T.size,readTime:T.document.readTime}),T.document))}getAllFromCache(T,S){return this.documentCache.getSizedEntries(T,S).next(({documents:T,sizeMap:S})=>(S.forEach((S,R)=>{this.documentStates.set(S,{size:R,readTime:T.get(S).readTime})}),T))}}function ch(T){return rX(T,rr)}function cp(T){return rX(T,t6)}function cf(T){let S=T.path.toArray();return[S.slice(0,S.length-2),S[S.length-2],S[S.length-1]]}function cm(T,S){let R=T.path.toArray();return[R.slice(0,R.length-2),R[R.length-2],lh(S),R[R.length-1]]}function cy(T,S){let R=S.documentKey.path.toArray();return[T,lh(S.readTime),R.slice(0,R.length-2),R.length>0?R[R.length-1]:""]}function cv(T,S){let R=T.path.toArray(),N=S.path.toArray(),O=0;for(let T=0;T<R.length-2&&T<N.length-2;++T)if(O=ex(R[T],N[T]))return O;return(O=ex(R.length,N.length))||(O=ex(R[R.length-2],N[N.length-2]))?O:ex(R[R.length-1],N[N.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cT=18;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{constructor(T,S){this.overlayedDocument=T,this.mutatedFields=S}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{constructor(T,S,R,N){this.remoteDocumentCache=T,this.mutationQueue=S,this.documentOverlayCache=R,this.indexManager=N}getDocument(T,S){let R=null;return this.documentOverlayCache.getOverlay(T,S).next(N=>(R=N,this.remoteDocumentCache.getEntry(T,S))).next(T=>(null!==R&&af(R.mutation,T,ne.empty(),e4.now()),T))}getDocuments(T,S){return this.remoteDocumentCache.getEntries(T,S).next(S=>this.getLocalViewOfDocuments(T,S,sQ()).next(()=>S))}getLocalViewOfDocuments(T,S,R=sQ()){let N=sq();return this.populateOverlays(T,N,S).next(()=>this.computeViews(T,S,N,R).next(T=>{let S=sV();return T.forEach((T,R)=>{S=S.insert(T,R.overlayedDocument)}),S}))}getOverlayedDocuments(T,S){let R=sq();return this.populateOverlays(T,R,S).next(()=>this.computeViews(T,S,R,sQ()))}populateOverlays(T,S,R){let N=[];return R.forEach(T=>{S.has(T)||N.push(T)}),this.documentOverlayCache.getOverlays(T,N).next(T=>{T.forEach((T,R)=>{S.set(T,R)})})}computeViews(T,S,R,N){let O=sB(),P=s$(),M=sj();return S.forEach((T,S)=>{let M=R.get(S.key);N.has(S.key)&&(void 0===M||M.mutation instanceof aT)?O=O.insert(S.key,S):void 0!==M?(P.set(S.key,M.mutation.getFieldMask()),af(M.mutation,S,M.mutation.getFieldMask(),e4.now())):P.set(S.key,ne.empty())}),this.recalculateAndSaveOverlays(T,O).next(T=>(T.forEach((T,S)=>P.set(T,S)),S.forEach((T,S)=>{var R;return M.set(T,new cS(S,null!==(R=P.get(T))&&void 0!==R?R:null))}),M))}recalculateAndSaveOverlays(T,S){let R=s$(),N=new r2((T,S)=>T-S),O=sQ();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(T,S).next(T=>{for(let O of T)O.keys().forEach(T=>{let P=S.get(T);if(null===P)return;let M=R.get(T)||ne.empty();M=O.applyToLocalView(P,M),R.set(T,M);let L=(N.get(O.batchId)||sQ()).add(T);N=N.insert(O.batchId,L)})}).next(()=>{let P=[],M=N.getReverseIterator();for(;M.hasNext();){let N=M.getNext(),L=N.key,U=N.value,V=sG();U.forEach(T=>{if(!O.has(T)){let N=ah(S.get(T),R.get(T));null!==N&&V.set(T,N),O=O.add(T)}}),P.push(this.documentOverlayCache.saveOverlays(T,L,V))}return tg.waitFor(P)}).next(()=>R)}recalculateAndSaveOverlaysForDocumentKeys(T,S){return this.remoteDocumentCache.getEntries(T,S).next(S=>this.recalculateAndSaveOverlays(T,S))}getDocumentsMatchingQuery(T,S,R,N){return sf(S)?this.getDocumentsMatchingDocumentQuery(T,S.path):sm(S)?this.getDocumentsMatchingCollectionGroupQuery(T,S,R,N):this.getDocumentsMatchingCollectionQuery(T,S,R,N)}getNextDocuments(T,S,R,N){return this.remoteDocumentCache.getAllFromCollectionGroup(T,S,R,N).next(O=>{let P=N-O.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(T,S,R.largestBatchId,N-O.size):tg.resolve(sq()),M=e9,L=O;return P.next(S=>tg.forEach(S,(S,R)=>(M<R.largestBatchId&&(M=R.largestBatchId),O.get(S))?tg.resolve():this.remoteDocumentCache.getEntry(T,S).next(T=>{L=L.insert(S,T)})).next(()=>this.populateOverlays(T,S,O)).next(()=>this.computeViews(T,L,S,sQ())).next(T=>({batchId:M,changes:sz(T)})))})}getDocumentsMatchingDocumentQuery(T,S){return this.getDocument(T,new eG(S)).next(T=>{let S=sV();return T.isFoundDocument()&&(S=S.insert(T.key,T)),S})}getDocumentsMatchingCollectionGroupQuery(T,S,R,N){let O=S.collectionGroup,P=sV();return this.indexManager.getCollectionParents(T,O).next(M=>tg.forEach(M,M=>{let L=sd(S,M.child(O));return this.getDocumentsMatchingCollectionQuery(T,L,R,N).next(T=>{T.forEach((T,S)=>{P=P.insert(T,S)})})}).next(()=>P))}getDocumentsMatchingCollectionQuery(T,S,R,N){let O;return this.documentOverlayCache.getOverlaysForCollection(T,S.path,R.largestBatchId).next(P=>(O=P,this.remoteDocumentCache.getDocumentsMatchingQuery(T,S,R,O,N))).next(T=>{O.forEach((S,R)=>{let N=R.getKey();null===T.get(N)&&(T=T.insert(N,i_.newInvalidDocument(N)))});let R=sV();return T.forEach((T,N)=>{let P=O.get(T);void 0!==P&&af(P.mutation,N,ne.empty(),e4.now()),sk(S,N)&&(R=R.insert(T,N))}),R})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(T){this.serializer=T,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(T,S){return tg.resolve(this.bundles.get(S))}saveBundleMetadata(T,S){return this.bundles.set(S.id,lR(S)),tg.resolve()}getNamedQuery(T,S){return tg.resolve(this.namedQueries.get(S))}saveNamedQuery(T,S){return this.namedQueries.set(S.name,lI(S)),tg.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(){this.overlays=new r2(eG.comparator),this.overlayByBatchId=new Map}getOverlay(T,S){return tg.resolve(this.overlays.get(S))}getOverlays(T,S){let R=sq();return tg.forEach(S,S=>this.getOverlay(T,S).next(T=>{null!==T&&R.set(S,T)})).next(()=>R)}saveOverlays(T,S,R){return R.forEach((R,N)=>{this.saveOverlay(T,S,N)}),tg.resolve()}removeOverlaysForBatchId(T,S,R){let N=this.overlayByBatchId.get(R);return void 0!==N&&(N.forEach(T=>this.overlays=this.overlays.remove(T)),this.overlayByBatchId.delete(R)),tg.resolve()}getOverlaysForCollection(T,S,R){let N=sq(),O=S.length+1,P=new eG(S.child("")),M=this.overlays.getIteratorFrom(P);for(;M.hasNext();){let T=M.getNext().value,P=T.getKey();if(!S.isPrefixOf(P.path))break;P.path.length===O&&T.largestBatchId>R&&N.set(T.getKey(),T)}return tg.resolve(N)}getOverlaysForCollectionGroup(T,S,R,N){let O=new r2((T,S)=>T-S),P=this.overlays.getIterator();for(;P.hasNext();){let T=P.getNext().value;if(T.getKey().getCollectionGroup()===S&&T.largestBatchId>R){let S=O.get(T.largestBatchId);null===S&&(S=sq(),O=O.insert(T.largestBatchId,S)),S.set(T.getKey(),T)}}let M=sq(),L=O.getIterator();for(;L.hasNext()&&(L.getNext().value.forEach((T,S)=>M.set(T,S)),!(M.size()>=N)););return tg.resolve(M)}saveOverlay(T,S,R){let N=this.overlays.get(R.key);if(null!==N){let T=this.overlayByBatchId.get(N.largestBatchId).delete(R.key);this.overlayByBatchId.set(N.largestBatchId,T)}this.overlays=this.overlays.insert(R.key,new aO(S,R));let O=this.overlayByBatchId.get(S);void 0===O&&(O=sQ(),this.overlayByBatchId.set(S,O)),this.overlayByBatchId.set(S,O.add(R.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(){this.sessionToken=ni.EMPTY_BYTE_STRING}getSessionToken(T){return tg.resolve(this.sessionToken)}setSessionToken(T,S){return this.sessionToken=S,tg.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(){this.refsByKey=new r9(cR.compareByKey),this.refsByTarget=new r9(cR.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(T,S){let R=new cR(T,S);this.refsByKey=this.refsByKey.add(R),this.refsByTarget=this.refsByTarget.add(R)}addReferences(T,S){T.forEach(T=>this.addReference(T,S))}removeReference(T,S){this.removeRef(new cR(T,S))}removeReferences(T,S){T.forEach(T=>this.removeReference(T,S))}removeReferencesForId(T){let S=new eG(new ej([])),R=new cR(S,T),N=new cR(S,T+1),O=[];return this.refsByTarget.forEachInRange([R,N],T=>{this.removeRef(T),O.push(T.key)}),O}removeAllReferences(){this.refsByKey.forEach(T=>this.removeRef(T))}removeRef(T){this.refsByKey=this.refsByKey.delete(T),this.refsByTarget=this.refsByTarget.delete(T)}referencesForId(T){let S=new eG(new ej([])),R=new cR(S,T),N=new cR(S,T+1),O=sQ();return this.refsByTarget.forEachInRange([R,N],T=>{O=O.add(T.key)}),O}containsKey(T){let S=new cR(T,0),R=this.refsByKey.firstAfterOrEqual(S);return null!==R&&T.isEqual(R.key)}}class cR{constructor(T,S){this.key=T,this.targetOrBatchId=S}static compareByKey(T,S){return eG.comparator(T.key,S.key)||ex(T.targetOrBatchId,S.targetOrBatchId)}static compareByTargetId(T,S){return ex(T.targetOrBatchId,S.targetOrBatchId)||eG.comparator(T.key,S.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(T,S){this.indexManager=T,this.referenceDelegate=S,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new r9(cR.compareByKey)}checkEmpty(T){return tg.resolve(0===this.mutationQueue.length)}addMutationBatch(T,S,R,N){let O=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let P=new aA(O,S,R,N);for(let S of(this.mutationQueue.push(P),N))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new cR(S.key,O)),this.indexManager.addToCollectionParentIndex(T,S.key.path.popLast());return tg.resolve(P)}lookupMutationBatch(T,S){return tg.resolve(this.findMutationBatch(S))}getNextMutationBatchAfterBatchId(T,S){let R=S+1,N=this.indexOfBatchId(R),O=N<0?0:N;return tg.resolve(this.mutationQueue.length>O?this.mutationQueue[O]:null)}getHighestUnacknowledgedBatchId(){return tg.resolve(0===this.mutationQueue.length?nC:this.nextBatchId-1)}getAllMutationBatches(T){return tg.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(T,S){let R=new cR(S,0),N=new cR(S,Number.POSITIVE_INFINITY),O=[];return this.batchesByDocumentKey.forEachInRange([R,N],T=>{let S=this.findMutationBatch(T.targetOrBatchId);O.push(S)}),tg.resolve(O)}getAllMutationBatchesAffectingDocumentKeys(T,S){let R=new r9(ex);return S.forEach(T=>{let S=new cR(T,0),N=new cR(T,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([S,N],T=>{R=R.add(T.targetOrBatchId)})}),tg.resolve(this.findMutationBatches(R))}getAllMutationBatchesAffectingQuery(T,S){let R=S.path,N=R.length+1,O=R;eG.isDocumentKey(O)||(O=O.child(""));let P=new cR(new eG(O),0),M=new r9(ex);return this.batchesByDocumentKey.forEachWhile(T=>{let S=T.key.path;return!!R.isPrefixOf(S)&&(S.length===N&&(M=M.add(T.targetOrBatchId)),!0)},P),tg.resolve(this.findMutationBatches(M))}findMutationBatches(T){let S=[];return T.forEach(T=>{let R=this.findMutationBatch(T);null!==R&&S.push(R)}),S}removeMutationBatch(T,S){em(0===this.indexOfExistingBatchId(S.batchId,"removed"),55003),this.mutationQueue.shift();let R=this.batchesByDocumentKey;return tg.forEach(S.mutations,N=>{let O=new cR(N.key,S.batchId);return R=R.delete(O),this.referenceDelegate.markPotentiallyOrphaned(T,N.key)}).next(()=>{this.batchesByDocumentKey=R})}removeCachedMutationKeys(T){}containsKey(T,S){let R=new cR(S,0),N=this.batchesByDocumentKey.firstAfterOrEqual(R);return tg.resolve(S.isEqual(N&&N.key))}performConsistencyCheck(T){return this.mutationQueue.length,tg.resolve()}indexOfExistingBatchId(T,S){return this.indexOfBatchId(T)}indexOfBatchId(T){return 0===this.mutationQueue.length?0:T-this.mutationQueue[0].batchId}findMutationBatch(T){let S=this.indexOfBatchId(T);return S<0||S>=this.mutationQueue.length?null:this.mutationQueue[S]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cN="-9223372036854775808";function cA(){return new r2(eG.comparator)}class cD{constructor(T){this.sizer=T,this.docs=cA(),this.size=0}setIndexManager(T){this.indexManager=T}addEntry(T,S){let R=S.key,N=this.docs.get(R),O=N?N.size:0,P=this.sizer(S);return this.docs=this.docs.insert(R,{document:S.mutableCopy(),size:P}),this.size+=P-O,this.indexManager.addToCollectionParentIndex(T,R.path.popLast())}removeEntry(T){let S=this.docs.get(T);S&&(this.docs=this.docs.remove(T),this.size-=S.size)}getEntry(T,S){let R=this.docs.get(S);return tg.resolve(R?R.document.mutableCopy():i_.newInvalidDocument(S))}getEntries(T,S){let R=sB();return S.forEach(T=>{let S=this.docs.get(T);R=R.insert(T,S?S.document.mutableCopy():i_.newInvalidDocument(T))}),tg.resolve(R)}getDocumentsMatchingQuery(T,S,R,N){let O=sB(),P=S.path,M=new eG(P.child("__id"+cN+"__")),L=this.docs.getIteratorFrom(M);for(;L.hasNext();){let{key:T,value:{document:M}}=L.getNext();if(!P.isPrefixOf(T.path))break;!(T.path.length>P.length+1||0>=th(tc(M),R))&&(N.has(M.key)||sk(S,M))&&(O=O.insert(M.key,M.mutableCopy()))}return tg.resolve(O)}getAllFromCollectionGroup(T,S,R,N){ep(9500)}forEachDocumentKey(T,S){return tg.forEach(this.docs,T=>S(T))}newChangeBuffer(T){return new cx(this)}getSize(T){return tg.resolve(this.size)}}function cO(T){return new cD(T)}class cx extends cl{constructor(T){super(),this.documentCache=T}applyChanges(T){let S=[];return this.changes.forEach((R,N)=>{N.isValidDocument()?S.push(this.documentCache.addEntry(T,N)):this.documentCache.removeEntry(R)}),tg.waitFor(S)}getFromCache(T,S){return this.documentCache.getEntry(T,S)}getAllFromCache(T,S){return this.documentCache.getEntries(T,S)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(T){this.persistence=T,this.targets=new sL(T=>i6(T),i5),this.lastRemoteSnapshotVersion=e6.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new cI,this.targetCount=0,this.targetIdGenerator=uY.forTargetCache()}forEachTarget(T,S){return this.targets.forEach((T,R)=>S(R)),tg.resolve()}getLastRemoteSnapshotVersion(T){return tg.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(T){return tg.resolve(this.highestSequenceNumber)}allocateTargetId(T){return this.highestTargetId=this.targetIdGenerator.next(),tg.resolve(this.highestTargetId)}setTargetsMetadata(T,S,R){return R&&(this.lastRemoteSnapshotVersion=R),S>this.highestSequenceNumber&&(this.highestSequenceNumber=S),tg.resolve()}saveTargetData(T){this.targets.set(T.target,T);let S=T.targetId;S>this.highestTargetId&&(this.targetIdGenerator=new uY(S),this.highestTargetId=S),T.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=T.sequenceNumber)}addTargetData(T,S){return this.saveTargetData(S),this.targetCount+=1,tg.resolve()}updateTargetData(T,S){return this.saveTargetData(S),tg.resolve()}removeTargetData(T,S){return this.targets.delete(S.target),this.references.removeReferencesForId(S.targetId),this.targetCount-=1,tg.resolve()}removeTargets(T,S,R){let N=0,O=[];return this.targets.forEach((P,M)=>{M.sequenceNumber<=S&&null===R.get(M.targetId)&&(this.targets.delete(P),O.push(this.removeMatchingKeysForTargetId(T,M.targetId)),N++)}),tg.waitFor(O).next(()=>N)}getTargetCount(T){return tg.resolve(this.targetCount)}getTargetData(T,S){let R=this.targets.get(S)||null;return tg.resolve(R)}addMatchingKeys(T,S,R){return this.references.addReferences(S,R),tg.resolve()}removeMatchingKeys(T,S,R){this.references.removeReferences(S,R);let N=this.persistence.referenceDelegate,O=[];return N&&S.forEach(S=>{O.push(N.markPotentiallyOrphaned(T,S))}),tg.waitFor(O)}removeMatchingKeysForTargetId(T,S){return this.references.removeReferencesForId(S),tg.resolve()}getMatchingKeysForTargetId(T,S){let R=this.references.referencesForId(S);return tg.resolve(R)}containsKey(T,S){return tg.resolve(this.references.containsKey(S))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cM="MemoryPersistence";class cL{constructor(T,S){this.mutationQueues={},this.overlays={},this.listenSequence=new tL(0),this._started=!1,this._started=!0,this.globalsCache=new cC,this.referenceDelegate=T(this),this.targetCache=new cP(this);let R=T=>this.referenceDelegate.documentSize(T);this.indexManager=new uD,this.remoteDocumentCache=cO(R),this.serializer=new lu(S),this.bundleCache=new c_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(T){return this.indexManager}getDocumentOverlayCache(T){let S=this.overlays[T.toKey()];return S||(S=new cw,this.overlays[T.toKey()]=S),S}getMutationQueue(T,S){let R=this.mutationQueues[T.toKey()];return R||(R=new ck(S,this.referenceDelegate),this.mutationQueues[T.toKey()]=R),R}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(T,S,R){eu(cM,"Starting transaction:",T);let N=new cF(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),R(N).next(T=>this.referenceDelegate.onTransactionCommitted(N).next(()=>T)).toPromise().then(T=>(N.raiseOnCommittedEvent(),T))}mutationQueuesContainKey(T,S){return tg.or(Object.values(this.mutationQueues).map(R=>()=>R.containsKey(T,S)))}}class cF extends tf{constructor(T){super(),this.currentSequenceNumber=T}}class cB{constructor(T){this.persistence=T,this.localViewReferences=new cI,this._orphanedDocuments=null}static factory(T){return new cB(T)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw ep(60996)}addReference(T,S,R){return this.localViewReferences.addReference(R,S),this.orphanedDocuments.delete(R.toString()),tg.resolve()}removeReference(T,S,R){return this.localViewReferences.removeReference(R,S),this.orphanedDocuments.add(R.toString()),tg.resolve()}markPotentiallyOrphaned(T,S){return this.orphanedDocuments.add(S.toString()),tg.resolve()}removeTarget(T,S){this.localViewReferences.removeReferencesForId(S.targetId).forEach(T=>this.orphanedDocuments.add(T.toString()));let R=this.persistence.getTargetCache();return R.getMatchingKeysForTargetId(T,S.targetId).next(T=>{T.forEach(T=>this.orphanedDocuments.add(T.toString()))}).next(()=>R.removeTargetData(T,S))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(T){let S=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tg.forEach(this.orphanedDocuments,R=>{let N=eG.fromPath(R);return this.isReferenced(T,N).next(T=>{T||S.removeEntry(N,e6.min())})}).next(()=>(this._orphanedDocuments=null,S.apply(T)))}updateLimboDocument(T,S){return this.isReferenced(T,S).next(T=>{T?this.orphanedDocuments.delete(S.toString()):this.orphanedDocuments.add(S.toString())})}documentSize(T){return 0}isReferenced(T,S){return tg.or([()=>tg.resolve(this.localViewReferences.containsKey(S)),()=>this.persistence.getTargetCache().containsKey(T,S),()=>this.persistence.mutationQueuesContainKey(T,S)])}}class cU{constructor(T,S){this.persistence=T,this.orphanedSequenceNumbers=new sL(T=>tj(T.path),(T,S)=>T.isEqual(S)),this.garbageCollector=cn(this,S)}static factory(T,S){return new cU(T,S)}onTransactionStarted(){}onTransactionCommitted(T){return tg.resolve()}forEachTarget(T,S){return this.persistence.getTargetCache().forEachTarget(T,S)}getSequenceNumberCount(T){let S=this.orphanedDocumentCount(T);return this.persistence.getTargetCache().getTargetCount(T).next(T=>S.next(S=>T+S))}orphanedDocumentCount(T){let S=0;return this.forEachOrphanedDocumentSequenceNumber(T,T=>{S++}).next(()=>S)}forEachOrphanedDocumentSequenceNumber(T,S){return tg.forEach(this.orphanedSequenceNumbers,(R,N)=>this.isPinned(T,R,N).next(T=>T?tg.resolve():S(N)))}removeTargets(T,S,R){return this.persistence.getTargetCache().removeTargets(T,S,R)}removeOrphanedDocuments(T,S){let R=0,N=this.persistence.getRemoteDocumentCache(),O=N.newChangeBuffer();return N.forEachDocumentKey(T,N=>this.isPinned(T,N,S).next(T=>{T||(R++,O.removeEntry(N,e6.min()))})).next(()=>O.apply(T)).next(()=>R)}markPotentiallyOrphaned(T,S){return this.orphanedSequenceNumbers.set(S,T.currentSequenceNumber),tg.resolve()}removeTarget(T,S){let R=S.withSequenceNumber(T.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(T,R)}addReference(T,S,R){return this.orphanedSequenceNumbers.set(R,T.currentSequenceNumber),tg.resolve()}removeReference(T,S,R){return this.orphanedSequenceNumbers.set(R,T.currentSequenceNumber),tg.resolve()}updateLimboDocument(T,S){return this.orphanedSequenceNumbers.set(S,T.currentSequenceNumber),tg.resolve()}documentSize(T){let S=T.key.toString().length;return T.isFoundDocument()&&(S+=n8(T.data.value)),S}isPinned(T,S,R){return tg.or([()=>this.persistence.mutationQueuesContainKey(T,S),()=>this.persistence.getTargetCache().containsKey(T,S),()=>{let T=this.orphanedSequenceNumbers.get(S);return tg.resolve(void 0!==T&&T>R)}])}getCacheSize(T){return this.persistence.getRemoteDocumentCache().getSize(T)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(T){this.serializer=T}createOrUpgrade(T,S,R,N){let O=new tb("createOrUpgrade",S);R<1&&N>=1&&(cz(T),cq(T),cW(T),c$(T));let P=tg.resolve();return R<3&&N>=3&&(0!==R&&(cQ(T),cW(T)),P=P.next(()=>cJ(O))),R<4&&N>=4&&(0!==R&&(P=P.next(()=>cG(T,O))),P=P.next(()=>{cX(T)})),R<5&&N>=5&&(P=P.next(()=>this.removeAcknowledgedMutations(O))),R<6&&N>=6&&(P=P.next(()=>(cH(T),this.addDocumentGlobal(O)))),R<7&&N>=7&&(P=P.next(()=>this.ensureSequenceNumbers(O))),R<8&&N>=8&&(P=P.next(()=>this.createCollectionParentIndex(T,O))),R<9&&N>=9&&(P=P.next(()=>{cY(T)})),R<10&&N>=10&&(P=P.next(()=>this.rewriteCanonicalIds(O))),R<11&&N>=11&&(P=P.next(()=>{cZ(T),c0(T)})),R<12&&N>=12&&(P=P.next(()=>{c6(T)})),R<13&&N>=13&&(P=P.next(()=>cK(T)).next(()=>this.rewriteRemoteDocumentCache(T,O)).next(()=>T.deleteObjectStore(t$))),R<14&&N>=14&&(P=P.next(()=>this.runOverlayMigration(T,O))),R<15&&N>=15&&(P=P.next(()=>c4(T))),R<16&&N>=16&&(P=P.next(()=>{S.objectStore(rI).clear()}).next(()=>{S.objectStore(rA).clear()})),R<17&&N>=17&&(P=P.next(()=>{c9(T)})),R<18&&N>=18&&isSafariOrWebkit()&&(P=P.next(()=>{S.objectStore(rI).clear()}).next(()=>{S.objectStore(rA).clear()})),P}addDocumentGlobal(T){let S=0;return T.store(t$).iterate((T,R)=>{S+=uz(R)}).next(()=>{let R={byteSize:S};return T.store(rr).put(rn,R)})}removeAcknowledgedMutations(T){let S=T.store(tW),R=T.store(tY);return S.loadAll().next(S=>tg.forEach(S,S=>{let N=IDBKeyRange.bound([S.userId,nC],[S.userId,S.lastAcknowledgedBatchId]);return R.loadAll(tX,N).next(R=>tg.forEach(R,R=>{em(R.userId===S.userId,18650,"Cannot process batch from unexpected user",{batchId:R.batchId});let N=ly(this.serializer,R);return uj(T,S.userId,N).next(()=>{})}))}))}ensureSequenceNumbers(T){let S=T.store(rl),R=T.store(t$);return T.store(rp).get(rh).next(T=>{let N=R=>S.put({targetId:0,path:tj(R),sequenceNumber:T.highestListenSequenceNumber}),O=[];return R.iterate((T,R)=>{let P=new ej(T),M=cj(P);O.push(S.get(M).next(T=>T?tg.resolve():N(P)))}).next(()=>tg.waitFor(O))})}createCollectionParentIndex(T,S){T.createObjectStore(rf,{keyPath:rm});let R=S.store(rf),N=new uO,O=T=>{if(N.add(T)){let S=T.lastSegment(),N=T.popLast();return R.put({collectionId:S,parent:tj(N)})}};return S.store(t$).iterate({keysOnly:!0},(T,S)=>O(new ej(T).popLast())).next(()=>S.store(t4).iterate({keysOnly:!0},([T,S,R],N)=>O(tG(S).popLast())))}rewriteCanonicalIds(T){let S=T.store(ri);return S.iterate((T,R)=>{let N=lv(R),O=lb(this.serializer,N);return S.put(O)})}rewriteRemoteDocumentCache(T,S){let R=S.store(t$),N=[];return R.iterate((T,R)=>{let O=S.store(t6),P=c5(R).path.toArray(),M={prefixPath:P.slice(0,P.length-2),collectionGroup:P[P.length-2],documentId:P[P.length-1],readTime:R.readTime||[0,0],unknownDocument:R.unknownDocument,noDocument:R.noDocument,document:R.document,hasCommittedMutations:!!R.hasCommittedMutations};N.push(O.put(M))}).next(()=>tg.waitFor(N))}runOverlayMigration(T,S){let R=S.store(tY),N=cc(this.serializer),O=new cL(cB.factory,this.serializer.remoteSerializer);return R.loadAll().next(T=>{let R=new Map;return T.forEach(T=>{var S;let N=null!==(S=R.get(T.userId))&&void 0!==S?S:sQ();ly(this.serializer,T).keys().forEach(T=>N=N.add(T)),R.set(T.userId,N)}),tg.forEach(R,(T,R)=>{let P=new er(R),M=lF.forUser(this.serializer,P),L=O.getIndexManager(P);return new cE(N,uq.forUser(P,this.serializer,L,O.referenceDelegate),M,L).recalculateAndSaveOverlaysForDocumentKeys(new rJ(S,tL.INVALID),T).next()})})}}function cj(T){return[0,tj(T)]}function cz(T){T.createObjectStore(tK)}function cq(T){T.createObjectStore(tW,{keyPath:tQ}),T.createObjectStore(tY,{keyPath:tJ,autoIncrement:!0}).createIndex(tX,tZ,{unique:!0}),T.createObjectStore(t4)}function cG(T,S){return S.store(tY).loadAll().next(R=>{T.deleteObjectStore(tY),T.createObjectStore(tY,{keyPath:tJ,autoIncrement:!0}).createIndex(tX,tZ,{unique:!0});let N=S.store(tY),O=R.map(T=>N.put(T));return tg.waitFor(O)})}function c$(T){T.createObjectStore(t$)}function cK(T){let S=T.createObjectStore(t6,{keyPath:t9});S.createIndex(t5,t8),S.createIndex(t7,rt)}function cH(T){T.createObjectStore(rr)}function cW(T){T.createObjectStore(rl,{keyPath:ru}).createIndex(rc,rd,{unique:!0}),T.createObjectStore(ri,{keyPath:rs}).createIndex(ra,ro,{unique:!0}),T.createObjectStore(rp)}function cQ(T){T.deleteObjectStore(rl),T.deleteObjectStore(ri),T.deleteObjectStore(rp)}function cY(T){T.objectStoreNames.contains("remoteDocumentChanges")&&T.deleteObjectStore("remoteDocumentChanges")}function cJ(T){let S=T.store(rp),R={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:e6.min().toTimestamp(),targetCount:0};return S.put(rh,R)}function cX(T){T.createObjectStore(rg,{keyPath:ry})}function cZ(T){T.createObjectStore(rv,{keyPath:rb})}function c0(T){T.createObjectStore(rT,{keyPath:rS})}function c4(T){T.createObjectStore(rE,{keyPath:r_,autoIncrement:!0}).createIndex(rw,rC,{unique:!1}),T.createObjectStore(rI,{keyPath:rR}).createIndex(rk,rN,{unique:!1}),T.createObjectStore(rA,{keyPath:rD}).createIndex(rO,rx,{unique:!1})}function c6(T){let S=T.createObjectStore(rP,{keyPath:rM});S.createIndex(rL,rF,{unique:!1}),S.createIndex(rB,rU,{unique:!1})}function c9(T){T.createObjectStore(rV,{keyPath:rj})}function c5(T){return T.document?new eG(ej.fromString(T.document.name).popFirst(5)):T.noDocument?eG.fromSegments(T.noDocument.path):T.unknownDocument?eG.fromSegments(T.unknownDocument.path):ep(36783)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let c8="IndexedDbPersistence",c7=null,de=5e3,dt=4e3,dr=null,dn=null,di="firestore_zombie",ds="main";class da{constructor(T,S,R,N,O,P,M,L,U,V,$=cT){if(this.allowTabSynchronization=T,this.persistenceKey=S,this.clientId=R,this.queue=O,this.window=P,this.document=M,this.sequenceNumberSyncer=U,this.forceOwningTab=V,this.schemaVersion=$,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=T=>Promise.resolve(),!da.isAvailable())throw new ev(ey.UNIMPLEMENTED,dn);this.referenceDelegate=new ci(this,N),this.dbName=S+ds,this.serializer=new lu(L),this.simpleDb=new tT(this.dbName,this.schemaVersion,new cV(this.serializer)),this.globalsCache=new lU,this.targetCache=new uJ(this.referenceDelegate,this.serializer),this.remoteDocumentCache=cc(this.serializer),this.bundleCache=new lP,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===V&&ec(c8,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ev(ey.FAILED_PRECONDITION,dr);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",T=>this.targetCache.getHighestSequenceNumber(T))}).then(T=>{this.listenSequence=new tL(T,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(T=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(T)))}setPrimaryStateListener(T){return this.primaryStateListener=async S=>{if(this.started)return T(S)},T(this.isPrimary)}setDatabaseDeletedListener(T){this.simpleDb.setDatabaseDeletedListener(T)}setNetworkEnabled(T){this.networkEnabled!==T&&(this.networkEnabled=T,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",T=>du(T).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(T).next(T=>{T||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(T)).next(S=>this.isPrimary&&!S?this.releasePrimaryLeaseIfHeld(T).next(()=>!1):!!S&&this.acquireOrExtendPrimaryLease(T).next(()=>!0))).catch(T=>{if(tw(T))return eu(c8,"Failed to extend owner lease: ",T),this.isPrimary;if(!this.allowTabSynchronization)throw T;return eu(c8,"Releasing owner lease after error during lease refresh",T),!1}).then(T=>{this.isPrimary!==T&&this.queue.enqueueRetryable(()=>this.primaryStateListener(T)),this.isPrimary=T})}verifyPrimaryLease(T){return dl(T).get(tH).next(T=>tg.resolve(this.isLocalClient(T)))}removeClientMetadata(T){return du(T).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,c7)){this.lastGarbageCollectionTime=Date.now();let T=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",T=>{let S=rX(T,rg);return S.loadAll().next(T=>{let R=this.filterActiveClients(T,c7),N=T.filter(T=>-1===R.indexOf(T));return tg.forEach(N,T=>S.delete(T.clientId)).next(()=>N)})}).catch(()=>[]);if(this.webStorage)for(let S of T)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(S.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",dt,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(T){return!!T&&T.ownerId===this.clientId}canActAsPrimary(T){return this.forceOwningTab?tg.resolve(!0):dl(T).get(tH).next(S=>{if(null!==S&&this.isWithinAge(S.leaseTimestampMs,de)&&!this.isClientZombied(S.ownerId)){if(this.isLocalClient(S)&&this.networkEnabled)return!0;if(!this.isLocalClient(S)){if(!S.allowTabSynchronization)throw new ev(ey.FAILED_PRECONDITION,dr);return!1}}return!!this.networkEnabled&&!!this.inForeground||du(T).loadAll().next(T=>void 0===this.filterActiveClients(T,de).find(T=>{if(this.clientId!==T.clientId){let S=!this.networkEnabled&&T.networkEnabled,R=!this.inForeground&&T.inForeground,N=this.networkEnabled===T.networkEnabled;if(S||R&&N)return!0}return!1}))}).next(T=>(this.isPrimary!==T&&eu(c8,`Client ${T?"is":"is not"} eligible for a primary lease.`),T))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[tK,rg],T=>{let S=new rJ(T,tL.INVALID);return this.releasePrimaryLeaseIfHeld(S).next(()=>this.removeClientMetadata(S))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(T,S){return T.filter(T=>this.isWithinAge(T.updateTimeMs,S)&&!this.isClientZombied(T.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",T=>du(T).loadAll().next(T=>this.filterActiveClients(T,c7).map(T=>T.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(T,S){return uq.forUser(T,this.serializer,S,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(T){return new uM(T,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(T){return lF.forUser(this.serializer,T)}getBundleCache(){return this.bundleCache}runTransaction(T,S,R){let N;eu(c8,"Starting transaction:",T);let O="readonly"===S?"readonly":"readwrite",P=rY(this.schemaVersion);return this.simpleDb.runTransaction(T,O,P,O=>(N=new rJ(O,this.listenSequence?this.listenSequence.next():tL.INVALID),"readwrite-primary"===S)?this.verifyPrimaryLease(N).next(T=>!!T||this.canActAsPrimary(N)).next(S=>{if(!S)throw ec(`Failed to obtain primary lease for action '${T}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new ev(ey.FAILED_PRECONDITION,tp);return R(N)}).next(T=>this.acquireOrExtendPrimaryLease(N).next(()=>T)):this.verifyAllowTabSynchronization(N).next(()=>R(N))).then(T=>(N.raiseOnCommittedEvent(),T))}verifyAllowTabSynchronization(T){return dl(T).get(tH).next(T=>{if(null!==T&&this.isWithinAge(T.leaseTimestampMs,de)&&!this.isClientZombied(T.ownerId)&&!this.isLocalClient(T)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!T.allowTabSynchronization))throw new ev(ey.FAILED_PRECONDITION,dr)})}acquireOrExtendPrimaryLease(T){let S={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return dl(T).put(tH,S)}static isAvailable(){return tT.isAvailable()}releasePrimaryLeaseIfHeld(T){let S=dl(T);return S.get(tH).next(T=>this.isLocalClient(T)?(eu(c8,"Releasing primary lease."),S.delete(tH)):tg.resolve())}isWithinAge(T,S){let R=Date.now(),N=R-S,O=R;return!(T<N)&&(!(T>O)||(ec(`Detected an update time that is in the future: ${T} > ${O}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var T;"function"==typeof(null===(T=this.window)||void 0===T?void 0:T.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let T=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match(T)||navigator.userAgent.match(T))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(T){var S;try{let R=(null===(S=this.webStorage)||void 0===S?void 0:S.getItem(this.zombiedClientLocalStorageKey(T)))!==null;return eu(c8,`Client '${T}' ${R?"is":"is not"} zombied in LocalStorage`),R}catch(T){return ec(c8,"Failed to get zombied client id.",T),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(T){ec("Failed to set zombie client id.",T)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(T){}}zombiedClientLocalStorageKey(T){return`${di}_${this.persistenceKey}_${T}`}}function dl(T){return rX(T,tK)}function du(T){return rX(T,rg)}function dc(T,S){let R=T.projectId;return T.isDefaultDatabase||(R+="."+T.database),"firestore/"+S+"/"+R+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(T,S,R,N,O){S=[...S],(T=[...T]).sort(R),S.sort(R);let P=T.length,M=S.length,L=0,U=0;for(;L<M&&U<P;){let P=R(T[U],S[L]);P<0?O(T[U++]):P>0?N(S[L++]):(L++,U++)}for(;L<M;)N(S[L++]);for(;U<P;)O(T[U++])}function dh(T,S){if(T.length!==S.length)return!1;for(let R=0;R<T.length;++R)if(T[R]!==S[R])return!1;return!0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp="LocalStore",df=3e8;class dm{constructor(T,S,R,N){this.persistence=T,this.queryEngine=S,this.serializer=N,this.targetDataByTarget=new r2(ex),this.targetIdByTarget=new sL(T=>i6(T),i5),this.collectionGroupReadTime=new Map,this.remoteDocuments=T.getRemoteDocumentCache(),this.targetCache=T.getTargetCache(),this.bundleCache=T.getBundleCache(),this.initializeUserComponents(R)}initializeUserComponents(T){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(T),this.indexManager=this.persistence.getIndexManager(T),this.mutationQueue=this.persistence.getMutationQueue(T,this.indexManager),this.localDocuments=new cE(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(T){return this.persistence.runTransaction("Collect garbage","readwrite-primary",S=>T.collect(S,this.targetDataByTarget))}}function dg(T,S,R,N){return new dm(T,S,R,N)}async function dy(T,S){let R=eg(T);return await R.persistence.runTransaction("Handle user change","readonly",T=>{let N;return R.mutationQueue.getAllMutationBatches(T).next(O=>(N=O,R.initializeUserComponents(S),R.mutationQueue.getAllMutationBatches(T))).next(S=>{let O=[],P=[],M=sQ();for(let T of N)for(let S of(O.push(T.batchId),T.mutations))M=M.add(S.key);for(let T of S)for(let S of(P.push(T.batchId),T.mutations))M=M.add(S.key);return R.localDocuments.getDocuments(T,M).next(T=>({affectedDocuments:T,removedBatchIds:O,addedBatchIds:P}))})})}function dT(T,S){let R,N;let O=eg(T),P=e4.now(),M=S.reduce((T,S)=>T.add(S.key),sQ());return O.persistence.runTransaction("Locally write mutations","readwrite",T=>{let L=sB(),U=sQ();return O.remoteDocuments.getEntries(T,M).next(T=>{(L=T).forEach((T,S)=>{S.isValidDocument()||(U=U.add(T))})}).next(()=>O.localDocuments.getOverlayedDocuments(T,L)).next(N=>{R=N;let M=[];for(let T of S){let S=am(T,R.get(T.key).overlayedDocument);null!=S&&M.push(new aT(T.key,S,iE(S.value.mapValue),au.exists(!0)))}return O.mutationQueue.addMutationBatch(T,P,M,S)}).next(S=>{N=S;let P=S.applyToLocalDocumentSet(R,U);return O.documentOverlayCache.saveOverlays(T,S.batchId,P)})}).then(()=>({batchId:N.batchId,changes:sz(R)}))}function dS(T,S){let R=eg(T);return R.persistence.runTransaction("Acknowledge batch","readwrite-primary",T=>{let N=S.batch.keys(),O=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});return dL(R,T,S,O).next(()=>O.apply(T)).next(()=>R.mutationQueue.performConsistencyCheck(T)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(T,N,S.batch.batchId)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,dE(S))).next(()=>R.localDocuments.getDocuments(T,N))})}function dE(T){let S=sQ();for(let R=0;R<T.mutationResults.length;++R)T.mutationResults[R].transformResults.length>0&&(S=S.add(T.batch.mutations[R].key));return S}function d_(T,S){let R=eg(T);return R.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let N;return R.mutationQueue.lookupMutationBatch(T,S).next(S=>(em(null!==S,37113),N=S.keys(),R.mutationQueue.removeMutationBatch(T,S))).next(()=>R.mutationQueue.performConsistencyCheck(T)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(T,N,S)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,N)).next(()=>R.localDocuments.getDocuments(T,N))})}function dw(T){let S=eg(T);return S.persistence.runTransaction("Get highest unacknowledged batch id","readonly",T=>S.mutationQueue.getHighestUnacknowledgedBatchId(T))}function dC(T){let S=eg(T);return S.persistence.runTransaction("Get last remote snapshot version","readonly",T=>S.targetCache.getLastRemoteSnapshotVersion(T))}function dI(T,S){let R=eg(T),N=S.snapshotVersion,O=R.targetDataByTarget;return R.persistence.runTransaction("Apply remote event","readwrite-primary",T=>{let P=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});O=R.targetDataByTarget;let M=[];S.targetChanges.forEach((P,L)=>{let U=O.get(L);if(!U)return;M.push(R.targetCache.removeMatchingKeys(T,P.removedDocuments,L).next(()=>R.targetCache.addMatchingKeys(T,P.addedDocuments,L)));let V=U.withSequenceNumber(T.currentSequenceNumber);null!==S.targetMismatches.get(L)?V=V.withResumeToken(ni.EMPTY_BYTE_STRING,e6.min()).withLastLimboFreeSnapshotVersion(e6.min()):P.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(P.resumeToken,N)),O=O.insert(L,V),dk(U,V,P)&&M.push(R.targetCache.updateTargetData(T,V))});let L=sB(),U=sQ();if(S.documentUpdates.forEach(N=>{S.resolvedLimboDocuments.has(N)&&M.push(R.persistence.referenceDelegate.updateLimboDocument(T,N))}),M.push(dR(T,P,S.documentUpdates).next(T=>{L=T.changedDocuments,U=T.existenceChangedKeys})),!N.isEqual(e6.min())){let S=R.targetCache.getLastRemoteSnapshotVersion(T).next(S=>R.targetCache.setTargetsMetadata(T,T.currentSequenceNumber,N));M.push(S)}return tg.waitFor(M).next(()=>P.apply(T)).next(()=>R.localDocuments.getLocalViewOfDocuments(T,L,U)).next(()=>L)}).then(T=>(R.targetDataByTarget=O,T))}function dR(T,S,R){let N=sQ(),O=sQ();return R.forEach(T=>N=N.add(T)),S.getEntries(T,N).next(T=>{let N=sB();return R.forEach((R,P)=>{let M=T.get(R);P.isFoundDocument()!==M.isFoundDocument()&&(O=O.add(R)),P.isNoDocument()&&P.version.isEqual(e6.min())?(S.removeEntry(R,P.readTime),N=N.insert(R,P)):!M.isValidDocument()||P.version.compareTo(M.version)>0||0===P.version.compareTo(M.version)&&M.hasPendingWrites?(S.addEntry(P),N=N.insert(R,P)):eu(dp,"Ignoring outdated watch update for ",R,". Current version:",M.version," Watch version:",P.version)}),{changedDocuments:N,existenceChangedKeys:O}})}function dk(T,S,R){return!!(0===T.resumeToken.approximateByteSize()||S.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=df)||R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}async function dN(T,S){let R=eg(T);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",T=>tg.forEach(S,S=>tg.forEach(S.addedKeys,N=>R.persistence.referenceDelegate.addReference(T,S.targetId,N)).next(()=>tg.forEach(S.removedKeys,N=>R.persistence.referenceDelegate.removeReference(T,S.targetId,N)))))}catch(T){if(tw(T))eu(dp,"Failed to update sequence numbers: "+T);else throw T}for(let T of S){let S=T.targetId;if(!T.fromCache){let T=R.targetDataByTarget.get(S),N=T.snapshotVersion,O=T.withLastLimboFreeSnapshotVersion(N);R.targetDataByTarget=R.targetDataByTarget.insert(S,O)}}}function dA(T,S){let R=eg(T);return R.persistence.runTransaction("Get next mutation batch","readonly",T=>(void 0===S&&(S=nC),R.mutationQueue.getNextMutationBatchAfterBatchId(T,S)))}function dD(T,S){let R=eg(T);return R.persistence.runTransaction("read document","readonly",T=>R.localDocuments.getDocument(T,S))}function dO(T,S){let R=eg(T);return R.persistence.runTransaction("Allocate target","readwrite",T=>{let N;return R.targetCache.getTargetData(T,S).next(O=>O?(N=O,tg.resolve(N)):R.targetCache.allocateTargetId(T).next(O=>(N=new ll(S,O,"TargetPurposeListen",T.currentSequenceNumber),R.targetCache.addTargetData(T,N).next(()=>N))))}).then(T=>{let N=R.targetDataByTarget.get(T.targetId);return(null===N||T.snapshotVersion.compareTo(N.snapshotVersion)>0)&&(R.targetDataByTarget=R.targetDataByTarget.insert(T.targetId,T),R.targetIdByTarget.set(S,T.targetId)),T})}function dx(T,S,R){let N=eg(T),O=N.targetIdByTarget.get(R);return void 0!==O?tg.resolve(N.targetDataByTarget.get(O)):N.targetCache.getTargetData(S,R)}async function dP(T,S,R){let N=eg(T),O=N.targetDataByTarget.get(S),P=R?"readwrite":"readwrite-primary";try{R||await N.persistence.runTransaction("Release target",P,T=>N.persistence.referenceDelegate.removeTarget(T,O))}catch(T){if(tw(T))eu(dp,`Failed to update sequence numbers for target ${S}: ${T}`);else throw T}N.targetDataByTarget=N.targetDataByTarget.remove(S),N.targetIdByTarget.delete(O.target)}function dM(T,S,R){let N=eg(T),O=e6.min(),P=sQ();return N.persistence.runTransaction("Execute query","readwrite",T=>dx(N,T,sy(S)).next(S=>{if(S)return O=S.lastLimboFreeSnapshotVersion,N.targetCache.getMatchingKeysForTargetId(T,S.targetId).next(T=>{P=T})}).next(()=>N.queryEngine.getDocumentsMatchingQuery(T,S,R?O:e6.min(),R?P:sQ())).next(T=>(dz(N,sx(S),T),{documents:T,remoteKeys:P})))}function dL(T,S,R,N){let O=R.batch,P=O.keys(),M=tg.resolve();return P.forEach(T=>{M=M.next(()=>N.getEntry(S,T)).next(S=>{let P=R.docVersions.get(T);em(null!==P,48541),0>S.version.compareTo(P)&&(O.applyToRemoteDocument(S,R),S.isValidDocument()&&(S.setReadTime(R.commitVersion),N.addEntry(S)))})}),M.next(()=>T.mutationQueue.removeMutationBatch(S,O))}function dF(T,S){let R=eg(T),N=eg(R.mutationQueue);return R.persistence.runTransaction("Lookup mutation documents","readonly",T=>N.lookupMutationKeys(T,S).next(S=>S?R.localDocuments.getDocuments(T,S):tg.resolve(null)))}function dB(T,S){eg(eg(T,dm).mutationQueue).removeCachedMutationKeys(S)}function dU(T){return eg(eg(T,dm).persistence).getActiveClients()}function dV(T,S){let R=eg(T),N=eg(R.targetCache),O=R.targetDataByTarget.get(S);return O?Promise.resolve(O.target):R.persistence.runTransaction("Get target data","readonly",T=>N.getTargetDataForTarget(T,S).next(T=>T?T.target:null))}function dj(T,S){let R=eg(T),N=R.collectionGroupReadTime.get(S)||e6.min();return R.persistence.runTransaction("Get new document changes","readonly",T=>R.remoteDocuments.getAllFromCollectionGroup(T,S,tu(N,e9),Number.MAX_SAFE_INTEGER)).then(T=>(dz(R,S,T),T))}function dz(T,S,R){let N=T.collectionGroupReadTime.get(S)||e6.min();R.forEach((T,S)=>{S.readTime.compareTo(N)>0&&(N=S.readTime)}),T.collectionGroupReadTime.set(S,N)}function dq(T){return sy(sc(ej.fromString(`__bundle__/docs/${T}`)))}async function dG(T,S,R,N){let O=eg(T),P=sQ(),M=sB();for(let T of R){let R=S.toDocumentKey(T.metadata.name);T.document&&(P=P.add(R));let N=S.toMutableDocument(T);N.setReadTime(S.toSnapshotVersion(T.metadata.readTime)),M=M.insert(R,N)}let L=O.remoteDocuments.newChangeBuffer({trackRemovals:!0}),U=await dO(O,dq(N));return O.persistence.runTransaction("Apply bundle documents","readwrite",T=>dR(T,L,M).next(S=>(L.apply(T),S)).next(S=>O.targetCache.removeMatchingKeysForTargetId(T,U.targetId).next(()=>O.targetCache.addMatchingKeys(T,P,U.targetId)).next(()=>O.localDocuments.getLocalViewOfDocuments(T,S.changedDocuments,S.existenceChangedKeys)).next(()=>S.changedDocuments)))}function d$(T,S){let R=eg(T),N=on(S.createTime);return R.persistence.runTransaction("hasNewerBundle","readonly",T=>R.bundleCache.getBundleMetadata(T,S.id)).then(T=>!!T&&T.createTime.compareTo(N)>=0)}function dK(T,S){let R=eg(T);return R.persistence.runTransaction("Save bundle","readwrite",T=>R.bundleCache.saveBundleMetadata(T,S))}function dH(T,S){let R=eg(T);return R.persistence.runTransaction("Get named query","readonly",T=>R.bundleCache.getNamedQuery(T,S))}async function dW(T,S,R=sQ()){let N=await dO(T,sy(lC(S.bundledQuery))),O=eg(T);return O.persistence.runTransaction("Save named query","readwrite",T=>{let P=on(S.readTime);if(N.snapshotVersion.compareTo(P)>=0)return O.bundleCache.saveNamedQuery(T,S);let M=N.withResumeToken(ni.EMPTY_BYTE_STRING,P);return O.targetDataByTarget=O.targetDataByTarget.insert(M.targetId,M),O.targetCache.updateTargetData(T,M).next(()=>O.targetCache.removeMatchingKeysForTargetId(T,N.targetId)).next(()=>O.targetCache.addMatchingKeys(T,R,N.targetId)).next(()=>O.bundleCache.saveNamedQuery(T,S))})}function dQ(T,S){eg(T).queryEngine.indexAutoCreationEnabled=S}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dY{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(T){this._documentReadCount+=T}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dJ=100;function dX(){return(0,K.G6)()?8:tS((0,K.z$)())>0?6:4}class dZ{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=dJ,this.relativeIndexReadCostPerDocument=dX()}initialize(T,S){this.localDocumentsView=T,this.indexManager=S,this.initialized=!0}getDocumentsMatchingQuery(T,S,R,N){let O={result:null};return this.performQueryUsingIndex(T,S).next(T=>{O.result=T}).next(()=>{if(!O.result)return this.performQueryUsingRemoteKeys(T,S,N,R).next(T=>{O.result=T})}).next(()=>{if(O.result)return;let R=new dY;return this.executeFullCollectionScan(T,S,R).next(N=>{if(O.result=N,this.indexAutoCreationEnabled)return this.createCacheIndexes(T,S,R,N.size)})}).next(()=>O.result)}createCacheIndexes(T,S,R,N){return R.documentReadCount<this.indexAutoCreationMinCollectionSize?(eo()<=V.in.DEBUG&&eu("QueryEngine","SDK will not create cache indexes for query:",sR(S),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),tg.resolve()):(eo()<=V.in.DEBUG&&eu("QueryEngine","Query:",sR(S),"scans",R.documentReadCount,"local documents and returns",N,"documents as results."),R.documentReadCount>this.relativeIndexReadCostPerDocument*N)?(eo()<=V.in.DEBUG&&eu("QueryEngine","The SDK decides to create cache indexes for query:",sR(S),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(T,sy(S))):tg.resolve()}performQueryUsingIndex(T,S){if(sh(S))return tg.resolve(null);let R=sy(S);return this.indexManager.getIndexType(T,R).next(N=>0===N?null:(null!==S.limit&&1===N&&(R=sy(S=sE(S,null,"F"))),this.indexManager.getDocumentsMatchingTarget(T,R).next(N=>{let O=sQ(...N);return this.localDocumentsView.getDocuments(T,O).next(N=>this.indexManager.getMinOffset(T,R).next(R=>{let P=this.applyQuery(S,N);return this.needsRefill(S,P,O,R.readTime)?this.performQueryUsingIndex(T,sE(S,null,"F")):this.appendRemainingResults(T,P,S,R)}))})))}performQueryUsingRemoteKeys(T,S,R,N){return sh(S)||N.isEqual(e6.min())?tg.resolve(null):this.localDocumentsView.getDocuments(T,R).next(O=>{let P=this.applyQuery(S,O);return this.needsRefill(S,P,R,N)?tg.resolve(null):(eo()<=V.in.DEBUG&&eu("QueryEngine","Re-using previous result from %s to execute query: %s",N.toString(),sR(S)),this.appendRemainingResults(T,P,S,tu(N,e9)).next(T=>T))})}applyQuery(T,S){let R=new r9(sP(T));return S.forEach((S,N)=>{sk(T,N)&&(R=R.add(N))}),R}needsRefill(T,S,R,N){if(null===T.limit)return!1;if(R.size!==S.size)return!0;let O="F"===T.limitType?S.last():S.first();return!!O&&(O.hasPendingWrites||O.version.compareTo(N)>0)}executeFullCollectionScan(T,S,R){return eo()<=V.in.DEBUG&&eu("QueryEngine","Using full collection scan to execute query:",sR(S)),this.localDocumentsView.getDocumentsMatchingQuery(T,S,td.min(),R)}appendRemainingResults(T,S,R,N){return this.localDocumentsView.getDocumentsMatchingQuery(T,R,N).next(T=>(S.forEach(S=>{T=T.insert(S.key,S)}),T))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d0="firestore_clients";function d3(T,S){return`${d0}_${T}_${S}`}let d4="firestore_mutations";function d6(T,S,R){let N=`${d4}_${T}_${R}`;return S.isAuthenticated()&&(N+=`_${S.uid}`),N}let d9="firestore_targets";function d5(T,S){return`${d9}_${T}_${S}`}let d8="firestore_online_state";function d7(T){return`${d8}_${T}`}let he="firestore_bundle_loaded_v2";function ht(T){return`${he}_${T}`}let hr="firestore_sequence_number";function hn(T){return`${hr}_${T}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hs="SharedClientState";class ha{constructor(T,S,R,N){this.user=T,this.batchId=S,this.state=R,this.error=N}static fromWebStorageEntry(T,S,R){let N;let O=JSON.parse(R),P="object"==typeof O&&-1!==["pending","acknowledged","rejected"].indexOf(O.state)&&(void 0===O.error||"object"==typeof O.error);return(P&&O.error&&(P="string"==typeof O.error.message&&"string"==typeof O.error.code)&&(N=new ev(O.error.code,O.error.message)),P)?new ha(T,S,O.state,N):(ec(hs,`Failed to parse mutation state for ID '${S}': ${R}`),null)}toWebStorageJSON(){let T={state:this.state,updateTimeMs:Date.now()};return this.error&&(T.error={code:this.error.code,message:this.error.message}),JSON.stringify(T)}}class ho{constructor(T,S,R){this.targetId=T,this.state=S,this.error=R}static fromWebStorageEntry(T,S){let R;let N=JSON.parse(S),O="object"==typeof N&&-1!==["not-current","current","rejected"].indexOf(N.state)&&(void 0===N.error||"object"==typeof N.error);return(O&&N.error&&(O="string"==typeof N.error.message&&"string"==typeof N.error.code)&&(R=new ev(N.error.code,N.error.message)),O)?new ho(T,N.state,R):(ec(hs,`Failed to parse target state for ID '${T}': ${S}`),null)}toWebStorageJSON(){let T={state:this.state,updateTimeMs:Date.now()};return this.error&&(T.error={code:this.error.code,message:this.error.message}),JSON.stringify(T)}}class hl{constructor(T,S){this.clientId=T,this.activeTargetIds=S}static fromWebStorageEntry(T,S){let R=JSON.parse(S),N="object"==typeof R&&R.activeTargetIds instanceof Array,O=sJ();for(let T=0;N&&T<R.activeTargetIds.length;++T)N=nk(R.activeTargetIds[T]),O=O.add(R.activeTargetIds[T]);return N?new hl(T,O):(ec(hs,`Failed to parse client data for instance '${T}': ${S}`),null)}}class hu{constructor(T,S){this.clientId=T,this.onlineState=S}static fromWebStorageEntry(T){let S=JSON.parse(T);return"object"==typeof S&&-1!==["Unknown","Online","Offline"].indexOf(S.onlineState)&&"string"==typeof S.clientId?new hu(S.clientId,S.onlineState):(ec(hs,`Failed to parse online state: ${T}`),null)}}class hc{constructor(){this.activeTargetIds=sJ()}addQueryTarget(T){this.activeTargetIds=this.activeTargetIds.add(T)}removeQueryTarget(T){this.activeTargetIds=this.activeTargetIds.delete(T)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hd{constructor(T,S,R,N,O){this.window=T,this.queue=S,this.persistenceKey=R,this.localClientId=N,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new r2(ex),this.started=!1,this.earlyEvents=[];let P=R.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=O,this.localClientStorageKey=d3(this.persistenceKey,this.localClientId),this.sequenceNumberKey=hn(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new hc),this.clientStateKeyRe=RegExp(`^${d0}_${P}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${d4}_${P}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${d9}_${P}_(\\d+)$`),this.onlineStateKey=d7(this.persistenceKey),this.bundleLoadedKey=ht(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(T){return!!(T&&T.localStorage)}async start(){for(let T of(await this.syncEngine.getActiveClients())){if(T===this.localClientId)continue;let S=this.getItem(d3(this.persistenceKey,T));if(S){let R=hl.fromWebStorageEntry(T,S);R&&(this.activeClients=this.activeClients.insert(R.clientId,R))}}this.persistClientState();let T=this.storage.getItem(this.onlineStateKey);if(T){let S=this.fromWebStorageOnlineState(T);S&&this.handleOnlineStateEvent(S)}for(let T of this.earlyEvents)this.handleWebStorageEvent(T);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(T){this.setItem(this.sequenceNumberKey,JSON.stringify(T))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(T){let S=!1;return this.activeClients.forEach((R,N)=>{N.activeTargetIds.has(T)&&(S=!0)}),S}addPendingMutation(T){this.persistMutationState(T,"pending")}updateMutationState(T,S,R){this.persistMutationState(T,S,R),this.removeMutationState(T)}addLocalQueryTarget(T,S=!0){let R="not-current";if(this.isActiveQueryTarget(T)){let S=this.storage.getItem(d5(this.persistenceKey,T));if(S){let N=ho.fromWebStorageEntry(T,S);N&&(R=N.state)}}return S&&this.localClientState.addQueryTarget(T),this.persistClientState(),R}removeLocalQueryTarget(T){this.localClientState.removeQueryTarget(T),this.persistClientState()}isLocalQueryTarget(T){return this.localClientState.activeTargetIds.has(T)}clearQueryState(T){this.removeItem(d5(this.persistenceKey,T))}updateQueryState(T,S,R){this.persistQueryTargetState(T,S,R)}handleUserChange(T,S,R){S.forEach(T=>{this.removeMutationState(T)}),this.currentUser=T,R.forEach(T=>{this.addPendingMutation(T)})}setOnlineState(T){this.persistOnlineState(T)}notifyBundleLoaded(T){this.persistBundleLoadedState(T)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(T){let S=this.storage.getItem(T);return eu(hs,"READ",T,S),S}setItem(T,S){eu(hs,"SET",T,S),this.storage.setItem(T,S)}removeItem(T){eu(hs,"REMOVE",T),this.storage.removeItem(T)}handleWebStorageEvent(T){let S=T;if(S.storageArea===this.storage){if(eu(hs,"EVENT",S.key,S.newValue),S.key===this.localClientStorageKey){ec("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(S);return}if(null!==S.key){if(this.clientStateKeyRe.test(S.key)){if(null!=S.newValue){let T=this.fromWebStorageClientState(S.key,S.newValue);if(T)return this.handleClientStateEvent(T.clientId,T)}else{let T=this.fromWebStorageClientStateKey(S.key);return this.handleClientStateEvent(T,null)}}else if(this.mutationBatchKeyRe.test(S.key)){if(null!==S.newValue){let T=this.fromWebStorageMutationMetadata(S.key,S.newValue);if(T)return this.handleMutationBatchEvent(T)}}else if(this.queryTargetKeyRe.test(S.key)){if(null!==S.newValue){let T=this.fromWebStorageQueryTargetMetadata(S.key,S.newValue);if(T)return this.handleQueryTargetEvent(T)}}else if(S.key===this.onlineStateKey){if(null!==S.newValue){let T=this.fromWebStorageOnlineState(S.newValue);if(T)return this.handleOnlineStateEvent(T)}}else if(S.key===this.sequenceNumberKey){let T=hh(S.newValue);T!==tL.INVALID&&this.sequenceNumberHandler(T)}else if(S.key===this.bundleLoadedKey){let T=this.fromWebStoreBundleLoadedState(S.newValue);await Promise.all(T.map(T=>this.syncEngine.synchronizeWithChangedDocuments(T)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(T,S,R){let N=new ha(this.currentUser,T,S,R),O=d6(this.persistenceKey,this.currentUser,T);this.setItem(O,N.toWebStorageJSON())}removeMutationState(T){let S=d6(this.persistenceKey,this.currentUser,T);this.removeItem(S)}persistOnlineState(T){let S={clientId:this.localClientId,onlineState:T};this.storage.setItem(this.onlineStateKey,JSON.stringify(S))}persistQueryTargetState(T,S,R){let N=d5(this.persistenceKey,T),O=new ho(T,S,R);this.setItem(N,O.toWebStorageJSON())}persistBundleLoadedState(T){let S=JSON.stringify(Array.from(T));this.setItem(this.bundleLoadedKey,S)}fromWebStorageClientStateKey(T){let S=this.clientStateKeyRe.exec(T);return S?S[1]:null}fromWebStorageClientState(T,S){let R=this.fromWebStorageClientStateKey(T);return hl.fromWebStorageEntry(R,S)}fromWebStorageMutationMetadata(T,S){let R=this.mutationBatchKeyRe.exec(T),N=Number(R[1]),O=void 0!==R[2]?R[2]:null;return ha.fromWebStorageEntry(new er(O),N,S)}fromWebStorageQueryTargetMetadata(T,S){let R=Number(this.queryTargetKeyRe.exec(T)[1]);return ho.fromWebStorageEntry(R,S)}fromWebStorageOnlineState(T){return hu.fromWebStorageEntry(T)}fromWebStoreBundleLoadedState(T){return JSON.parse(T)}async handleMutationBatchEvent(T){if(T.user.uid!==this.currentUser.uid){eu(hs,`Ignoring mutation for non-active user ${T.user.uid}`);return}return this.syncEngine.applyBatchState(T.batchId,T.state,T.error)}handleQueryTargetEvent(T){return this.syncEngine.applyTargetState(T.targetId,T.state,T.error)}handleClientStateEvent(T,S){let R=S?this.activeClients.insert(T,S):this.activeClients.remove(T),N=this.extractActiveQueryTargets(this.activeClients),O=this.extractActiveQueryTargets(R),P=[],M=[];return O.forEach(T=>{N.has(T)||P.push(T)}),N.forEach(T=>{O.has(T)||M.push(T)}),this.syncEngine.applyActiveTargetsChange(P,M).then(()=>{this.activeClients=R})}handleOnlineStateEvent(T){this.activeClients.get(T.clientId)&&this.onlineStateHandler(T.onlineState)}extractActiveQueryTargets(T){let S=sJ();return T.forEach((T,R)=>{S=S.unionWith(R.activeTargetIds)}),S}}function hh(T){let S=tL.INVALID;if(null!=T)try{let R=JSON.parse(T);em("number"==typeof R,30636,{seqString:T}),S=R}catch(T){ec(hs,"Failed to read sequence number from WebStorage",T)}return S}class hp{constructor(){this.localState=new hc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(T){}updateMutationState(T,S,R){}addLocalQueryTarget(T,S=!0){return S&&this.localState.addQueryTarget(T),this.queryState[T]||"not-current"}updateQueryState(T,S,R){this.queryState[T]=S}removeLocalQueryTarget(T){this.localState.removeQueryTarget(T)}isLocalQueryTarget(T){return this.localState.activeTargetIds.has(T)}clearQueryState(T){delete this.queryState[T]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(T){return this.localState.activeTargetIds.has(T)}start(){return this.localState=new hc,Promise.resolve()}handleUserChange(T,S,R){}setOnlineState(T){}shutdown(){}writeSequenceNumber(T){}notifyBundleLoaded(T){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{addCallback(T){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(T){this.sendFn=T.sendFn,this.closeFn=T.closeFn}onConnected(T){this.wrappedOnConnected=T}onOpen(T){this.wrappedOnOpen=T}onClose(T){this.wrappedOnClose=T}onMessage(T){this.wrappedOnMessage=T}close(){this.closeFn()}send(T){this.sendFn(T)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(T){this.wrappedOnClose(T)}callOnMessage(T){this.wrappedOnMessage(T)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hg=null;function hy(){return 268435456+Math.round(2147483648*Math.random())}function hv(){return null===hg?hg=hy():hg++,"0x"+hg.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(T){return new Promise((S,R)=>{T((T,N)=>{T?R(T):S(N)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hS="1.9.15",hE="GrpcConnection",h_=`gl-node/${process.versions.node} fire/${en} grpc/${hS}`;function hw(T,S,R,N){em(null===S||"OAuth"===S.type,36936);let O=new X.SF;return S&&S.headers.forEach((T,S)=>O.set(S,T)),R&&R.headers.forEach((T,S)=>O.set(S,T)),N&&O.set("X-Firebase-GMPID",N),O.set("X-Goog-Api-Client",h_),O.set("Google-Cloud-Resource-Prefix",T),O.set("x-goog-request-params",T),O}class hC{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(T,S){this.databaseInfo=S,this.cachedStub=null,this.firestore=T.google.firestore.v1,this.databasePath=`projects/${S.databaseId.projectId}/databases/${S.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){eu(hE,"Creating Firestore stub.");let T=this.databaseInfo.ssl?X.K9.createSsl():X.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,T)}return this.cachedStub}invokeRPC(T,S,R,N,O){let P=hv(),M=this.ensureActiveStub(),L=hw(this.databasePath,N,O,this.databaseInfo.appId),U=Object.assign({database:this.databasePath},R);return hT(S=>(eu(hE,`RPC '${T}' ${P} invoked with request:`,R),M[T](U,L,(R,N)=>{R?(eu(hE,`RPC '${T}' ${P} failed with error:`,R),S(new ev(aL(R.code),R.message))):(eu(hE,`RPC '${T}' ${P} completed with response:`,N),S(void 0,N))})))}invokeStreamingRPC(T,S,R,N,O,P){let M=hv(),L=[],U=new eb;eu(hE,`RPC '${T}' ${M} invoked (streaming) with request:`,R);let V=this.ensureActiveStub(),$=hw(this.databasePath,N,O,this.databaseInfo.appId),K=Object.assign(Object.assign({},R),{database:this.databasePath}),W=V[T](K,$),Q=!1;return W.on("data",S=>{eu(hE,`RPC ${T} ${M} received result:`,S),L.push(S),void 0!==P&&L.length===P&&(Q=!0,U.resolve(L))}),W.on("end",()=>{eu(hE,`RPC '${T}' ${M} completed.`),Q||(Q=!0,U.resolve(L))}),W.on("error",S=>{eu(hE,`RPC '${T}' ${M} failed with error:`,S);let R=aL(S.code);U.reject(new ev(R,S.message))}),U.promise}openStream(T,S,R){let N=hv(),O=this.ensureActiveStub(),P=hw(this.databasePath,S,R,this.databaseInfo.appId),M=O[T](P),L=!1,U=T=>{L||(L=!0,V.callOnClose(T),M.end())},V=new hm({sendFn:S=>{if(L)eu(hE,`RPC '${T}' stream ${N} not sending because gRPC stream is closed:`,S);else{eu(hE,`RPC '${T}' stream ${N} sending:`,S);try{M.write(S)}catch(T){throw ec("Failure sending:",S),ec("Error:",T),T}}},closeFn:()=>{eu(hE,`RPC '${T}' stream ${N} closed locally via close().`),U()}}),$=!1;return M.on("data",S=>{L||(eu(hE,`RPC '${T}' stream ${N} received:`,S),$||(V.callOnConnected(),$=!0),V.callOnMessage(S))}),M.on("end",()=>{eu(hE,`RPC '${T}' stream ${N} ended.`),U()}),M.on("error",S=>{L||(ed(hE,`RPC '${T}' stream ${N} error. Code:`,S.code,"Message:",S.message),U(new ev(aL(S.code),S.message)))}),eu(hE,`Opening RPC '${T}' stream ${N} to ${this.databaseInfo.host}`),setTimeout(()=>{V.callOnOpen()},0),V}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let hI={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var hR={nested:hI},hk=Object.freeze({__proto__:null,nested:hI,default:hR});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hN={longs:String,enums:String,defaults:!0,oneofs:!1};function hA(){let T=Z.im(hk,hN);return X.Rz(T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hD(T){return new hC(hA(),T)}function hO(){return new hf}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hx(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function hP(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hM(T){return new a4(T,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hL="ExponentialBackoff",hF=1e3,hB=1.5,hU=6e4;class hV{constructor(T,S,R=hF,N=hB,O=hU){this.queue=T,this.timerId=S,this.initialDelayMs=R,this.backoffFactor=N,this.maxDelayMs=O,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(T){this.cancel();let S=Math.floor(this.currentBaseMs+this.jitterDelayMs()),R=Math.max(0,Date.now()-this.lastAttemptTime),N=Math.max(0,S-R);N>0&&eu(hL,`Backing off for ${N} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${S} ms, last attempt: ${R} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,N,()=>(this.lastAttemptTime=Date.now(),T())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hj="PersistentStream",hz=6e4,hq=1e4;class hG{constructor(T,S,R,N,O,P,M,L){this.queue=T,this.idleTimerId=R,this.healthTimerId=N,this.connection=O,this.authCredentialsProvider=P,this.appCheckCredentialsProvider=M,this.listener=L,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new hV(T,S)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,hz,()=>this.handleIdleCloseTimer()))}sendRequest(T){this.cancelIdleCheck(),this.stream.send(T)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(T,S){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==T?this.backoff.reset():S&&S.code===ey.RESOURCE_EXHAUSTED?(ec(S.toString()),ec("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):S&&S.code===ey.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=T,await this.listener.onClose(S)}tearDown(){}auth(){this.state=1;let T=this.getCloseGuardedDispatcher(this.closeCount),S=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([T,R])=>{this.closeCount===S&&this.startStream(T,R)},S=>{T(()=>{let T=new ev(ey.UNKNOWN,"Fetching auth token failed: "+S.message);return this.handleStreamClose(T)})})}startStream(T,S){let R=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(T,S),this.stream.onConnected(()=>{R(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{R(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,hq,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(T=>{R(()=>this.handleStreamClose(T))}),this.stream.onMessage(T=>{R(()=>1==++this.responseCount?this.onFirst(T):this.onNext(T))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(T){return eu(hj,`close with error: ${T}`),this.stream=null,this.close(4,T)}getCloseGuardedDispatcher(T){return S=>{this.queue.enqueueAndForget(()=>this.closeCount===T?S():(eu(hj,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h$ extends hG{constructor(T,S,R,N,O,P){super(T,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",S,R,N,P),this.serializer=O}startRpc(T,S){return this.connection.openStream("Listen",T,S)}onFirst(T){return this.onNext(T)}onNext(T){this.backoff.reset();let S=oE(this.serializer,T),R=ow(T);return this.listener.onWatchChange(S,R)}watch(T){let S={};S.database=oh(this.serializer),S.addTarget=oj(this.serializer,T);let R=oU(this.serializer,T);R&&(S.labels=R),this.sendRequest(S)}unwatch(T){let S={};S.database=oh(this.serializer),S.removeTarget=T,this.sendRequest(S)}}class hK extends hG{constructor(T,S,R,N,O,P){super(T,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",S,R,N,P),this.serializer=O}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(T,S){return this.connection.openStream("Write",T,S)}onFirst(T){return em(!!T.streamToken,31322),this.lastStreamToken=T.streamToken,em(!T.writeResults||0===T.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(T){em(!!T.streamToken,12678),this.lastStreamToken=T.streamToken,this.backoff.reset();let S=oA(T.writeResults,T.commitTime),R=on(T.commitTime);return this.listener.onMutationResult(R,S)}writeHandshake(){let T={};T.database=oh(this.serializer),this.sendRequest(T)}writeMutations(T){let S={streamToken:this.lastStreamToken,writes:T.map(T=>oC(this.serializer,T))};this.sendRequest(S)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hH{}class hW extends hH{constructor(T,S,R,N){super(),this.authCredentials=T,this.appCheckCredentials=S,this.connection=R,this.serializer=N,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new ev(ey.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(T,S,R,N){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([O,P])=>this.connection.invokeRPC(T,oa(S,R),N,O,P)).catch(T=>{if("FirebaseError"===T.name)throw T.code===ey.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),T;throw new ev(ey.UNKNOWN,T.toString())})}invokeStreamingRPC(T,S,R,N,O){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([P,M])=>this.connection.invokeStreamingRPC(T,oa(S,R),N,P,M,O)).catch(T=>{if("FirebaseError"===T.name)throw T.code===ey.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),T;throw new ev(ey.UNKNOWN,T.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function hQ(T,S,R,N){return new hW(T,S,R,N)}async function hY(T,S){let R=eg(T),N={writes:S.map(T=>oC(R.serializer,T))};await R.invokeRPC("Commit",R.serializer.databaseId,ej.emptyPath(),N)}async function hJ(T,S){let R=eg(T),N={documents:S.map(T=>ol(R.serializer,T))},O=await R.invokeStreamingRPC("BatchGetDocuments",R.serializer.databaseId,ej.emptyPath(),N,S.length),P=new Map;O.forEach(T=>{let S=oS(R.serializer,T);P.set(S.key.toString(),S)});let M=[];return S.forEach(T=>{let S=P.get(T.toString());em(!!S,55234,{key:T}),M.push(S)}),M}async function hX(T,S,R){var N;let O=eg(T),{request:P,aliasMap:M,parent:L}=oL(O.serializer,sv(S),R);O.connection.shouldResourcePathBeIncludedInRequest||delete P.parent;let U=(await O.invokeStreamingRPC("RunAggregationQuery",O.serializer.databaseId,L,P,1)).filter(T=>!!T.result);em(1===U.length,64727);let V=null===(N=U[0].result)||void 0===N?void 0:N.aggregateFields;return Object.keys(V).reduce((T,S)=>(T[M[S]]=V[S],T),{})}function hZ(T,S,R){let N=eg(T);return N.verifyInitialized(),new hK(S,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}function h0(T,S,R){let N=eg(T);return N.verifyInitialized(),new h$(S,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h1="OnlineStateTracker",h2=1,h3=1e4;class h4{constructor(T,S){this.asyncQueue=T,this.onlineStateHandler=S,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",h3,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${h3/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(T){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=h2&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${h2} times. Most recent error: ${T.toString()}`),this.setAndBroadcast("Offline")))}set(T){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===T&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(T)}setAndBroadcast(T){T!==this.state&&(this.state=T,this.onlineStateHandler(T))}logClientOfflineWarningIfNecessary(T){let S=`Could not reach Cloud Firestore backend. ${T}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(ec(S),this.shouldWarnClientIsOffline=!1):eu(h1,S)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h6="RemoteStore",h9=10;class h5{constructor(T,S,R,N,O){this.localStore=T,this.datastore=S,this.asyncQueue=R,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=O,this.connectivityMonitor.addCallback(T=>{R.enqueueAndForget(async()=>{pl(this)&&(eu(h6,"Restarting streams for network reachability change."),await pk(this))})}),this.onlineStateTracker=new h4(R,N)}}function h8(T,S,R,N,O){return new h5(T,S,R,N,O)}async function h7(T){if(pl(T))for(let S of T.onNetworkStatusChange)await S(!0)}async function pe(T){for(let S of T.onNetworkStatusChange)await S(!1)}async function pt(T){let S=eg(T);eu(h6,"RemoteStore shutting down."),S.offlineCauses.add(5),await pe(S),S.connectivityMonitor.shutdown(),S.onlineStateTracker.set("Unknown")}function pr(T,S){let R=eg(T);!R.listenTargets.has(S.targetId)&&(R.listenTargets.set(S.targetId,S),po(R)?pa(R):pD(R).isOpen()&&pi(R,S))}function pn(T,S){let R=eg(T),N=pD(R);R.listenTargets.delete(S),N.isOpen()&&ps(R,S),0===R.listenTargets.size&&(N.isOpen()?N.markIdle():pl(R)&&R.onlineStateTracker.set("Unknown"))}function pi(T,S){if(T.watchChangeAggregator.recordPendingTargetRequest(S.targetId),S.resumeToken.approximateByteSize()>0||S.snapshotVersion.compareTo(e6.min())>0){let R=T.remoteSyncer.getRemoteKeysForTarget(S.targetId).size;S=S.withExpectedCount(R)}pD(T).watch(S)}function ps(T,S){T.watchChangeAggregator.recordPendingTargetRequest(S),pD(T).unwatch(S)}function pa(T){T.watchChangeAggregator=new aJ({getRemoteKeysForTarget:S=>T.remoteSyncer.getRemoteKeysForTarget(S),getTargetDataForTarget:S=>T.listenTargets.get(S)||null,getDatabaseId:()=>T.datastore.serializer.databaseId}),pD(T).start(),T.onlineStateTracker.handleWatchStreamStart()}function po(T){return pl(T)&&!pD(T).isStarted()&&T.listenTargets.size>0}function pl(T){return 0===eg(T).offlineCauses.size}function pu(T){T.watchChangeAggregator=void 0}async function pc(T){T.onlineStateTracker.set("Online")}async function pd(T){T.listenTargets.forEach((S,R)=>{pi(T,S)})}async function ph(T,S){pu(T),po(T)?(T.onlineStateTracker.handleWatchStreamFailure(S),pa(T)):T.onlineStateTracker.set("Unknown")}async function pp(T,S,R){if(T.onlineStateTracker.set("Online"),S instanceof aW&&2===S.state&&S.cause){try{await py(T,S)}catch(R){eu(h6,"Failed to remove targets %s: %s ",S.targetIds.join(","),R),await pf(T,R)}return}if(S instanceof aK?T.watchChangeAggregator.handleDocumentChange(S):S instanceof aH?T.watchChangeAggregator.handleExistenceFilter(S):T.watchChangeAggregator.handleTargetChange(S),!R.isEqual(e6.min()))try{let S=await dC(T.localStore);R.compareTo(S)>=0&&await pg(T,R)}catch(S){eu(h6,"Failed to raise snapshot:",S),await pf(T,S)}}async function pf(T,S,R){if(tw(S))T.offlineCauses.add(1),await pe(T),T.onlineStateTracker.set("Offline"),R||(R=()=>dC(T.localStore)),T.asyncQueue.enqueueRetryable(async()=>{eu(h6,"Retrying IndexedDB access"),await R(),T.offlineCauses.delete(1),await h7(T)});else throw S}function pm(T,S){return S().catch(R=>pf(T,R,S))}function pg(T,S){let R=T.watchChangeAggregator.createRemoteEvent(S);return R.targetChanges.forEach((R,N)=>{if(R.resumeToken.approximateByteSize()>0){let O=T.listenTargets.get(N);O&&T.listenTargets.set(N,O.withResumeToken(R.resumeToken,S))}}),R.targetMismatches.forEach((S,R)=>{let N=T.listenTargets.get(S);N&&(T.listenTargets.set(S,N.withResumeToken(ni.EMPTY_BYTE_STRING,N.snapshotVersion)),ps(T,S),pi(T,new ll(N.target,S,R,N.sequenceNumber)))}),T.remoteSyncer.applyRemoteEvent(R)}async function py(T,S){let R=S.cause;for(let N of S.targetIds)T.listenTargets.has(N)&&(await T.remoteSyncer.rejectListen(N,R),T.listenTargets.delete(N),T.watchChangeAggregator.removeTarget(N))}async function pv(T){let S=eg(T),R=pO(S),N=S.writePipeline.length>0?S.writePipeline[S.writePipeline.length-1].batchId:nC;for(;pb(S);)try{let T=await dA(S.localStore,N);if(null===T){0===S.writePipeline.length&&R.markIdle();break}N=T.batchId,pT(S,T)}catch(T){await pf(S,T)}pS(S)&&pE(S)}function pb(T){return pl(T)&&T.writePipeline.length<h9}function pT(T,S){T.writePipeline.push(S);let R=pO(T);R.isOpen()&&R.handshakeComplete&&R.writeMutations(S.mutations)}function pS(T){return pl(T)&&!pO(T).isStarted()&&T.writePipeline.length>0}function pE(T){pO(T).start()}async function p_(T){pO(T).writeHandshake()}async function pw(T){let S=pO(T);for(let R of T.writePipeline)S.writeMutations(R.mutations)}async function pC(T,S,R){let N=T.writePipeline.shift(),O=aD.from(N,S,R);await pm(T,()=>T.remoteSyncer.applySuccessfulWrite(O)),await pv(T)}async function pI(T,S){S&&pO(T).handshakeComplete&&await pR(T,S),pS(T)&&pE(T)}async function pR(T,S){if(aM(S.code)){let R=T.writePipeline.shift();pO(T).inhibitBackoff(),await pm(T,()=>T.remoteSyncer.rejectFailedWrite(R.batchId,S)),await pv(T)}}async function pk(T){let S=eg(T);S.offlineCauses.add(4),await pe(S),S.onlineStateTracker.set("Unknown"),S.offlineCauses.delete(4),await h7(S)}async function pN(T,S){let R=eg(T);R.asyncQueue.verifyOperationInProgress(),eu(h6,"RemoteStore received new credentials");let N=pl(R);R.offlineCauses.add(3),await pe(R),N&&R.onlineStateTracker.set("Unknown"),await R.remoteSyncer.handleCredentialChange(S),R.offlineCauses.delete(3),await h7(R)}async function pA(T,S){let R=eg(T);S?(R.offlineCauses.delete(2),await h7(R)):S||(R.offlineCauses.add(2),await pe(R),R.onlineStateTracker.set("Unknown"))}function pD(T){return T.watchStream||(T.watchStream=h0(T.datastore,T.asyncQueue,{onConnected:pc.bind(null,T),onOpen:pd.bind(null,T),onClose:ph.bind(null,T),onWatchChange:pp.bind(null,T)}),T.onNetworkStatusChange.push(async S=>{S?(T.watchStream.inhibitBackoff(),po(T)?pa(T):T.onlineStateTracker.set("Unknown")):(await T.watchStream.stop(),pu(T))})),T.watchStream}function pO(T){return T.writeStream||(T.writeStream=hZ(T.datastore,T.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:p_.bind(null,T),onClose:pI.bind(null,T),onHandshakeComplete:pw.bind(null,T),onMutationResult:pC.bind(null,T)}),T.onNetworkStatusChange.push(async S=>{S?(T.writeStream.inhibitBackoff(),await pv(T)):(await T.writeStream.stop(),T.writePipeline.length>0&&(eu(h6,`Stopping write stream with ${T.writePipeline.length} pending writes`),T.writePipeline=[]))})),T.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let px="AsyncQueue";class pP{constructor(T,S,R,N,O){this.asyncQueue=T,this.timerId=S,this.targetTimeMs=R,this.op=N,this.removalCallback=O,this.deferred=new eb,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(T=>{})}get promise(){return this.deferred.promise}static createAndSchedule(T,S,R,N,O){let P=new pP(T,S,Date.now()+R,N,O);return P.start(R),P}start(T){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),T)}skipDelay(){return this.handleDelayElapsed()}cancel(T){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ev(ey.CANCELLED,"Operation cancelled"+(T?": "+T:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(T=>this.deferred.resolve(T))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pM(T,S){if(ec(px,`${S}: ${T}`),tw(T))return new ev(ey.UNAVAILABLE,`${S}: ${T}`);throw T}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pL{static emptySet(T){return new pL(T.comparator)}constructor(T){T?this.comparator=(S,R)=>T(S,R)||eG.comparator(S.key,R.key):this.comparator=(T,S)=>eG.comparator(T.key,S.key),this.keyedMap=sV(),this.sortedSet=new r2(this.comparator)}has(T){return null!=this.keyedMap.get(T)}get(T){return this.keyedMap.get(T)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(T){let S=this.keyedMap.get(T);return S?this.sortedSet.indexOf(S):-1}get size(){return this.sortedSet.size}forEach(T){this.sortedSet.inorderTraversal((S,R)=>(T(S),!1))}add(T){let S=this.delete(T.key);return S.copy(S.keyedMap.insert(T.key,T),S.sortedSet.insert(T,null))}delete(T){let S=this.get(T);return S?this.copy(this.keyedMap.remove(T),this.sortedSet.remove(S)):this}isEqual(T){if(!(T instanceof pL)||this.size!==T.size)return!1;let S=this.sortedSet.getIterator(),R=T.sortedSet.getIterator();for(;S.hasNext();){let T=S.getNext().key,N=R.getNext().key;if(!T.isEqual(N))return!1}return!0}toString(){let T=[];return(this.forEach(S=>{T.push(S.toString())}),0===T.length)?"DocumentSet ()":"DocumentSet (\n  "+T.join("  \n")+"\n)"}copy(T,S){let R=new pL;return R.comparator=this.comparator,R.keyedMap=T,R.sortedSet=S,R}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(){this.changeMap=new r2(eG.comparator)}track(T){let S=T.doc.key,R=this.changeMap.get(S);if(!R){this.changeMap=this.changeMap.insert(S,T);return}0!==T.type&&3===R.type?this.changeMap=this.changeMap.insert(S,T):3===T.type&&1!==R.type?this.changeMap=this.changeMap.insert(S,{type:R.type,doc:T.doc}):2===T.type&&2===R.type?this.changeMap=this.changeMap.insert(S,{type:2,doc:T.doc}):2===T.type&&0===R.type?this.changeMap=this.changeMap.insert(S,{type:0,doc:T.doc}):1===T.type&&0===R.type?this.changeMap=this.changeMap.remove(S):1===T.type&&2===R.type?this.changeMap=this.changeMap.insert(S,{type:1,doc:R.doc}):0===T.type&&1===R.type?this.changeMap=this.changeMap.insert(S,{type:2,doc:T.doc}):ep(63341,{change:T,oldChange:R})}getChanges(){let T=[];return this.changeMap.inorderTraversal((S,R)=>{T.push(R)}),T}}class pB{constructor(T,S,R,N,O,P,M,L,U){this.query=T,this.docs=S,this.oldDocs=R,this.docChanges=N,this.mutatedKeys=O,this.fromCache=P,this.syncStateChanged=M,this.excludesMetadataChanges=L,this.hasCachedResults=U}static fromInitialDocuments(T,S,R,N,O){let P=[];return S.forEach(T=>{P.push({type:0,doc:T})}),new pB(T,S,pL.emptySet(S),P,R,N,!0,!1,O)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(T){if(this.fromCache!==T.fromCache||this.hasCachedResults!==T.hasCachedResults||this.syncStateChanged!==T.syncStateChanged||!this.mutatedKeys.isEqual(T.mutatedKeys)||!sC(this.query,T.query)||!this.docs.isEqual(T.docs)||!this.oldDocs.isEqual(T.oldDocs))return!1;let S=this.docChanges,R=T.docChanges;if(S.length!==R.length)return!1;for(let T=0;T<S.length;T++)if(S[T].type!==R[T].type||!S[T].doc.isEqual(R[T].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pU{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(T=>T.listensToRemoteStore())}}function pV(){return new pj}class pj{constructor(){this.queries=pz(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){pW(this,new ev(ey.ABORTED,"Firestore shutting down"))}}function pz(){return new sL(T=>sI(T),sC)}async function pq(T,S){let R=eg(T),N=3,O=S.query,P=R.queries.get(O);P?!P.hasRemoteListeners()&&S.listensToRemoteStore()&&(N=2):(P=new pU,N=S.listensToRemoteStore()?0:1);try{switch(N){case 0:P.viewSnap=await R.onListen(O,!0);break;case 1:P.viewSnap=await R.onListen(O,!1);break;case 2:await R.onFirstRemoteStoreListen(O)}}catch(R){let T=pM(R,`Initialization of query '${sR(S.query)}' failed`);S.onError(T);return}R.queries.set(O,P),P.listeners.push(S),S.applyOnlineStateChange(R.onlineState),P.viewSnap&&S.onViewSnapshot(P.viewSnap)&&pQ(R)}async function pG(T,S){let R=eg(T),N=S.query,O=3,P=R.queries.get(N);if(P){let T=P.listeners.indexOf(S);T>=0&&(P.listeners.splice(T,1),0===P.listeners.length?O=S.listensToRemoteStore()?0:1:!P.hasRemoteListeners()&&S.listensToRemoteStore()&&(O=2))}switch(O){case 0:return R.queries.delete(N),R.onUnlisten(N,!0);case 1:return R.queries.delete(N),R.onUnlisten(N,!1);case 2:return R.onLastRemoteStoreUnlisten(N);default:return}}function p$(T,S){let R=eg(T),N=!1;for(let T of S){let S=T.query,O=R.queries.get(S);if(O){for(let S of O.listeners)S.onViewSnapshot(T)&&(N=!0);O.viewSnap=T}}N&&pQ(R)}function pK(T,S,R){let N=eg(T),O=N.queries.get(S);if(O)for(let T of O.listeners)T.onError(R);N.queries.delete(S)}function pH(T,S){let R=eg(T);R.onlineState=S;let N=!1;R.queries.forEach((T,R)=>{for(let T of R.listeners)T.applyOnlineStateChange(S)&&(N=!0)}),N&&pQ(R)}function pW(T,S){let R=eg(T),N=R.queries;R.queries=pz(),N.forEach((T,R)=>{for(let T of R.listeners)T.onError(S)})}function pQ(T){T.snapshotsInSyncListeners.forEach(T=>{T.next()})}!function(T){T.Default="default",T.Cache="cache"}(M||(M={}));class pY{constructor(T,S,R){this.query=T,this.queryObserver=S,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=R||{}}onViewSnapshot(T){if(!this.options.includeMetadataChanges){let S=[];for(let R of T.docChanges)3!==R.type&&S.push(R);T=new pB(T.query,T.docs,T.oldDocs,S,T.mutatedKeys,T.fromCache,T.syncStateChanged,!0,T.hasCachedResults)}let S=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(T)&&(this.queryObserver.next(T),S=!0):this.shouldRaiseInitialEvent(T,this.onlineState)&&(this.raiseInitialEvent(T),S=!0),this.snap=T,S}onError(T){this.queryObserver.error(T)}applyOnlineStateChange(T){this.onlineState=T;let S=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,T)&&(this.raiseInitialEvent(this.snap),S=!0),S}shouldRaiseInitialEvent(T,S){if(!T.fromCache||!this.listensToRemoteStore())return!0;let R="Offline"!==S;return(!this.options.waitForSyncWhenOnline||!R)&&(!T.docs.isEmpty()||T.hasCachedResults||"Offline"===S)}shouldRaiseEvent(T){if(T.docChanges.length>0)return!0;let S=this.snap&&this.snap.hasPendingWrites!==T.hasPendingWrites;return(!!T.syncStateChanged||!!S)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(T){T=pB.fromInitialDocuments(T.query,T.docs,T.mutatedKeys,T.fromCache,T.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(T)}listensToRemoteStore(){return this.options.source!==M.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pJ{constructor(T,S,R,N){this.targetId=T,this.fromCache=S,this.addedKeys=R,this.removedKeys=N}static fromSnapshot(T,S){let R=sQ(),N=sQ();for(let T of S.docChanges)switch(T.type){case 0:R=R.add(T.doc.key);break;case 1:N=N.add(T.doc.key)}return new pJ(T,S.fromCache,R,N)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pX{constructor(T){this.serializer=T}toDocumentKey(T){return ou(this.serializer,T)}toMutableDocument(T){return T.metadata.exists?ov(this.serializer,T.document,!1):i_.newNoDocument(this.toDocumentKey(T.metadata.name),this.toSnapshotVersion(T.metadata.readTime))}toSnapshotVersion(T){return on(T)}}class pZ{constructor(T,S){this.bundleMetadata=T,this.serializer=S,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=p0(T)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(T){this.progress.bytesLoaded+=T.byteLength;let S=this.progress.documentsLoaded;if(T.payload.namedQuery)this._queries.push(T.payload.namedQuery);else if(T.payload.documentMetadata){this._documents.push({metadata:T.payload.documentMetadata}),!T.payload.documentMetadata.exists&&++S;let R=ej.fromString(T.payload.documentMetadata.name);this.collectionGroups.add(R.get(R.length-2))}else T.payload.document&&(this._documents[this._documents.length-1].document=T.payload.document,++S);return S!==this.progress.documentsLoaded?(this.progress.documentsLoaded=S,Object.assign({},this.progress)):null}getQueryDocumentMapping(T){let S=new Map,R=new pX(this.serializer);for(let N of T)if(N.metadata.queries){let T=R.toDocumentKey(N.metadata.name);for(let R of N.metadata.queries){let N=(S.get(R)||sQ()).add(T);S.set(R,N)}}return S}async completeAndStoreAsync(T){let S=await dG(T,new pX(this.serializer),this._documents,this.bundleMetadata.id),R=this.getQueryDocumentMapping(this.documents);for(let S of this._queries)await dW(T,S,R.get(S.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:S}}}function p0(T){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:T.totalDocuments,totalBytes:T.totalBytes}}function p3(T){return{taskState:"Success",documentsLoaded:T.totalDocuments,bytesLoaded:T.totalBytes,totalDocuments:T.totalDocuments,totalBytes:T.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4{constructor(T){this.key=T}}class p6{constructor(T){this.key=T}}class p9{constructor(T,S){this.query=T,this._syncedDocuments=S,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=sQ(),this.mutatedKeys=sQ(),this.docComparator=sP(T),this.documentSet=new pL(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(T,S){let R=S?S.changeSet:new pF,N=S?S.documentSet:this.documentSet,O=S?S.mutatedKeys:this.mutatedKeys,P=N,M=!1,L="F"===this.query.limitType&&N.size===this.query.limit?N.last():null,U="L"===this.query.limitType&&N.size===this.query.limit?N.first():null;if(T.inorderTraversal((T,S)=>{let V=N.get(T),$=sk(this.query,S)?S:null,K=!!V&&this.mutatedKeys.has(V.key),W=!!$&&($.hasLocalMutations||this.mutatedKeys.has($.key)&&$.hasCommittedMutations),Q=!1;V&&$?V.data.isEqual($.data)?K!==W&&(R.track({type:3,doc:$}),Q=!0):!this.shouldWaitForSyncedDocument(V,$)&&(R.track({type:2,doc:$}),Q=!0,(L&&this.docComparator($,L)>0||U&&0>this.docComparator($,U))&&(M=!0)):!V&&$?(R.track({type:0,doc:$}),Q=!0):V&&!$&&(R.track({type:1,doc:V}),Q=!0,(L||U)&&(M=!0)),Q&&($?(P=P.add($),O=W?O.add(T):O.delete(T)):(P=P.delete(T),O=O.delete(T)))}),null!==this.query.limit)for(;P.size>this.query.limit;){let T="F"===this.query.limitType?P.last():P.first();P=P.delete(T.key),O=O.delete(T.key),R.track({type:1,doc:T})}return{documentSet:P,changeSet:R,needsRefill:M,mutatedKeys:O}}shouldWaitForSyncedDocument(T,S){return T.hasLocalMutations&&S.hasCommittedMutations&&!S.hasLocalMutations}applyChanges(T,S,R,N){let O=this.documentSet;this.documentSet=T.documentSet,this.mutatedKeys=T.mutatedKeys;let P=T.changeSet.getChanges();P.sort((T,S)=>p5(T.type,S.type)||this.docComparator(T.doc,S.doc)),this.applyTargetChange(R),N=null!=N&&N;let M=S&&!N?this.updateLimboDocuments():[],L=0===this.limboDocuments.size&&this.current&&!N?1:0,U=L!==this.syncState;return(this.syncState=L,0!==P.length||U)?{snapshot:new pB(this.query,T.documentSet,O,P,T.mutatedKeys,0===L,U,!1,!!R&&R.resumeToken.approximateByteSize()>0),limboChanges:M}:{limboChanges:M}}applyOnlineStateChange(T){return this.current&&"Offline"===T?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new pF,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(T){return!this._syncedDocuments.has(T)&&!!this.documentSet.has(T)&&!this.documentSet.get(T).hasLocalMutations}applyTargetChange(T){T&&(T.addedDocuments.forEach(T=>this._syncedDocuments=this._syncedDocuments.add(T)),T.modifiedDocuments.forEach(T=>{}),T.removedDocuments.forEach(T=>this._syncedDocuments=this._syncedDocuments.delete(T)),this.current=T.current)}updateLimboDocuments(){if(!this.current)return[];let T=this.limboDocuments;this.limboDocuments=sQ(),this.documentSet.forEach(T=>{this.shouldBeInLimbo(T.key)&&(this.limboDocuments=this.limboDocuments.add(T.key))});let S=[];return T.forEach(T=>{this.limboDocuments.has(T)||S.push(new p6(T))}),this.limboDocuments.forEach(R=>{T.has(R)||S.push(new p4(R))}),S}synchronizeWithPersistedState(T){this._syncedDocuments=T.remoteKeys,this.limboDocuments=sQ();let S=this.computeDocChanges(T.documents);return this.applyChanges(S,!0)}computeInitialSnapshot(){return pB.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function p5(T,S){let R=T=>{switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ep(20277,{change:T})}};return R(T)-R(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p8="SyncEngine";class p7{constructor(T,S,R){this.query=T,this.targetId=S,this.view=R}}class fe{constructor(T){this.key=T,this.receivedDocument=!1}}class ft{constructor(T,S,R,N,O,P){this.localStore=T,this.remoteStore=S,this.eventManager=R,this.sharedClientState=N,this.currentUser=O,this.maxConcurrentLimboResolutions=P,this.syncEngineListener={},this.queryViewsByQuery=new sL(T=>sI(T),sC),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new r2(eG.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new cI,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=uY.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function fr(T,S,R,N,O,P,M){let L=new ft(T,S,R,N,O,P);return M&&(L._isPrimaryClient=!0),L}async function fi(T,S,R=!0){let N;let O=fV(T),P=O.queryViewsByQuery.get(S);return P?(O.sharedClientState.addLocalQueryTarget(P.targetId),N=P.view.computeInitialSnapshot()):N=await fo(O,S,R,!0),N}async function fa(T,S){let R=fV(T);await fo(R,S,!0,!1)}async function fo(T,S,R,N){let O;let P=await dO(T.localStore,sy(S)),M=P.targetId,L=T.sharedClientState.addLocalQueryTarget(M,R);return N&&(O=await fl(T,S,M,"current"===L,P.resumeToken)),T.isPrimaryClient&&R&&pr(T.remoteStore,P),O}async function fl(T,S,R,N,O){T.applyDocChanges=(S,R,N)=>fR(T,S,R,N);let P=await dM(T.localStore,S,!0),M=new p9(S,P.remoteKeys),L=M.computeDocChanges(P.documents),U=a$.createSynthesizedTargetChangeForCurrentChange(R,N&&"Offline"!==T.onlineState,O),V=M.applyChanges(L,T.isPrimaryClient,U);f_(T,R,V.limboChanges);let $=new p7(S,R,M);return T.queryViewsByQuery.set(S,$),T.queriesByTarget.has(R)?T.queriesByTarget.get(R).push(S):T.queriesByTarget.set(R,[S]),V.snapshot}async function fu(T,S,R){let N=eg(T),O=N.queryViewsByQuery.get(S),P=N.queriesByTarget.get(O.targetId);if(P.length>1){N.queriesByTarget.set(O.targetId,P.filter(T=>!sC(T,S))),N.queryViewsByQuery.delete(S);return}N.isPrimaryClient?(N.sharedClientState.removeLocalQueryTarget(O.targetId),N.sharedClientState.isActiveQueryTarget(O.targetId)||await dP(N.localStore,O.targetId,!1).then(()=>{N.sharedClientState.clearQueryState(O.targetId),R&&pn(N.remoteStore,O.targetId),fS(N,O.targetId)}).catch(tm)):(fS(N,O.targetId),await dP(N.localStore,O.targetId,!0))}async function fc(T,S){let R=eg(T),N=R.queryViewsByQuery.get(S),O=R.queriesByTarget.get(N.targetId);R.isPrimaryClient&&1===O.length&&(R.sharedClientState.removeLocalQueryTarget(N.targetId),pn(R.remoteStore,N.targetId))}async function fd(T,S,R){let N=fj(T);try{let T=await dT(N.localStore,S);N.sharedClientState.addPendingMutation(T.batchId),fb(N,T.batchId,R),await fI(N,T.changes),await pv(N.remoteStore)}catch(S){let T=pM(S,"Failed to persist write");R.reject(T)}}async function fh(T,S){let R=eg(T);try{let T=await dI(R.localStore,S);S.targetChanges.forEach((T,S)=>{let N=R.activeLimboResolutionsByTarget.get(S);N&&(em(T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size<=1,22616),T.addedDocuments.size>0?N.receivedDocument=!0:T.modifiedDocuments.size>0?em(N.receivedDocument,14607):T.removedDocuments.size>0&&(em(N.receivedDocument,42227),N.receivedDocument=!1))}),await fI(R,T,S)}catch(T){await tm(T)}}function fp(T,S,R){let N=eg(T);if(N.isPrimaryClient&&0===R||!N.isPrimaryClient&&1===R){let T=[];N.queryViewsByQuery.forEach((R,N)=>{let O=N.view.applyOnlineStateChange(S);O.snapshot&&T.push(O.snapshot)}),pH(N.eventManager,S),T.length&&N.syncEngineListener.onWatchChange(T),N.onlineState=S,N.isPrimaryClient&&N.sharedClientState.setOnlineState(S)}}async function ff(T,S,R){let N=eg(T);N.sharedClientState.updateQueryState(S,"rejected",R);let O=N.activeLimboResolutionsByTarget.get(S),P=O&&O.key;if(P){let T=new r2(eG.comparator);T=T.insert(P,i_.newNoDocument(P,e6.min()));let R=sQ().add(P),O=new aG(e6.min(),new Map,new r2(ex),T,R);await fh(N,O),N.activeLimboTargetsByKey=N.activeLimboTargetsByKey.remove(P),N.activeLimboResolutionsByTarget.delete(S),fC(N)}else await dP(N.localStore,S,!1).then(()=>fS(N,S,R)).catch(tm)}async function fm(T,S){let R=eg(T),N=S.batch.batchId;try{let T=await dS(R.localStore,S);fT(R,N,null),fy(R,N),R.sharedClientState.updateMutationState(N,"acknowledged"),await fI(R,T)}catch(T){await tm(T)}}async function fg(T,S,R){let N=eg(T);try{let T=await d_(N.localStore,S);fT(N,S,R),fy(N,S),N.sharedClientState.updateMutationState(S,"rejected",R),await fI(N,T)}catch(T){await tm(T)}}function fy(T,S){(T.pendingWritesCallbacks.get(S)||[]).forEach(T=>{T.resolve()}),T.pendingWritesCallbacks.delete(S)}function fv(T,S){T.pendingWritesCallbacks.forEach(T=>{T.forEach(T=>{T.reject(new ev(ey.CANCELLED,S))})}),T.pendingWritesCallbacks.clear()}function fb(T,S,R){let N=T.mutationUserCallbacks[T.currentUser.toKey()];N||(N=new r2(ex)),N=N.insert(S,R),T.mutationUserCallbacks[T.currentUser.toKey()]=N}function fT(T,S,R){let N=eg(T),O=N.mutationUserCallbacks[N.currentUser.toKey()];if(O){let T=O.get(S);T&&(R?T.reject(R):T.resolve(),O=O.remove(S)),N.mutationUserCallbacks[N.currentUser.toKey()]=O}}function fS(T,S,R=null){for(let N of(T.sharedClientState.removeLocalQueryTarget(S),T.queriesByTarget.get(S)))T.queryViewsByQuery.delete(N),R&&T.syncEngineListener.onWatchError(N,R);T.queriesByTarget.delete(S),T.isPrimaryClient&&T.limboDocumentRefs.removeReferencesForId(S).forEach(S=>{T.limboDocumentRefs.containsKey(S)||fE(T,S)})}function fE(T,S){T.enqueuedLimboResolutions.delete(S.path.canonicalString());let R=T.activeLimboTargetsByKey.get(S);null!==R&&(pn(T.remoteStore,R),T.activeLimboTargetsByKey=T.activeLimboTargetsByKey.remove(S),T.activeLimboResolutionsByTarget.delete(R),fC(T))}function f_(T,S,R){for(let N of R)N instanceof p4?(T.limboDocumentRefs.addReference(N.key,S),fw(T,N)):N instanceof p6?(eu(p8,"Document no longer in limbo: "+N.key),T.limboDocumentRefs.removeReference(N.key,S),T.limboDocumentRefs.containsKey(N.key)||fE(T,N.key)):ep(19791,{limboChange:N})}function fw(T,S){let R=S.key,N=R.path.canonicalString();T.activeLimboTargetsByKey.get(R)||T.enqueuedLimboResolutions.has(N)||(eu(p8,"New document in limbo: "+R),T.enqueuedLimboResolutions.add(N),fC(T))}function fC(T){for(;T.enqueuedLimboResolutions.size>0&&T.activeLimboTargetsByKey.size<T.maxConcurrentLimboResolutions;){let S=T.enqueuedLimboResolutions.values().next().value;T.enqueuedLimboResolutions.delete(S);let R=new eG(ej.fromString(S)),N=T.limboTargetIdGenerator.next();T.activeLimboResolutionsByTarget.set(N,new fe(R)),T.activeLimboTargetsByKey=T.activeLimboTargetsByKey.insert(R,N),pr(T.remoteStore,new ll(sy(sc(R.path)),N,"TargetPurposeLimboResolution",tL.INVALID))}}async function fI(T,S,R){let N=eg(T),O=[],P=[],M=[];N.queryViewsByQuery.isEmpty()||(N.queryViewsByQuery.forEach((T,L)=>{M.push(N.applyDocChanges(L,S,R).then(T=>{var S;if((T||R)&&N.isPrimaryClient){let O=T?!T.fromCache:null===(S=null==R?void 0:R.targetChanges.get(L.targetId))||void 0===S?void 0:S.current;N.sharedClientState.updateQueryState(L.targetId,O?"current":"not-current")}if(T){O.push(T);let S=pJ.fromSnapshot(L.targetId,T);P.push(S)}}))}),await Promise.all(M),N.syncEngineListener.onWatchChange(O),await dN(N.localStore,P))}async function fR(T,S,R,N){let O=S.view.computeDocChanges(R);O.needsRefill&&(O=await dM(T.localStore,S.query,!1).then(({documents:T})=>S.view.computeDocChanges(T,O)));let P=N&&N.targetChanges.get(S.targetId),M=N&&null!=N.targetMismatches.get(S.targetId),L=S.view.applyChanges(O,T.isPrimaryClient,P,M);return f_(T,S.targetId,L.limboChanges),L.snapshot}async function fk(T,S){let R=eg(T);if(!R.currentUser.isEqual(S)){eu(p8,"User change. New user:",S.toKey());let T=await dy(R.localStore,S);R.currentUser=S,fv(R,"'waitForPendingWrites' promise is rejected due to a user change."),R.sharedClientState.handleUserChange(S,T.removedBatchIds,T.addedBatchIds),await fI(R,T.affectedDocuments)}}function fN(T,S){let R=eg(T),N=R.activeLimboResolutionsByTarget.get(S);if(N&&N.receivedDocument)return sQ().add(N.key);{let T=sQ(),N=R.queriesByTarget.get(S);if(!N)return T;for(let S of N){let N=R.queryViewsByQuery.get(S);T=T.unionWith(N.view.syncedDocuments)}return T}}async function fA(T,S){let R=eg(T),N=await dM(R.localStore,S.query,!0),O=S.view.synchronizeWithPersistedState(N);return R.isPrimaryClient&&f_(R,S.targetId,O.limboChanges),O}async function fD(T,S){let R=eg(T);return dj(R.localStore,S).then(T=>fI(R,T))}async function fO(T,S,R,N){let O=eg(T),P=await dF(O.localStore,S);if(null===P){eu(p8,"Cannot apply mutation batch with id: "+S);return}"pending"===R?await pv(O.remoteStore):"acknowledged"===R||"rejected"===R?(fT(O,S,N||null),fy(O,S),dB(O.localStore,S)):ep(6720,"Unknown batchState",{batchState:R}),await fI(O,P)}async function fx(T,S){let R=eg(T);if(fV(R),fj(R),!0===S&&!0!==R._isPrimaryClient){let T=R.sharedClientState.getAllActiveQueryTargets(),S=await fM(R,T.toArray());for(let T of(R._isPrimaryClient=!0,await pA(R.remoteStore,!0),S))pr(R.remoteStore,T)}else if(!1===S&&!1!==R._isPrimaryClient){let T=[],S=Promise.resolve();R.queriesByTarget.forEach((N,O)=>{R.sharedClientState.isLocalQueryTarget(O)?T.push(O):S=S.then(()=>(fS(R,O),dP(R.localStore,O,!0))),pn(R.remoteStore,O)}),await S,await fM(R,T),fP(R),R._isPrimaryClient=!1,await pA(R.remoteStore,!1)}}function fP(T){let S=eg(T);S.activeLimboResolutionsByTarget.forEach((T,R)=>{pn(S.remoteStore,R)}),S.limboDocumentRefs.removeAllReferences(),S.activeLimboResolutionsByTarget=new Map,S.activeLimboTargetsByKey=new r2(eG.comparator)}async function fM(T,S,R){let N=eg(T),O=[],P=[];for(let T of S){let S;let R=N.queriesByTarget.get(T);if(R&&0!==R.length)for(let T of(S=await dO(N.localStore,sy(R[0])),R)){let S=N.queryViewsByQuery.get(T),R=await fA(N,S);R.snapshot&&P.push(R.snapshot)}else{let R=await dV(N.localStore,T);S=await dO(N.localStore,R),await fl(N,fL(R),T,!1,S.resumeToken)}O.push(S)}return N.syncEngineListener.onWatchChange(P),O}function fL(T){return su(T.path,T.collectionGroup,T.orderBy,T.filters,T.limit,"F",T.startAt,T.endAt)}function fF(T){return dU(eg(T).localStore)}async function fB(T,S,R,N){let O=eg(T);if(O._isPrimaryClient){eu(p8,"Ignoring unexpected query state notification.");return}let P=O.queriesByTarget.get(S);if(P&&P.length>0)switch(R){case"current":case"not-current":{let T=await dj(O.localStore,sx(P[0])),N=aG.createSynthesizedRemoteEventForCurrentChange(S,"current"===R,ni.EMPTY_BYTE_STRING);await fI(O,T,N);break}case"rejected":await dP(O.localStore,S,!0),fS(O,S,N);break;default:ep(64155,R)}}async function fU(T,S,R){let N=fV(T);if(N._isPrimaryClient){for(let T of S){if(N.queriesByTarget.has(T)&&N.sharedClientState.isActiveQueryTarget(T)){eu(p8,"Adding an already active target "+T);continue}let S=await dV(N.localStore,T),R=await dO(N.localStore,S);await fl(N,fL(S),R.targetId,!1,R.resumeToken),pr(N.remoteStore,R)}for(let T of R)N.queriesByTarget.has(T)&&await dP(N.localStore,T,!1).then(()=>{pn(N.remoteStore,T),fS(N,T)}).catch(tm)}}function fV(T){let S=eg(T);return S.remoteStore.remoteSyncer.applyRemoteEvent=fh.bind(null,S),S.remoteStore.remoteSyncer.getRemoteKeysForTarget=fN.bind(null,S),S.remoteStore.remoteSyncer.rejectListen=ff.bind(null,S),S.syncEngineListener.onWatchChange=p$.bind(null,S.eventManager),S.syncEngineListener.onWatchError=pK.bind(null,S.eventManager),S}function fj(T){let S=eg(T);return S.remoteStore.remoteSyncer.applySuccessfulWrite=fm.bind(null,S),S.remoteStore.remoteSyncer.rejectFailedWrite=fg.bind(null,S),S}function fz(T,S,R){let N=eg(T);fq(N,S,R).then(T=>{N.sharedClientState.notifyBundleLoaded(T)})}async function fq(T,S,R){try{let N=await S.getMetadata();if(await d$(T.localStore,N))return await S.close(),R._completeWith(p3(N)),Promise.resolve(new Set);R._updateProgress(p0(N));let O=new pZ(N,S.serializer),P=await S.nextElement();for(;P;){let T=await O.addSizedElement(P);T&&R._updateProgress(T),P=await S.nextElement()}let M=await O.completeAndStoreAsync(T.localStore);return await fI(T,M.changedDocs,void 0),await dK(T.localStore,N),R._completeWith(M.progress),Promise.resolve(M.changedCollectionGroups)}catch(T){return ed(p8,`Loading bundle failed with ${T}`),R._failWith(T),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fG{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(T){this.serializer=hM(T.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(T),this.persistence=this.createPersistence(T),await this.persistence.start(),this.localStore=this.createLocalStore(T),this.gcScheduler=this.createGarbageCollectionScheduler(T,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(T,this.localStore)}createGarbageCollectionScheduler(T,S){return null}createIndexBackfillerScheduler(T,S){return null}createLocalStore(T){return dg(this.persistence,new dZ,T.initialUser,this.serializer)}createPersistence(T){return new cL(cB.factory,this.serializer)}createSharedClientState(T){return new hp}async terminate(){var T,S;null===(T=this.gcScheduler)||void 0===T||T.stop(),null===(S=this.indexBackfillerScheduler)||void 0===S||S.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fG.provider={build:()=>new fG};class f$ extends fG{constructor(T){super(),this.cacheSizeBytes=T}createGarbageCollectionScheduler(T,S){return em(this.persistence.referenceDelegate instanceof cU,46915),new ct(this.persistence.referenceDelegate.garbageCollector,T.asyncQueue,S)}createPersistence(T){let S=void 0!==this.cacheSizeBytes?u4.withCacheSize(this.cacheSizeBytes):u4.DEFAULT;return new cL(T=>cU.factory(T,S),this.serializer)}}class fK extends null{constructor(T,S,R){super(),this.onlineComponentProvider=T,this.cacheSizeBytes=S,this.forceOwnership=R,this.kind="persistent",this.synchronizeTabs=!1}async initialize(T){await super.initialize(T),await this.onlineComponentProvider.initialize(this,T),await fj(this.onlineComponentProvider.syncEngine),await pv(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(T){return dg(this.persistence,new dZ,T.initialUser,this.serializer)}createGarbageCollectionScheduler(T,S){return new ct(this.persistence.referenceDelegate.garbageCollector,T.asyncQueue,S)}createIndexBackfillerScheduler(T,S){let R=new tM(S,this.persistence);return new tP(T.asyncQueue,R)}createPersistence(T){let S=dc(T.databaseInfo.databaseId,T.databaseInfo.persistenceKey),R=void 0!==this.cacheSizeBytes?u4.withCacheSize(this.cacheSizeBytes):u4.DEFAULT;return new da(this.synchronizeTabs,S,T.clientId,R,T.asyncQueue,hx(),hP(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(T){return new hp}}class fH{async initialize(T,S){this.localStore||(this.localStore=T.localStore,this.sharedClientState=T.sharedClientState,this.datastore=this.createDatastore(S),this.remoteStore=this.createRemoteStore(S),this.eventManager=this.createEventManager(S),this.syncEngine=this.createSyncEngine(S,!T.synchronizeTabs),this.sharedClientState.onlineStateHandler=T=>fp(this.syncEngine,T,1),this.remoteStore.remoteSyncer.handleCredentialChange=fk.bind(null,this.syncEngine),await pA(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(T){return pV()}createDatastore(T){let S=hM(T.databaseInfo.databaseId),R=hD(T.databaseInfo);return hQ(T.authCredentials,T.appCheckCredentials,R,S)}createRemoteStore(T){return h8(this.localStore,this.datastore,T.asyncQueue,T=>fp(this.syncEngine,T,0),hO())}createSyncEngine(T,S){return fr(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,T.initialUser,T.maxConcurrentLimboResolutions,S)}async terminate(){var T,S;await pt(this.remoteStore),null===(T=this.datastore)||void 0===T||T.terminate(),null===(S=this.eventManager)||void 0===S||S.terminate()}}fH.provider={build:()=>new fH};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fW=10240;function fQ(T,S=fW){let R=0;return{async read(){if(R<T.byteLength){let N={value:T.slice(R,R+S),done:!1};return R+=S,N}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fY(T,S){if(!(T instanceof Uint8Array))throw new ev(ey.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${eY(T)}`);return fQ(T,S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fJ{constructor(T){this.observer=T,this.muted=!1}next(T){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,T)}error(T){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,T):ec("Uncaught Error in snapshot listener:",T.toString()))}mute(){this.muted=!0}scheduleEvent(T,S){setTimeout(()=>{this.muted||T(S)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fX{constructor(T,S){this.payload=T,this.byteLength=S}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fZ{constructor(T,S){this.reader=T,this.serializer=S,this.metadata=new eb,this.buffer=new Uint8Array,this.textDecoder=eD(),this.nextElementImpl().then(T=>{T&&T.isBundleMetadata()?this.metadata.resolve(T.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==T?void 0:T.payload)}`))},T=>this.metadata.reject(T))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let T=await this.readLength();if(null===T)return null;let S=this.textDecoder.decode(T),R=Number(S);return isNaN(R)&&this.raiseError(`length string (${S}) is not valid number`),new fX(JSON.parse(await this.readJsonString(R)),T.length+R)}indexOfOpenBracket(){return this.buffer.findIndex(T=>123===T)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let T=this.indexOfOpenBracket();T<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let S=this.buffer.slice(0,T);return this.buffer=this.buffer.slice(T),S}async readJsonString(T){for(;this.buffer.length<T;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let S=this.textDecoder.decode(this.buffer.slice(0,T));return this.buffer=this.buffer.slice(T),S}raiseError(T){throw this.reader.cancel(),Error(`Invalid bundle format: ${T}`)}async pullMoreDataToBuffer(){let T=await this.reader.read();if(!T.done){let S=new Uint8Array(this.buffer.length+T.value.length);S.set(this.buffer),S.set(T.value,this.buffer.length),this.buffer=S}return T.done}}function f0(T,S){return new fZ(T,S)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3{constructor(T,S){this.bundleData=T,this.serializer=S,this.cursor=0,this.elements=[];let R=this.nextElement();if(R&&R.isBundleMetadata())this.metadata=R;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(null==R?void 0:R.payload)}`);do null!==(R=this.nextElement())&&this.elements.push(R);while(null!==R)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let T=this.readLength();return new fX(JSON.parse(this.readJsonString(T)),T)}readJsonString(T){if(this.cursor+T>this.bundleData.length)throw new ev(ey.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=T)}readLength(){let T=this.cursor,S=this.cursor;for(;S<this.bundleData.length;){if("{"===this.bundleData[S]){if(S===T)throw Error("First character is a bracket and not a number");return this.cursor=S,Number(this.bundleData.slice(T,S))}S++}throw Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(T){this.datastore=T,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(T){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ev(ey.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let S=await hJ(this.datastore,T);return S.forEach(T=>this.recordVersion(T)),S}set(T,S){this.write(S.toMutation(T,this.precondition(T))),this.writtenDocs.add(T.toString())}update(T,S){try{this.write(S.toMutation(T,this.preconditionForUpdate(T)))}catch(T){this.lastTransactionError=T}this.writtenDocs.add(T.toString())}delete(T){this.write(new aI(T,this.precondition(T))),this.writtenDocs.add(T.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let T=this.readVersions;this.mutations.forEach(S=>{T.delete(S.key.toString())}),T.forEach((T,S)=>{let R=eG.fromPath(S);this.mutations.push(new aN(R,this.precondition(R)))}),await hY(this.datastore,this.mutations),this.committed=!0}recordVersion(T){let S;if(T.isFoundDocument())S=T.version;else if(T.isNoDocument())S=e6.min();else throw ep(50498,{documentName:T.constructor.name});let R=this.readVersions.get(T.key.toString());if(R){if(!S.isEqual(R))throw new ev(ey.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(T.key.toString(),S)}precondition(T){let S=this.readVersions.get(T.toString());return this.writtenDocs.has(T.toString())||!S?au.none():S.isEqual(e6.min())?au.exists(!1):au.updateTime(S)}preconditionForUpdate(T){let S=this.readVersions.get(T.toString());if(this.writtenDocs.has(T.toString())||!S)return au.exists(!0);if(S.isEqual(e6.min()))throw new ev(ey.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return au.updateTime(S)}write(T){this.ensureCommitNotCalled(),this.mutations.push(T)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f6="FirestoreClient",f9=100,f5=11,f8=20,f7=22;class me{constructor(T,S,R,N,O){this.authCredentials=T,this.appCheckCredentials=S,this.asyncQueue=R,this.databaseInfo=N,this.user=er.UNAUTHENTICATED,this.clientId=eO.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=O,this.authCredentials.start(R,async T=>{eu(f6,"Received user=",T.uid),await this.authCredentialListener(T),this.user=T}),this.appCheckCredentials.start(R,T=>(eu(f6,"Received new app check token=",T),this.appCheckCredentialListener(T,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:f9}}setCredentialChangeListener(T){this.authCredentialListener=T}setAppCheckTokenChangeListener(T){this.appCheckCredentialListener=T}terminate(){this.asyncQueue.enterRestrictedMode();let T=new eb;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),T.resolve()}catch(R){let S=pM(R,"Failed to shutdown persistence");T.reject(S)}}),T.promise}}async function mt(T,S){T.asyncQueue.verifyOperationInProgress(),eu(f6,"Initializing OfflineComponentProvider");let R=T.configuration;await S.initialize(R);let N=R.initialUser;T.setCredentialChangeListener(async T=>{N.isEqual(T)||(await dy(S.localStore,T),N=T)}),S.persistence.setDatabaseDeletedListener(()=>{ed("Terminating Firestore due to IndexedDb database deletion"),T.terminate().then(()=>{eu("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(T=>{ed("Terminating Firestore due to IndexedDb database deletion failed",T)})}),T._offlineComponents=S}async function mr(T,S){T.asyncQueue.verifyOperationInProgress();let R=await mi(T);eu(f6,"Initializing OnlineComponentProvider"),await S.initialize(R,T.configuration),T.setCredentialChangeListener(T=>pN(S.remoteStore,T)),T.setAppCheckTokenChangeListener((T,R)=>pN(S.remoteStore,R)),T._onlineComponents=S}function mn(T){return"FirebaseError"===T.name?T.code===ey.FAILED_PRECONDITION||T.code===ey.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&T instanceof DOMException)||T.code===f7||T.code===f8||T.code===f5}async function mi(T){if(!T._offlineComponents){if(T._uninitializedComponentsProvider){eu(f6,"Using user provided OfflineComponentProvider");try{await mt(T,T._uninitializedComponentsProvider._offline)}catch(R){let S=R;if(!mn(S))throw S;ed("Error using user provided cache. Falling back to memory cache: "+S),await mt(T,new fG)}}else eu(f6,"Using default OfflineComponentProvider"),await mt(T,new f$(void 0))}return T._offlineComponents}async function ms(T){return T._onlineComponents||(T._uninitializedComponentsProvider?(eu(f6,"Using user provided OnlineComponentProvider"),await mr(T,T._uninitializedComponentsProvider._online)):(eu(f6,"Using default OnlineComponentProvider"),await mr(T,new fH))),T._onlineComponents}function ma(T){return mi(T).then(T=>T.localStore)}function mo(T){return ms(T).then(T=>T.syncEngine)}function ml(T){return ms(T).then(T=>T.datastore)}async function mu(T){let S=await ms(T),R=S.eventManager;return R.onListen=fi.bind(null,S.syncEngine),R.onUnlisten=fu.bind(null,S.syncEngine),R.onFirstRemoteStoreListen=fa.bind(null,S.syncEngine),R.onLastRemoteStoreUnlisten=fc.bind(null,S.syncEngine),R}function mc(T,S,R,N){let O=new fJ(N),P=new pY(S,O,R);return T.asyncQueue.enqueueAndForget(async()=>pq(await mu(T),P)),()=>{O.mute(),T.asyncQueue.enqueueAndForget(async()=>pG(await mu(T),P))}}function mh(T,S,R={}){let N=new eb;return T.asyncQueue.enqueueAndForget(async()=>mm(await mu(T),T.asyncQueue,S,R,N)),N.promise}function mp(T,S,R={}){let N=new eb;return T.asyncQueue.enqueueAndForget(async()=>mg(await mu(T),T.asyncQueue,S,R,N)),N.promise}function mf(T,S){let R=new eb;return T.asyncQueue.enqueueAndForget(async()=>fd(await mo(T),S,R)),R.promise}function mm(T,S,R,N,O){let P=new fJ({next:L=>{P.mute(),S.enqueueAndForget(()=>pG(T,M));let U=L.docs.has(R);!U&&L.fromCache?O.reject(new ev(ey.UNAVAILABLE,"Failed to get document because the client is offline.")):U&&L.fromCache&&N&&"server"===N.source?O.reject(new ev(ey.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):O.resolve(L)},error:T=>O.reject(T)}),M=new pY(sc(R.path),P,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return pq(T,M)}function mg(T,S,R,N,O){let P=new fJ({next:R=>{P.mute(),S.enqueueAndForget(()=>pG(T,M)),R.fromCache&&"server"===N.source?O.reject(new ev(ey.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(R)},error:T=>O.reject(T)}),M=new pY(R,P,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return pq(T,M)}function my(T,S,R,N){let O=mb(R,hM(S));T.asyncQueue.enqueueAndForget(async()=>{fz(await mo(T),O,N)})}function mv(T,S){return T.asyncQueue.enqueue(async()=>dH(await ma(T),S))}function mb(T,S){let R;return f0(fY(R="string"==typeof T?eA().encode(T):T),S)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mT(T,S){return T.timeoutSeconds===S.timeoutSeconds}function mS(T){let S={};return void 0!==T.timeoutSeconds&&(S.timeoutSeconds=T.timeoutSeconds),S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mE="ComponentProvider",m_=new Map;function mw(T){let S=m_.get(T);S&&(eu(mE,"Removing Datastore"),m_.delete(T),S.terminate())}function mC(T,S,R,N){return new nS(T,S,R,N.host,N.ssl,N.experimentalForceLongPolling,N.experimentalAutoDetectLongPolling,mS(N.experimentalLongPollingOptions),N.useFetchStreams,N.isUsingEmulator)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mI="firestore.googleapis.com",mR=!0,mk=5,mN=30,mA=!0;class mD{constructor(T){var S,R;if(void 0===T.host){if(void 0!==T.ssl)throw new ev(ey.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=mI,this.ssl=mR}else this.host=T.host,this.ssl=null!==(S=T.ssl)&&void 0!==S?S:mR;if(this.isUsingEmulator=void 0!==T.emulatorOptions,this.credentials=T.credentials,this.ignoreUndefinedProperties=!!T.ignoreUndefinedProperties,this.localCache=T.localCache,void 0===T.cacheSizeBytes)this.cacheSizeBytes=u3;else{if(T.cacheSizeBytes!==u2&&T.cacheSizeBytes<u9)throw new ev(ey.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${u9}`);this.cacheSizeBytes=T.cacheSizeBytes}eK("experimentalForceLongPolling",T.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",T.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!T.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===T.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=mA:this.experimentalAutoDetectLongPolling=!!T.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=mS(null!==(R=T.experimentalLongPollingOptions)&&void 0!==R?R:{}),mO(this.experimentalLongPollingOptions),this.useFetchStreams=!!T.useFetchStreams}isEqual(T){return this.host===T.host&&this.ssl===T.ssl&&this.credentials===T.credentials&&this.cacheSizeBytes===T.cacheSizeBytes&&this.experimentalForceLongPolling===T.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===T.experimentalAutoDetectLongPolling&&mT(this.experimentalLongPollingOptions,T.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===T.ignoreUndefinedProperties&&this.useFetchStreams===T.useFetchStreams}}function mO(T){if(void 0!==T.timeoutSeconds){if(isNaN(T.timeoutSeconds))throw new ev(ey.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (must not be NaN)`);if(T.timeoutSeconds<mk)throw new ev(ey.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (minimum allowed value is ${mk})`);if(T.timeoutSeconds>mN)throw new ev(ey.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (maximum allowed value is ${mN})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(T,S,R,N){this._authCredentials=T,this._appCheckCredentials=S,this._databaseId=R,this._app=N,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mD({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ev(ey.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(T){if(this._settingsFrozen)throw new ev(ey.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mD(T),this._emulatorOptions=T.emulatorOptions||{},void 0!==T.credentials&&(this._authCredentials=ek(T.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return mw(this),Promise.resolve()}}function mP(T,S,R,N={}){var O;T=eX(T,mx);let P=(0,K.Xx)(S),M=T._getSettings(),L=Object.assign(Object.assign({},M),{emulatorOptions:T._getEmulatorOptions()}),U=`${S}:${R}`;P&&((0,K.Uo)(`https://${U}`),(0,K.dp)("Firestore",!0)),M.host!==mI&&M.host!==U&&ed("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let V=Object.assign(Object.assign({},M),{host:U,ssl:P,emulatorOptions:N});if(!(0,K.vZ)(V,L)&&(T._setSettings(V),N.mockUserToken)){let S,R;if("string"==typeof N.mockUserToken)S=N.mockUserToken,R=er.MOCK_USER;else{S=(0,K.Sg)(N.mockUserToken,null===(O=T._app)||void 0===O?void 0:O.options.projectId);let P=N.mockUserToken.sub||N.mockUserToken.user_id;if(!P)throw new ev(ey.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new er(P)}T._authCredentials=new eE(new eT(S,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(T,S,R){this.converter=S,this._query=R,this.type="query",this.firestore=T}withConverter(T){return new mM(this.firestore,T,this._query)}}class mL{constructor(T,S,R){this.converter=S,this._key=R,this.type="document",this.firestore=T}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mF(this.firestore,this.converter,this._key.path.popLast())}withConverter(T){return new mL(this.firestore,T,this._key)}toJSON(){return{type:mL._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(T,S,R){if(e1(S,mL._jsonSchema))return new mL(T,R||null,new eG(ej.fromString(S.referencePath)))}}mL._jsonSchemaVersion="firestore/documentReference/1.0",mL._jsonSchema={type:e0("string",mL._jsonSchemaVersion),referencePath:e0("string")};class mF extends mM{constructor(T,S,R){super(T,S,sc(R)),this._path=R,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let T=this._path.popLast();return T.isEmpty()?null:new mL(this.firestore,null,new eG(T))}withConverter(T){return new mF(this.firestore,T,this._path)}}function mB(T,S,...R){if(T=(0,K.m9)(T),e$("collection","path",S),T instanceof mx){let N=ej.fromString(S,...R);return eW(N),new mF(T,null,N)}{if(!(T instanceof mL)&&!(T instanceof mF))throw new ev(ey.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let N=T._path.child(ej.fromString(S,...R));return eW(N),new mF(T.firestore,null,N)}}function mU(T,S,...R){if(T=(0,K.m9)(T),1==arguments.length&&(S=eO.newId()),e$("doc","path",S),T instanceof mx){let N=ej.fromString(S,...R);return eH(N),new mL(T,null,new eG(N))}{if(!(T instanceof mL)&&!(T instanceof mF))throw new ev(ey.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let N=T._path.child(ej.fromString(S,...R));return eH(N),new mL(T.firestore,T instanceof mF?T.converter:null,new eG(N))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mV="AsyncQueue";class mj{constructor(T=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new hV(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=T}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(T){this.enqueue(T)}enqueueAndForgetEvenWhileRestricted(T){this.verifyNotFailed(),this.enqueueInternal(T)}enterRestrictedMode(T){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=T||!1)}enqueue(T){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let S=new eb;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(T().then(S.resolve,S.reject),S.promise)).then(()=>S.promise)}enqueueRetryable(T){this.enqueueAndForget(()=>(this.retryableOps.push(T),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(T){if(tw(T))eu(mV,"Operation failed with retryable error: "+T);else throw T}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(T){let S=this.tail.then(()=>(this.operationInProgress=!0,T().catch(T=>{throw this.failure=T,this.operationInProgress=!1,ec("INTERNAL UNHANDLED ERROR: ",mz(T)),T}).then(T=>(this.operationInProgress=!1,T))));return this.tail=S,S}enqueueAfterDelay(T,S,R){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(T)>-1&&(S=0);let N=pP.createAndSchedule(this,T,S,R,T=>this.removeDelayedOperation(T));return this.delayedOperations.push(N),N}verifyNotFailed(){this.failure&&ep(47125,{messageOrStack:mz(this.failure)})}verifyOperationInProgress(){}async drain(){let T;do T=this.tail,await T;while(T!==this.tail)}containsDelayedOperation(T){for(let S of this.delayedOperations)if(S.timerId===T)return!0;return!1}runAllDelayedOperationsUntil(T){return this.drain().then(()=>{for(let S of(this.delayedOperations.sort((T,S)=>T.targetTimeMs-S.targetTimeMs),this.delayedOperations))if(S.skipDelay(),"all"!==T&&S.timerId===T)break;return this.drain()})}skipDelaysForTimerId(T){this.timerIdsToSkip.push(T)}removeDelayedOperation(T){let S=this.delayedOperations.indexOf(T);this.delayedOperations.splice(S,1)}}function mz(T){let S=T.message||"";return T.stack&&(S=T.stack.includes(T.message)?T.stack:T.message+"\n"+T.stack),S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mq{constructor(){this._progressObserver={},this._taskCompletionResolver=new eb,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(T,S,R){this._progressObserver={next:T,error:S,complete:R}}catch(T){return this._taskCompletionResolver.promise.catch(T)}then(T,S){return this._taskCompletionResolver.promise.then(T,S)}_completeWith(T){this._updateProgress(T),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(T)}_failWith(T){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(T),this._taskCompletionResolver.reject(T)}_updateProgress(T){this._lastProgress=T,this._progressObserver.next&&this._progressObserver.next(T)}}class mG extends mx{constructor(T,S,R,N){super(T,S,R,N),this.type="firestore",this._queue=new mj,this._persistenceKey=(null==N?void 0:N.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let T=this._firestoreClient.terminate();this._queue=new mj(T),this._firestoreClient=void 0,await T}}}function m$(T,S){let R="object"==typeof T?T:(0,L.Mq)(),N="string"==typeof T?T:S||nE,O=(0,L.qX)(R,"firestore").getImmediate({identifier:N});if(!O._initialized){let T=(0,K.P0)("firestore");T&&mP(O,...T)}return O}function mK(T){if(T._terminated)throw new ev(ey.FAILED_PRECONDITION,"The client has already been terminated.");return T._firestoreClient||mH(T),T._firestoreClient}function mH(T){var S,R,N;let O=T._freezeSettings(),P=mC(T._databaseId,(null===(S=T._app)||void 0===S?void 0:S.options.appId)||"",T._persistenceKey,O);!T._componentsProvider&&(null===(R=O.localCache)||void 0===R?void 0:R._offlineComponentProvider)&&(null===(N=O.localCache)||void 0===N?void 0:N._onlineComponentProvider)&&(T._componentsProvider={_offline:O.localCache._offlineComponentProvider,_online:O.localCache._onlineComponentProvider}),T._firestoreClient=new me(T._authCredentials,T._appCheckCredentials,T._queue,P,T._componentsProvider&&mW(T._componentsProvider))}function mW(T){let S=null==T?void 0:T._online.build();return{_offline:null==T?void 0:T._offline.build(S),_online:S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mQ(T,S=!0){ei(L.Jn),(0,L.Xd)(new U.wA("firestore",(T,{instanceIdentifier:R,options:N})=>{let O=T.getProvider("app").getImmediate(),P=new mG(new e_(T.getProvider("auth-internal")),new eR(O,T.getProvider("app-check-internal")),nw(O,R),O);return N=Object.assign({useFetchStreams:S},N),P._setSettings(N),P},"PUBLIC").setMultipleInstances(!0)),(0,L.KN)(ee,et,T),(0,L.KN)(ee,et,"esm2017")}class mY{constructor(T,S,R){this._userDataWriter=S,this._data=R,this.type="AggregateQuerySnapshot",this.query=T}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mJ{constructor(T){this._byteString=T}static fromBase64String(T){try{return new mJ(ni.fromBase64String(T))}catch(T){throw new ev(ey.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+T)}}static fromUint8Array(T){return new mJ(ni.fromUint8Array(T))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(T){return this._byteString.isEqual(T._byteString)}toJSON(){return{type:mJ._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(T){if(e1(T,mJ._jsonSchema))return mJ.fromBase64String(T.bytes)}}mJ._jsonSchemaVersion="firestore/bytes/1.0",mJ._jsonSchema={type:e0("string",mJ._jsonSchemaVersion),bytes:e0("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mX{constructor(...T){for(let S=0;S<T.length;++S)if(0===T[S].length)throw new ev(ey.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eq(T)}isEqual(T){return this._internalPath.isEqual(T._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mZ{constructor(T){this._methodName=T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(T,S){if(!isFinite(T)||T<-90||T>90)throw new ev(ey.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+T);if(!isFinite(S)||S<-180||S>180)throw new ev(ey.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+S);this._lat=T,this._long=S}get latitude(){return this._lat}get longitude(){return this._long}isEqual(T){return this._lat===T._lat&&this._long===T._long}_compareTo(T){return ex(this._lat,T._lat)||ex(this._long,T._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:m0._jsonSchemaVersion}}static fromJSON(T){if(e1(T,m0._jsonSchema))return new m0(T.latitude,T.longitude)}}m0._jsonSchemaVersion="firestore/geoPoint/1.0",m0._jsonSchema={type:e0("string",m0._jsonSchemaVersion),latitude:e0("number"),longitude:e0("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(T){this._values=(T||[]).map(T=>T)}toArray(){return this._values.map(T=>T)}isEqual(T){return dh(this._values,T._values)}toJSON(){return{type:m1._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(T){if(e1(T,m1._jsonSchema)){if(Array.isArray(T.vectorValues)&&T.vectorValues.every(T=>"number"==typeof T))return new m1(T.vectorValues);throw new ev(ey.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}m1._jsonSchemaVersion="firestore/vectorValue/1.0",m1._jsonSchema={type:e0("string",m1._jsonSchemaVersion),vectorValues:e0("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m2=/^__.*__$/;class m3{constructor(T,S,R){this.data=T,this.fieldMask=S,this.fieldTransforms=R}toMutation(T,S){return null!==this.fieldMask?new aT(T,this.data,this.fieldMask,S,this.fieldTransforms):new ay(T,this.data,S,this.fieldTransforms)}}class m4{constructor(T,S,R){this.data=T,this.fieldMask=S,this.fieldTransforms=R}toMutation(T,S){return new aT(T,this.data,this.fieldMask,S,this.fieldTransforms)}}function m6(T){switch(T){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ep(40011,{dataSource:T})}}class m9{constructor(T,S,R,N,O,P){this.settings=T,this.databaseId=S,this.serializer=R,this.ignoreUndefinedProperties=N,void 0===O&&this.validatePath(),this.fieldTransforms=O||[],this.fieldMask=P||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(T){return new m9(Object.assign(Object.assign({},this.settings),T),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(T){var S;let R=null===(S=this.path)||void 0===S?void 0:S.child(T),N=this.contextWith({path:R,arrayElement:!1});return N.validatePathSegment(T),N}childContextForFieldPath(T){var S;let R=null===(S=this.path)||void 0===S?void 0:S.child(T),N=this.contextWith({path:R,arrayElement:!1});return N.validatePath(),N}childContextForArray(T){return this.contextWith({path:void 0,arrayElement:!0})}createError(T){return gT(T,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(T){return void 0!==this.fieldMask.find(S=>T.isPrefixOf(S))||void 0!==this.fieldTransforms.find(S=>T.isPrefixOf(S.field))}validatePath(){if(this.path)for(let T=0;T<this.path.length;T++)this.validatePathSegment(this.path.get(T))}validatePathSegment(T){if(0===T.length)throw this.createError("Document fields must not be empty");if(m6(this.dataSource)&&m2.test(T))throw this.createError('Document fields cannot begin and end with "__"')}}class m5{constructor(T,S,R){this.databaseId=T,this.ignoreUndefinedProperties=S,this.serializer=R||hM(T)}createContext(T,S,R,N=!1){return new m9({dataSource:T,methodName:S,targetDoc:R,path:eq.emptyPath(),arrayElement:!1,hasConverter:N},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function m8(T){let S=T._freezeSettings(),R=hM(T._databaseId);return new m5(T._databaseId,!!S.ignoreUndefinedProperties,R)}function m7(T,S,R,N,O,P={}){let M,L;let U=T.createContext(P.merge||P.mergeFields?2:0,S,R,O);gg("Data must be an object, but it was:",U,N);let V=gc(N,U);if(P.merge)M=new ne(U.fieldMask),L=U.fieldTransforms;else if(P.mergeFields){let T=[];for(let N of P.mergeFields){let O=gy(S,N,R);if(!U.contains(O))throw new ev(ey.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);gS(T,O)||T.push(O)}M=new ne(T),L=U.fieldTransforms.filter(T=>M.covers(T.field))}else M=null,L=U.fieldTransforms;return new m3(new iS(V),M,L)}class ge extends mZ{_toFieldTransform(T){if(2===T.dataSource)T.fieldMask.push(T.path);else if(1===T.dataSource)throw T.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw T.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(T){return T instanceof ge}}function gt(T,S,R){return new m9({dataSource:3,targetDoc:S.settings.targetDoc,methodName:T._methodName,arrayElement:R},S.databaseId,S.serializer,S.ignoreUndefinedProperties)}class gr extends null{_toFieldTransform(T){return new as(T.path,new s9)}isEqual(T){return T instanceof gr}}class gn extends null{constructor(T,S){super(T),this._elements=S}_toFieldTransform(T){let S=gt(this,T,!0),R=new s5(this._elements.map(T=>gu(T,S)));return new as(T.path,R)}isEqual(T){return T instanceof gn&&deepEqual(this._elements,T._elements)}}class gi extends null{constructor(T,S){super(T),this._elements=S}_toFieldTransform(T){let S=gt(this,T,!0),R=new s7(this._elements.map(T=>gu(T,S)));return new as(T.path,R)}isEqual(T){return T instanceof gi&&deepEqual(this._elements,T._elements)}}class gs extends mZ{constructor(T,S){super(T),this._operand=S}_toFieldTransform(T){let S=new at(T.serializer,s0(T.serializer,this._operand));return new as(T.path,S)}isEqual(T){return T instanceof gs&&this._operand===T._operand}}function ga(T,S,R,N){let O=T.createContext(1,S,R);gg("Data must be an object, but it was:",O,N);let P=[],M=iS.empty();return r0(N,(T,N)=>{let L=gb(S,T,R);N=(0,K.m9)(N);let U=O.childContextForFieldPath(L);if(N instanceof ge)P.push(L);else{let T=gu(N,U);null!=T&&(P.push(L),M.set(L,T))}}),new m4(M,new ne(P),O.fieldTransforms)}function go(T,S,R,N,O,P){let M=T.createContext(1,S,R),L=[gy(S,N,R)],U=[O];if(P.length%2!=0)throw new ev(ey.INVALID_ARGUMENT,`Function ${S}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<P.length;T+=2)L.push(gy(S,P[T])),U.push(P[T+1]);let V=[],$=iS.empty();for(let T=L.length-1;T>=0;--T)if(!gS(V,L[T])){let S=L[T],R=U[T];R=(0,K.m9)(R);let N=M.childContextForFieldPath(S);if(R instanceof ge)V.push(S);else{let T=gu(R,N);null!=T&&(V.push(S),$.set(S,T))}}return new m4($,new ne(V),M.fieldTransforms)}function gl(T,S,R,N=!1){return gu(R,T.createContext(N?4:3,S))}function gu(T,S){if(gm(T=(0,K.m9)(T)))return gg("Unsupported field value:",S,T),gc(T,S);if(T instanceof mZ)return gh(T,S),null;if(void 0===T&&S.ignoreUndefinedProperties)return null;if(S.path&&S.fieldMask.push(S.path),!(T instanceof Array))return gp(T,S);if(S.settings.arrayElement&&4!==S.dataSource)throw S.createError("Nested arrays are not supported");return gd(T,S)}function gc(T,S){let R={};return r1(T)?S.path&&S.path.length>0&&S.fieldMask.push(S.path):r0(T,(T,N)=>{let O=gu(N,S.childContextForField(T));null!=O&&(R[T]=O)}),{mapValue:{fields:R}}}function gd(T,S){let R=[],N=0;for(let O of T){let T=gu(O,S.childContextForArray(N));null==T&&(T={nullValue:"NULL_VALUE"}),R.push(T),N++}return{arrayValue:{values:R}}}function gh(T,S){if(!m6(S.dataSource))throw S.createError(`${T._methodName}() can only be used with update() and set()`);if(!S.path)throw S.createError(`${T._methodName}() is not currently supported inside arrays`);let R=T._toFieldTransform(S);R&&S.fieldTransforms.push(R)}function gp(T,S){if(null===(T=(0,K.m9)(T)))return{nullValue:"NULL_VALUE"};if("number"==typeof T)return s0(S.serializer,T);if("boolean"==typeof T)return{booleanValue:T};if("string"==typeof T)return{stringValue:T};if(T instanceof Date){let R=e4.fromDate(T);return{timestampValue:a8(S.serializer,R)}}if(T instanceof e4){let R=new e4(T.seconds,1e3*Math.floor(T.nanoseconds/1e3));return{timestampValue:a8(S.serializer,R)}}if(T instanceof m0)return{geoPointValue:{latitude:T.latitude,longitude:T.longitude}};else if(T instanceof mJ)return{bytesValue:oe(S.serializer,T._byteString)};else if(T instanceof mL){let R=S.databaseId,N=T.firestore._databaseId;if(!N.isEqual(R))throw S.createError(`Document reference is for database ${N.projectId}/${N.database} but should be for database ${R.projectId}/${R.database}`);return{referenceValue:oi(T.firestore._databaseId||S.databaseId,T._key.path)}}else if(T instanceof m1)return gf(T,S);else throw S.createError(`Unsupported field value: ${eY(T)}`)}function gf(T,S){return{mapValue:{fields:{[nN]:{stringValue:nO},[nx]:{arrayValue:{values:T.toArray().map(T=>{if("number"!=typeof T)throw S.createError("VectorValues must only contain numeric values.");return sX(S.serializer,T)})}}}}}}function gm(T){return"object"==typeof T&&null!==T&&!(T instanceof Array)&&!(T instanceof Date)&&!(T instanceof e4)&&!(T instanceof m0)&&!(T instanceof mJ)&&!(T instanceof mL)&&!(T instanceof mZ)&&!(T instanceof m1)}function gg(T,S,R){if(!gm(R)||!eQ(R)){let N=eY(R);if("an object"===N)throw S.createError(T+" a custom object");throw S.createError(T+" "+N)}}function gy(T,S,R){if((S=(0,K.m9)(S))instanceof mX)return S._internalPath;if("string"==typeof S)return gb(T,S);throw gT("Field path arguments must be of type string or ",T,!1,void 0,R)}let gv=RegExp("[~\\*/\\[\\]]");function gb(T,S,R){if(S.search(gv)>=0)throw gT(`Invalid field path (${S}). Paths must not contain '~', '*', '/', '[', or ']'`,T,!1,void 0,R);try{return new mX(...S.split("."))._internalPath}catch(N){throw gT(`Invalid field path (${S}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,T,!1,void 0,R)}}function gT(T,S,R,N,O){let P=N&&!N.isEmpty(),M=void 0!==O,L=`Function ${S}() called with invalid data`;R&&(L+=" (via `toFirestore()`)"),L+=". ";let U="";return(P||M)&&(U+=" (found",P&&(U+=` in field ${N}`),M&&(U+=` in document ${O}`),U+=")"),new ev(ey.INVALID_ARGUMENT,L+T+U)}function gS(T,S){return T.some(T=>T.isEqual(S))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(T,S,R,N,O){this._firestore=T,this._userDataWriter=S,this._key=R,this._document=N,this._converter=O}get id(){return this._key.path.lastSegment()}get ref(){return new mL(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let T=new g_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(T)}}}get(T){if(this._document){let S=this._document.data.field(gw("DocumentSnapshot.get",T));if(null!==S)return this._userDataWriter.convertValue(S)}}}class g_ extends gE{data(){return super.data()}}function gw(T,S){return"string"==typeof S?gb(T,S):S instanceof mX?S._internalPath:S._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(T){if("L"===T.limitType&&0===T.explicitOrderBy.length)throw new ev(ey.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class gI{}class gR extends gI{}function gk(T,S,...R){let N=[];for(let O of(S instanceof gI&&N.push(S),gQ(N=N.concat(R)),N))T=O._apply(T);return T}class gN extends gR{constructor(T,S,R){super(),this._field=T,this._op=S,this._value=R,this.type="where"}static _create(T,S,R){return new gN(T,S,R)}_apply(T){let S=this._parse(T);return gK(T._query,S),new mM(T.firestore,T.converter,sT(T._query,S))}_parse(T){let S=m8(T.firestore);return gU(T._query,"where",S,T.firestore._databaseId,this._field,this._op,this._value)}}function gA(T,S,R){let N=S,O=gw("where",T);return gN._create(O,N,R)}class gD extends gI{constructor(T,S){super(),this.type=T,this._queryConstraints=S}static _create(T,S){return new gD(T,S)}_parse(T){let S=this._queryConstraints.map(S=>S._parse(T)).filter(T=>T.getFilters().length>0);return 1===S.length?S[0]:iL.create(S,this._getOperator())}_apply(T){let S=this._parse(T);return 0===S.getFilters().length?T:(gH(T._query,S),new mM(T.firestore,T.converter,sT(T._query,S)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class gO extends gR{constructor(T,S){super(),this._field=T,this._direction=S,this.type="orderBy"}static _create(T,S){return new gO(T,S)}_apply(T){let S=gV(T._query,this._field,this._direction);return new mM(T.firestore,T.converter,sS(T._query,S))}}function gx(T,S="asc"){let R=S,N=gw("orderBy",T);return gO._create(N,R)}class gP extends gR{constructor(T,S,R){super(),this.type=T,this._limit=S,this._limitType=R}static _create(T,S,R){return new gP(T,S,R)}_apply(T){return new mM(T.firestore,T.converter,sE(T._query,this._limit,this._limitType))}}function gM(T){return eZ("limit",T),gP._create("limit",T,"F")}class gL extends null{constructor(T,S,R){super(),this.type=T,this._docOrFields=S,this._inclusive=R}static _create(T,S,R){return new gL(T,S,R)}_apply(T){let S=gB(T,this.type,this._docOrFields,this._inclusive);return new mM(T.firestore,T.converter,s_(T._query,S))}}class gF extends null{constructor(T,S,R){super(),this.type=T,this._docOrFields=S,this._inclusive=R}static _create(T,S,R){return new gF(T,S,R)}_apply(T){let S=gB(T,this.type,this._docOrFields,this._inclusive);return new mM(T.firestore,T.converter,sw(T._query,S))}}function gB(T,S,R,N){if(R[0]=getModularInstance(R[0]),R[0]instanceof gE)return gj(T._query,T.firestore._databaseId,S,R[0]._document,N);{let O=m8(T.firestore);return gz(T._query,T.firestore._databaseId,O,S,R,N)}}function gU(T,S,R,N,O,P,M){let L;if(O.isKeyField()){if("array-contains"===P||"array-contains-any"===P)throw new ev(ey.INVALID_ARGUMENT,`Invalid Query. You can't perform '${P}' queries on documentId().`);if("in"===P||"not-in"===P){gG(M,P);let S=[];for(let R of M)S.push(gq(N,T,R));L={arrayValue:{values:S}}}else L=gq(N,T,M)}else("in"===P||"not-in"===P||"array-contains-any"===P)&&gG(M,P),L=gl(R,S,M,"in"===P||"not-in"===P);return iM.create(O,P,L)}function gV(T,S,R){if(null!==T.startAt)throw new ev(ey.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==T.endAt)throw new ev(ey.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new iA(S,R)}function gj(T,S,R,N,O){if(!N)throw new ev(ey.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${R}().`);let P=[];for(let R of sg(T))if(R.field.isKeyField())P.push(ir(S,N.key));else{let T=N.data.field(R.field);if(ny(T))throw new ev(ey.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==T)P.push(T);else{let T=R.field.canonicalString();throw new ev(ey.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}}return new iC(P,O)}function gz(T,S,R,N,O,P){let M=T.explicitOrderBy;if(O.length>M.length)throw new ev(ey.INVALID_ARGUMENT,`Too many arguments provided to ${N}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let L=[];for(let P=0;P<O.length;P++){let U=O[P];if(M[P].field.isKeyField()){if("string"!=typeof U)throw new ev(ey.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${N}(), but got a ${typeof U}`);if(!sm(T)&&-1!==U.indexOf("/"))throw new ev(ey.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${N}() must be a plain document ID, but '${U}' contains a slash.`);let R=T.path.child(ej.fromString(U));if(!eG.isDocumentKey(R))throw new ev(ey.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${N}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let O=new eG(R);L.push(ir(S,O))}else{let T=gl(R,N,U);L.push(T)}}return new iC(L,P)}function gq(T,S,R){if("string"==typeof(R=(0,K.m9)(R))){if(""===R)throw new ev(ey.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sm(S)&&-1!==R.indexOf("/"))throw new ev(ey.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${R}' contains a '/' character.`);let N=S.path.child(ej.fromString(R));if(!eG.isDocumentKey(N))throw new ev(ey.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${N}' is not because it has an odd number of segments (${N.length}).`);return ir(T,new eG(N))}if(R instanceof mL)return ir(T,R._key);throw new ev(ey.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eY(R)}.`)}function gG(T,S){if(!Array.isArray(T)||0===T.length)throw new ev(ey.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${S.toString()}' filters.`)}function g$(T){switch(T){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function gK(T,S){let R=gW(T.filters,g$(S.op));if(null!==R){if(R===S.op)throw new ev(ey.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${S.op.toString()}' filter.`);throw new ev(ey.INVALID_ARGUMENT,`Invalid query. You cannot use '${S.op.toString()}' filters with '${R.toString()}' filters.`)}}function gH(T,S){let R=T;for(let T of S.getFlattenedFilters())gK(R,T),R=sT(R,T)}function gW(T,S){for(let R of T)for(let T of R.getFlattenedFilters())if(S.indexOf(T.op)>=0)return T.op;return null}function gQ(T){let S=T.filter(T=>T instanceof gD).length,R=T.filter(T=>T instanceof gN).length;if(S>1||S>0&&R>0)throw new ev(ey.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gY{convertValue(T,S="none"){switch(nM(T)){case 0:return null;case 1:return T.booleanValue;case 2:return nd(T.integerValue||T.doubleValue);case 3:return this.convertTimestamp(T.timestampValue);case 4:return this.convertServerTimestamp(T,S);case 5:return T.stringValue;case 6:return this.convertBytes(nh(T.bytesValue));case 7:return this.convertReference(T.referenceValue);case 8:return this.convertGeoPoint(T.geoPointValue);case 9:return this.convertArray(T.arrayValue,S);case 11:return this.convertObject(T.mapValue,S);case 10:return this.convertVectorValue(T.mapValue);default:throw ep(62114,{value:T})}}convertObject(T,S){return this.convertObjectMap(T.fields,S)}convertObjectMap(T,S="none"){let R={};return r0(T,(T,N)=>{R[T]=this.convertValue(N,S)}),R}convertVectorValue(T){var S,R,N;return new m1(null===(N=null===(R=null===(S=T.fields)||void 0===S?void 0:S[nx].arrayValue)||void 0===R?void 0:R.values)||void 0===N?void 0:N.map(T=>nd(T.doubleValue)))}convertGeoPoint(T){return new m0(nd(T.latitude),nd(T.longitude))}convertArray(T,S){return(T.values||[]).map(T=>this.convertValue(T,S))}convertServerTimestamp(T,S){switch(S){case"previous":let R=nb(T);if(null==R)return null;return this.convertValue(R,S);case"estimate":return this.convertTimestamp(nT(T));default:return null}}convertTimestamp(T){let S=nc(T);return new e4(S.seconds,S.nanos)}convertDocumentKey(T,S){let R=ej.fromString(T);em(la(R),9688,{name:T});let N=new n_(R.get(1),R.get(3)),O=new eG(R.popFirst(5));return N.isEqual(S)||ec(`Document ${O} contains a document reference within a different database (${N.projectId}/${N.database}) which is not supported. It will be treated as a reference in the current database (${S.projectId}/${S.database}) instead.`),O}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gJ(T,S,R){return T?R&&(R.merge||R.mergeFields)?T.toFirestore(S,R):T.toFirestore(S):S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gX(T){return gZ(T,["next","error","complete"])}function gZ(T,S){if("object"!=typeof T||null===T)return!1;let R=T;for(let T of S)if(T in R&&"function"==typeof R[T])return!0;return!1}let g0=eA();function g1(T){let S=JSON.stringify(T),R=g0.encode(S).byteLength;return`${R}${S}`}g1({metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),g1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),g1({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),g1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),g1({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),g1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),g1({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}}),g1({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}});/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g2=1;class g3{constructor(T,S){this.firestore=T,this.bundleId=S,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new e4(0,0),this.databaseId=T._databaseId,this.serializer=new a4(this.databaseId,!0),this.userDataReader=new m5(this.databaseId,!0,this.serializer)}addBundleDocument(T,S){let R=this.documents.get(T.documentPath),N=null==R?void 0:R.metadata.queries,O=T.readTime,P=(null==R?void 0:R.metadata.readTime)?a7(R.metadata.readTime):null,M=!O&&null==P,L=void 0!==O&&(null==P||P<O);if((M||L)&&this.documents.set(T.documentPath,{document:this.toBundleDocument(T),metadata:{name:ol(this.serializer,T.documentKey),readTime:O?a8(this.serializer,O):void 0,exists:T.documentExists}}),O&&O>this.latestReadTime&&(this.latestReadTime=O),S){let R=this.documents.get(T.documentPath);R.metadata.queries=N||[],R.metadata.queries.push(S)}}addBundleQuery(T){if(this.namedQueries.has(T.name))throw Error(`Query name conflict: ${name} has already been added.`);let S=new e4(0,0);for(let R of T.docBundleDataArray)this.addBundleDocument(R,T.name),R.readTime&&R.readTime>S&&(S=R.readTime);let R=oM(this.serializer,sy(T.query)),N={parent:T.parent,structuredQuery:R.queryTarget.structuredQuery};this.namedQueries.set(T.name,{name:T.name,bundledQuery:N,readTime:a8(this.serializer,S)})}toBundleDocument(T){let S=this.userDataReader.createContext(4,"internal toBundledDocument"),R=gc(T.documentData,S);return{name:ol(this.serializer,T.documentKey),fields:R.mapValue.fields,updateTime:a8(this.serializer,T.versionTime),createTime:a8(this.serializer,T.createdTime)}}lengthPrefixedString(T){let S=JSON.stringify(T),R=g0.encode(S).byteLength;return`${R}${S}`}build(){let T="";for(let S of this.namedQueries.values())T+=this.lengthPrefixedString({namedQuery:S});for(let S of this.documents.values()){let R=S.metadata;T+=this.lengthPrefixedString({documentMetadata:R});let N=S.document;N&&(T+=this.lengthPrefixedString({document:N}))}let S={id:this.bundleId,createTime:a8(this.serializer,this.latestReadTime),version:g2,totalDocuments:this.documents.size,totalBytes:g0.encode(T).length};return this.lengthPrefixedString({metadata:S})+T}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g4(T,S,R,N){let O=new g3(T,eO.newId());return O.addBundleDocument(g9(N,R,S)),O.build()}function g6(T,S,R,N,O,P,M){let L=[];for(let T=0;T<P.length;T++)L.push(g9(O[T],M[T],P[T]));let U={name:R,query:S,parent:N,docBundleDataArray:L},V=new g3(T,R);return V.addBundleQuery(U),V.build()}function g9(T,S,R){return{documentData:S,documentKey:R.mutableCopy().key,documentPath:T,documentExists:!0,createdTime:R.createTime.toTimestamp(),readTime:R.readTime.toTimestamp(),versionTime:R.version.toTimestamp()}}class g5{constructor(T,S){this.hasPendingWrites=T,this.fromCache=S}isEqual(T){return this.hasPendingWrites===T.hasPendingWrites&&this.fromCache===T.fromCache}}class g8 extends gE{constructor(T,S,R,N,O,P){super(T,S,R,N,P),this._firestore=T,this._firestoreImpl=T,this.metadata=O}exists(){return super.exists()}data(T={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,T.serverTimestamps);{let S=new g7(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(S,T)}}}get(T,S={}){if(this._document){let R=this._document.data.field(gw("DocumentSnapshot.get",T));if(null!==R)return this._userDataWriter.convertValue(R,S.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ev(ey.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let T=this._document,S={};if(S.type=g8._jsonSchemaVersion,S.bundle="",S.bundleSource="DocumentSnapshot",S.bundleName=this._key.toString(),!T||!T.isValidDocument()||!T.isFoundDocument())return S;let R=this._userDataWriter.convertObjectMap(T.data.value.mapValue.fields,"previous");return S.bundle=g4(this._firestore,T,R,this.ref.path),S}}g8._jsonSchemaVersion="firestore/documentSnapshot/1.0",g8._jsonSchema={type:e0("string",g8._jsonSchemaVersion),bundleSource:e0("string","DocumentSnapshot"),bundleName:e0("string"),bundle:e0("string")};class g7 extends g8{data(T={}){return super.data(T)}}class ye{constructor(T,S,R,N){this._firestore=T,this._userDataWriter=S,this._snapshot=N,this.metadata=new g5(N.hasPendingWrites,N.fromCache),this.query=R}get docs(){let T=[];return this.forEach(S=>T.push(S)),T}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(T,S){this._snapshot.docs.forEach(R=>{T.call(S,new g7(this._firestore,this._userDataWriter,R.key,R,new g5(this._snapshot.mutatedKeys.has(R.key),this._snapshot.fromCache),this.query.converter))})}docChanges(T={}){let S=!!T.includeMetadataChanges;if(S&&this._snapshot.excludesMetadataChanges)throw new ev(ey.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===S||(this._cachedChanges=yt(this,S),this._cachedChangesIncludeMetadataChanges=S),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ev(ey.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let T={};T.type=ye._jsonSchemaVersion,T.bundleSource="QuerySnapshot",T.bundleName=eO.newId();let S=this._firestore._databaseId.database,R=this._firestore._databaseId.projectId,N=`projects/${R}/databases/${S}/documents`,O=[],P=[],M=[];return this.docs.forEach(T=>{null!==T._document&&(O.push(T._document),P.push(this._userDataWriter.convertObjectMap(T._document.data.value.mapValue.fields,"previous")),M.push(T.ref.path))}),T.bundle=g6(this._firestore,this.query._query,T.bundleName,N,M,O,P),T}}function yt(T,S){if(T._snapshot.oldDocs.isEmpty()){let S=0;return T._snapshot.docChanges.map(R=>{let N=new g7(T._firestore,T._userDataWriter,R.doc.key,R.doc,new g5(T._snapshot.mutatedKeys.has(R.doc.key),T._snapshot.fromCache),T.query.converter);return R.doc,{type:"added",doc:N,oldIndex:-1,newIndex:S++}})}{let R=T._snapshot.oldDocs;return T._snapshot.docChanges.filter(T=>S||3!==T.type).map(S=>{let N=new g7(T._firestore,T._userDataWriter,S.doc.key,S.doc,new g5(T._snapshot.mutatedKeys.has(S.doc.key),T._snapshot.fromCache),T.query.converter),O=-1,P=-1;return 0!==S.type&&(O=R.indexOf(S.doc.key),R=R.delete(S.doc.key)),1!==S.type&&(P=(R=R.add(S.doc)).indexOf(S.doc.key)),{type:yr(S.type),doc:N,oldIndex:O,newIndex:P}})}}function yr(T){switch(T){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ep(61501,{type:T})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(T){T=eX(T,mL);let S=eX(T.firestore,mG);return mh(mK(S),T._key).then(R=>yd(S,T,R))}ye._jsonSchemaVersion="firestore/querySnapshot/1.0",ye._jsonSchema={type:e0("string",ye._jsonSchemaVersion),bundleSource:e0("string","QuerySnapshot"),bundleName:e0("string"),bundle:e0("string")};class yi extends gY{constructor(T){super(),this.firestore=T}convertBytes(T){return new mJ(T)}convertReference(T){let S=this.convertDocumentKey(T,this.firestore._databaseId);return new mL(this.firestore,null,S)}}function ys(T){T=eX(T,mM);let S=eX(T.firestore,mG),R=mK(S),N=new yi(S);return gC(T._query),mp(R,T._query).then(R=>new ye(S,N,T,R))}function ya(T,S,R,...N){let O;T=eX(T,mL);let P=eX(T.firestore,mG),M=m8(P);return yc(P,[(O="string"==typeof(S=(0,K.m9)(S))||S instanceof mX?go(M,"updateDoc",T._key,S,R,N):ga(M,"updateDoc",T._key,S)).toMutation(T._key,au.exists(!0))])}function yo(T){return yc(eX(T.firestore,mG),[new aI(T._key,au.none())])}function yl(T,S){let R=eX(T.firestore,mG),N=mU(T),O=gJ(T.converter,S);return yc(R,[m7(m8(T.firestore),"addDoc",N._key,O,null!==T.converter,{}).toMutation(N._key,au.exists(!1))]).then(()=>N)}function yu(T,...S){var R,N,O;let P,M,L;T=(0,K.m9)(T);let U={includeMetadataChanges:!1,source:"default"},V=0;"object"!=typeof S[0]||gX(S[V])||(U=S[V++]);let $={includeMetadataChanges:U.includeMetadataChanges,source:U.source};if(gX(S[V])){let T=S[V];S[V]=null===(R=T.next)||void 0===R?void 0:R.bind(T),S[V+1]=null===(N=T.error)||void 0===N?void 0:N.bind(T),S[V+2]=null===(O=T.complete)||void 0===O?void 0:O.bind(T)}if(T instanceof mL)M=eX(T.firestore,mG),L=sc(T._key.path),P={next:R=>{S[V]&&S[V](yd(M,T,R))},error:S[V+1],complete:S[V+2]};else{let R=eX(T,mM);M=eX(R.firestore,mG),L=R._query;let N=new yi(M);P={next:T=>{S[V]&&S[V](new ye(M,N,R,T))},error:S[V+1],complete:S[V+2]},gC(T._query)}return mc(mK(M),L,$,P)}function yc(T,S){return mf(mK(T),S)}function yd(T,S,R){let N=R.docs.get(S._key),O=new yi(T);return new g8(T,O,S._key,N,new g5(R.hasPendingWrites,R.fromCache),S.converter)}class yh{constructor(T){this.forceOwnership=T,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(T){this._onlineComponentProvider=fH.provider,this._offlineComponentProvider={build:S=>new fK(S,null==T?void 0:T.cacheSizeBytes,this.forceOwnership)}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(T,S){this._firestore=T,this._commitHandler=S,this._mutations=[],this._committed=!1,this._dataReader=m8(T)}set(T,S,R){this._verifyNotCommitted();let N=yf(T,this._firestore),O=gJ(N.converter,S,R),P=m7(this._dataReader,"WriteBatch.set",N._key,O,null!==N.converter,R);return this._mutations.push(P.toMutation(N._key,au.none())),this}update(T,S,R,...N){let O;this._verifyNotCommitted();let P=yf(T,this._firestore);return O="string"==typeof(S=(0,K.m9)(S))||S instanceof mX?go(this._dataReader,"WriteBatch.update",P._key,S,R,N):ga(this._dataReader,"WriteBatch.update",P._key,S),this._mutations.push(O.toMutation(P._key,au.exists(!0))),this}delete(T){this._verifyNotCommitted();let S=yf(T,this._firestore);return this._mutations=this._mutations.concat(new aI(S._key,au.none())),this}commit(){return(this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0)?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ev(ey.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function yf(T,S){if((T=(0,K.m9)(T)).firestore===S)return T;throw new ev(ey.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}function ym(T){return new gs("increment",T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(T){return mK(T=eX(T,mG)),new yp(T,S=>yc(T,S))}new WeakMap,/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mQ("node")},73424:(T,S,R)=>{"use strict";R.d(S,{Jt:()=>t3,cF:()=>t6,iH:()=>t4,KV:()=>t2});var N,O,P=R(95285),M=R(61006),L=R(47059);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let U="firebasestorage.googleapis.com",V="storageBucket",$=12e4,K=6e5,W=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q extends M.ZR{constructor(T,S,R=0){super(Y(T),`Firebase Storage: ${S} (${Y(T)})`),this.status_=R,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Q.prototype)}get status(){return this.status_}set status(T){this.status_=T}_codeEquals(T){return Y(T)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(T){this.customData.serverResponse=T,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function Y(T){return"storage/"+T}function X(){let T="An unknown error occurred, please check the error payload for server response.";return new Q(N.UNKNOWN,T)}function Z(T){return new Q(N.OBJECT_NOT_FOUND,"Object '"+T+"' does not exist.")}function ee(T){return new Q(N.QUOTA_EXCEEDED,"Quota for bucket '"+T+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function et(){let T="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Q(N.UNAUTHENTICATED,T)}function er(){return new Q(N.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function en(T){return new Q(N.UNAUTHORIZED,"User does not have permission to access '"+T+"'.")}function ei(){return new Q(N.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function es(){return new Q(N.CANCELED,"User canceled the upload/download.")}function ea(T){return new Q(N.INVALID_URL,"Invalid URL '"+T+"'.")}function eo(T){return new Q(N.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+T+"'.")}function eu(){return new Q(N.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+V+"' property when initializing the app?")}function ec(){return new Q(N.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function ed(){return new Q(N.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function eh(){return new Q(N.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ep(T){return new Q(N.INVALID_ARGUMENT,T)}function ef(){return new Q(N.APP_DELETED,"The Firebase app was deleted.")}function em(T){return new Q(N.INVALID_ROOT_OPERATION,"The operation '"+T+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function eg(T,S){return new Q(N.INVALID_FORMAT,"String does not match format '"+T+"': "+S)}function ey(T){throw new Q(N.INTERNAL_ERROR,"Internal error: "+T)}!function(T){T.UNKNOWN="unknown",T.OBJECT_NOT_FOUND="object-not-found",T.BUCKET_NOT_FOUND="bucket-not-found",T.PROJECT_NOT_FOUND="project-not-found",T.QUOTA_EXCEEDED="quota-exceeded",T.UNAUTHENTICATED="unauthenticated",T.UNAUTHORIZED="unauthorized",T.UNAUTHORIZED_APP="unauthorized-app",T.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",T.INVALID_CHECKSUM="invalid-checksum",T.CANCELED="canceled",T.INVALID_EVENT_NAME="invalid-event-name",T.INVALID_URL="invalid-url",T.INVALID_DEFAULT_BUCKET="invalid-default-bucket",T.NO_DEFAULT_BUCKET="no-default-bucket",T.CANNOT_SLICE_BLOB="cannot-slice-blob",T.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",T.NO_DOWNLOAD_URL="no-download-url",T.INVALID_ARGUMENT="invalid-argument",T.INVALID_ARGUMENT_COUNT="invalid-argument-count",T.APP_DELETED="app-deleted",T.INVALID_ROOT_OPERATION="invalid-root-operation",T.INVALID_FORMAT="invalid-format",T.INTERNAL_ERROR="internal-error",T.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(N||(N={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(T,S){this.bucket=T,this.path_=S}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let T=encodeURIComponent;return"/b/"+T(this.bucket)+"/o/"+T(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(T,S){let R;try{R=ev.makeFromUrl(T,S)}catch(S){return new ev(T,"")}if(""===R.path)return R;throw eo(T)}static makeFromUrl(T,S){let R=null,N="([A-Za-z0-9.\\-_]+)";function O(T){"/"===T.path.charAt(T.path.length-1)&&(T.path_=T.path_.slice(0,-1))}let P=RegExp("^gs://"+N+"(/(.*))?$","i"),M={bucket:1,path:3};function L(T){T.path_=decodeURIComponent(T.path)}let V="v[A-Za-z0-9_]+",$=S.replace(/[.]/g,"\\."),K="(/([^?#]*).*)?$",W=RegExp(`^https?://${$}/${V}/b/${N}/o${K}`,"i"),Q=S===U?"(?:storage.googleapis.com|storage.cloud.google.com)":S,Y="([^?#]*)",X=[{regex:P,indices:M,postModify:O},{regex:W,indices:{bucket:1,path:3},postModify:L},{regex:RegExp(`^https?://${Q}/${N}/${Y}`,"i"),indices:{bucket:1,path:2},postModify:L}];for(let S=0;S<X.length;S++){let N=X[S],O=N.regex.exec(T);if(O){let T=O[N.indices.bucket],S=O[N.indices.path];S||(S=""),R=new ev(T,S),N.postModify(R);break}}if(null==R)throw ea(T);return R}}class eb{constructor(T){this.promise_=Promise.reject(T)}getPromise(){return this.promise_}cancel(T=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(T,S,R){let N=1,O=null,P=null,M=!1,L=0;function U(){return 2===L}let V=!1;function $(...T){V||(V=!0,S.apply(null,T))}function K(S){O=setTimeout(()=>{O=null,T(Q,U())},S)}function W(){P&&clearTimeout(P)}function Q(T,...S){let R;if(V){W();return}if(T||U()||M){W(),$.call(null,T,...S);return}N<64&&(N*=2),1===L?(L=2,R=0):R=(N+Math.random())*1e3,K(R)}let Y=!1;function X(T){!Y&&(Y=!0,W(),!V&&(null!==O?(T||(L=2),clearTimeout(O),K(0)):T||(L=1)))}return K(0),P=setTimeout(()=>{M=!0,X(!0)},R),X}function eS(T){T(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eE(T){return void 0!==T}function e_(T){return"function"==typeof T}function ew(T){return"object"==typeof T&&!Array.isArray(T)}function eC(T){return"string"==typeof T||T instanceof String}function eI(T){return eR()&&T instanceof Blob}function eR(){return"undefined"!=typeof Blob}function ek(T,S,R,N){if(N<S)throw ep(`Invalid value for '${T}'. Expected ${S} or greater.`);if(N>R)throw ep(`Invalid value for '${T}'. Expected ${R} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(T,S,R){let N=S;return null==R&&(N=`https://${S}`),`${R}://${N}/v0${T}`}function eA(T){let S=encodeURIComponent,R="?";for(let N in T)T.hasOwnProperty(N)&&(R=R+(S(N)+"=")+S(T[N])+"&");return R.slice(0,-1)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eD(T,S){let R=T>=500&&T<600,N=-1!==[408,429].indexOf(T),O=-1!==S.indexOf(T);return R||N||O}!function(T){T[T.NO_ERROR=0]="NO_ERROR",T[T.NETWORK_ERROR=1]="NETWORK_ERROR",T[T.ABORT=2]="ABORT"}(O||(O={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(T,S,R,N,O,P,M,L,U,V,$,K=!0,W=!1){this.url_=T,this.method_=S,this.headers_=R,this.body_=N,this.successCodes_=O,this.additionalRetryCodes_=P,this.callback_=M,this.errorCallback_=L,this.timeout_=U,this.progressCallback_=V,this.connectionFactory_=$,this.retry=K,this.isUsingEmulator=W,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,S)=>{this.resolve_=T,this.reject_=S,this.start_()})}start_(){let T=(T,S)=>{if(S){T(!1,new ex(!1,null,!0));return}let R=this.connectionFactory_();this.pendingConnection_=R;let N=T=>{let S=T.loaded,R=T.lengthComputable?T.total:-1;null!==this.progressCallback_&&this.progressCallback_(S,R)};null!==this.progressCallback_&&R.addUploadProgressListener(N),R.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&R.removeUploadProgressListener(N),this.pendingConnection_=null;let S=R.getErrorCode()===O.NO_ERROR,P=R.getStatus();if(!S||eD(P,this.additionalRetryCodes_)&&this.retry){T(!1,new ex(!1,null,R.getErrorCode()===O.ABORT));return}T(!0,new ex(-1!==this.successCodes_.indexOf(P),R))})},S=(T,S)=>{let R=this.resolve_,N=this.reject_,O=S.connection;if(S.wasSuccessCode)try{let T=this.callback_(O,O.getResponse());eE(T)?R(T):R()}catch(T){N(T)}else if(null!==O){let T=X();T.serverResponse=O.getErrorText(),N(this.errorCallback_?this.errorCallback_(O,T):T)}else N(S.canceled?this.appDelete_?ef():es():ei())};this.canceled_?S(!1,new ex(!1,null,!0)):this.backoffId_=eT(T,S,this.timeout_)}getPromise(){return this.promise_}cancel(T){this.canceled_=!0,this.appDelete_=T||!1,null!==this.backoffId_&&eS(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ex{constructor(T,S,R){this.wasSuccessCode=T,this.connection=S,this.canceled=!!R}}function eP(T,S){null!==S&&S.length>0&&(T.Authorization="Firebase "+S)}function eM(T,S){T["X-Firebase-Storage-Version"]="webjs/"+(null!=S?S:"AppManager")}function eL(T,S){S&&(T["X-Firebase-GMPID"]=S)}function eF(T,S){null!==S&&(T["X-Firebase-AppCheck"]=S)}function eB(T,S,R,N,O,P,M=!0,L=!1){let U=eA(T.urlParams),V=T.url+U,$=Object.assign({},T.headers);return eL($,S),eP($,R),eM($,P),eF($,N),new eO(V,T.method,$,T.body,T.successCodes,T.additionalRetryCodes,T.handler,T.errorHandler,T.timeout,T.progressCallback,O,M,L)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eU(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function eV(...T){let S=eU();if(void 0!==S){let R=new S;for(let S=0;S<T.length;S++)R.append(T[S]);return R.getBlob()}if(eR())return new Blob(T);throw new Q(N.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function ej(T,S,R){return T.webkitSlice?T.webkitSlice(S,R):T.mozSlice?T.mozSlice(S,R):T.slice?T.slice(S,R):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ez(T){if(/[^-A-Za-z0-9+/=]/.test(T))throw eg("base64","Invalid character found");return Buffer.from(T,"base64").toString("binary")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eq={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class eG{constructor(T,S){this.data=T,this.contentType=S||null}}function e$(T,S){switch(T){case eq.RAW:return new eG(eK(S));case eq.BASE64:case eq.BASE64URL:return new eG(eW(T,S));case eq.DATA_URL:return new eG(eY(S),eJ(S))}throw X()}function eK(T){let S=[];for(let R=0;R<T.length;R++){let N=T.charCodeAt(R);N<=127?S.push(N):N<=2047?S.push(192|N>>6,128|63&N):(64512&N)==55296?R<T.length-1&&(64512&T.charCodeAt(R+1))==56320?(N=65536|(1023&N)<<10|1023&T.charCodeAt(++R),S.push(240|N>>18,128|N>>12&63,128|N>>6&63,128|63&N)):S.push(239,191,189):(64512&N)==56320?S.push(239,191,189):S.push(224|N>>12,128|N>>6&63,128|63&N)}return new Uint8Array(S)}function eH(T){let S;try{S=decodeURIComponent(T)}catch(T){throw eg(eq.DATA_URL,"Malformed data URL.")}return eK(S)}function eW(T,S){let R;switch(T){case eq.BASE64:{let R=-1!==S.indexOf("-"),N=-1!==S.indexOf("_");if(R||N)throw eg(T,"Invalid character '"+(R?"-":"_")+"' found: is it base64url encoded?");break}case eq.BASE64URL:{let R=-1!==S.indexOf("+"),N=-1!==S.indexOf("/");if(R||N)throw eg(T,"Invalid character '"+(R?"+":"/")+"' found: is it base64 encoded?");S=S.replace(/-/g,"+").replace(/_/g,"/")}}try{R=ez(S)}catch(S){if(S.message.includes("polyfill"))throw S;throw eg(T,"Invalid character found")}let N=new Uint8Array(R.length);for(let T=0;T<R.length;T++)N[T]=R.charCodeAt(T);return N}class eQ{constructor(T){this.base64=!1,this.contentType=null;let S=T.match(/^data:([^,]+)?,/);if(null===S)throw eg(eq.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let R=S[1]||null;null!=R&&(this.base64=eX(R,";base64"),this.contentType=this.base64?R.substring(0,R.length-7):R),this.rest=T.substring(T.indexOf(",")+1)}}function eY(T){let S=new eQ(T);return S.base64?eW(eq.BASE64,S.rest):eH(S.rest)}function eJ(T){return new eQ(T).contentType}function eX(T,S){return T.length>=S.length&&T.substring(T.length-S.length)===S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eZ{constructor(T,S){let R=0,N="";eI(T)?(this.data_=T,R=T.size,N=T.type):T instanceof ArrayBuffer?(S?this.data_=new Uint8Array(T):(this.data_=new Uint8Array(T.byteLength),this.data_.set(new Uint8Array(T))),R=this.data_.length):T instanceof Uint8Array&&(S?this.data_=T:(this.data_=new Uint8Array(T.length),this.data_.set(T)),R=T.length),this.size_=R,this.type_=N}size(){return this.size_}type(){return this.type_}slice(T,S){if(!eI(this.data_))return new eZ(new Uint8Array(this.data_.buffer,T,S-T),!0);{let R=ej(this.data_,T,S);return null===R?null:new eZ(R)}}static getBlob(...T){if(eR()){let S=T.map(T=>T instanceof eZ?T.data_:T);return new eZ(eV.apply(null,S))}{let S=T.map(T=>eC(T)?e$(eq.RAW,T).data:T.data_),R=0;S.forEach(T=>{R+=T.byteLength});let N=new Uint8Array(R),O=0;return S.forEach(T=>{for(let S=0;S<T.length;S++)N[O++]=T[S]}),new eZ(N,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e0(T){let S;try{S=JSON.parse(T)}catch(T){return null}return ew(S)?S:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e1(T){if(0===T.length)return null;let S=T.lastIndexOf("/");return -1===S?"":T.slice(0,S)}function e2(T,S){let R=S.split("/").filter(T=>T.length>0).join("/");return 0===T.length?R:T+"/"+R}function e3(T){let S=T.lastIndexOf("/",T.length-2);return -1===S?T:T.slice(S+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e4(T,S){return S}class e6{constructor(T,S,R,N){this.server=T,this.local=S||T,this.writable=!!R,this.xform=N||e4}}let e9=null;function e5(T){return!eC(T)||T.length<2?T:e3(T)}function e8(){if(e9)return e9;let T=[];function S(T,S){return e5(S)}T.push(new e6("bucket")),T.push(new e6("generation")),T.push(new e6("metageneration")),T.push(new e6("name","fullPath",!0));let R=new e6("name");function N(T,S){return void 0!==S?Number(S):S}R.xform=S,T.push(R);let O=new e6("size");return O.xform=N,T.push(O),T.push(new e6("timeCreated")),T.push(new e6("updated")),T.push(new e6("md5Hash",null,!0)),T.push(new e6("cacheControl",null,!0)),T.push(new e6("contentDisposition",null,!0)),T.push(new e6("contentEncoding",null,!0)),T.push(new e6("contentLanguage",null,!0)),T.push(new e6("contentType",null,!0)),T.push(new e6("metadata","customMetadata",!0)),e9=T}function e7(T,S){function R(){let R=new ev(T.bucket,T.fullPath);return S._makeStorageReference(R)}Object.defineProperty(T,"ref",{get:R})}function te(T,S,R){let N={};N.type="file";let O=R.length;for(let T=0;T<O;T++){let O=R[T];N[O.local]=O.xform(N,S[O.server])}return e7(N,T),N}function tt(T,S,R){let N=e0(S);return null===N?null:te(T,N,R)}function tr(T,S,R,N){let O=e0(S);if(null===O||!eC(O.downloadTokens))return null;let P=O.downloadTokens;if(0===P.length)return null;let M=encodeURIComponent;return P.split(",").map(S=>{let O=T.bucket,P=T.fullPath;return eN("/b/"+M(O)+"/o/"+M(P),R,N)+eA({alt:"media",token:S})})[0]}function ti(T,S){let R={},N=S.length;for(let O=0;O<N;O++){let N=S[O];N.writable&&(R[N.server]=T[N.local])}return JSON.stringify(R)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ts="prefixes",ta="items";function tl(T,S,R){let N={prefixes:[],items:[],nextPageToken:R.nextPageToken};if(R[ts])for(let O of R[ts]){let R=O.replace(/\/$/,""),P=T._makeStorageReference(new ev(S,R));N.prefixes.push(P)}if(R[ta])for(let O of R[ta]){let R=T._makeStorageReference(new ev(S,O.name));N.items.push(R)}return N}function tu(T,S,R){let N=e0(R);return null===N?null:tl(T,S,N)}class tc{constructor(T,S,R,N){this.url=T,this.method=S,this.handler=R,this.timeout=N,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(T){if(!T)throw X()}function th(T,S){return function(R,N){let O=tt(T,N,S);return td(null!==O),O}}function tp(T,S){return function(R,N){let O=tu(T,S,N);return td(null!==O),O}}function tf(T,S){return function(R,N){let O=tt(T,N,S);return td(null!==O),tr(O,N,T.host,T._protocol)}}function tm(T){return function(S,R){let N;return(N=401===S.getStatus()?S.getErrorText().includes("Firebase App Check token is invalid")?er():et():402===S.getStatus()?ee(T.bucket):403===S.getStatus()?en(T.path):R).status=S.getStatus(),N.serverResponse=R.serverResponse,N}}function tg(T){let S=tm(T);return function(R,N){let O=S(R,N);return 404===R.getStatus()&&(O=Z(T.path)),O.serverResponse=N.serverResponse,O}}function ty(T,S,R){let N=eN(S.fullServerUrl(),T.host,T._protocol),O="GET",P=T.maxOperationRetryTime,M=new tc(N,O,th(T,R),P);return M.errorHandler=tg(S),M}function tv(T,S,R,N,O){let P={};S.isRoot?P.prefix="":P.prefix=S.path+"/",R&&R.length>0&&(P.delimiter=R),N&&(P.pageToken=N),O&&(P.maxResults=O);let M=eN(S.bucketOnlyServerUrl(),T.host,T._protocol),L="GET",U=T.maxOperationRetryTime,V=new tc(M,L,tp(T,S.bucket),U);return V.urlParams=P,V.errorHandler=tm(S),V}function tb(T,S,R){let N=eN(S.fullServerUrl(),T.host,T._protocol),O="GET",P=T.maxOperationRetryTime,M=new tc(N,O,tf(T,R),P);return M.errorHandler=tg(S),M}function tT(T,S){return T&&T.contentType||S&&S.type()||"application/octet-stream"}function tS(T,S,R){let N=Object.assign({},R);return N.fullPath=T.path,N.size=S.size(),N.contentType||(N.contentType=tT(null,S)),N}function tE(T,S,R,N,O){let P=S.bucketOnlyServerUrl(),M={"X-Goog-Upload-Protocol":"multipart"},L=function(){let T="";for(let S=0;S<2;S++)T+=Math.random().toString().slice(2);return T}();M["Content-Type"]="multipart/related; boundary="+L;let U=tS(S,N,O),V="--"+L+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ti(U,R)+"\r\n--"+L+"\r\nContent-Type: "+U.contentType+"\r\n\r\n",$="\r\n--"+L+"--",K=eZ.getBlob(V,N,$);if(null===K)throw ec();let W={name:U.fullPath},Q=eN(P,T.host,T._protocol),Y="POST",X=T.maxUploadRetryTime,Z=new tc(Q,Y,th(T,R),X);return Z.urlParams=W,Z.headers=M,Z.body=K.uploadData(),Z.errorHandler=tm(S),Z}class t_{constructor(T,S,R,N){this.current=T,this.total=S,this.finalized=!!R,this.metadata=N||null}}function tw(T,S){let R=null;try{R=T.getResponseHeader("X-Goog-Upload-Status")}catch(T){td(!1)}let N=S||["active"];return td(!!R&&-1!==N.indexOf(R)),R}function tC(T,S,R,N,O){let P=S.bucketOnlyServerUrl(),M=tS(S,N,O),L={name:M.fullPath},U=eN(P,T.host,T._protocol),V="POST",$={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${N.size()}`,"X-Goog-Upload-Header-Content-Type":M.contentType,"Content-Type":"application/json; charset=utf-8"},K=ti(M,R),W=new tc(U,V,function(T){let S;tw(T);try{S=T.getResponseHeader("X-Goog-Upload-URL")}catch(T){td(!1)}return td(eC(S)),S},T.maxUploadRetryTime);return W.urlParams=L,W.headers=$,W.body=K,W.errorHandler=tm(S),W}function tI(T,S,R,N){let O={"X-Goog-Upload-Command":"query"},P=new tc(R,"POST",function(T){let S=tw(T,["active","final"]),R=null;try{R=T.getResponseHeader("X-Goog-Upload-Size-Received")}catch(T){td(!1)}R||td(!1);let O=Number(R);return td(!isNaN(O)),new t_(O,N.size(),"final"===S)},T.maxUploadRetryTime);return P.headers=O,P.errorHandler=tm(S),P}let tR=null;function tk(T,S,R,N,O,P,M,L){let U=new t_(0,0);if(M?(U.current=M.current,U.total=M.total):(U.current=0,U.total=N.size()),N.size()!==U.total)throw ed();let V=U.total-U.current,$=V;O>0&&($=Math.min($,O));let K=U.current,W=K+$,Q="",Y={"X-Goog-Upload-Command":Q=0===$?"finalize":V===$?"upload, finalize":"upload","X-Goog-Upload-Offset":`${U.current}`},X=N.slice(K,W);if(null===X)throw ec();let Z=new tc(R,"POST",function(T,R){let O;let M=tw(T,["active","final"]),L=U.current+$,V=N.size();return O="final"===M?th(S,P)(T,R):null,new t_(L,V,"final"===M,O)},S.maxUploadRetryTime);return Z.headers=Y,Z.body=X.uploadData(),Z.progressCallback=L||null,Z.errorHandler=tm(T),Z}let tN={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function tA(T){switch(T){case"running":case"pausing":case"canceling":return tN.RUNNING;case"paused":return tN.PAUSED;case"success":return tN.SUCCESS;case"canceled":return tN.CANCELED;default:return tN.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(T,S,R){if(e_(T)||null!=S||null!=R)this.next=T,this.error=null!=S?S:void 0,this.complete=null!=R?R:void 0;else{let S=T;this.next=S.next,this.error=S.error,this.complete=S.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tO(T){return(...S)=>{Promise.resolve().then(()=>T(...S))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tP=null;class tM{constructor(){this.errorText_="",this.sent_=!1,this.errorCode_=O.NO_ERROR}async send(T,S,R,N,P){if(this.sent_)throw ey("cannot .send() more than once");this.sent_=!0;try{let M=await tV(T,S,R,P,N);this.headers_=M.headers,this.statusCode_=M.status,this.errorCode_=O.NO_ERROR,this.body_=await M.arrayBuffer()}catch(T){this.errorText_=null==T?void 0:T.message,this.statusCode_=0,this.errorCode_=O.NETWORK_ERROR}}getErrorCode(){if(void 0===this.errorCode_)throw ey("cannot .getErrorCode() before receiving response");return this.errorCode_}getStatus(){if(void 0===this.statusCode_)throw ey("cannot .getStatus() before receiving response");return this.statusCode_}getErrorText(){return this.errorText_}abort(){}getResponseHeader(T){if(!this.headers_)throw ey("cannot .getResponseHeader() before receiving response");return this.headers_.get(T)}addUploadProgressListener(T){}removeUploadProgressListener(T){}}class tL extends tM{getResponse(){if(!this.body_)throw ey("cannot .getResponse() before receiving response");return Buffer.from(this.body_).toString("utf-8")}}function tF(){return tP?tP():new tL}class tB extends null{getResponse(){if(!this.body_)throw ey("cannot .getResponse() before sending");return this.body_}}class tU extends null{constructor(){super(...arguments),this.stream_=null}async send(T,S,R,N,P){if(this.sent_)throw ey("cannot .send() more than once");this.sent_=!0;try{let M=await tV(T,S,R,P,N);this.headers_=M.headers,this.statusCode_=M.status,this.errorCode_=O.NO_ERROR,this.stream_=M.body}catch(T){this.errorText_=null==T?void 0:T.message,this.statusCode_=0,this.errorCode_=O.NETWORK_ERROR}}getResponse(){if(!this.stream_)throw ey("cannot .getResponse() before sending");return this.stream_}}function tV(T,S,R,N,O){let P={method:S,headers:N||{},body:O};return(0,M.Xx)(T)&&R&&(P.credentials="include"),fetch(T,P)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(T,S){this._service=T,S instanceof ev?this._location=S:this._location=ev.makeFromUrl(S,T.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(T,S){return new tj(T,S)}get root(){let T=new ev(this._location.bucket,"");return this._newRef(this._service,T)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return e3(this._location.path)}get storage(){return this._service}get parent(){let T=e1(this._location.path);if(null===T)return null;let S=new ev(this._location.bucket,T);return new tj(this._service,S)}_throwIfRoot(T){if(""===this._location.path)throw em(T)}}function tz(T,S,R){T._throwIfRoot("uploadBytes");let N=tE(T.storage,T._location,e8(),new eZ(S,!0),R);return T.storage.makeRequestWithTokens(N,tF).then(S=>({metadata:S,ref:T}))}function tq(T,S){null!=S&&"number"==typeof S.maxResults&&ek("options.maxResults",1,1e3,S.maxResults);let R=S||{},N=tv(T.storage,T._location,"/",R.pageToken,R.maxResults);return T.storage.makeRequestWithTokens(N,tF)}function tG(T){T._throwIfRoot("getDownloadURL");let S=tb(T.storage,T._location,e8());return T.storage.makeRequestWithTokens(S,tF).then(T=>{if(null===T)throw eh();return T})}function t$(T,S){let R=e2(T._location.path,S),N=new ev(T._location.bucket,R);return new tj(T.storage,N)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tK(T){return/^[A-Za-z]+:\/\//.test(T)}function tH(T,S){return new tj(T,S)}function tW(T,S){if(T instanceof tX){let R=T;if(null==R._bucket)throw eu();let N=new tj(R,R._bucket);return null!=S?tW(N,S):N}return void 0!==S?t$(T,S):T}function tQ(T,S){if(!(S&&tK(S)))return tW(T,S);if(T instanceof tX)return tH(T,S);throw ep("To use ref(service, url), the first argument must be a Storage instance.")}function tY(T,S){let R=null==S?void 0:S[V];return null==R?null:ev.makeFromBucketSpec(R,T)}function tJ(T,S,R,N={}){T.host=`${S}:${R}`;let O=(0,M.Xx)(S);O&&((0,M.Uo)(`https://${T.host}/b`),(0,M.dp)("Storage",!0)),T._isUsingEmulator=!0,T._protocol=O?"https":"http";let{mockUserToken:P}=N;P&&(T._overrideAuthToken="string"==typeof P?P:(0,M.Sg)(P,T.app.options.projectId))}class tX{constructor(T,S,R,N,O,P=!1){this.app=T,this._authProvider=S,this._appCheckProvider=R,this._url=N,this._firebaseVersion=O,this._isUsingEmulator=P,this._bucket=null,this._host=U,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$,this._maxUploadRetryTime=K,this._requests=new Set,null!=N?this._bucket=ev.makeFromBucketSpec(N,this._host):this._bucket=tY(this._host,this.app.options)}get host(){return this._host}set host(T){this._host=T,null!=this._url?this._bucket=ev.makeFromBucketSpec(this._url,T):this._bucket=tY(T,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(T){ek("time",0,Number.POSITIVE_INFINITY,T),this._maxUploadRetryTime=T}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(T){ek("time",0,Number.POSITIVE_INFINITY,T),this._maxOperationRetryTime=T}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let T=this._authProvider.getImmediate({optional:!0});if(T){let S=await T.getToken();if(null!==S)return S.accessToken}return null}async _getAppCheckToken(){if((0,P.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let T=this._appCheckProvider.getImmediate({optional:!0});return T?(await T.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(T=>T.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(T){return new tj(this,T)}_makeRequest(T,S,R,N,O=!0){if(this._deleted)return new eb(ef());{let P=eB(T,this._appId,R,N,S,this._firebaseVersion,O,this._isUsingEmulator);return this._requests.add(P),P.getPromise().then(()=>this._requests.delete(P),()=>this._requests.delete(P)),P}}async makeRequestWithTokens(T,S){let[R,N]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(T,S,R,N).getPromise()}}let tZ="@firebase/storage",t0="0.13.14",t1="storage";function t2(T,S,R){return tz(T=(0,M.m9)(T),S,R)}function t3(T){return tG(T=(0,M.m9)(T))}function t4(T,S){return tQ(T=(0,M.m9)(T),S)}function t6(T=(0,P.Mq)(),S){T=(0,M.m9)(T);let R=(0,P.qX)(T,t1).getImmediate({identifier:S}),N=(0,M.P0)("storage");return N&&t9(R,...N),R}function t9(T,S,R,N={}){tJ(T,S,R,N)}function t5(T,{instanceIdentifier:S}){return new tX(T.getProvider("app").getImmediate(),T.getProvider("auth-internal"),T.getProvider("app-check-internal"),S,P.Jn)}(function(){(0,P.Xd)(new L.wA(t1,t5,"PUBLIC").setMultipleInstances(!0)),(0,P.KN)(tZ,t0)})()},81513:T=>{"use strict";T.exports={i8:"1.9.15"}},56541:T=>{"use strict";T.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},89987:T=>{"use strict";T.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],"php_generic_services",[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},57674:T=>{"use strict";T.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},73795:T=>{"use strict";T.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};