(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9801],{3178:function(e,t,s){Promise.resolve().then(s.bind(s,2184))},2184:function(e,t,s){"use strict";s.r(t);var a=s(6687),n=s(5029),r=s(8965),i=s(4670),l=s(44),d=s(7437),o=s(2265),c=s(4033),u=s(7972),m=s(5883),x=s(4322),h=s(3008),g=s(4822),f=s(2245),p=s(2741),y=s(2682),v=s(286),b=s(4499),j=s(5853);t.default=function(){var e,t,s,N,w,_,k,C,O,S,T,R=(0,c.useRouter)(),L=(0,i._)((0,o.useState)(null),2),D=L[0],P=L[1],Z=(0,i._)((0,o.useState)(null),2),A=Z[0],I=Z[1],z=(0,i._)((0,o.useState)([]),2),E=z[0],G=z[1],J=(0,i._)((0,o.useState)(null),2),U=J[0],M=J[1],Y=(0,i._)((0,o.useState)({totalDeliveries:0,completedToday:0,earnings:0,rating:5}),2),q=Y[0];Y[1];var H=(0,i._)((0,o.useState)(!1),2),W=H[0],B=H[1],F=(0,i._)((0,o.useState)(null),2),K=F[0],Q=F[1],V=(0,i._)((0,o.useState)(!0),2),X=V[0],$=V[1],ee=(0,o.useRef)(null),et=(0,j.useToast)().showToast,es=(0,o.useRef)(null);(0,o.useEffect)(function(){if(!(0,b.isRiderLoggedIn)()){R.push("/rider/auth/login");return}var e,t=(0,b.getCurrentRider)();return P(t),B((null==t?void 0:t.status)==="online"),(null==t?void 0:t.id)?e=(0,b.subscribeToRiderOrders)(t.id,function(e){var t=e.find(function(e){return["assigned","picked_up","out_for_delivery"].includes(e.status)}),s=e.filter(function(e){return!["assigned","picked_up","out_for_delivery"].includes(e.status)}).slice(0,10);I(t||null),G(s),t?(0,b.subscribeToOrderTracking)(t.id,function(e){M(e)}):M(null),$(!1)}):$(!1),function(){e&&e()}},[R]),(0,o.useEffect)(function(){return W&&D&&D.id?navigator.geolocation?(navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};(0,b.updateRiderLocation)(D.id,t)},function(e){alert("Location permission denied. Please enable location sharing to receive orders and update your location."),B(!1)},{enableHighAccuracy:!0}),ee.current=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};(0,b.updateRiderLocation)(D.id,t)},function(e){alert("Location update failed. Please check your device settings."),B(!1)},{enableHighAccuracy:!0})},1e4)):(alert("Geolocation is not supported by your browser."),B(!1)):ee.current&&(clearInterval(ee.current),ee.current=null),function(){ee.current&&(clearInterval(ee.current),ee.current=null)}},[W,D&&D.id]),(0,o.useEffect)(function(){A&&A.status&&(es.current&&es.current!==A.status&&et("Order status updated: ".concat(A.status.replace("_"," ")),"info"),es.current=A.status)},[null==A?void 0:A.status]);var ea=(e=(0,a._)(function(){var e,t;return(0,l.Jh)(this,function(s){switch(s.label){case 0:if(!D||!D.id)return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),e=W?"offline":"online",[4,(0,b.updateRiderStatus)(D.id,e)];case 2:return s.sent(),B(!W),P(t=(0,r._)((0,n._)({},D),{status:e})),localStorage.setItem("currentRider",JSON.stringify(t)),[3,4];case 3:return s.sent(),[3,4];case 4:return[2]}})}),function(){return e.apply(this,arguments)}),en=(t=(0,a._)(function(e){return(0,l.Jh)(this,function(t){switch(t.label){case 0:if(Q(e),!(null==D?void 0:D.id))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(0,b.updateRiderLocation)(D.id,e)];case 2:case 3:return t.sent(),[3,4];case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),er=(s=(0,a._)(function(e){var t;return(0,l.Jh)(this,function(s){switch(s.label){case 0:if(!A||!(null==D?void 0:D.id))return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),t={location:K,note:"Order ".concat(e.replace("_"," ")," by rider")},"delivered"===e&&(t.deliveryProof={type:"photo",url:"placeholder-proof-url",timestamp:new Date}),[4,(0,b.updateOrderStatusWithRider)(A.id,e,t)];case 2:case 3:return s.sent(),[3,4];case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),ei=function(){var e;if(null==A?void 0:null===(e=A.address)||void 0===e?void 0:e.coordinates){var t=A.address.coordinates,s=t.lat,a=t.lng,n="https://www.google.com/maps/dir/?api=1&destination=".concat(s,",").concat(a,"&travelmode=driving");window.open(n,"_blank")}};return(A&&(null==U||U.riderLocation),X)?(0,d.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Loading dashboard..."})]})}):(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,d.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,d.jsx)("div",{className:"max-w-md mx-auto px-4 py-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,d.jsx)(u.Z,{className:"w-6 h-6 text-green-600"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"font-semibold text-gray-900",children:null==D?void 0:D.name}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:null==D?void 0:D.vehicle})]})]}),(0,d.jsx)("button",{onClick:function(){localStorage.removeItem("currentRider"),R.push("/rider/auth/login")},className:"p-2 text-gray-400 hover:text-gray-600",children:(0,d.jsx)(m.Z,{className:"w-5 h-5"})})]})})}),(0,d.jsxs)("div",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[(0,d.jsx)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(W?"bg-green-500":"bg-gray-400")}),(0,d.jsx)("span",{className:"font-medium text-gray-900",children:W?"You are Online":"You are Offline"})]}),(0,d.jsx)("button",{onClick:ea,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(W?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:W?"Go Offline":"Go Online"})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(x.Z,{className:"w-5 h-5 text-blue-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Total Orders"})]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:q.totalDeliveries})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(h.Z,{className:"w-5 h-5 text-green-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Today"})]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:q.completedToday})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(g.Z,{className:"w-5 h-5 text-purple-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Earnings"})]}),(0,d.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["₹",q.earnings]})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(f.Z,{className:"w-5 h-5 text-yellow-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-600",children:"Rating"})]}),(0,d.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:q.rating})]})]}),A?(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,d.jsxs)("div",{className:"p-4 border-b",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("h2",{className:"font-semibold text-gray-900",children:"Active Order"}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("assigned"===A.status?"bg-blue-100 text-blue-700":"picked_up"===A.status?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),children:A.status.replace("_"," ").toUpperCase()})]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["#",A.orderNumber]})]}),(0,d.jsxs)("div",{className:"p-4 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"font-medium text-gray-900",children:A.customerName||"Customer"}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:(null===(N=A.address)||void 0===N?void 0:N.street)||(null===(w=A.address)||void 0===w?void 0:w.addressLine1)||(null===(_=A.address)||void 0===_?void 0:_.addressLine2)||(null===(k=A.address)||void 0===k?void 0:k.landmark)||(null===(C=A.address)||void 0===C?void 0:C.city)||(null===(O=A.address)||void 0===O?void 0:O.state)||"Address not available"}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:(null===(S=A.address)||void 0===S?void 0:S.city)||(null===(T=A.address)||void 0===T?void 0:T.state)||""})]}),(0,d.jsx)("button",{onClick:function(){return window.open("tel:".concat(A.customerPhone))},className:"p-2 bg-green-100 text-green-600 rounded-full hover:bg-green-200",children:(0,d.jsx)(p.Z,{className:"w-5 h-5"})})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Items (",A.items.length,")"]}),A.items.slice(0,3).map(function(e,t){var s=e.quantity||e.qty||1;return(0,d.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,d.jsxs)("span",{className:"text-gray-600",children:[s,"x ",e.name]}),(0,d.jsxs)("span",{className:"text-gray-900",children:["₹",e.price*s]})]},t)}),A.items.length>3&&(0,d.jsxs)("p",{className:"text-sm text-gray-500",children:["+",A.items.length-3," more items"]}),(0,d.jsxs)("div",{className:"border-t pt-2 flex justify-between font-medium",children:[(0,d.jsx)("span",{children:"Total Amount"}),(0,d.jsxs)("span",{children:["₹",A.totalAmount||A.total||0]})]})]}),U&&(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("h3",{className:"font-medium text-gray-900",children:"Live Tracking"}),(0,d.jsx)(v.Z,{orderId:A.id,trackingData:U,mode:"rider",height:"200px",onLocationUpdate:en,onDirectionsClick:ei})]}),(0,d.jsxs)("div",{className:"space-y-2",children:["assigned"===A.status&&(0,d.jsx)("button",{onClick:function(){return er("picked_up")},className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700",children:"Mark as Picked Up"}),"picked_up"===A.status&&(0,d.jsx)("button",{onClick:function(){return er("out_for_delivery")},className:"w-full bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700",children:"Start Delivery"}),"out_for_delivery"===A.status&&(0,d.jsx)("button",{onClick:function(){return er("delivered")},className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700",children:"Mark as Delivered"}),(0,d.jsxs)("button",{onClick:ei,className:"w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 flex items-center justify-center gap-2",children:[(0,d.jsx)(y.Z,{className:"w-5 h-5"}),"Open in Maps"]})]})]})]}):(0,d.jsxs)("div",{className:"bg-white rounded-lg p-8 text-center shadow-sm",children:[(0,d.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,d.jsx)(x.Z,{className:"w-8 h-8 text-gray-400"})}),(0,d.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No Active Orders"}),(0,d.jsx)("p",{className:"text-gray-600 text-sm",children:W?"You'll receive new orders when available":"Go online to start receiving orders"})]}),E.length>0&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,d.jsx)("div",{className:"p-4 border-b",children:(0,d.jsx)("h2",{className:"font-semibold text-gray-900",children:"Recent Orders"})}),(0,d.jsx)("div",{className:"divide-y",children:E.map(function(e){return(0,d.jsxs)("div",{className:"p-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsxs)("span",{className:"font-medium text-gray-900",children:["#",e.orderNumber]}),(0,d.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("delivered"===e.status?"bg-green-100 text-green-700":"cancelled"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:e.status.toUpperCase()})]}),(0,d.jsx)("p",{className:"text-sm text-gray-600",children:e.customerName}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["₹",e.totalAmount]}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()})]},e.id)})})]})]})]})}},5853:function(e,t,s){"use strict";s.r(t),s.d(t,{ToastProvider:function(){return u},useToast:function(){return c}});var a=s(4670),n=s(1801),r=s(7437),i=s(9102),l=s.n(i),d=s(2265),o=(0,d.createContext)({showToast:function(){}}),c=function(){return(0,d.useContext)(o)},u=function(e){var t=e.children,s=(0,a._)((0,d.useState)([]),2),i=s[0],c=s[1];return(0,r.jsxs)(o.Provider,{value:{showToast:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=Date.now();c(function(a){return(0,n._)(a).concat([{id:s,message:e,type:t}])}),setTimeout(function(){c(function(e){return e.filter(function(e){return e.id!==s})})},3500)}},children:[t,(0,r.jsx)("div",{className:"jsx-8325a2722a98286e fixed top-4 right-4 z-50 space-y-2",children:i.map(function(e){return(0,r.jsx)("div",{className:"jsx-8325a2722a98286e "+"px-4 py-3 rounded-lg shadow-lg text-white font-medium transition-all animate-fade-in-down\n              ".concat("success"===e.type?"bg-green-600":"error"===e.type?"bg-red-600":"bg-gray-800"),children:e.message},e.id)})}),(0,r.jsx)(l(),{id:"8325a2722a98286e",children:"@-webkit-keyframes fade-in-down{0%{opacity:0;-webkit-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fade-in-down{0%{opacity:0;-moz-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fade-in-down{0%{opacity:0;-o-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fade-in-down{0%{opacity:0;-webkit-transform:translatey(-20px);-moz-transform:translatey(-20px);-o-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-fade-in-down{-webkit-animation:fade-in-down.4s ease;-moz-animation:fade-in-down.4s ease;-o-animation:fade-in-down.4s ease;animation:fade-in-down.4s ease}"})]})}}},function(e){e.O(0,[4358,9990,5643,6569,112,4499,286,2971,4938,1744],function(){return e(e.s=3178)}),_N_E=e.O()}]);