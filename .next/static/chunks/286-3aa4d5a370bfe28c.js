"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{286:function(e,t,n){var s=n(6687),r=n(4670),a=n(44),i=n(7437),l=n(2265),o=n(4322),c=n(1961),d=n(2682),u=n(3008),m=n(6141),g=n(6142),x=n(6264),h=n(2741),f=n(9235);t.Z=function(e){e.orderId;var t,n=e.trackingData,p=e.mode,w=e.height,v=void 0===w?"400px":w,b=e.showControls,j=e.showRoute,N=void 0===j||j,y=e.onLocationUpdate,k=(e.onDirectionsClick,e.riderInfo),L=e.customerAddress,C=(0,l.useRef)(null),_=(0,l.useRef)(null),M=(0,l.useRef)(null),Z=(0,l.useRef)(null),D=(0,l.useRef)(null),A=(0,l.useRef)(null),S=(0,l.useRef)(null),E=(0,r._)((0,l.useState)(!0),2),R=E[0],I=E[1],z=(0,r._)((0,l.useState)(null),2),T=z[0],B=z[1],F=(0,r._)((0,l.useState)(null),2),O=(F[0],F[1]),P=(0,r._)((0,l.useState)(!1),2),V=P[0],W=P[1],G=(0,r._)((0,l.useState)(!1),2),H=G[0],K=G[1],U=(0,r._)((0,l.useState)(null),2),X=U[0],J=U[1],Y=(0,r._)((0,l.useState)(null),2),q=Y[0],Q=Y[1],$=(0,l.useCallback)(function(){if(!_.current){if(!C.current||!window.google){B("Map container not available");return}try{var e={zoom:14,center:{lat:28.6139,lng:77.209},mapTypeControl:!1,streetViewControl:!1,fullscreenControl:"admin"===p};e.mapId="377229b98af3c169e073c4d1",_.current=new window.google.maps.Map(C.current,e),D.current=new window.google.maps.DirectionsService,A.current=new window.google.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:"#10B981",strokeWeight:4,strokeOpacity:.8}}),A.current.setMap(_.current),I(!1),"rider"===p&&et(),n&&ea(n)}catch(e){B("Failed to initialize map"),I(!1)}}},[p,n]),ee=(0,l.useCallback)(function(){new f.aN({apiKey:"AIzaSyDIHawXZZfiYMhBUznsnbXS0LOId9u5FLA",version:"weekly",libraries:["geometry","places","marker"]}).load().then(function(){$()}).catch(function(){return B("Failed to load Google Maps")})},[$]),et=(0,l.useCallback)(function(){navigator.geolocation&&(W(!0),S.current=navigator.geolocation.watchPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};O(t),y&&y(t),M.current?M.current.position=t:en(t),_.current&&_.current.setCenter(t)},function(e){W(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4}))},[y]);(0,l.useCallback)(function(){S.current&&(navigator.geolocation.clearWatch(S.current),S.current=null),W(!1)},[]);var en=(0,l.useCallback)(function(e){if(_.current&&window.google&&e){M.current&&(M.current.map=null);var t,n=window.google.maps.marker.AdvancedMarkerElement;if(M.current=new n({map:_.current,position:e,title:"Delivery Partner",content:((t=document.createElement("div")).innerHTML='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="14" fill="#10B981" stroke="#ffffff" stroke-width="3"/><path d="M10 16L14 20L22 12" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',t)}),k&&"rider"!==p){var s=new window.google.maps.InfoWindow({content:'\n          <div class="p-3 min-w-[200px]">\n            <div class="flex items-center gap-3 mb-2">\n              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">\n                <svg width="20" height="20" fill="currentColor" class="text-green-600">\n                  <path d="M8 16l2.879-2.879a3 3 0 114.242 4.242L8 24l-7.121-7.121a3 3 0 114.242-4.242L8 16z"/>\n                </svg>\n              </div>\n              <div>\n                <h4 class="font-semibold text-gray-900">'.concat(k.name,'</h4>\n                <p class="text-sm text-gray-600">').concat(k.vehicle,'</p>\n              </div>\n            </div>\n            <div class="flex items-center justify-between">\n              <div class="flex items-center gap-1">\n                <span class="text-yellow-400">‚≠ê</span>\n                <span class="text-sm font-medium">').concat(k.rating,"</span>\n              </div>\n              <button onclick=\"window.open('tel:").concat(k.phone,'\')" \n                class="bg-green-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1">\n                <svg width="14" height="14" fill="currentColor">\n                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>\n                </svg>\n                Call\n              </button>\n            </div>\n          </div>\n        ')});M.current.addListener("click",function(){s.open(_.current,M.current)})}}},[k,p]),es=(0,l.useCallback)(function(e){if(_.current&&window.google&&e){Z.current&&(Z.current.map=null);var t,n=window.google.maps.marker.AdvancedMarkerElement;Z.current=new n({map:_.current,position:e,title:"Delivery Address",content:((t=document.createElement("div")).innerHTML='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="14" fill="#EF4444" stroke="#ffffff" stroke-width="3"/><path d="M16 8v8l4 4" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',t)})}},[]),er=(0,l.useCallback)(function(e,t){D.current&&A.current&&e&&t&&D.current.route({origin:e,destination:t,travelMode:window.google.maps.TravelMode.DRIVING,optimizeWaypoints:!0},function(e,t){"OK"===t&&A.current.setDirections(e)})},[]),ea=(0,l.useCallback)(function(e){if(_.current&&(e.riderLocation&&en(e.riderLocation),e.customerLocation&&es(e.customerLocation),e.riderLocation&&e.customerLocation&&N&&er(e.riderLocation,e.customerLocation),e.riderLocation||e.customerLocation)){var t=new window.google.maps.LatLngBounds;e.riderLocation&&t.extend(e.riderLocation),e.customerLocation&&t.extend(e.customerLocation),_.current.fitBounds(t),window.google.maps.event.addListenerOnce(_.current,"bounds_changed",function(){_.current.getZoom()>16&&_.current.setZoom(16)})}},[N,en,es,er]),ei=(t=(0,s._)(function(){return(0,a.Jh)(this,function(e){if(Q(null),J(null),!window.google||!(null==n?void 0:n.riderLocation)||!(null==n?void 0:n.customerLocation))return Q("Location data missing for navigation."),[2];try{new window.google.maps.DirectionsService().route({origin:n.riderLocation,destination:n.customerLocation,travelMode:window.google.maps.TravelMode.DRIVING},function(e,t){if("OK"===t&&e){var n,s,r=e.routes[0].legs[0];J({eta:(null===(n=r.duration)||void 0===n?void 0:n.text)||"N/A",distance:(null===(s=r.distance)||void 0===s?void 0:s.text)||"N/A"})}else Q("Could not calculate route. Please try again.")})}catch(e){Q("Could not calculate route. Please try again.")}return[2]})}),function(){return t.apply(this,arguments)});return((0,l.useEffect)(function(){return C.current&&ee(),function(){S.current&&navigator.geolocation.clearWatch(S.current)}},[]),(0,l.useEffect)(function(){n&&_.current&&ea(n)},[n,ea]),T)?(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8 text-center",style:{height:v},children:[(0,i.jsx)("div",{className:"text-red-600 mb-2",children:(0,i.jsx)(g.Z,{className:"w-8 h-8 mx-auto"})}),(0,i.jsx)("p",{className:"text-red-700 font-medium",children:"Map Error"}),(0,i.jsx)("p",{className:"text-red-600 text-sm mt-1",children:T})]}):n&&(n.riderLocation||n.customerLocation)?(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("div",{ref:C,className:"w-full rounded-lg border border-gray-200",style:{height:v}}),R&&(0,i.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)(x.Z,{className:"w-8 h-8 animate-spin text-green-600 mx-auto mb-2"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Loading map..."})]})}),(void 0===b||b)&&n&&(0,i.jsx)("div",{className:"absolute top-4 left-4 right-4 bg-white rounded-lg shadow-lg p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"p-2 rounded-full ".concat(function(e){switch(e){case"assigned":return"text-blue-600 bg-blue-100";case"picked_up":return"text-orange-600 bg-orange-100";case"out_for_delivery":return"text-green-600 bg-green-100";case"delivered":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}}(n.status)),children:function(e){switch(e){case"assigned":return(0,i.jsx)(o.Z,{className:"w-4 h-4"});case"picked_up":return(0,i.jsx)(c.Z,{className:"w-4 h-4"});case"out_for_delivery":return(0,i.jsx)(d.Z,{className:"w-4 h-4"});case"delivered":return(0,i.jsx)(u.Z,{className:"w-4 h-4"});default:return(0,i.jsx)(m.Z,{className:"w-4 h-4"})}}(n.status)}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold text-gray-900 capitalize",children:n.status.replace("_"," ")}),n.estimatedArrival&&(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:["ETA: ",new Date(n.estimatedArrival).toLocaleTimeString()]})]})]}),"rider"===p&&(0,i.jsxs)("button",{onClick:function(){K(!0),ei()},className:"bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition-colors",children:[(0,i.jsx)(d.Z,{className:"w-4 h-4"}),"Directions"]})]})}),"rider"===p&&H&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-sm w-full relative",children:[(0,i.jsx)("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",onClick:function(){return K(!1)},children:(0,i.jsx)("span",{className:"text-xl",children:"\xd7"})}),(0,i.jsxs)("h2",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[(0,i.jsx)(d.Z,{className:"w-5 h-5"})," Directions"]}),(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Customer Address"}),(0,i.jsx)("div",{className:"text-sm text-gray-900 font-medium",children:L||"Address not available"})]}),q&&(0,i.jsx)("div",{className:"text-red-600 text-sm mb-2",children:q}),X?(0,i.jsx)("div",{className:"mb-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[(0,i.jsx)("span",{children:"ETA:"}),(0,i.jsx)("span",{className:"font-semibold",children:X.eta}),(0,i.jsx)("span",{children:"‚Ä¢"}),(0,i.jsx)("span",{children:"Distance:"}),(0,i.jsx)("span",{className:"font-semibold",children:X.distance})]})}):!q&&(0,i.jsx)("div",{className:"text-gray-500 text-sm mb-2",children:"Calculating route..."}),(0,i.jsxs)("button",{className:"w-full mt-3 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-60",onClick:function(){if(null==n?void 0:n.customerLocation){var e=n.customerLocation,t=e.lat,s=e.lng,r="https://www.google.com/maps/dir/?api=1&destination=".concat(t,",").concat(s,"&travelmode=driving");window.open(r,"_blank")}},disabled:!!q||!X,children:[(0,i.jsx)(d.Z,{className:"w-5 h-5"})," Start Navigation"]})]})}),"rider"===p&&(0,i.jsx)("div",{className:"absolute bottom-4 left-4",children:(0,i.jsx)("div",{className:"px-3 py-2 rounded-lg shadow-lg ".concat(V?"bg-green-600 text-white":"bg-yellow-600 text-white"),children:(0,i.jsx)("div",{className:"flex items-center gap-2",children:V?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Live Tracking"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{className:"w-4 h-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"GPS Disabled"})]})})})}),"customer"===p&&n&&k&&(0,i.jsx)("div",{className:"absolute bottom-4 left-4 right-4 bg-white rounded-lg shadow-lg p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,i.jsx)(c.Z,{className:"w-6 h-6 text-green-600"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-semibold text-gray-900",children:k.name}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:k.vehicle}),(0,i.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,i.jsx)("span",{className:"text-yellow-400",children:"‚≠ê"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:k.rating})]})]})]}),(0,i.jsx)("button",{onClick:function(){return window.open("tel:".concat(k.phone))},className:"bg-green-600 text-white p-3 rounded-full hover:bg-green-700 transition-colors",children:(0,i.jsx)(h.Z,{className:"w-5 h-5"})})]})})]}):(0,i.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",style:{height:v},children:[(0,i.jsx)("div",{className:"text-yellow-600 mb-2",children:(0,i.jsx)(g.Z,{className:"w-8 h-8 mx-auto"})}),(0,i.jsx)("p",{className:"text-yellow-700 font-medium",children:"Location Data Missing"}),(0,i.jsxs)("p",{className:"text-yellow-600 text-sm mt-1",children:["Rider and/or customer location is not available yet.",(0,i.jsx)("br",{}),"Please ensure the rider app is sharing location and the order has a valid delivery address with coordinates."]})]})}}}]);