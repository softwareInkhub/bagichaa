(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9801],{3178:function(e,t,s){Promise.resolve().then(s.bind(s,2184))},2184:function(e,t,s){"use strict";s.r(t);var a=s(6687),n=s(5029),r=s(8965),i=s(4670),l=s(44),c=s(7437),o=s(2265),d=s(4033),u=s(7972),m=s(5883),x=s(4322),h=s(3008),g=s(4822),f=s(2245),p=s(2741),y=s(2682),v=s(286),b=s(4499),j=s(5853);t.default=function(){var e,t,s,N,w,_=(0,d.useRouter)(),k=(0,i._)((0,o.useState)(null),2),C=k[0],O=k[1],S=(0,i._)((0,o.useState)(null),2),T=S[0],R=S[1],D=(0,i._)((0,o.useState)([]),2),Z=D[0],P=D[1],A=(0,i._)((0,o.useState)(null),2),I=A[0],z=A[1],E=(0,i._)((0,o.useState)({totalDeliveries:0,completedToday:0,earnings:0,rating:5}),2),L=E[0];E[1];var G=(0,i._)((0,o.useState)(!1),2),J=G[0],U=G[1],q=(0,i._)((0,o.useState)(null),2),M=q[0],Y=q[1],H=(0,i._)((0,o.useState)(!0),2),W=H[0],B=H[1],F=(0,o.useRef)(null),K=(0,j.useToast)().showToast,Q=(0,o.useRef)(null);(0,o.useEffect)(function(){if(!(0,b.isRiderLoggedIn)()){_.push("/rider/auth/login");return}var e,t=(0,b.getCurrentRider)();return O(t),U((null==t?void 0:t.status)==="online"),(null==t?void 0:t.id)?e=(0,b.subscribeToRiderOrders)(t.id,function(e){var t=e.find(function(e){return["assigned","picked_up","out_for_delivery"].includes(e.status)}),s=e.filter(function(e){return!["assigned","picked_up","out_for_delivery"].includes(e.status)}).slice(0,10);R(t||null),P(s),t?(0,b.subscribeToOrderTracking)(t.id,function(e){z(e)}):z(null),B(!1)}):B(!1),function(){e&&e()}},[_]),(0,o.useEffect)(function(){return J?navigator.geolocation?(navigator.geolocation.getCurrentPosition(function(e){X({lat:e.coords.latitude,lng:e.coords.longitude})},function(e){alert("Location permission is required for delivery tracking. Please enable location services.")},{enableHighAccuracy:!0}),F.current=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){X({lat:e.coords.latitude,lng:e.coords.longitude})})},1e4)):alert("Geolocation is not supported by your browser."):F.current&&(clearInterval(F.current),F.current=null),function(){F.current&&(clearInterval(F.current),F.current=null)}},[J]),(0,o.useEffect)(function(){T&&T.status&&(Q.current&&Q.current!==T.status&&K("Order status updated: ".concat(T.status.replace("_"," ")),"info"),Q.current=T.status)},[null==T?void 0:T.status]);var V=(e=(0,a._)(function(){var e,t;return(0,l.Jh)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),e=J?"offline":"online",[4,(0,b.updateRiderStatus)(C.id,e)];case 1:return s.sent(),U(!J),O(t=(0,r._)((0,n._)({},C),{status:e})),localStorage.setItem("currentRider",JSON.stringify(t)),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})}),function(){return e.apply(this,arguments)}),X=(t=(0,a._)(function(e){return(0,l.Jh)(this,function(t){switch(t.label){case 0:if(Y(e),!(null==C?void 0:C.id))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(0,b.updateRiderLocation)(C.id,e)];case 2:case 3:return t.sent(),[3,4];case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),$=(s=(0,a._)(function(e){var t;return(0,l.Jh)(this,function(s){switch(s.label){case 0:if(!T||!(null==C?void 0:C.id))return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),t={location:M,note:"Order ".concat(e.replace("_"," ")," by rider")},"delivered"===e&&(t.deliveryProof={type:"photo",url:"placeholder-proof-url",timestamp:new Date}),[4,(0,b.updateOrderStatusWithRider)(T.id,e,t)];case 2:case 3:return s.sent(),[3,4];case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),ee=function(){var e;if(null==T?void 0:null===(e=T.address)||void 0===e?void 0:e.coordinates){var t=T.address.coordinates,s=t.lat,a=t.lng,n="https://www.google.com/maps/dir/?api=1&destination=".concat(s,",").concat(a,"&travelmode=driving");window.open(n,"_blank")}};return W?(0,c.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),(0,c.jsx)("p",{className:"text-gray-600",children:"Loading dashboard..."})]})}):(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,c.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,c.jsx)("div",{className:"max-w-md mx-auto px-4 py-4",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:(0,c.jsx)(u.Z,{className:"w-6 h-6 text-green-600"})}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"font-semibold text-gray-900",children:null==C?void 0:C.name}),(0,c.jsx)("p",{className:"text-sm text-gray-600",children:null==C?void 0:C.vehicle})]})]}),(0,c.jsx)("button",{onClick:function(){localStorage.removeItem("currentRider"),_.push("/rider/auth/login")},className:"p-2 text-gray-400 hover:text-gray-600",children:(0,c.jsx)(m.Z,{className:"w-5 h-5"})})]})})}),(0,c.jsxs)("div",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[(0,c.jsx)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[(0,c.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(J?"bg-green-500":"bg-gray-400")}),(0,c.jsx)("span",{className:"font-medium text-gray-900",children:J?"You are Online":"You are Offline"})]}),(0,c.jsx)("button",{onClick:V,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(J?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:J?"Go Offline":"Go Online"})]})}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,c.jsx)(x.Z,{className:"w-5 h-5 text-blue-600"}),(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Total Orders"})]}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:L.totalDeliveries})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,c.jsx)(h.Z,{className:"w-5 h-5 text-green-600"}),(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Today"})]}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:L.completedToday})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,c.jsx)(g.Z,{className:"w-5 h-5 text-purple-600"}),(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Earnings"})]}),(0,c.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["₹",L.earnings]})]}),(0,c.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,c.jsx)(f.Z,{className:"w-5 h-5 text-yellow-600"}),(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Rating"})]}),(0,c.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:L.rating})]})]}),T?(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,c.jsxs)("div",{className:"p-4 border-b",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,c.jsx)("h2",{className:"font-semibold text-gray-900",children:"Active Order"}),(0,c.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("assigned"===T.status?"bg-blue-100 text-blue-700":"picked_up"===T.status?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),children:T.status.replace("_"," ").toUpperCase()})]}),(0,c.jsxs)("p",{className:"text-sm text-gray-600",children:["#",T.orderNumber]})]}),(0,c.jsxs)("div",{className:"p-4 space-y-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"font-medium text-gray-900",children:T.customerName||"Customer"}),(0,c.jsx)("p",{className:"text-sm text-gray-600",children:(null===(N=T.address)||void 0===N?void 0:N.street)||"Address not available"}),(0,c.jsx)("p",{className:"text-sm text-gray-600",children:(null===(w=T.address)||void 0===w?void 0:w.city)||""})]}),(0,c.jsx)("button",{onClick:function(){return window.open("tel:".concat(T.customerPhone))},className:"p-2 bg-green-100 text-green-600 rounded-full hover:bg-green-200",children:(0,c.jsx)(p.Z,{className:"w-5 h-5"})})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Items (",T.items.length,")"]}),T.items.slice(0,3).map(function(e,t){var s=e.quantity||e.qty||1;return(0,c.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,c.jsxs)("span",{className:"text-gray-600",children:[s,"x ",e.name]}),(0,c.jsxs)("span",{className:"text-gray-900",children:["₹",e.price*s]})]},t)}),T.items.length>3&&(0,c.jsxs)("p",{className:"text-sm text-gray-500",children:["+",T.items.length-3," more items"]}),(0,c.jsxs)("div",{className:"border-t pt-2 flex justify-between font-medium",children:[(0,c.jsx)("span",{children:"Total Amount"}),(0,c.jsxs)("span",{children:["₹",T.totalAmount||T.total||0]})]})]}),I&&(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsx)("h3",{className:"font-medium text-gray-900",children:"Live Tracking"}),(0,c.jsx)(v.Z,{orderId:T.id,trackingData:I,mode:"rider",height:"200px",onLocationUpdate:X,onDirectionsClick:ee})]}),(0,c.jsxs)("div",{className:"space-y-2",children:["assigned"===T.status&&(0,c.jsx)("button",{onClick:function(){return $("picked_up")},className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700",children:"Mark as Picked Up"}),"picked_up"===T.status&&(0,c.jsx)("button",{onClick:function(){return $("out_for_delivery")},className:"w-full bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700",children:"Start Delivery"}),"out_for_delivery"===T.status&&(0,c.jsx)("button",{onClick:function(){return $("delivered")},className:"w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700",children:"Mark as Delivered"}),(0,c.jsxs)("button",{onClick:ee,className:"w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 flex items-center justify-center gap-2",children:[(0,c.jsx)(y.Z,{className:"w-5 h-5"}),"Open in Maps"]})]})]})]}):(0,c.jsxs)("div",{className:"bg-white rounded-lg p-8 text-center shadow-sm",children:[(0,c.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,c.jsx)(x.Z,{className:"w-8 h-8 text-gray-400"})}),(0,c.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No Active Orders"}),(0,c.jsx)("p",{className:"text-gray-600 text-sm",children:J?"You'll receive new orders when available":"Go online to start receiving orders"})]}),Z.length>0&&(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,c.jsx)("div",{className:"p-4 border-b",children:(0,c.jsx)("h2",{className:"font-semibold text-gray-900",children:"Recent Orders"})}),(0,c.jsx)("div",{className:"divide-y",children:Z.map(function(e){return(0,c.jsxs)("div",{className:"p-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,c.jsxs)("span",{className:"font-medium text-gray-900",children:["#",e.orderNumber]}),(0,c.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("delivered"===e.status?"bg-green-100 text-green-700":"cancelled"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:e.status.toUpperCase()})]}),(0,c.jsx)("p",{className:"text-sm text-gray-600",children:e.customerName}),(0,c.jsxs)("p",{className:"text-sm text-gray-600",children:["₹",e.totalAmount]}),(0,c.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()})]},e.id)})})]})]})]})}},5853:function(e,t,s){"use strict";s.r(t),s.d(t,{ToastProvider:function(){return u},useToast:function(){return d}});var a=s(4670),n=s(1801),r=s(7437),i=s(9102),l=s.n(i),c=s(2265),o=(0,c.createContext)({showToast:function(){}}),d=function(){return(0,c.useContext)(o)},u=function(e){var t=e.children,s=(0,a._)((0,c.useState)([]),2),i=s[0],d=s[1];return(0,r.jsxs)(o.Provider,{value:{showToast:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=Date.now();d(function(a){return(0,n._)(a).concat([{id:s,message:e,type:t}])}),setTimeout(function(){d(function(e){return e.filter(function(e){return e.id!==s})})},3500)}},children:[t,(0,r.jsx)("div",{className:"jsx-8325a2722a98286e fixed top-4 right-4 z-50 space-y-2",children:i.map(function(e){return(0,r.jsx)("div",{className:"jsx-8325a2722a98286e "+"px-4 py-3 rounded-lg shadow-lg text-white font-medium transition-all animate-fade-in-down\n              ".concat("success"===e.type?"bg-green-600":"error"===e.type?"bg-red-600":"bg-gray-800"),children:e.message},e.id)})}),(0,r.jsx)(l(),{id:"8325a2722a98286e",children:"@-webkit-keyframes fade-in-down{0%{opacity:0;-webkit-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fade-in-down{0%{opacity:0;-moz-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fade-in-down{0%{opacity:0;-o-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fade-in-down{0%{opacity:0;-webkit-transform:translatey(-20px);-moz-transform:translatey(-20px);-o-transform:translatey(-20px);transform:translatey(-20px)}100%{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-fade-in-down{-webkit-animation:fade-in-down.4s ease;-moz-animation:fade-in-down.4s ease;-o-animation:fade-in-down.4s ease;animation:fade-in-down.4s ease}"})]})}}},function(e){e.O(0,[4358,9990,5643,6569,112,4499,286,2971,4938,1744],function(){return e(e.s=3178)}),_N_E=e.O()}]);