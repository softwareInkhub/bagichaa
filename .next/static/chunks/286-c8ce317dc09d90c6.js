"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{286:function(e,t,n){var r=n(4670),s=n(7437),a=n(2265),i=n(4322),l=n(1961),o=n(2682),c=n(3008),d=n(6141),u=n(6142),m=n(6264),g=n(2741),h=n(9235);t.Z=function(e){e.orderId;var t=e.trackingData,n=e.mode,x=e.height,f=void 0===x?"400px":x,p=e.showControls,w=e.showRoute,v=void 0===w||w,b=e.onLocationUpdate,j=e.onDirectionsClick,y=e.riderInfo,N=(0,a.useRef)(null),k=(0,a.useRef)(null),L=(0,a.useRef)(null),C=(0,a.useRef)(null),M=(0,a.useRef)(null),Z=(0,a.useRef)(null),_=(0,a.useRef)(null),D=(0,r._)((0,a.useState)(!0),2),E=D[0],R=D[1],A=(0,r._)((0,a.useState)(null),2),S=A[0],T=A[1],z=(0,r._)((0,a.useState)(null),2),I=(z[0],z[1]),B=(0,r._)((0,a.useState)(!1),2),F=B[0],O=B[1],P=(0,a.useCallback)(function(){if(!N.current||!window.google){T("Map container not available");return}try{k.current=new window.google.maps.Map(N.current,{zoom:14,center:{lat:28.6139,lng:77.209},mapTypeControl:!1,streetViewControl:!1,fullscreenControl:"admin"===n,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),M.current=new window.google.maps.DirectionsService,Z.current=new window.google.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:"#10B981",strokeWeight:4,strokeOpacity:.8}}),Z.current.setMap(k.current),R(!1),"rider"===n&&H(),t&&U(t)}catch(e){T("Failed to initialize map"),R(!1)}},[n,t]),W=(0,a.useCallback)(function(){new h.aN({apiKey:"AIzaSyDIHawXZZfiYMhBUznsnbXS0LOId9u5FLA",version:"weekly",libraries:["geometry","places","marker"]}).load().then(function(){P()}).catch(function(){return T("Failed to load Google Maps")})},[P]),H=(0,a.useCallback)(function(){navigator.geolocation&&(O(!0),_.current=navigator.geolocation.watchPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};I(t),b&&b(t),L.current?L.current.setPosition(t):V(t),k.current&&k.current.setCenter(t)},function(e){O(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4}))},[b]);(0,a.useCallback)(function(){_.current&&(navigator.geolocation.clearWatch(_.current),_.current=null),O(!1)},[]);var V=(0,a.useCallback)(function(e){if(k.current&&window.google&&e){L.current&&(L.current.map=null);var t,r=window.google.maps.marker.AdvancedMarkerElement;if(L.current=new r({map:k.current,position:e,title:"Delivery Partner",content:((t=document.createElement("div")).innerHTML='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="14" fill="#10B981" stroke="#ffffff" stroke-width="3"/><path d="M10 16L14 20L22 12" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',t)}),y&&"rider"!==n){var s=new window.google.maps.InfoWindow({content:'\n          <div class="p-3 min-w-[200px]">\n            <div class="flex items-center gap-3 mb-2">\n              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">\n                <svg width="20" height="20" fill="currentColor" class="text-green-600">\n                  <path d="M8 16l2.879-2.879a3 3 0 114.242 4.242L8 24l-7.121-7.121a3 3 0 114.242-4.242L8 16z"/>\n                </svg>\n              </div>\n              <div>\n                <h4 class="font-semibold text-gray-900">'.concat(y.name,'</h4>\n                <p class="text-sm text-gray-600">').concat(y.vehicle,'</p>\n              </div>\n            </div>\n            <div class="flex items-center justify-between">\n              <div class="flex items-center gap-1">\n                <span class="text-yellow-400">⭐</span>\n                <span class="text-sm font-medium">').concat(y.rating,"</span>\n              </div>\n              <button onclick=\"window.open('tel:").concat(y.phone,'\')" \n                class="bg-green-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1">\n                <svg width="14" height="14" fill="currentColor">\n                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>\n                </svg>\n                Call\n              </button>\n            </div>\n          </div>\n        ')});L.current.addListener("click",function(){s.open(k.current,L.current)})}}},[y,n]),G=(0,a.useCallback)(function(e){if(k.current&&window.google&&e){C.current&&(C.current.map=null);var t,n=window.google.maps.marker.AdvancedMarkerElement;C.current=new n({map:k.current,position:e,title:"Delivery Address",content:((t=document.createElement("div")).innerHTML='<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="16" cy="16" r="14" fill="#EF4444" stroke="#ffffff" stroke-width="3"/><path d="M16 8v8l4 4" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',t)})}},[]),K=(0,a.useCallback)(function(e,t){M.current&&Z.current&&e&&t&&M.current.route({origin:e,destination:t,travelMode:window.google.maps.TravelMode.DRIVING,optimizeWaypoints:!0},function(e,t){"OK"===t&&Z.current.setDirections(e)})},[]),U=(0,a.useCallback)(function(e){if(k.current&&(e.riderLocation&&V(e.riderLocation),e.customerLocation&&G(e.customerLocation),e.riderLocation&&e.customerLocation&&v&&K(e.riderLocation,e.customerLocation),e.riderLocation||e.customerLocation)){var t=new window.google.maps.LatLngBounds;e.riderLocation&&t.extend(e.riderLocation),e.customerLocation&&t.extend(e.customerLocation),k.current.fitBounds(t),window.google.maps.event.addListenerOnce(k.current,"bounds_changed",function(){k.current.getZoom()>16&&k.current.setZoom(16)})}},[v,V,G,K]);return((0,a.useEffect)(function(){return W(),function(){_.current&&navigator.geolocation.clearWatch(_.current)}},[W]),(0,a.useEffect)(function(){t&&k.current&&U(t)},[t,U]),S)?(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8 text-center",style:{height:f},children:[(0,s.jsx)("div",{className:"text-red-600 mb-2",children:(0,s.jsx)(u.Z,{className:"w-8 h-8 mx-auto"})}),(0,s.jsx)("p",{className:"text-red-700 font-medium",children:"Map Error"}),(0,s.jsx)("p",{className:"text-red-600 text-sm mt-1",children:S})]}):t&&(t.riderLocation||t.customerLocation)?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{ref:N,className:"w-full rounded-lg border border-gray-200",style:{height:f}}),E&&(0,s.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(m.Z,{className:"w-8 h-8 animate-spin text-green-600 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading map..."})]})}),(void 0===p||p)&&t&&(0,s.jsx)("div",{className:"absolute top-4 left-4 right-4 bg-white rounded-lg shadow-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-full ".concat(function(e){switch(e){case"assigned":return"text-blue-600 bg-blue-100";case"picked_up":return"text-orange-600 bg-orange-100";case"out_for_delivery":return"text-green-600 bg-green-100";case"delivered":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}}(t.status)),children:function(e){switch(e){case"assigned":return(0,s.jsx)(i.Z,{className:"w-4 h-4"});case"picked_up":return(0,s.jsx)(l.Z,{className:"w-4 h-4"});case"out_for_delivery":return(0,s.jsx)(o.Z,{className:"w-4 h-4"});case"delivered":return(0,s.jsx)(c.Z,{className:"w-4 h-4"});default:return(0,s.jsx)(d.Z,{className:"w-4 h-4"})}}(t.status)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900 capitalize",children:t.status.replace("_"," ")}),t.estimatedArrival&&(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["ETA: ",new Date(t.estimatedArrival).toLocaleTimeString()]})]})]}),"rider"===n&&j&&(0,s.jsxs)("button",{onClick:j,className:"bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition-colors",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4"}),"Directions"]})]})}),"rider"===n&&(0,s.jsx)("div",{className:"absolute bottom-4 left-4",children:(0,s.jsx)("div",{className:"px-3 py-2 rounded-lg shadow-lg ".concat(F?"bg-green-600 text-white":"bg-yellow-600 text-white"),children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:F?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Live Tracking"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"GPS Disabled"})]})})})}),"customer"===n&&t&&y&&(0,s.jsx)("div",{className:"absolute bottom-4 left-4 right-4 bg-white rounded-lg shadow-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(l.Z,{className:"w-6 h-6 text-green-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:y.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:y.vehicle}),(0,s.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,s.jsx)("span",{className:"text-yellow-400",children:"⭐"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:y.rating})]})]})]}),(0,s.jsx)("button",{onClick:function(){return window.open("tel:".concat(y.phone))},className:"bg-green-600 text-white p-3 rounded-full hover:bg-green-700 transition-colors",children:(0,s.jsx)(g.Z,{className:"w-5 h-5"})})]})})]}):(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-8 text-center",style:{height:f},children:[(0,s.jsx)("div",{className:"text-yellow-600 mb-2",children:(0,s.jsx)(u.Z,{className:"w-8 h-8 mx-auto"})}),(0,s.jsx)("p",{className:"text-yellow-700 font-medium",children:"Location Data Missing"}),(0,s.jsxs)("p",{className:"text-yellow-600 text-sm mt-1",children:["Rider and/or customer location is not available yet.",(0,s.jsx)("br",{}),"Please ensure the rider app is sharing location and the order has a valid delivery address with coordinates."]})]})}}}]);